
<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://www.EWhisper.cn/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://www.EWhisper.cn/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://www.EWhisper.cn/theme/font-awesome/css/font-awesome.min.css">

    <link href="https://www.EWhisper.cn/static/custom.css" rel="stylesheet">


    <link href="https://www.EWhisper.cn/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="ä¸œé£å¾®é¸£ Blog RSS">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">


    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">

<meta name="author" content="ä¸œé£å¾®é¸£" />
<meta name="description" content="OpenShiftç”¨èµ·æ¥æŒºçˆ½çš„. å®æˆ˜2å°æ—¶å°±æŠŠç¦…é“å¼€æºç‰ˆéƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ, æ— éœ€ç”³è¯·ä¸»æœºã€å­˜å‚¨ã€æ•°æ®åº“ã€ä¸­é—´ä»¶å’ŒåŸŸåã€‚éƒ¨ç½²å¥½äº†ç›´æ¥åŸŸåè®¿é—®ã€‚" />
<meta name="keywords" content="openshift, docker">

<meta property="og:site_name" content="ä¸œé£å¾®é¸£ Blog"/>
<meta property="og:title" content="OpenShiftä¼ä¸šæµ‹è¯•ç¯å¢ƒåº”ç”¨éƒ¨ç½²å®æˆ˜"/>
<meta property="og:description" content="OpenShiftç”¨èµ·æ¥æŒºçˆ½çš„. å®æˆ˜2å°æ—¶å°±æŠŠç¦…é“å¼€æºç‰ˆéƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ, æ— éœ€ç”³è¯·ä¸»æœºã€å­˜å‚¨ã€æ•°æ®åº“ã€ä¸­é—´ä»¶å’ŒåŸŸåã€‚éƒ¨ç½²å¥½äº†ç›´æ¥åŸŸåè®¿é—®ã€‚"/>
<meta property="og:locale" content="zh_CN"/>
<meta property="og:url" content="https://www.EWhisper.cn/deploy-app-with-openshift-in-enterprise-env.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-05-20 00:04:46.077394+08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://www.EWhisper.cn/author/dong-feng-wei-ming.html">
<meta property="article:section" content="DevOps"/>
<meta property="article:tag" content="openshift"/>
<meta property="article:tag" content="docker"/>
<meta property="og:image" content="//s.gravatar.com/avatar/7c743bc6ac83171e35a5aa8bd66cc1ea?s=120">

  <title>ä¸œé£å¾®é¸£ Blog &ndash; OpenShiftä¼ä¸šæµ‹è¯•ç¯å¢ƒåº”ç”¨éƒ¨ç½²å®æˆ˜</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://www.EWhisper.cn">
        <img src="//s.gravatar.com/avatar/7c743bc6ac83171e35a5aa8bd66cc1ea?s=120" alt="ä¸œé£å¾®é¸£" title="ä¸œé£å¾®é¸£">
      </a>
      <h1><a href="https://www.EWhisper.cn">ä¸œé£å¾®é¸£</a></h1>

<p>Focus on Python/Java/DevOps/Observability</p>
      <nav>
        <ul class="list">
          <li><a href="https://www.EWhisper.cn/pages/about.html#about">About</a></li>
          <li><a href="https://www.EWhisper.cn/pages/contact.html#contact">Contact</a></li>

          <li><a href="http://www.miitbeian.gov.cn/" target="_blank">æ²ªICPå¤‡19007314å·-1</a></li>
        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-wechat" href="/images/wechat_paycode.png" target="_blank"><i class="fa fa-wechat"></i></a></li>
        <li><a class="sc-envelope-o" href="mailto:cuikaidong@foxmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-reddit" href="https://www.jianshu.com/u/0f08daeaa5a9" target="_blank"><i class="fa fa-reddit"></i></a></li>
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/å‡¯ä¸œ-å´”-136128116/" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-weibo" href="https://weibo.com/long5to2gf" target="_blank"><i class="fa fa-weibo"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://www.EWhisper.cn">ä¸»é¡µ</a>

      <a href="/archives/index.html">å­˜æ¡£</a>
      <a href="/categories.html">ç±»åˆ«</a>
      <a href="/tags.html">æ ‡ç­¾</a>
      <a href="/authors.html">ä½œè€…</a>


      <a href="https://www.EWhisper.cn/feeds/all.rss.xml">RSSè®¢é˜…</a>
    </nav>

<article class="single">
  <header>
    <h1 id="deploy-app-with-openshift-in-enterprise-env">OpenShiftä¼ä¸šæµ‹è¯•ç¯å¢ƒåº”ç”¨éƒ¨ç½²å®æˆ˜</h1>
    <p>
      åœ¨ 2019-05-20 Monday å‘å¸ƒäº <a href="https://www.EWhisper.cn/category/devops.html">DevOps</a> åˆ†ç±»

        &#8226; 4 min read
    </p>
  </header>


  <div>
    <div class="toc">
<ul>
<li><a href="#_1">æ€»è§ˆ</a><ul>
<li><a href="#_2">ç¦…é“ç®€ä»‹</a></li>
</ul>
</li>
<li><a href="#_3">å®æˆ˜æ­¥éª¤</a><ul>
<li><a href="#_4">æ¦‚è¿°</a></li>
<li><a href="#_5">å…·ä½“æ­¥éª¤</a></li>
</ul>
</li>
<li><a href="#_6">æ€»ç»“</a></li>
</ul>
</div>
<h2 id="_1">æ€»è§ˆ<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>ä»Šå¤©é¢†å¯¼äº¤ç»™æˆ‘ä¸ªå°ä»»åŠ¡ - æŠŠé¡¹ç›®ç®¡ç†è½¯ä»¶<a href="https://www.zentao.net/download/80137.html">"ç¦…é“"</a>å¼€æºç‰ˆ éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ. å¤§æ¦‚ç ”ç©¶äº†ä¸‹ç¦…é“å¼€æºç‰ˆçš„å®˜æ–¹æ–‡æ¡£, å†³å®šé€šè¿‡Dockerå®¹å™¨çš„æ–¹å¼æŠŠå®ƒéƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ. </p>
<p>é™¤å»ç ”ç©¶çš„æ—¶é—´, å®é™…ä¸Š2å°æ—¶å°±æŠŠç¦…é“å¼€æºç‰ˆéƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ, æ— éœ€ç”³è¯·ä¸»æœºã€å­˜å‚¨ã€æ•°æ®åº“ã€ä¸­é—´ä»¶å’ŒåŸŸåã€‚çœŸæ˜¯ä¸èˆ¬é¡ºæ»‘, æŒºèˆ’æœçš„.</p>
<h3 id="_2">ç¦…é“ç®€ä»‹<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p><strong>ç¦…é“<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup>æ˜¯ä¸“ä¸šçš„ç ”å‘é¡¹ç›®ç®¡ç†è½¯ä»¶</strong></p>
<ul>
<li>ç»†åˆ†éœ€æ±‚ã€ä»»åŠ¡ã€ç¼ºé™·å’Œç”¨ä¾‹</li>
<li>å®Œæ•´è¦†ç›–ç ”å‘é¡¹ç›®æ ¸å¿ƒæµç¨‹</li>
<li>å®Œæ•´è½¯ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†</li>
</ul>
<h2 id="_3">å®æˆ˜æ­¥éª¤<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">æ¦‚è¿°<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>ç®€å•å½’çº³èµ·æ¥, å°±ä»¥ä¸‹å‡ æ­¥:</p>
<ol>
<li>æ„å»º"ç¦…é“"å¼€æºç‰ˆçš„Docker é•œåƒ</li>
<li>åœ¨OpenShiftä¸Š, åˆ›å»º"ç¦…é“"é¡¹ç›®, å¹¶é€šè¿‡Docker é•œåƒåˆ›å»º"ç¦…é“"åº”ç”¨.</li>
<li>å°†"ç¦…é“"åº”ç”¨é€šè¿‡åŸŸåå‘å¸ƒåˆ°ä¼ä¸šå†…ç½‘.</li>
</ol>
<p>å½“ç„¶, ç”±äºOpenShiftçš„å®‰å…¨å¢å¼º, ä»¥åŠä¼ä¸šæµ‹è¯•ç¯å¢ƒçš„éƒ¨åˆ†å®‰å…¨é™åˆ¶ä»¥åŠå…¶ä»–å®¢è§‚æ¡ä»¶, å®é™…ä¸Šæ‰§è¡Œèµ·æ¥éœ€è¦çš„æ­¥éª¤æ›´å¤š:</p>
<ol>
<li>æ„å»º"ç¦…é“"å¼€æºç‰ˆçš„Docker é•œåƒ<ol>
<li>åœ¨äº‘ä¸»æœºä¸Š, é€šè¿‡Dockerfile æ„å»ºDockeré•œåƒ. å¹¶å¯¼å‡º</li>
<li>åœ¨ä¼ä¸šOpenShift æµ‹è¯•ç¯å¢ƒä¸Š, ä¸Šä¼ å¹¶å¯¼å…¥Docker é•œåƒ</li>
</ol>
</li>
<li>åœ¨OpenShiftä¸Š, åˆ›å»º"ç¦…é“"é¡¹ç›®, å¹¶é€šè¿‡Docker é•œåƒåˆ›å»º"ç¦…é“"åº”ç”¨.<ol>
<li>åˆ›å»º"ç¦…é“" - <strong>zentao</strong> é¡¹ç›®<ol>
<li>(å¯é€‰) æŒ‡å®šè¯¥é¡¹ç›®åªèƒ½è¢«è°ƒåº¦åˆ°ç‰¹å®šä¸»æœºä¸Š;</li>
</ol>
</li>
<li>(å¯é€‰) åˆ›å»ºOpenShift useroot æœåŠ¡è´¦æˆ· </li>
<li>åˆ›å»º"ç¦…é“" app åº”ç”¨</li>
<li>æŒä¹…åŒ–"ç¦…é“"åº”ç”¨å’Œæ•°æ®åº“æ•°æ®.</li>
</ol>
</li>
<li>å°†"ç¦…é“"åº”ç”¨é€šè¿‡åŸŸåå‘å¸ƒåˆ°ä¼ä¸šå†…ç½‘.<ol>
<li>åˆ›å»º"ç¦…é“" æœåŠ¡(service)</li>
<li>åˆ›å»º"ç¦…é“" è·¯ç”±(route)</li>
<li>æ·»åŠ DNSè®°å½•.</li>
</ol>
</li>
</ol>
<h3 id="_5">å…·ä½“æ­¥éª¤<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<h4>1-1 Dockerfile æ„å»ºé•œåƒå¹¶å¯¼å‡º</h4>
<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"> è¯´æ˜:</p>
<p>æˆ‘æ˜¯åœ¨æˆ‘çš„äº‘ä¸»æœºä¸Šæ„å»ºçš„. </p>
<p>ä¹‹æ‰€ä»¥é€‰æ‹©äº‘ä¸»æœº, åŸå› æœ‰2:</p>
<ol>
<li>æœ‰ç½‘, æœ‰Dockeré•œåƒä¸‹è½½åŠ é€Ÿ;</li>
<li>å·²å®‰è£… Docker ç»„ä»¶å’ŒæœåŠ¡</li>
</ol>
</blockquote>
<ol>
<li>åˆ›å»º <code>Dockerfile</code> (å¯ä»¥ç›´æ¥é€šè¿‡<a href="http://dl.cnezsoft.com/zentao/docker/docker_zentao.zip">å®˜ç½‘ä¸‹è½½è¿æ¥</a>ä¸‹è½½),</li>
</ol>
<div class="highlight"><pre><span></span><span class="k">FROM</span><span class="s"> ubuntu:16.04</span>
<span class="k">MAINTAINER</span><span class="s"> yidong &lt;yidong@cnezsoft.com&gt;</span>

<span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y apache2 mariadb-server php php-curl php-gd php-ldap php-mbstring php-mcrypt php-mysql php-xml php-zip php-cli php-json curl unzip libapache2-mod-php locales

<span class="k">ENV</span> <span class="nv">LANG</span><span class="o">=</span><span class="s2">&quot;en_US.UTF8&quot;</span>
<span class="k">ENV</span> <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span><span class="s2">&quot;123456&quot;</span>
<span class="k">RUN</span> <span class="nb">echo</span> -e <span class="s2">&quot;LANG=\&quot;en_US.UTF-8\&quot;\nLANGUAGE=\&quot;en_US:en\&quot;&quot;</span> &gt; /etc/default/locale <span class="o">&amp;&amp;</span> locale-gen en_US.UTF-8

<span class="k">RUN</span> mkdir -p /app/zentaopms
<span class="k">COPY</span> docker-entrypoint.sh /app
<span class="k">RUN</span> <span class="nv">random</span><span class="o">=</span><span class="sb">`</span>date +%s<span class="sb">`</span><span class="p">;</span> curl http://cdn.zentaopm.com/latest/zentao.zip?rand<span class="o">=</span><span class="nv">$random</span> -o /var/www/zentao.zip
<span class="k">RUN</span> <span class="nb">cd</span> /var/www/ <span class="o">&amp;&amp;</span> unzip -q zentao.zip <span class="o">&amp;&amp;</span> rm zentao.zip
<span class="k">RUN</span> a2enmod rewrite

<span class="k">RUN</span> rm -rf /etc/apache2/sites-enabled/000-default.conf /var/lib/mysql/*
<span class="k">RUN</span> sed -i <span class="s1">&#39;1i ServerName 127.0.0.1&#39;</span> /etc/apache2/apache2.conf
<span class="k">COPY</span> config/apache.conf /etc/apache2/sites-enabled/000-default.conf
<span class="k">COPY</span> config/ioncube_loader_lin_7.0.so /usr/lib/php/20151012/ioncube_loader_lin_7.0.so
<span class="k">COPY</span> config/00-ioncube.ini /etc/php/7.0/apache2/conf.d/
<span class="k">COPY</span> config/00-ioncube.ini /etc/php/7.0/cli/conf.d/

<span class="k">VOLUME</span><span class="s"> /app/zentaopms /var/lib/mysql</span>
<span class="k">ENTRYPOINT</span> <span class="p">[</span><span class="s2">&quot;/app/docker-entrypoint.sh&quot;</span><span class="p">]</span>
</pre></div>


<ol start="2">
<li>æ­¤æ—¶, è¯¥é¡¹ç›®ç›®å½•åŒ…å«ä»¥ä¸‹å†…å®¹:</li>
</ol>
<div class="highlight"><pre><span></span>$ tree docker_zentao
docker_zentao
<span class="p">|</span>-- config
<span class="p">|</span>   <span class="p">|</span>-- <span class="m">00</span>-ioncube.ini
<span class="p">|</span>   <span class="p">|</span>-- apache.conf
<span class="p">|</span>   <span class="sb">`</span>-- ioncube_loader_lin_7.0.so
<span class="p">|</span>-- docker-entrypoint.sh
<span class="p">|</span>-- Dockerfile
<span class="p">|</span>-- docker_zentao.tar.gz
<span class="sb">`</span>-- README.md

<span class="m">1</span> directory, <span class="m">7</span> files
</pre></div>


<ol start="3">
<li>ä½¿ç”¨<code>Dockerfile</code> æ„å»ºdocker é•œåƒ:</li>
</ol>
<div class="highlight"><pre><span></span><span class="nb">cd</span> docker_zentao
docker build -t zentao .
</pre></div>


<ol start="4">
<li>(å¯é€‰) å¯ä»¥è¿è¡Œä¸€ä¸‹ä»¥æµ‹è¯•æ„å»ºçš„é•œåƒæ˜¯å¦å¯ä»¥æ­£å¸¸è¿è¡Œ:</li>
</ol>
<div class="highlight"><pre><span></span>docker run --name zentao-test -p <span class="m">8000</span>:80 -e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span><span class="m">123456</span> -d zentao  <span class="c1"># åå°è¿è¡Œè¯¥dockerå®¹å™¨</span>
docker ps  <span class="c1"># æŸ¥çœ‹å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ, æœ‰æ— crash</span>
docker stop zentao-test  <span class="c1"># æµ‹è¯•å®Œæ¯•, åœæ­¢è¯¥å®¹å™¨</span>
</pre></div>


<ol start="5">
<li>å°†é•œåƒå¯¼å‡ºä¸ºtaråŒ….</li>
</ol>
<div class="highlight"><pre><span></span>docker save -o docker_zentao.tar zentao
</pre></div>


<h4>1-2 ä¸Šä¼ å¹¶å¯¼å…¥docker é•œåƒ</h4>
<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"> è¯´æ˜:</p>
<p>ä¸ºä»€ä¹ˆè¦é€šè¿‡taråŒ…å¯¼å…¥é•œåƒ?</p>
<p>å› ä¸ºä¼ä¸šçš„OpenShiftæµ‹è¯•ç¯å¢ƒä¸é€šå¤–ç½‘, ä½†æ˜¯æœ‰ä¸ªæµ‹è¯•å†…ç½‘çš„é•œåƒä»“åº“.</p>
</blockquote>
<ol>
<li>æŠŠé•œåƒtaråŒ…, ä¸Šä¼ åˆ°å¯ä»¥è¿æ¥åˆ°OpenShiftä¼ä¸šæµ‹è¯•ç¯å¢ƒçš„ä»»æ„èŠ‚ç‚¹(æœ¬ä¾‹å­é€šè¿‡sftpä¸Šä¼ )</li>
<li>å¯¼å…¥åˆ°ä¼ä¸šæµ‹è¯•ç¯å¢ƒçš„é•œåƒä»“åº“:</li>
</ol>
<div class="highlight"><pre><span></span>docker load -i docker_zentao.tar
docker push txocp-registry.example.com/ewhisper/zentao
</pre></div>


<h4>2-1 åˆ›å»º"ç¦…é“" - <strong>zentao</strong> é¡¹ç›®</h4>
<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"> è¯´æ˜1:</p>
<p>"é¡¹ç›®"(project) æ˜¯OpenShiftä¸­çš„æ¦‚å¿µ, projectå¯ä»¥ç†è§£ä¸ºå¯¹åº”K8Sçš„<code>namespace</code>. é€šè¿‡è¿™ä¸ªå®ç°äº†å¤šç§Ÿæˆ·çš„éš”ç¦».</p>
<p>æ‰€ä»¥æ¯å¯åŠ¨ä¸€ä¸ªæ–°é¡¹ç›®, å°±åº”è¯¥åœ¨OpenShiftä¸Šåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„é¡¹ç›®.</p>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"> è¯´æ˜2:</p>
<p>(å¯é€‰) æŒ‡å®šè¯¥é¡¹ç›®åªèƒ½è¢«è°ƒåº¦åˆ°ç‰¹å®šä¸»æœºä¸Š;</p>
<p>ç”±äºæ˜¯æµ‹è¯•ç¯å¢ƒ, ä¸ºäº†æ–¹ä¾¿é…ç½®, ä¼šé€šè¿‡<code>HostPath</code> (å°±æ˜¯æŠŠæ–‡ä»¶æŒä¹…åŒ–åˆ°æœ¬æœºçš„æœ¬åœ°ç£ç›˜)æ¥å®ç°æŒä¹…åŒ–. é‚£ä¹ˆå°±è¦ä¿è¯"ç¦…é“"(zentao)è¿™ä¸ªé¡¹ç›®çš„å®¹å™¨éƒ½è¦è°ƒåº¦åˆ°ä¸€å°æŒ‡å®šçš„node(èŠ‚ç‚¹)æœåŠ¡å™¨. æ‰€ä»¥è¦é€šè¿‡ä¸‹æ–‡çš„<code>node-selector</code>æ¥å®ç°è¯¥åŠŸèƒ½.</p>
</blockquote>
<div class="highlight"><pre><span></span>oc adm new-project zentao <span class="se">\</span>
    --node-selector<span class="o">=</span><span class="s1">&#39;kubernetes.io/hostname=txocp.node02.example.com&#39;</span>
</pre></div>


<p>åœ¨ä¸Šè¾¹çš„å‘½ä»¤ä¸­, <code>oc adm new-project zentao</code> å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›® - zentao.</p>
<p><code>--node-selector</code> å°±æ˜¯é€šè¿‡<code>node-selector</code> åè¾¹çš„æ¡ä»¶æ¥æŒ‡å®šè¯¥é¡¹ç›®å¦‚ä½•è°ƒåº¦.(åº”ç”¨åœºæ™¯æ˜¯: è°ƒåº¦åˆ°é«˜IOèŠ‚ç‚¹, æˆ–è€…è°ƒåº¦åˆ°ä¸Šæµ·åŒºåŸŸ...)</p>
<p><code>kubernetes.io/hostname=txocp.node02.example.com</code> å‰è¾¹çš„<code>xxxhostname</code>æ˜¯æ¡ä»¶, å³æ ¹æ®hostname è°ƒåº¦, åè¾¹çš„æ˜¯åˆ¤å®š. æ€»çš„æ¥è¯´, å³è¯¥é¡¹ç›®è¦è¢«è°ƒåº¦åˆ°:hostnameä¸º<code>txocp.node02.example.com</code>çš„èŠ‚ç‚¹. (è¯¥èŠ‚ç‚¹è‚¯å®šåªæœ‰ä¸€ä¸ª). </p>
<h5>2-1-1 åˆ›å»ºOpenShift useroot æœåŠ¡è´¦æˆ·</h5>
<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"> è¯´æ˜:</p>
<p>ä¹‹æ‰€ä»¥åˆ›å»ºOpenShift æœåŠ¡è´¦æˆ·, æ˜¯å› ä¸º OpenShift ä½œä¸ºä¼ä¸šçº§å®¹å™¨å¹³å°, è¿›è¡Œäº†å®‰å…¨åŠ å›º,  é»˜è®¤ä¸å…è®¸å®¹å™¨ä»¥<strong>root</strong> ç”¨æˆ·å¯åŠ¨å’Œè¿è¡Œ. æ‰€ä»¥è¦é€šè¿‡åˆ›å»ºä¸€ä¸ªæœåŠ¡è´¦æˆ· <code>useroot</code>, ä¸ºæ­¤è´¦æˆ·æ·»åŠ "å…è®¸å®¹å™¨ä»¥rootå¯åŠ¨å’Œè¿è¡Œçš„"çš„æƒé™, å¹¶åº”ç”¨åˆ°"zentao" é¡¹ç›®. ä»¥æ­¤æ¥ä½¿å¾—å®¹å™¨å¯ä»¥æ­£å¸¸å¯åŠ¨.</p>
</blockquote>
<ol>
<li>åœ¨zentaoé¡¹ç›®ä¸­, åˆ›å»º æœåŠ¡è´¦æˆ·(serviceaccount) - useroot</li>
</ol>
<div class="highlight"><pre><span></span>oc create serviceaccount useroot
</pre></div>


<ol start="2">
<li>ä½¿ç”¨OpenShifté›†ç¾¤ç®¡ç†å‘˜ç”¨æˆ·, ä¸º<code>useroot</code>èµ‹äºˆ<code>anyuid</code>çš„æƒé™:</li>
</ol>
<div class="highlight"><pre><span></span>oc adm policy add-scc-to-user anyuid -z useroot
</pre></div>


<ol start="3">
<li>(å¯é€‰) å¦‚æœå·²ç»å¯åŠ¨è¿‡åº”ç”¨, åˆ™é€šè¿‡<code>oc patch</code>æ¥æ›´æ–°åº”ç”¨çš„dc (éƒ¨ç½²é…ç½®)å†…å®¹:</li>
</ol>
<div class="highlight"><pre><span></span>oc patch dc/zentao --patch <span class="s1">&#39;{&quot;spec&quot;:{&quot;template&quot;:{&quot;spec&quot;:{&quot;serviceAccountName&quot;: &quot;useroot&quot;}}}&#39;</span>
</pre></div>


<ol start="4">
<li>æ­¤å, å®¹å™¨å†…å°±å¯ä»¥é€šè¿‡rootè¿è¡Œ.</li>
</ol>
<h4>2-2 åˆ›å»º"ç¦…é“" - zentao åº”ç”¨</h4>
<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"> è¯´æ˜:</p>
<p>ä¸€ä¸ª<strong>é¡¹ç›®</strong> ä¸­, å¯ä»¥åŒ…æ‹¬å¤šä¸ªåº”ç”¨, æ¯”å¦‚: ç¦…é“web server, ç¦…é“app server, ç¦…é“ç¼“å­˜æœåŠ¡å™¨, ç¦…é“æ•°æ®åº“...</p>
<p>æœ¬æ¬¡ä¸ºæµ‹è¯•ç¯å¢ƒ, ç¦…é“çš„æ‰€æœ‰ç»„ä»¶ç»Ÿç»Ÿæ‰“è¿›ä¸€ä¸ªdockeré•œåƒé‡Œäº†, æ‰€ä»¥å°±åªæœ‰ä¸€ä¸ªåº”ç”¨ - zentao. é‡Œè¾¹å…¶å®å°±åŒ…æ‹¬äº†ç¦…é“çš„: web server, app serverå’Œdb.</p>
</blockquote>
<div class="highlight"><pre><span></span>oc new-app --name<span class="o">=</span>zentao <span class="se">\</span>
--docker-image<span class="o">=</span>txocp-registry.example.com/ewhisper/zentao <span class="se">\</span>
-e <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span><span class="m">123456</span> <span class="se">\</span>
--insecure-registry<span class="o">=</span><span class="nb">true</span>
</pre></div>


<p>ä¸Šè¾¹çš„å‘½ä»¤, é€šè¿‡<code>oc new-app</code>æ¥åˆ›å»ºæ–°åº”ç”¨. é€šè¿‡<code>--docker-image</code>æ¥æŒ‡å®šé•œåƒçš„åœ°å€, é€šè¿‡<code>--e xxx</code> æ¥æŒ‡å®šç¯å¢ƒå˜é‡.</p>
<p>ç”±äºæµ‹è¯•ç¯å¢ƒçš„registryæ²¡æœ‰é…ç½®https, æ‰€ä»¥è¦æ·»åŠ <code>--insecure-registy=true</code>, å¦åˆ™é»˜è®¤æ˜¯é€šè¿‡httpsè®¿é—®, ä¼šæ‰¾ä¸åˆ°é•œåƒ.</p>
<p>è¿è¡Œå‘½ä»¤å, OpenShiftä¼šé»˜è®¤åˆ›å»º:</p>
<ul>
<li>deployment configuration (dc, éƒ¨ç½²é…ç½®) - zentao </li>
<li>build configuration (bc, æ„å»ºé…ç½®)</li>
<li>pod(å®¹å™¨)</li>
<li>...</li>
</ul>
<p>å¯ä»¥é€šè¿‡<code>oc get</code> åè¾¹è·Ÿ <code>dc</code>  <code>bc</code>   <code>pod</code>ç­‰æ¥è·å–åº”ç”¨çš„åˆ›å»ºå’Œéƒ¨ç½²çŠ¶æ€.</p>
<p>é€šè¿‡<code>oc status</code> æˆ–è€…<code>oc logs</code>æ¥æŸ¥çœ‹ç›¸å…³äº‹ä»¶å’Œæ—¥å¿—.</p>
<p>è‡³æ­¤, åº”ç”¨å·²ç»éƒ¨ç½²å¥½äº†, ä½†æ˜¯ç›®å‰è¿˜å­˜åœ¨2ä¸ªé—®é¢˜:</p>
<ol>
<li>"ç¦…é“"çš„åº”ç”¨å’Œæ•°æ®åº“æ•°æ®æ˜¯ä¸´æ—¶æ€§çš„, è¿˜æ²¡æœ‰è¿›è¡ŒæŒä¹…åŒ–;</li>
<li>"ç¦…é“"åªèƒ½é€šè¿‡dockerå†…éƒ¨è®¿é—®, ç”¨æˆ·æ— æ³•è®¿é—®.</li>
</ol>
<p>åç»­æ¥ä¸€ä¸€è§£å†³è¿™2ä¸ªé—®é¢˜. é¦–å…ˆè§£å†³æ•°æ®æ²¡æœ‰æŒä¹…åŒ–çš„é—®é¢˜.</p>
<h4>2-3 æŒä¹…åŒ–åº”ç”¨å’Œæ•°æ®åº“æ•°æ®</h4>
<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"> è¯´æ˜:</p>
<p>OpenShift æ˜¯ä¸€ä¸ªå®¹å™¨ç¼–æ’è°ƒåº¦ç³»ç»Ÿ, ç†è®ºä¸Šæ¥è¯´ä¸€ä¸ªpodåœ¨å“ªå„¿æˆ‘ä»¬å®Œå…¨ä¸çŸ¥é“, æ‰€ä»¥OpenShiftæ¨èçš„æŒä¹…åŒ–æ–¹æ¡ˆæ˜¯é€šè¿‡PVå’ŒPVCæ¥å®ç°çš„.</p>
<p>PVçš„å…·ä½“å®ç°å¯ä»¥æ˜¯: NFSä¹‹ç±»çš„å…¬æœ‰å­˜å‚¨, è€Œä¸åº”è¯¥æ˜¯æœ¬åœ°è·¯å¾„. (OpenShifté»˜è®¤ä¸å…è®¸æœ¬åœ°è·¯å¾„(å³: hostPath)å®ç°æ–¹å¼)</p>
<p>æœ¬ä¾‹ä¸­, ä¸ºäº†é¿å…ä¸€åˆ‡ä¸å¿…è¦çš„èµ„æºç”³è¯·æµç¨‹(å½“å‰OpenShiftæµ‹è¯•ç¯å¢ƒæ²¡æœ‰ç°æˆçš„nfsè¿™ç±»å…¬æœ‰å­˜å‚¨), æ‰€ä»¥å°±ç›´æ¥ç”¨æœ¬åœ°è·¯å¾„æ¥å®ç°æŒä¹…åŒ–. ä½†è¿˜æ˜¯è¦å¼ºè°ƒ, è¿™ä¸æ˜¯æœ€ä½³å®è·µ, ä¸æ¨èè¿™ä¹ˆåš. <br>
</p>
</blockquote>
<p>ç”±äºOpenShiftä¸å…è®¸æœ¬åœ°è·¯å¾„æŒä¹…åŒ–, æ‰€ä»¥é¦–å…ˆè¦æ›´æ”¹é…ç½®ä½¿å…¶å…è®¸. </p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªåä¸º<code>hostpath</code>çš„SCC (SCCå¯ä»¥ç®€å•çš„ç†è§£ä¸ºå®‰å…¨é™åˆ¶ç­–ç•¥). å…ˆåˆ›å»ºä¸€ä¸ª<code>scc-hostpath.yaml</code></li>
</ol>
<div class="highlight"><pre><span></span><span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SecurityContextConstraints</span>
<span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hostpath</span>
<span class="nt">allowPrivilegedContainer</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">runAsUser</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RunAsAny</span>
<span class="nt">seLinuxContext</span><span class="p">:</span>
  <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">RunAsAny</span>
</pre></div>


<ol start="2">
<li>é€šè¿‡yaml åˆ›å»ºSCC:</li>
</ol>
<div class="highlight"><pre><span></span>oc create -f scc-hostpath.yaml
</pre></div>


<ol start="3">
<li>æŠŠ<code>allowHostDirVolumePlugin</code> å‚æ•°é…ç»™<code>hostpath</code> :</li>
</ol>
<div class="highlight"><pre><span></span>oc patch scc hostpath -p <span class="s1">&#39;{&quot;allowHostDirVolumePlugin&quot;: true}&#39;</span>
</pre></div>


<ol start="4">
<li>æŠŠ<code>hostpath</code>è¿™ä¸ªSCCèµ‹æƒç»™æ‰€æœ‰ç”¨æˆ·: (<code>system:authenticated</code> å°±æ˜¯æ‰€æœ‰ç”¨æˆ·)</li>
</ol>
<div class="highlight"><pre><span></span>oc adm policy add-scc-to-group hostpath system:authenticated
</pre></div>


<p>è‡³æ­¤, æ‰€æœ‰ç”¨æˆ·å°±éƒ½å¯ä»¥æŒ‚è½½<code>hostPath</code> å·äº†.</p>
<p>æ¥ä¸‹æ¥, å°±æ˜¯è¦é…ç½®æŒä¹…åŒ–äº†:</p>
<ol>
<li>åœ¨å¯¹åº”çš„nodeèŠ‚ç‚¹, åˆ›å»ºå¯¹åº”çš„æŒä¹…åŒ–ç›®å½•, å¦‚:<code>/data/mysql</code> å’Œ<code>/data/zentaopms</code> (ç¦…é“ é•œåƒ, åŒ…å«äº†2ä¸ªéœ€è¦æŒä¹…åŒ–çš„ç›®å½•, åˆ†åˆ«ä¸º: <code>/var/lib/mysql</code> å’Œ<code>/app/zentaopms</code>, åˆ†åˆ«æŒä¹…åŒ–åˆ°å‰è¾¹çš„2ä¸ªç›®å½•)</li>
<li>ç¼–è¾‘åˆ›å»º zentao appæ—¶è‡ªåŠ¨ç”Ÿæˆçš„<code>dc</code> é…ç½®, <code>oc edit dc zentao</code>, ä¿®æ”¹å®Œæˆåå¦‚ä¸‹:</li>
</ol>
<div class="highlight"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">apps.openshift.io/v1</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">DeploymentConfig</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">annotations</span><span class="p">:</span>
    <span class="nt">openshift.io/generated-by</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">OpenShiftNewApp</span>
  <span class="nt">creationTimestamp</span><span class="p">:</span> <span class="s">&#39;2019-05-16T10:24:25Z&#39;</span>
  <span class="nt">labels</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao</span>
  <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao</span>
  <span class="nt">resourceVersion</span><span class="p">:</span> <span class="s">&#39;12345678&#39;</span>
  <span class="nt">selfLink</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/apis/apps.openshift.io/v1/namespaces/zentao/deploymentconfigs/zentao</span>
  <span class="nt">uid</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">c7xxxxxd-77c4-11e9-xxxx-faxxxxxxxfa</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">revisionHistoryLimit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
  <span class="nt">selector</span><span class="p">:</span>
    <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao</span>
    <span class="nt">deploymentconfig</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao</span>
  <span class="nt">strategy</span><span class="p">:</span>
    <span class="nt">activeDeadlineSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">21600</span>
    <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
    <span class="nt">rollingParams</span><span class="p">:</span>
      <span class="nt">intervalSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="nt">maxSurge</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">25%</span>
      <span class="nt">maxUnavailable</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">25%</span>
      <span class="nt">timeoutSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">600</span>
      <span class="nt">updatePeriodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Rolling</span>
  <span class="nt">template</span><span class="p">:</span>
    <span class="nt">metadata</span><span class="p">:</span>
      <span class="nt">annotations</span><span class="p">:</span>
        <span class="nt">openshift.io/generated-by</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">OpenShiftNewApp</span>
      <span class="nt">creationTimestamp</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">null</span>
      <span class="nt">labels</span><span class="p">:</span>
        <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao</span>
        <span class="nt">deploymentconfig</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao</span>
    <span class="nt">spec</span><span class="p">:</span>
      <span class="nt">containers</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">env</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_ROOT_PASSWORD</span>
              <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">123456</span>
          <span class="nt">image</span><span class="p">:</span> <span class="p p-Indicator">&gt;-</span>
            <span class="no">txocp-registry.example.com/ewhisper/zentao@sha256:......</span>
          <span class="nt">imagePullPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Always</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao</span>
          <span class="nt">resources</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
          <span class="nt">terminationMessagePath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/dev/termination-log</span>
          <span class="nt">terminationMessagePolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">File</span>
          <span class="nt">volumeMounts</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/zentaopms</span>
              <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao-volume-1</span>
            <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/lib/mysql</span>
              <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao-volume-2</span>
      <span class="nt">dnsPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterFirst</span>
      <span class="nt">restartPolicy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Always</span>
      <span class="nt">schedulerName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">default-scheduler</span>
      <span class="nt">securityContext</span><span class="p">:</span> <span class="p p-Indicator">{}</span>
      <span class="nt">serviceAccount</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">useroot</span>
      <span class="nt">serviceAccountName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">useroot</span>
      <span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">30</span>
      <span class="nt">volumes</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">hostPath</span><span class="p">:</span>
            <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/cuikaidong/zentao/zentaopms</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao-volume-1</span>
        <span class="p p-Indicator">-</span> <span class="nt">hostPath</span><span class="p">:</span>
            <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/cuikaidong/zentao/mysql</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao-volume-2</span>
  <span class="nt">test</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
  <span class="nt">triggers</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigChange</span>
    <span class="p p-Indicator">-</span> <span class="nt">imageChangeParams</span><span class="p">:</span>
        <span class="nt">automatic</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
        <span class="nt">containerNames</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">zentao</span>
        <span class="nt">from</span><span class="p">:</span>
          <span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ImageStreamTag</span>
          <span class="nt">name</span><span class="p">:</span> <span class="s">&#39;zentao:latest&#39;</span>
          <span class="nt">namespace</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao</span>
        <span class="nt">lastTriggeredImage</span><span class="p">:</span> <span class="p p-Indicator">&gt;-</span>
          <span class="no">txocp-registry.example.com/ewhisper/zentao@sha256:......</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ImageChange</span>
<span class="nt">status</span><span class="p">:</span>
  <span class="nt">availableReplicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">conditions</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">lastTransitionTime</span><span class="p">:</span> <span class="s">&#39;2019-05-16T10:26:16Z&#39;</span>
      <span class="nt">lastUpdateTime</span><span class="p">:</span> <span class="s">&#39;2019-05-16T10:26:16Z&#39;</span>
      <span class="nt">message</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Deployment config has minimum availability.</span>
      <span class="nt">status</span><span class="p">:</span> <span class="s">&#39;True&#39;</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Available</span>
    <span class="p p-Indicator">-</span> <span class="nt">lastTransitionTime</span><span class="p">:</span> <span class="s">&#39;2019-05-16T11:54:24Z&#39;</span>
      <span class="nt">lastUpdateTime</span><span class="p">:</span> <span class="s">&#39;2019-05-16T11:54:26Z&#39;</span>
      <span class="nt">message</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">replication controller &quot;zentao-5&quot; successfully rolled out</span>
      <span class="nt">reason</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">NewReplicationControllerAvailable</span>
      <span class="nt">status</span><span class="p">:</span> <span class="s">&#39;True&#39;</span>
      <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Progressing</span>
  <span class="nt">details</span><span class="p">:</span>
    <span class="nt">causes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ConfigChange</span>
    <span class="nt">message</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">config change</span>
  <span class="nt">latestVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
  <span class="nt">observedGeneration</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">6</span>
  <span class="nt">readyReplicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">replicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="nt">unavailableReplicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
  <span class="nt">updatedReplicas</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
</pre></div>


<p>ä¸è¦è¢«è¿™ä¸ªé…ç½®æ–‡ä»¶å“åˆ°, å…¶å®è¿™äº›éƒ½æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„. å…³é”®ä¿¡æ¯æ˜¯å¦‚ä¸‹:</p>
<div class="highlight"><pre><span></span>          <span class="nt">volumeMounts</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/app/zentaopms</span>
              <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao-volume-1</span>
            <span class="p p-Indicator">-</span> <span class="nt">mountPath</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/lib/mysql</span>
              <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao-volume-2</span>
</pre></div>


<p>â–³ å³2ä¸ªå®¹å™¨å†…çš„éœ€è¦æŒ‚è½½çš„è·¯å¾„, åˆ†åˆ«è¢«è‡ªåŠ¨å‘½åä¸º: <code>zentao-volume-1</code>å’Œ <code>zentao-volume-2</code>. </p>
<p>å¯¹åº”çš„å¤–éƒ¨æŒ‚è½½, åŸå§‹æƒ…å†µæ˜¯<code>EmptyDir</code> (å³æ²¡æœ‰æŒ‚è½½), å®¹å™¨é‡å¯äº†æ•°æ®å°±æ²¡äº†. å…·ä½“å¦‚ä¸‹:</p>
<div class="highlight"><pre><span></span>      <span class="nt">volumes</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">emptyDir</span><span class="p">:</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao-volume-1</span>
        <span class="p p-Indicator">-</span> <span class="nt">emptyDir</span><span class="p">:</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao-volume-2</span>
</pre></div>


<p>ä¿®æ”¹åå¦‚ä¸‹:</p>
<div class="highlight"><pre><span></span>      <span class="nt">volumes</span><span class="p">:</span>
        <span class="p p-Indicator">-</span> <span class="nt">hostPath</span><span class="p">:</span>
            <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/cuikaidong/zentao/zentaopms</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao-volume-1</span>
        <span class="p p-Indicator">-</span> <span class="nt">hostPath</span><span class="p">:</span>
            <span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/var/cuikaidong/zentao/mysql</span>
            <span class="nt">type</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
          <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">zentao-volume-2</span>
</pre></div>


<p>ä¹‹å, podä¼šè‡ªåŠ¨è¿›è¡Œé‡å¯, æŠŠå¯¹åº”çš„æ•°æ®é€šè¿‡<code>hostPath</code> æŒ‚è½½åˆ°æœ¬åœ°ç›®å½•æ¥å®ç°æŒä¹…åŒ–.</p>
<h4>3-1 åˆ›å»º"ç¦…é“" æœåŠ¡(service)</h4>
<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"> è¯´æ˜:</p>
<p><strong>æœåŠ¡</strong>(Service) æ˜¯OpenShiftæˆ–K8S çš„ä¸“æœ‰æ¦‚å¿µ, ç®€å•ç†è§£å°±æ˜¯æŠŠpodå†…çš„æŒ‡å®šæ¥å£æš´éœ²ç»™OpenShiftæˆ–K8Sé›†ç¾¤å†…éƒ¨ä½¿ç”¨çš„ä¸€ç§æ–¹æ³•. (æ¯”å¦‚æŠŠ: mysqlå®¹å™¨å†…çš„3306ç«¯å£æš´éœ²åˆ°OpenShift SDNç½‘ç»œçš„ 172.X.X.X:3306).</p>
</blockquote>
<div class="highlight"><pre><span></span>oc expose dc zentao --port<span class="o">=</span><span class="m">80</span>
</pre></div>


<p>æŠŠ zentao åº”ç”¨çš„httpæœåŠ¡ç«¯å£80 æš´éœ²ç»™OpenShifté›†ç¾¤å†…éƒ¨. (ä¼šåˆ›å»ºä¸€ä¸ªå« zentao çš„ svc)</p>
<h4>3-2 åˆ›å»º"ç¦…é“" è·¯ç”±(route)</h4>
<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"> è¯´æ˜:</p>
<p><strong>è·¯ç”±</strong> (route)æ˜¯OpenShiftçš„ä¸“æœ‰æ¦‚å¿µ, ç±»ä¼¼äºK8Sçš„Ingress, ä½œç”¨éƒ½æ˜¯æŠŠæœåŠ¡æš´éœ²ç»™OpenShiftä¹‹å¤–çš„ç½‘ç»œ, ä½¿å¾—ç”¨æˆ·å¯ä»¥é€šè¿‡åŸŸåæˆ–å…¶ä»–æ–¹å¼è®¿é—®åˆ°è¯¥åº”ç”¨. (å¦‚: é€šè¿‡<code>zentao.apps.example.com</code> è®¿é—®åˆ° "ç¦…é“" é¡¹ç›®ç®¡ç†å·¥å…·é¦–é¡µ)</p>
</blockquote>
<div class="highlight"><pre><span></span>oc expose svc zentao --hostname<span class="o">=</span><span class="s2">&quot;zentao.apps.example.com&quot;</span>
</pre></div>


<p>é€šè¿‡ä¸Šè¾¹çš„å‘½ä»¤, å°±åˆ›å»ºäº†ä¸€æ¡è·¯ç”±, å®ç°äº†é€šè¿‡<code>zentao.apps.example.com</code> è®¿é—®åˆ° "ç¦…é“" é¡¹ç›®ç®¡ç†å·¥å…·é¦–é¡µ. (å¦‚æœä¸åŠ <code>--hostname</code>, é»˜è®¤çš„hostnameå‰ç¼€ä¸º<code>appname-projectname</code>, å³"zentao-zentao")</p>
<h4>3-3 æ·»åŠ DNSè®°å½•</h4>
<p>ç”±äºæˆ‘ä»¬ä¼ä¸šçš„OpenShift æµ‹è¯•ç¯å¢ƒDNS çš„å®¢è§‚æƒ…å†µ. æ— æ³•å®ç°æ³›è§£æ, æ‰€ä»¥è¿˜éœ€è¦è¯·ç›¸å…³ä¸“ä¸šç»„æ‰‹åŠ¨æ·»åŠ DNSè®°å½•. åŠå…¬ç”µè„‘æ·»åŠ DNSæµ‹è¯•åŸŸç­‰æ“ä½œ. </p>
<p>åšå®Œè¿™äº›æ“ä½œå, æ‰èƒ½é€šè¿‡åŸŸåè®¿é—®åˆ°ç¦…é“ç³»ç»Ÿ.</p>
<p>è‡³æ­¤, æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åŸŸåè®¿é—® "ç¦…é“" é¡µé¢â€‹, â€‹è€Œâ€‹æˆ‘ä»¬â€‹ä½¿ç”¨â€‹çš„â€‹æ•°æ®â€‹ä¹Ÿä¼šâ€‹ä¿ç•™åœ¨â€‹æŒ‡å®šâ€‹çš„â€‹nodeâ€‹èŠ‚ç‚¹â€‹ä¸Š.â€‹ <img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"><img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"><img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"></p>
<p><img alt="ç¦…é“é¦–é¡µ" src="./images/zentao_openshift.png"></p>
<h2 id="_6">æ€»ç»“<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>æ•´ä½“ä½¿ç”¨ä¸‹æ¥, éƒ¨åˆ†åœ°æ–¹è¿˜å­˜åœ¨ä½¿ç”¨ä¸ç•…çš„æƒ…å†µ, å¯ä»¥ç»§ç»­ä¼˜åŒ–æå‡ä½¿ç”¨ä½“éªŒ, å¤§æ¦‚æ€»ç»“ä¸€ä¸‹:</p>
<ul>
<li>å†…éƒ¨é•œåƒä»“åº“é•œåƒèµ„æºå¤ªåŒ®ä¹. å¯¼è‡´æ„å»ºé•œåƒä¸å¤ªæ–¹ä¾¿. åç»­å†…éƒ¨çš„é•œåƒä»“åº“å¯ä»¥ä»docker hub, çº¢å¸½å®˜æ–¹å®šæœŸæ‹‰å–è¾ƒä¸ºæµè¡Œçš„é•œåƒ.</li>
<li>åœ¨OpenShiftä¸Š, å¤šæŒ‚è½½ä¸€ä¸ªæˆ–å¤šä¸ªå…¬æœ‰å­˜å‚¨(å¦‚NFS, NAS, å¯¹è±¡å­˜å‚¨ç­‰), æ–¹ä¾¿è¿›è¡Œæ•°æ®æŒä¹…åŒ–<ul>
<li>è·Ÿè¿›ä¸€æ­¥, å¸Œæœ›OpenShiftå¯ä»¥ç›´æ¥è°ƒç”¨ä¸‹ä¸€å±‚æ•°æ®å­˜å‚¨çš„ç›¸å…³æ¥å£, å®ç°è‡ªåŠ¨ç”³è¯·</li>
</ul>
</li>
<li>åº”ç”¨é€šè¿‡åŸŸåå‘å¸ƒå‡ºæ¥, è¿˜éœ€è¦ç»è¿‡åŸŸæ§æˆ–F5æˆ–ä¸ªäººç”µè„‘è¿›è¡Œè¿›ä¸€æ­¥é…ç½®æ‰èƒ½ç”Ÿæ•ˆ. åç»­å¯ä»¥è€ƒè™‘:<ul>
<li>é…ç½®æŸäºŒçº§åŸŸåçš„æ³›è§£æ, å®ç°ç›¸å…³åŸŸåçš„è‡ªåŠ¨å‘å¸ƒ. </li>
<li>æ›´è¿›ä¸€æ­¥, å¯ä»¥è€ƒè™‘OpenShiftç›´æ¥å’ŒF5æ·±åº¦æ•´åˆ, å°†F5ä½œä¸ºå…¶routerä½¿ç”¨. (å½“å‰æ˜¯: F5 -&gt; HAProxy(router) )</li>
</ul>
</li>
</ul>
<div class="footnote">
<hr>
<ol>
<li id="fn:1">
<p>https://www.zentao.net&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://www.EWhisper.cn/tag/openshift.html">openshift</a>
      <a href="https://www.EWhisper.cn/tag/docker.html">docker</a>
    </p>
  </div>

  <div class="center social-share">
    <p>å–œæ¬¢è¿™ç¯‡æ–‡ç« å—ï¼Ÿå°†å®ƒä¸æ‚¨çš„æœ‹å‹åˆ†äº«å§ï¼</p>
    <div class="addthis_native_toolbox"></div>
    <div class="addthis_sharing_toolbox"></div>
    <div class="addthis_inline_share_toolbox"></div>
  </div>

  <div class="neighbors">
    <a class="btn float-left" href="https://www.EWhisper.cn/openshift-pod-autoscaling.html" title="å®¹å™¨è‡ªåŠ¨ä¼¸ç¼©">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="https://www.EWhisper.cn/dynatrace-appmon-handbook-20-reporting.html" title="Dynatrace AppMon å®æˆ˜æ‰‹å†Œ - 20.æŠ¥å‘ŠåŠŸèƒ½">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4>æ‚¨å¯èƒ½è¿˜å–œæ¬¢</h4>
    <ul class="related-posts">
      <li><a href="https://www.EWhisper.cn/I-was-screwed-by-previous-project.html">ä»Šå¤©è¢«å‰ä¸€ä¸ªé¡¹ç›®ç»„åŸ‹çš„é›·ç‚¸æƒ¨äº†!</a></li>
      <li><a href="https://www.EWhisper.cn/update-zentao-where-deployed-on-openshift.html">OpenShiftä¸Šç¦…é“å‡çº§æ–¹æ¡ˆ</a></li>
      <li><a href="https://www.EWhisper.cn/container-best-practices.html">å®¹å™¨æœ€ä½³å®è·µ</a></li>
      <li><a href="https://www.EWhisper.cn/install-gitlab-with-docker.html">ä½¿ç”¨ Docker å®‰è£… Gitlab</a></li>
      <li><a href="https://www.EWhisper.cn/openshift-pod-autoscaling.html">å®¹å™¨è‡ªåŠ¨ä¼¸ç¼©</a></li>
    </ul>
  </div>


</article>

    <footer>
<p>
  &copy;  2019 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>æœ¬ç«™ç”± <a href="http://getpelican.com" target="_blank">Pelican</a> é©±åŠ¨ï¼Œå¹¶ä½¿ç”¨äº† <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a> å¼€å‘çš„ <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> ä¸»é¢˜ã€‚</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
<!-- StatusCake -->
<a href="https://www.statuscake.com" title="ä¸œé£å¾®é¸£ Blog Uptime">
  <img src="https://app.statuscake.com/button/index.php?Track=CbJdcjmnCx&amp;Days=7&amp;Design=7" alt="ä¸œé£å¾®é¸£ Blog Uptime"/>
</a>

<!-- End StatusCake --></p>    </footer>
  </main>


    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c98c3e21c4def55" async="async"></script>


<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " ä¸œé£å¾®é¸£ Blog ",
  "url" : "https://www.EWhisper.cn",
  "image": "//s.gravatar.com/avatar/7c743bc6ac83171e35a5aa8bd66cc1ea?s=120",
  "description": "Focus on Python/Java/DevOps/Observability"
}
</script>

<a href="https://github.com/east4ming/my-pelican" class="github-corner" aria-label="View source on Github">
    <svg width="80"
         height="80"
         viewBox="0 0 250 250"
         style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
         aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor"
              style="transform-origin: 130px 106px;"
              class="octo-arm">
        </path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor"
              class="octo-body">
        </path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></body>
</html>