
<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://www.EWhisper.cn/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://www.EWhisper.cn/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://www.EWhisper.cn/theme/font-awesome/css/font-awesome.min.css">

    <link href="https://www.EWhisper.cn/static/custom.css" rel="stylesheet">


    <link href="https://www.EWhisper.cn/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="个人技术分享 RSS">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">


    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">

<meta name="author" content="个人技术分享" />
<meta name="description" content="Dynatrace AppMon 实战手册系列文章. 本文是第二十八篇, 主要介绍Dynatrace AppMon 6.5的升级和迁移方法." />
<meta name="keywords" content="Dynatrace, Observability">

<meta property="og:site_name" content="个人技术分享"/>
<meta property="og:title" content="Dynatrace AppMon 实战手册 - 28.Dynatrace 6.5升级和迁移向导"/>
<meta property="og:description" content="Dynatrace AppMon 实战手册系列文章. 本文是第二十八篇, 主要介绍Dynatrace AppMon 6.5的升级和迁移方法."/>
<meta property="og:locale" content="zh_CN"/>
<meta property="og:url" content="https://www.EWhisper.cn/dynatrace-appmon-handbook-28-update-migrate-guide.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-06-19 19:00:00+08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://www.EWhisper.cn/author/ge-ren-ji-zhu-fen-xiang.html">
<meta property="article:section" content="Observability"/>
<meta property="article:tag" content="Dynatrace"/>
<meta property="article:tag" content="Observability"/>
<meta property="og:image" content="//s.gravatar.com/avatar/7c743bc6ac83171e35a5aa8bd66cc1ea?s=120">

  <title>个人技术分享 &ndash; Dynatrace AppMon 实战手册 - 28.Dynatrace 6.5升级和迁移向导</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://www.EWhisper.cn">
        <img src="//s.gravatar.com/avatar/7c743bc6ac83171e35a5aa8bd66cc1ea?s=120" alt="个人技术分享" title="个人技术分享">
      </a>
      <h1><a href="https://www.EWhisper.cn">个人技术分享</a></h1>

<p>Focus on Python/Java/DevOps/Observability</p>
      <nav>
        <ul class="list">
          <li><a href="https://www.EWhisper.cn/pages/about.html#about">About</a></li>
          <li><a href="https://www.EWhisper.cn/pages/contact.html#contact">Contact</a></li>

          <li><a href="http://beian.miit.gov.cn" target="_blank">沪ICP备19007314号-1</a></li>
        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-wechat" href="/images/wechat_paycode.png" target="_blank"><i class="fa fa-wechat"></i></a></li>
        <li><a class="sc-envelope-o" href="mailto:cuikaidong@foxmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-reddit" href="https://www.jianshu.com/u/0f08daeaa5a9" target="_blank"><i class="fa fa-reddit"></i></a></li>
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/凯东-崔-136128116/" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-weibo" href="https://weibo.com/long5to2gf" target="_blank"><i class="fa fa-weibo"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://www.EWhisper.cn">主页</a>

      <a href="/archives/index.html">存档</a>
      <a href="/categories.html">类别</a>
      <a href="/tags.html">标签</a>
      <a href="/authors.html">作者</a>


      <a href="https://www.EWhisper.cn/feeds/all.rss.xml">RSS订阅</a>
    </nav>

<article class="single">
  <header>
    <h1 id="dynatrace-appmon-handbook-28-update-migrate-guide">Dynatrace AppMon 实战手册 - 28.Dynatrace 6.5升级和迁移向导</h1>
    <p>
      在 2019-06-19 Wednesday 发布于 <a href="https://www.EWhisper.cn/category/observability.html">Observability</a> 分类

        &#8226; 4 min read
    </p>
  </header>


  <div>
    <div class="toc">
<ul>
<li><a href="#_1">前言</a><ul>
<li><a href="#1">1.准备迁移（见第一章）</a></li>
<li><a href="#2">2.安装新组件并迁移数据（见第二章）</a></li>
<li><a href="#3agents">3.如果需要，则升级Agents（见第三章）</a></li>
<li><a href="#4">4.最终检查和验证（见第四章）</a></li>
</ul>
</li>
<li><a href="#1_1">1 准备升级</a><ul>
<li><a href="#_2">步骤一</a></li>
<li><a href="#_3">步骤二</a></li>
<li><a href="#_4">步骤三</a></li>
<li><a href="#_5">步骤四</a></li>
<li><a href="#_6">步骤五</a></li>
<li><a href="#_7">步骤六</a></li>
<li><a href="#_8">步骤七</a></li>
<li><a href="#_9">步骤八</a></li>
<li><a href="#_10">步骤九</a></li>
<li><a href="#_11">步骤十</a></li>
<li><a href="#_12">步骤十一</a></li>
<li><a href="#_13">步骤十二</a></li>
<li><a href="#_14">步骤十三</a></li>
<li><a href="#_15">步骤十四</a></li>
<li><a href="#_16">步骤十五</a></li>
<li><a href="#_17">步骤十六</a></li>
<li><a href="#11-agent">1.1 Agent兼容矩阵</a></li>
</ul>
</li>
<li><a href="#2-servercollectors">2 升级Server，Collectors，客户端</a><ul>
<li><a href="#21-servercollectors">2.1 安装新的Server，Collectors和客户端</a></li>
<li><a href="#22">2.2 关闭老版本</a></li>
<li><a href="#23">2.3 创建备份</a></li>
<li><a href="#24-servercollector">2.4 服务迁移（Server，Collector和内存分析服务器）</a></li>
<li><a href="#25">2.5 自动启动新服务</a></li>
<li><a href="#26">2.6 客户端迁移</a></li>
<li><a href="#27-server">2.7 启动新的Server组件</a></li>
<li><a href="#28">2.8 启动新的客户端</a></li>
<li><a href="#29-serverlicenses">2.9 激活新的Server的licenses</a></li>
<li><a href="#210-server-sizing">2.10 选择Server Sizing</a></li>
<li><a href="#211-dynatrace">2.11 升级新的Dynatrace</a></li>
<li><a href="#212">2.12 连接性能仓库</a></li>
<li><a href="#213-session">2.13 配置Session存储</a></li>
<li><a href="#214-collectors">2.14 启动新的Collectors</a></li>
<li><a href="#215">2.15 手动文件迁移</a></li>
</ul>
</li>
<li><a href="#3-agents">3 升级Agents</a><ul>
<li><a href="#31-agents">3.1 升级Agents</a></li>
<li><a href="#32-agents">3.2 重启Agents</a></li>
<li><a href="#33-bootstrap-agents">3.3 升级Bootstrap Agents</a></li>
<li><a href="#34-zos-agents">3.4 升级zOS Agents</a></li>
</ul>
</li>
<li><a href="#4_1">4 最终检查</a><ul>
<li><a href="#41">4.1 检查配置</a></li>
<li><a href="#42-dynatrace-server">4.2 确认新的Dynatrace Server的运行</a></li>
</ul>
</li>
<li><a href="#5">5 故障排除</a><ul>
<li><a href="#51">5.1 常见问题</a></li>
<li><a href="#52-dynatrace">5.2 Dynatrace 支持</a></li>
</ul>
</li>
</ul>
</div>
<blockquote>
<p>2017年2月22日</p>
</blockquote>
<h2 id="_1">前言<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>本文档用于：</p>
<ul>
<li>升级现有的Dynatrace环境到6.5，或者</li>
<li>迁移已存在的Dynatrace 6.5 Server 到另一台主机</li>
</ul>
<h3 id="1">1.准备迁移（见第一章）<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<p>开始之前，检查当前已安装（Servers, Collectors, Agents)来判定当前使用的版本，以及是否有组件可以直接升级到新版本。另外，检查<strong>系统需求</strong>来确定你正在使用受支持的硬件和平台。</p>
<h3 id="2">2.安装新组件并迁移数据（见第二章）<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<p>安装新组件，<strong>使用最新</strong>的<a href="https://files.dynatrace.com/downloads/migrationtool/dynatrace-migration.jar"><em>dynatrace-migration Tool</em></a>来转移当前数据和配置至新版本。当你从命令行运行该工具时请检查所显示的版本！</p>
<p>你需要几步手工的操作和编辑来完成迁移。</p>
<h3 id="3agents">3.如果需要，则升级Agents（见第三章）<a class="headerlink" href="#3agents" title="Permanent link">&para;</a></h3>
<p>大多数Agents会自动升级到最新版本。在某些情况下，你可能需要手动升级Agents。</p>
<h3 id="4">4.最终检查和验证（见第四章）<a class="headerlink" href="#4" title="Permanent link">&para;</a></h3>
<p>启动Dynatrace AppMon并且查看是否Agents在发送数据，PurePaths和仪表板正确地显示。</p>
<h2 id="1_1">1 准备升级<a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h2>
<p>检查下列checklist来确保你已经做好迁移准备。</p>
<h3 id="_2">步骤一<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>检查已安装的Dynatrace的版本和安装类型：</p>
<ul>
<li>对于5.6之前版本，你<strong>必须</strong>先迁移到6.2。具体见<a href="https://community.dynatrace.com/community/display/DOCDT62/Upgrade+and+Migration+Guide">《6.2升级向导》</a>。</li>
<li>对于POC，需要<a href="https://community.dynatrace.com/community/display/DOCDT63/Installation+Overview">重新安装</a>。</li>
<li>对于独立软件供应商版本（PTC Windchill),请使用供应商提供的文档。</li>
</ul>
<h3 id="_3">步骤二<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>创建一个已安装的Collectors, Agents, Clients的详细清单，来审定升级的范围。</p>
<h3 id="_4">步骤三<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>验证<a href="https://community.dynatrace.com/community/display/DOCDT63/System+Requirements"><strong>系统需求</strong></a>是否符合。一些要点如下：</p>
<ul>
<li>Servers<strong>只兼容</strong>主版本相同，小版本相同或更小的Collectors。例如：一台6.1的Server可以和一台6.0的Collector正常工作，但是<strong>不兼容</strong>5.6或6.2的Collector.</li>
<li><strong>推荐</strong>使用<strong>64位客户端</strong>而不是32位的。查看<em>客户端配置</em>和<em>Webstart 客户端</em>获取更多信息。</li>
<li>迁移<strong>不支持</strong>Server内置的Collector。<strong>升级之前</strong>需要为当前版本安装一个stand-alone服务。特别是对于“开发团队版本”。</li>
<li>内置性能仓库<strong>不支持</strong>迁移。首先要切换到外置的，具体描述见<a href="https://community.dynatrace.com/community/display/DOCDT63/Performance+Warehouse+Administration">链接</a>。</li>
<li>如果启用LDAP认证，用户需要至少称为一个Dynatrace LDAP组的一员用以登陆。查看<a href="https://community.dynatrace.com/community/display/DOCDT63/User+Permissions+and+Authentication#UserPermissionsandAuthentication-LDAP">LDAP</a>获取更多信息。</li>
<li>如果你的Dynatrace和DC RUM整合，DC RUM必须&gt;= 12.0.2.</li>
</ul>
<h3 id="_5">步骤四<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>对于清单上的每个Agent，检查<em>Agent和新的Servers和Collectors的兼容性</em>（见1.1）。</p>
<p>推荐升级所有Agents，可能需要新功能来正常工作以及获取支持，来确保已知问题已经被修复。</p>
<blockquote>
<p><strong>Tip</strong></p>
<p>计划好利用已安排好的升级窗口来进行升级：</p>
<ul>
<li>必须能够重启Agent 组。</li>
</ul>
</blockquote>
<p><strong>注意项</strong>：.NET和IIS Agent： 由于license的变动，所有.NET和IIS Agents在6.3之前的需要升级后重启只6.3或更高。</p>
<h3 id="_6">步骤五<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p><strong>注意项</strong>：如果当前的Dynatrace server安装路径<DT_HOME_OLD>,存在一个<em>server/instances</em>文件夹，并且你正在使用这些<strong>Server实例</strong>：该功能，dtserver和dtfrontendserver的<em>- instance</em>参数6.3版本已弃用。Collector实例仍然支持。</p>
<p>使用<a href="https://community.dynatrace.com/community/display/APMDOC/Migrating+Server+Instances+to+Separate+Installations">该向导</a>，<strong>升级前</strong>检查迁移Server 实例到独立安装的需求。</p>
<h3 id="_7">步骤六<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p><strong>注意项</strong>：6.2主机监控发生重大更改。被监控的主机不在被映射到系统配置文件，而是在一个叫做<strong>基础结构</strong>的部分进行全局管理。</p>
<p>因为这些更改，迁移前被收集的历史主机监控数据和相关的系统配置文件在使用Dynatrace 6.2或以后版本将不再可以访问。</p>
<p>要使历史主机监控数据迁移后仍可以访问，具体步骤参考<a href="https://community.dynatrace.com/community/display/DTKB/After+Upgrade+to+6.2%2C+Host+Metrics+From+Times+Before+the+Upgrade+Are+No+Longer+Shown"><em>升级6.2后，来自升级前的主机度量无法显示</em></a></p>
<h3 id="_8">步骤七<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>检查Server sizing,如果从以下版本升级，请事先<a href="https://support.dynatrace.com/">联系support</a> ：</p>
<ul>
<li>5.6，并且<em>dtserver.ini</em>中<em>-Xmx</em>值大于14GB</li>
<li>≥ 6.0，并且在<em>dtserver.ini</em>或<em>dfrontendserver.ini</em>, <em>memory</em>的值不受支持。</li>
</ul>
<h3 id="_9">步骤八<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>要证明是否正在使用<strong>连续事务存储</strong>。在客户端检查：<strong>设置-&gt;Dynatrace Server-&gt;存储</strong></p>
<h3 id="_10">步骤九<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<ul>
<li>要证明是否有安装额外插件：客户端：<strong>设置-&gt;Dynatrace Server-&gt;插件</strong></li>
<li>要证明自监控Profile里的所有的<strong>停机时间和事件规则</strong>。</li>
</ul>
<h3 id="_11">步骤十<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p><strong>性能仓库数据库</strong>和<strong>Session存储</strong>：</p>
<ul>
<li>查看当前配置：从客户端：<strong>设置-&gt;Dynatrace Server</strong>，选择左侧面板：<ul>
<li><strong>性能仓库</strong>所有细节包括密码，因为6.1版本密码存储改变过，你需要迁移后重新输入密码。</li>
</ul>
</li>
<li>该向导工作的一部分，要准备好创建备份。</li>
<li>检查<a href="https://community.dynatrace.com/community/display/DOCDT63/System+Requirements#SystemRequirements-pwh">系统需求</a>，是否你的SQL DB server受支持：<ul>
<li>如果不支持，<strong>升级前</strong>创建<strong>备份</strong>并切换到受支持的DB</li>
</ul>
</li>
<li>确认配置<strong>性能仓库</strong>的用户有权限创建和移除DBMS的表。</li>
</ul>
<h3 id="_12">步骤十一<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<h4>会话存储</h4>
<ul>
<li>如果当前存储位置位于安装路径（默认的），并且你想保留sessions，为了简化session存储和未来的迁移，在迁移之前可以<a href="https://community.dynatrace.com/community/display/DOCDT65/Move+Session+Storage+to+a+new+Disk+or+Directory">移动session存储</a>到一个2者（老的和新的安装）都可以访问到的独立目录。</li>
<li>确定当前配置：从客户端： <strong>Settings -&gt; Dynatrace Server</strong>，选择左面版的<strong>存储</strong></li>
<li>创建备份作为升级的一部分。</li>
</ul>
<h3 id="_13">步骤十二<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p>确定下列服务的密码：Email、LDAP、Proxy、DC-RUM、Gomez、数据库。</p>
<h3 id="_14">步骤十三<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p>在现有的<strong>Dynatrace Server</strong>上停用license。可能需要升级现有的license。查看<a href="https://community.dynatrace.com/community/display/DOCDT63/License+Upgrade">license升级文档</a>获取更多信息。</p>
<blockquote>
<p>注意！</p>
<p>如果你使用z/OS Agents，（从6.3开始）不在需要额外的license（LMS - license管理系统）。取而代之的是你需要联系<strong>license 管理</strong>去获得需要数量的CICS和IMS agents 和/或 Java Agents加到你的Server license上。</p>
</blockquote>
<h3 id="_15">步骤十四<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p>迁移之前，需要下载软件：</p>
<ul>
<li>对应应用平台和操作系统的<a href="https://downloads.dynatrace.com/downloads/download.aspx?p=DT">安装包</a> (完整包 或 Server/Collector/Client/Memory Analysis Server 或只是Agent)</li>
<li>最新版的<strong> dynatrace-migration Tool</strong>.</li>
<li><strong>最新的升级包</strong>，如果可用，可以在6.5<a href="https://downloads.dynatrace.com/downloads/download.aspx?p=DT">下载列表</a>的顶部找到。具体参考<a href="https://community.dynatrace.com/community/display/DOCDT65/Install+an+Update">安装升级包</a></li>
<li>如果Server无法联网，从<a href="http://eservices.dynatrace.com/">eServices</a>下载<strong>升级后的licenses</strong></li>
</ul>
<h3 id="_16">步骤十五<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p>如果正在使用自定义keys用于Dynatrace TLS通信（替换<em>keystore.jks</em>)或WebUI（通过<em>com.dynatrace.diagnostics.web.ssl.</em>* 参数），准备好私钥和相应的证书链以防这些需要被重新导入。参见<a href="https://community.dynatrace.com/community/display/DOCDT65/Custom+Certificate+Requirements">自定义证书需求</a></p>
<h3 id="_17">步骤十六<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p>你可以并行运行不同版本的Dynatrace来测试升级情况，另外要了解<strong>并行运行配置需求</strong>。</p>
<p><strong>下一步</strong>：升级Server，Collectors，客户端（见第二章）。</p>
<h3 id="11-agent">1.1 Agent兼容矩阵<a class="headerlink" href="#11-agent" title="Permanent link">&para;</a></h3>
<p>升级Agents取决于他们的类型：</p>
<ul>
<li>当应用重启时，<strong>Bootstrapped Agents</strong>自动升级。</li>
<li>使用了<strong>non-bootstrapped Agents</strong>，需要手动升级。（安装到一个新的目录路径）当应用层被重启，Agent连接字符串必须被指定到新的路径。</li>
</ul>
<p>要查看Agent的版本以及是否有引导程序，使用Dynatrace客户端的<strong>驾驶舱 -&gt; Agent概述</strong>。</p>
<p>尽管老版本Agents连接新版本Collectors是支持的。但是Agents应该尽早升级到Collector的版本 -- 通过安装新的Agents并且重启apps。</p>
<p><em>Agent/Collector 兼容性</em></p>
<table>
<thead>
<tr>
<th>Collector（横）/Agent(竖)</th>
<th>6.0</th>
<th>6.1</th>
<th>6.2</th>
<th>6.3</th>
<th>6.5</th>
</tr>
</thead>
<tbody>
<tr>
<td>5.6</td>
<td>OK</td>
<td>OK</td>
<td>OK</td>
<td>OK</td>
<td>OK</td>
</tr>
<tr>
<td>6.0</td>
<td>OK</td>
<td>OK</td>
<td>OK</td>
<td>OK</td>
<td>OK</td>
</tr>
<tr>
<td>6.1</td>
<td>n/a 1)</td>
<td>OK</td>
<td>OK</td>
<td>OK</td>
<td>OK</td>
</tr>
<tr>
<td>6.2</td>
<td>n/a 1)</td>
<td>n/a 1)</td>
<td>OK</td>
<td>OK</td>
<td>OK</td>
</tr>
<tr>
<td>6.3</td>
<td>n/a 1)</td>
<td>n/a 1)</td>
<td>n/a 1)</td>
<td>OK</td>
<td>OK</td>
</tr>
<tr>
<td>6.5</td>
<td>n/a 1)</td>
<td>n/a 1)</td>
<td>n/a 1)</td>
<td>n/a 1)</td>
<td>OK</td>
</tr>
</tbody>
</table>
<p>1) 在非引导程序Agents之前升级Server和Collectors。</p>
<h2 id="2-servercollectors">2 升级Server，Collectors，客户端<a class="headerlink" href="#2-servercollectors" title="Permanent link">&para;</a></h2>
<p>如果你需要迁移Server到新主机而不是升级到新版本，你只需要执行适当的步骤，例如，不需要停止和安装新的Collectors。</p>
<h3 id="21-servercollectors">2.1 安装新的Server，Collectors和客户端<a class="headerlink" href="#21-servercollectors" title="Permanent link">&para;</a></h3>
<ul>
<li>在所有相关机器上安装新的Dynatrace Server和Dynatrace Collectors和客户端。</li>
<li>应该被安装到<strong>新的目录</strong>，在该向导中被引用做<DT_HOME_NEW>。</li>
</ul>
<p><strong>Windows</strong>：使用完整安装包<strong>自定义</strong>选项或者使用Server, Collector, Client独立安装包。</p>
<blockquote>
<p><strong>重要</strong>：Windows：在安装完成后，推荐手动启动Server, Collector和客户端。<strong>不要在安装时启动这些组件。</strong></p>
<p><a href="https://community.dynatrace.com/community/display/DOCDT63/*NIX">*NIX</a>：<strong>不要</strong>解压<em>.jar</em>。而是运行<br>
<code>java -jar &lt;pathToInstallerJar&gt;/dynatrace-6.5.0.&lt;build&gt;-linux-&lt;bit&gt;.jar</code><br>
</p>
</blockquote>
<p>自动化安装参见<strong>无人值守（静默）安装</strong>。</p>
<h3 id="22">2.2 关闭老版本<a class="headerlink" href="#22" title="Permanent link">&para;</a></h3>
<ol>
<li>关闭老版本客户端，停掉老版本Server，Frontend Server，Collector和内存分析服务器服务。</li>
</ol>
<blockquote>
<p><strong>提示</strong>：关于如何启动和停止Dynatrace 服务可以在<a href="https://community.dynatrace.com/community/display/DOCDT63/How+to+Start+and+Stop+dynaTrace+Services+or+Daemons">这儿</a>找到。</p>
</blockquote>
<ol start="2">
<li>取消老版本Server，Frontend Server，Collector和内存分析服务器的自启动:</li>
</ol>
<ul>
<li><strong>Windows</strong>: <strong>控制面板-&gt;管理员工具-&gt;服务</strong>。在每个服务属性里，设置<strong>启动类型</strong>为<strong>手动</strong>。</li>
<li><em><strong>NIX</strong>: 使用</em>chkconfig<em> 或者</em>update - rc.d *来禁用所有Dynatrace服务。</li>
</ul>
<h3 id="23">2.3 创建备份<a class="headerlink" href="#23" title="Permanent link">&para;</a></h3>
<p>准备期间进行配置信息收集：</p>
<ol>
<li>备份<strong>性能仓库DB</strong></li>
<li>备份<strong>Session存储</strong></li>
<li>在<em><strong>NIX</strong>，备份在</em>/etc/init.d*下的所有Dynatrace脚本。</li>
</ol>
<p><em>DT_HOME</em>的文件在下一步进行备份。</p>
<h3 id="24-servercollector">2.4 服务迁移（Server，Collector和内存分析服务器）<a class="headerlink" href="#24-servercollector" title="Permanent link">&para;</a></h3>
<p>下载并在所有Server和Collector机器上使用最新<a href="https://files.dynatrace.com/downloads/migrationtool/dynatrace-migration.jar">dynatrace-migration tool</a>。对于迁移的更多选项参见<a href="https://community.dynatrace.com/community/display/APMDOC/Migration+Tool+Details">dynatrace-migration Tool 细节</a>或者运行<code>java -jar dynatrace-migration.jar</code></p>
<h4>2.4.1 文件收集</h4>
<p>使用<em>dynatrace-migration</em>创建迁移存档：</p>
<blockquote>
<p><strong>文件收集</strong></p>
<p><code>shell
java -jar dynatrace-migration.jar -migration -sourceDTHome "&lt;DT_HOME_OLD&gt;" -targetArchiveDir "&lt;ARCHIVE_DIR&gt;"</code></p>
</blockquote>
<p><strong><DT_HOME_OLD></strong>是老版本Dynatrace安装路径。名为<Server_name>_<creation_dateTime>.dtma的<MIGRATION_ARCHIVE>文件将会在<ARCHIVE_DIR>中被创建。</p>
<p>保留该生成文件作为永久备份。</p>
<h4>2.4.2 文件迁移</h4>
<p>在目标主机， 要迁移所有Server和Collector实例<DT_HOME_NEW>，使用如下：</p>
<p><strong>推荐迁移方式</strong></p>
<div class="highlight"><pre><span></span>java -jar dynatrace-migration.jar -migration -sourceArchive <span class="s2">&quot;&lt;ARCHIVE_DIR&gt;/&lt;MIGRATION_ARCHIVE&gt;&quot;</span> -targetDTHome <span class="s2">&quot;&lt;DT_HOME_NEW&gt;&quot;</span>
</pre></div>


<p>备份（文件转移到<DT_HOME_NEW>）,迁移日志会在<em><DT_HOME_NEW>/migration/backup/</em> 创建一个新目录。</p>
<p>若果你在这些步骤遇到问题，可以获取支持或者考虑<a href="https://community.dynatrace.com/community/display/DOCDT62/Manual+File+Migration">手动文件迁移</a>。</p>
<h4>2.4.3 编辑配置文件</h4>
<p>最后， dynatrace-migration 会列出可能需要手动迁移到新版本的文件（如配置设置文件）。因此，相关的老版本文件被复制并加上后缀<em>.toBeMigrated</em> 。这些文件位于<DT_HOME_NEW>。<strong>不要复用</strong>这些老版本文件，因为6.3修改过boot bundles，将导致Server无法启动。</p>
<p><strong>以下是示例输出：</strong></p>
<div class="highlight"><pre><span></span>There are some files left, which have to be migrated manually:
In C:\Program Files\dynaTrace\dynaTrace 6.5 :
 \dtanalysisserver.ini -&gt; edit and integrate custom settings from old \dtanalysisserver.ini.toBeMigrated
 \dtcollector.ini -&gt; edit and integrate custom settings from old \dtcollector.ini.toBeMigrated
 \dtfrontendserver.ini -&gt; edit and integrate custom settings from old \dtfrontendserver.ini.toBeMigrated
 \dtserver.ini -&gt; edit and integrate custom settings from old \dtserver.ini.toBeMigrated
 \server\selfmonitoring\dtselfmon.ini -&gt; edit and integrate custom settings from old
\server\selfmonitoring\dtselfmon.ini.toBeMigrated
Do NOT re-use the old files, this may cause components not to start!
</pre></div>


<ul>
<li><em>dtserver.ini</em> ：如果你正在升级，且使用连续事务存储，如果显式指定<code>-Dcom.dynatrace.diagnostics.memory.maxPurePathBufferSize=&lt;x&gt;</code>,则<strong>不要</strong>迁移该参数。</li>
<li>如果从 ＜ 6.1 升级，并且<em>dtserver.ini.toBeMigrated</em> 包含<em>-Dcom.dynatrace.diagnostics.SQLSERVERUSENTLMV2</em>，参考<a href="https://community.dynatrace.com/community/display/DTKB/How+to+connect+the+Performance+Warehouse+to+a+MS+SQL+Server+via+Windows+Authentication">该文章</a>,迁移该条目并且也需要新增2个条目到<em>dtfrontendserver.ini</em>.</li>
<li>迁移所有的-Xmx, -Xms, -XX:PermSize, 和 -XX:MaxPermSize条目。</li>
</ul>
<blockquote>
<p>​<img align="absmiddle" alt="⚠" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/26a0.png" title=":warning:" width="20px"> <strong>自定义证书：</strong> 如果ini文件包含<em>-Dcom.dynatrace.diagnostics.web.ssl.keystore</em>,则一个自定义web认证<a href="https://community.dynatrace.com/community/display/DOCDT62/Configure+SSL+Communication">被配置</a>。不要带上该条目，而是在升级结束后使用新的<a href="https://community.dynatrace.com/community/display/DOCDT65/Certificate+Management">证书管理</a>来roll out之前的证书。</p>
<p>如果修改<em><DT_HOME_OLD>/server/conf/keystore.jks</em>，使用一个自定义证书用于通信，该证书将会被自动迁移。</p>
<p>如果两者都做过配置，推荐升级后使用<a href="https://community.dynatrace.com/community/display/DOCDT65/Certificate+Management">证书管理</a>来切换到一个单一证书。</p>
</blockquote>
<p>更多信息参见<strong>Server配置</strong>和<strong>Collector配置</strong>。</p>
<h4>2.4.4 注册并自动启动额外的Collector 实例</h4>
<p><strong>关于多实例的信息扩展。</strong></p>
<p>如果你在老版本是使用Collector多实例：</p>
<p><strong>Windows</strong>: 对于每个Collector实例，在老版本中使用相同的<code>&lt;CollectorInstanceName&gt;</code>,在目录<DT_HOME_NEW>中，执行：</p>
<div class="highlight"><pre><span></span>dtcollector -service install -instance &lt;CollectorInstanceName&gt;
</pre></div>


<p><strong>*NIX</strong> ：在<code>/etc/init.d</code>中，对于每个Collector示例，会有一个老的启动脚本叫做<code>dynaTraceCollector&lt;NN&gt;</code> ， <code>&lt;NN&gt;</code>是数字。对于每个该文件：</p>
<ul>
<li>
<p>记下变量<em>DT_OPTARGS</em>和<em>DT_INSTANCE</em>的值</p>
</li>
<li>
<p>使用新版本替换：</p>
</li>
</ul>
<div class="highlight"><pre><span></span>cp &lt;DT_HOME_NEW&gt;/init.d/dynaTraceCollector /etc
/init.d/dynaTraceCollector&lt;NN&gt;
</pre></div>


<ul>
<li>编辑<code>/etc/init.d/dynaTraceCollector&lt;NN&gt;</code>并填写<code>DT_OPTARGS</code>和<code>DT_INSTANCE</code>的记录值</li>
</ul>
<h3 id="25">2.5 自动启动新服务<a class="headerlink" href="#25" title="Permanent link">&para;</a></h3>
<p><strong>仅限*NIX</strong>：使用<em>chkconfig</em>或<em>update-rc.d</em>，确保新的Server，Collectors，内存分析服务器，和Frontend Server使用<em>/etc/init.d</em>脚本自动启动，并且权限是正确的。</p>
<h3 id="26">2.6 客户端迁移<a class="headerlink" href="#26" title="Permanent link">&para;</a></h3>
<p>如果你在Dynatrace 客户端里有特殊设置，像是代理设置，比较<DT_HOME_OLD>和<DT_HOME_NEW>中的<em>dtclient.ini</em>,以及：</p>
<ul>
<li><strong>Windows</strong>:<code>C:\Users\&lt;username&gt;\.dynaTrace\dynaTrace 6.5\</code></li>
<li><strong>*NIX</strong>:  <code>~/.dynaTrace/dynaTrace 6.5/</code></li>
</ul>
<p>适用的属性仍然要延续。</p>
<h3 id="27-server">2.7 启动新的Server组件<a class="headerlink" href="#27-server" title="Permanent link">&para;</a></h3>
<p>如果你配置过<em>DT_HOME</em>变量，把它升级到<DT_HOME_NEW>,并且之后启动Dynatrace Server和<strong>Frontend Server</strong>（6.0版本引入）。</p>
<h3 id="28">2.8 启动新的客户端<a class="headerlink" href="#28" title="Permanent link">&para;</a></h3>
<p>在<DT_HOME_NEW>里启动<em>dtclient</em>或者使用<a href="https://community.dynatrace.com/community/display/DOCDT63/Webstart+Client">Webstart Client</a>: <code>http://&lt;servername&gt;:8020</code>。在<strong>设置-&gt;Dynatrace Server-&gt;连接状态</strong>面板配置，确保连接到正确的Dynatrace Server（hostname）。</p>
<h3 id="29-serverlicenses">2.9 激活新的Server的licenses<a class="headerlink" href="#29-serverlicenses" title="Permanent link">&para;</a></h3>
<p>如过你需要代理服务器来访问互联网，手动配置<a href="https://community.dynatrace.com/community/display/DOCDT63/Licensing+Details#LicensingDetails-proxysettings">代理服务器设置来访问eServices的在线liensing站点</a>.</p>
<h3 id="210-server-sizing">2.10 选择Server Sizing<a class="headerlink" href="#210-server-sizing" title="Permanent link">&para;</a></h3>
<p>license导入后，会显示选择不同的sizing选项（参见<a href="https://community.dynatrace.com/community/display/DOCDT63/Sizing+Settings">Sizing设置</a>获取更多信息。）选择在准备阶段验证过的Sizing。<strong>在启动新的Collectors之前</strong>执行这一步骤很重要，可以避免内存溢出问题。</p>
<h3 id="211-dynatrace">2.11 升级新的Dynatrace<a class="headerlink" href="#211-dynatrace" title="Permanent link">&para;</a></h3>
<p>检查<a href="https://downloads.dynatrace.com/downloads/download.aspx?p=DT">下载页面</a>是否有Dynatrace 6.5的升级包，使用客户端<a href="https://community.dynatrace.com/community/display/DOCDT65/Install+an+Update">安装升级包</a>，然后按照说明做。升级包安装好后会重启和升级Collectors和Agents。</p>
<h3 id="212">2.12 连接性能仓库<a class="headerlink" href="#212" title="Permanent link">&para;</a></h3>
<p>在<strong>设置-&gt;Dynatrace Server-&gt;性能仓库</strong>，验证连接细节并且输入数据库授权信息来连接到老的数据库。</p>
<p>点击<strong>测试</strong>,如果DB连接状态正常，点击<strong>连接</strong>。</p>
<p>Server会自动升级schema和数据到最新版本。这可能会花费大概5分钟。</p>
<h3 id="213-session">2.13 配置Session存储<a class="headerlink" href="#213-session" title="Permanent link">&para;</a></h3>
<p>如果你想迁移已存储的sessions，在<strong>设置-&gt;Dynatrace Server-&gt;存储</strong>修改目录到你的session存储数据。</p>
<h3 id="214-collectors">2.14 启动新的Collectors<a class="headerlink" href="#214-collectors" title="Permanent link">&para;</a></h3>
<p>启动新的Collectors，然后在<strong>设置-&gt;Dynatrace Server-&gt;Collectors</strong>面板确保所有的Collectors已连接到新的Server。如果你应用过升级（到新的Server），你应该在当前的对话框中立刻重启Collectors，确保应用升级。</p>
<p>Dynatrace Server和Collector现在将接收Agent的连接。</p>
<p><strong>下一步</strong>：升级Agents（见第三章）。</p>
<h3 id="215">2.15 手动文件迁移<a class="headerlink" href="#215" title="Permanent link">&para;</a></h3>
<p>不推荐手动迁移文件。如果使用迁移工具出现问题，请开ticket。</p>
<h2 id="3-agents">3 升级Agents<a class="headerlink" href="#3-agents" title="Permanent link">&para;</a></h2>
<h3 id="31-agents">3.1 升级Agents<a class="headerlink" href="#31-agents" title="Permanent link">&para;</a></h3>
<p>那么推荐升级Agents到最新而且将需要接收升级包。</p>
<h4>3.1.1 Bootstrapped Agents(Java, .NET, HOST, Native ADK, Web Server, PHP, CICS, and IMS)</h4>
<p>Bootstrapped Agents重启时自动升级。到那时，老的Agents会尝试连接运行中的 Collector/Server。参见在兼容性矩阵中关于重启考量的详细描述（见1.1）。</p>
<p>如果你从＜6.0升级，并且想使用<a href="https://community.dynatrace.com/community/display/DOCDT63/Updates">Controlled Update Rollout</a>,那么你必须重新安装Agents到<strong>升级它们的bootstrap组件</strong>（见3.3）。</p>
<p>如果你有 与你在升级的同一台主机上的bootstrapped Agents，它们将升级，但是会<strong>继续使用<DT_HOME_OLD></strong>目录来恢复它们的配置。因此，需要手动迁移它们的配置文件到<DT_HOME_NEW>(新版本安装目录)或为了相关配置继续使用<DT_HOME_OLD>。查看特殊Agent 配置获取更多细节（见3.1.1下文）。</p>
<h5>Bootstrapped Web Server Agents</h5>
<p>使用正确顺序来重启Web Server Agent 服务和Web Server Agent是必要的。第一次重启Web Server Agent 服务并且等待直至重新连接。然后重启Web Server Agent。这个步骤是必须的以确保两个Agents都升级到正确的版本。对于老版本的，Apache Web Server自动启动Web Server Agent服务的Unix安装，Apache Web Server可能需要二次重启。</p>
<p>如果你想从客户端重启Webserver Agent 服务，那么你必须升级bootstrap(见3.3)。</p>
<h5>NGINX Web Server Agent</h5>
<p>6.2中，JSON偏移量文件包括比6.1更多的数据。如果NGINX binary包含debug标志，重命名JSON文件就好，Agent启动时它将被自动再次生成。然而，如果stripped NGINX binary被使用，偏移量文件需要在NGINX Agent重启前被手动再次生成，否则升级后的Agent将无法启动。</p>
<p>使用下列命令行重命名偏移量(offset)文件:</p>
<div class="highlight"><pre><span></span>&lt;AGENT_HOME&gt;/agent/conf/ngx_offset_gen.sh &lt;nginx binary&gt; &lt;nginx debug symbols file&gt; &lt;JSON offset file&gt;
</pre></div>


<h4>3.1.2 Non-bootstrapped Agents需要手动升级（浏览器和移动APP ADK）</h4>
<p>在<a href="https://downloads.compuwareapm.com/downloads/download.aspx?p=DT">这儿</a>找到新的浏览器Agent安装包和新的ADK版本。</p>
<p>瞎子啊并应用新的Agent-only安装包升级到最新的浏览器Agent。</p>
<p>在移动APP开发环境，切换到新的ADK并部署新版本升级。</p>
<h4>3.1.3 z/OS Agents</h4>
<p>它们可以被 bootstrapped 或 non-bootstrapped。参见<strong>升级zOS Agents</strong>（见3.4）。</p>
<h3 id="32-agents">3.2 重启Agents<a class="headerlink" href="#32-agents" title="Permanent link">&para;</a></h3>
<p>除非你已经升级并手动重启Agents，否则请<strong>对你所有相关的应用现在执行重启</strong>来升级Agents。</p>
<p><strong>下一步</strong>：最终检查（见第四章）</p>
<h3 id="33-bootstrap-agents">3.3 升级Bootstrap Agents<a class="headerlink" href="#33-bootstrap-agents" title="Permanent link">&para;</a></h3>
<p>Dynatrace是6.5版本不支持bootstrap agents &lt; 6.0 。 使用该向导升级6.0之前的 bootstrap agents到最新版本。</p>
<h4>3.3.1 准备</h4>
<ol>
<li>从<a href="https://downloads.dynatrace.com/downloads/download.aspx?p=DT">downloads.dynatrace.com</a>下载对应平台的新的agent安装包。</li>
<li>备份当前agent的配置文件目录</li>
<li>在你的目标平台上部署和安装agent靠近当前正在使用的agents安装。</li>
</ol>
<h4>3.3.2 Bootstrap agent升级过程</h4>
<h5>Host Agent</h5>
<ol>
<li>停掉所有老版本的host agent</li>
<li>将<em>/conf/dthostagent.ini</em>（主要是名称和对应server）从老目录迁移到新目录。</li>
<li>启动新的host agent。</li>
</ol>
<h5>Webserver Agent</h5>
<ol>
<li>停掉老版本的web server agent</li>
<li>将<em>conf/dtwsagent.ini</em>从老目录迁移到新安装目录。</li>
<li>启动新的web server agent</li>
</ol>
<h5>Java Agent</h5>
<ol>
<li>重新在应用配置里配置agent路径（如从-agentpath:/opt/dynatrace-5.6.0/agent/lib64/libdtagent.<br>
   so=name=Application_Monitoring  到  -agentpath:/opt/dynatrace-6.2/agent/lib64<br>
   /libdtagent.so=name=Application_Monitoring）。:light:你也可以安装和配置一个与版本无关的agent路径（如/opt/dynatrace-agent/)，并移除老版本，安装新版本到同一目录。</li>
<li>重启应用。</li>
</ol>
<h5>.NET Agent</h5>
<ol>
<li>安装好新agents后重启应用</li>
</ol>
<h5>zOS zLocal/zRemote agent</h5>
<ol>
<li>升级zLocal/zRemote agents将自动升级bootstrap agents。请参考说明（见3.4）。</li>
</ol>
<h4>3.3.3 卸载过时agents</h4>
<ul>
<li>Linux：简单删除过时agents的安装目录</li>
<li>Windows：使用添加/删除应用卸载过时agents。</li>
</ul>
<h3 id="34-zos-agents">3.4 升级zOS Agents<a class="headerlink" href="#34-zos-agents" title="Permanent link">&para;</a></h3>
<h4>3.4.1 前提条件</h4>
<h5>升级Dynatrace Servers，Collectors，Agents和性能仓库</h5>
<p>在启动z/OS Agents的任何迁移操作之前，先阅读通用<strong>升级</strong>（见前言）到6.5向导并创建一份详细的Dynatrace Servers，Collectors，其他Agents，性能仓库和其他组件的升级计划。为了减少维护开票，协调应用程序重启来配合这些升级。</p>
<blockquote>
<p>​<img align="absmiddle" alt="⚠" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/26a0.png" title=":warning:" width="20px"> <strong>重要</strong></p>
<p>Dynatrace 6.2版本， z/OS Agent不先通过zRemote Agent则无法直接连接到Dynatrace Collector。使用zRemote Agent是为了减少z/OS上的CPU开销。如果你现在的6.2之前的z/OS Agent部署忽略了zRemote Agent，作为升级的一部分你需要安装它。更多信息参见<strong>zRemote Agent</strong>(见下文)。</p>
</blockquote>
<h5>License</h5>
<p>你需要Dynatrace Server和z/OS Agents的有效licenses。参考<a href="https://community.dynatrace.com/community/display/DOCDT63/License+Upgrade">license 升级</a>获取更多信息。z/OS Agent的license是基于MIPS的。参见<strong>准备升级</strong>（见第一章）和<a href="https://community.dynatrace.com/community/display/DOCDT63/License+Upgrade">license 升级</a>获取更多信息。</p>
<p>对于任何Dynatrace 版本（预生产/测试中心或生产），z/OS license是有效的。如果硬件（“fingerprint”）发生改变（例如，加了一个CPU），license会失效，并且必须在14天内更新。</p>
<h4>3.4.2 升级步骤</h4>
<ol>
<li>
<p>如升级描述（见前言）将Dynatrace Server和Collector优先升级到6.5，以此来升级主框架组件。新的zOS Agents一般无法与老的Dynatrace Collectors或Servers兼容，反而是新的Dynatrace Collectors或Servers通常可以和老的zOS Agents一起工作。</p>
</li>
<li>
<p>按照标准Agent 安装步骤。这包括：运行JCL来下载agent 分发文件，运行SMP/E来为新版本填入目标数据集。更多信息，参考<strong>下载并SMP/E 安装z/OS Agent组件</strong>（见下文）。</p>
</li>
<li>
<p>第二步之后，你可以选择下文的1或2的其中一个来做：</p>
</li>
<li>
<p>停掉当前zDC，并升级zDC认证库到6.5版。重启z/DC之前，你应该确保zDC参数<em>DTMSG_SMOSIZE</em>已经去掉注释，而且参数<em>DTMSG_QSIZE</em>已经被删除。这些参数控制无论信息已经队列进入zDC数据空间还是zDC 64位共享内存对象（SMO）挂起他们的写入，到Dynatrace Agent。       5.6版本，数据空间已经被弃用。如果你在5.6版本中自定义了ZDCSYSIN 样例，你可以跳过该步骤因为该样例已经包含了该变更。zDC启动后，CICS和IMS agents 应该在5分钟内注册。 <strong>- OR -</strong></p>
</li>
<li>为zDC和zLocal（原名USS）Agent创建并行6.5环境。按照<strong>安装zDC</strong>（见上文）的指引。在并行6.5环境，当你迁移独立的CICS区域和IMS控制区域到新的zDC时,你可以继续运行老的z/DC，或者你可以优先测试几个区域来升级默认的zDC。如果多个zDC在运行，指定为DEFAULT（YES）的那个将被选中除非在CICS或IMS系统初始化字段指定了一个INITPARM参数，那样的话它必须使用一个独有名称：INITPARM=(ZDTPLT6x='xxxx')连接到zDC。</li>
</ol>
<blockquote>
<p>​ <img align="absmiddle" alt="⚠" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/26a0.png" title=":warning:" width="20px"> <strong>注意</strong></p>
<ul>
<li>有DEFAULT（YES）选项，每个LPAR只有一个zDC。</li>
<li>每个zDC的SUBSYSTEM_ID必须独一无二。</li>
<li>zDC STEPLIB使用的库必须被授权。</li>
</ul>
</blockquote>
<ol start="4">
<li>
<p>当bootstrap Agent 第一次连接到升级后的Dynatrace Collector/Server，会自动升级zLocal Agent。如果使用z/OS UNIX Agent的 non-bootstrap 版本，你必须运行 COPYAGNT来复制新版本到z/OS UNIX文件系统的相应执行位置。参考位于<strong>安装zDC</strong>中的COPYAGNT步骤（见上文）。</p>
</li>
<li>
<p>因为Dynatrace新版本zDC兼容老的CICS和IMS agents，你不需要立刻升级所有的CICS区域和IMS控制区域。然而，如果你监控跨CICS区域或IMS控制区域的事务，这些相关区域应该agent版本相同，否则会有未完成的PurePath。因此，CICS区域和IMS控制区域的升级应该考虑应用组群来做。尽早计划升级所有的CICS区域和IMS控制区域，以此来使用最新Dynatrace版本的功能。</p>
</li>
<li>
<p>要升级CICS区域，使用新的PDS（或它的内容）来替换老的PDS（或它的内容）DFHRPL concatenation。</p>
<p><code>// DD DISP=SHR,DSN=&lt;hlq&gt;.LZDT6 30.SZDTLOAD</code></p>
</li>
<li>
<p>要升级IMS控制区域，在JCL，执行IMS Agent注入程序，ZDTIINST，使用新的PDS（或它的内容）来替换STEPLIB PDS（或它的内容）。</p>
<p><code>// DD DISP=SHR,DSN=&lt;hlq&gt;.LZDT6 30.SZDTAUTH</code></p>
</li>
</ol>
<blockquote>
<p>​<img align="absmiddle" alt="⚠" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/26a0.png" title=":warning:" width="20px"> <strong>注意</strong></p>
<ul>
<li>STEPLIB使用的库必须被授权。</li>
</ul>
</blockquote>
<p>关于Dynatrace组件兼容性列表，请参考<a href="https://community.compuwareapm.com/community/display/DOCDT56/zOS+Agent+Troubleshooting#zOSAgentTroubleshooting-MigrationTroubleshooting">迁移故障排除</a>。</p>
<h2 id="4_1">4 最终检查<a class="headerlink" href="#4_1" title="Permanent link">&para;</a></h2>
<h3 id="41">4.1 检查配置<a class="headerlink" href="#41" title="Permanent link">&para;</a></h3>
<h4>4.1.1 应用自定义配置，不要被自动化的覆盖</h4>
<h5>事件规则和停机时间</h5>
<p>你需要重新定义Self-Monitoring系统配置文件的所有<a href="https://community.dynatrace.com/community/display/DOCDT63/Incidents+and+Alerting">停机时间</a>和<a href="https://community.dynatrace.com/community/display/DOCDT63/Incidents+and+Alerting">事件规则</a>。</p>
<h5>在自带项：传感器包 中重新应用修改项</h5>
<p>dynatrace-migration不会迁移随着产品安装和分发的项，像是内置传感器包。因为这些在不同版本可能有改动，你不应该简单导出和导入它们，而是应该重新配置编辑。</p>
<h5>检查用户插件</h5>
<p>在Dynatrace 客户端：<strong>设置-&gt;Dynatrace Server</strong>，检查是否所有的插件被迁移，是否需要重新安装。</p>
<h5>重新导入LDAP认证</h5>
<p>如果额外认证（如为LDAP创建的CA或自签名证书）被导入到Dynatrace的keystore：</p>
<ul>
<li>server/conf/jssecacerts</li>
</ul>
<p>重新导入证书到新的keystore。不要复制老的keystores，以此来避免通过潜在的被盗用的公有证书的安全漏洞。</p>
<p>在LDAP证书的案例中，你可以通过使用Dynatrace本地用户登陆并点击Dynatrace客户端：<strong>设置-&gt;Dynatrace Server-&gt;用户-&gt;LDAP-&gt;测试连接</strong>来重新导入之前的证书。</p>
<h3 id="42-dynatrace-server">4.2 确认新的Dynatrace Server的运行<a class="headerlink" href="#42-dynatrace-server" title="Permanent link">&para;</a></h3>
<p>为确保新的Server正常运转，验证下列内容：</p>
<ul>
<li><strong>驾驶舱-&gt;状态概述-&gt;agent概述</strong>中显示了所有的Agents：<ul>
<li>已连接</li>
<li>有数据到达：水平滚动来验证<strong>事件计数</strong> 或 <strong>类加载计数</strong> （或2个一起）的变化</li>
<li>如果安装了，有正确的Agent版本（6.5）和升级版本。</li>
</ul>
</li>
<li>有PurePath</li>
<li>仪表板正确显示</li>
<li>如果迁移了Session存储，历史数据可以展现</li>
<li>如果使用自定义证书，通过Server的<a href="http://localhost:8020/">http://localhost:8020/</a> 站点来验证。</li>
<li>验证这些服务和连机器工作：Email、LDAP、Proxy、DC-RUM、Gomez</li>
<li>查看<strong>开始中心 -&gt; 管理</strong>的告警和错误。</li>
</ul>
<blockquote>
<p>​<img align="absmiddle" alt="☑" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2611.png" title=":ballot_box_with_check:" width="20px"> <strong>恭喜！</strong></p>
<p>迁移完成！</p>
</blockquote>
<h2 id="5">5 故障排除<a class="headerlink" href="#5" title="Permanent link">&para;</a></h2>
<h3 id="51">5.1 常见问题<a class="headerlink" href="#51" title="Permanent link">&para;</a></h3>
<h4>什么版本Agent在运行</h4>
<p>Server/Collector升级后，Agent bootstrap 升级部分现有Agent，但是老版本Agents会一直运行直到你重启了应用。</p>
<p>请准备一个应用层的重启计划/协调。</p>
<p>你可以在<strong>驾驶舱-&gt;Agent概述</strong>里找到Agent版本信息（bootstrap和活动部分）。</p>
<h4>我的性能仓库DB schema是哪个版本</h4>
<p>当新的Dynatrace Server连接到老的性能仓库DB时，Dynatrace DB schema被升级。因此，如果你不确定版本，在连接前检查一下是个好主意。</p>
<p>对于SQL Server，例如：</p>
<div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">dynatrace6</span> <span class="mi">5</span><span class="p">.</span><span class="n">dbo</span><span class="p">.</span><span class="k">version</span><span class="p">;</span>
</pre></div>


<h4>性能仓库DB schema向后兼容吗</h4>
<p>不兼容。请使用DB备份进行回滚。</p>
<h4>升级后PurePath丢失</h4>
<p>如果升级时没有迁移类缓存，且有丢失的PurePath或者PurePath包含<code>&lt;unknown&gt;</code>节点，尝试重启相关应用。需要重启<strong>2次</strong>来避免该问题。</p>
<h4>为什么dtserver.ini和dtfrontendserver.ini中的内存设置被忽略甚至移除</h4>
<p>从Dynatrace 6.0开始，‘-Xmx’和‘-Xms’ VM参数被忽略。请通过<strong>设置-&gt;Dynatrace Server-&gt;设置面板-&gt;Sizing</strong>来选择合适的sizing。更多信息，见<a href="https://community.dynatrace.com/community/display/DOCDT63/Sizing+Settings">Sizing 设置</a>。</p>
<h3 id="52-dynatrace">5.2 Dynatrace 支持<a class="headerlink" href="#52-dynatrace" title="Permanent link">&para;</a></h3>
<p>如果需要更多支持，请访问我们的<strong>支持页面</strong>。</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://www.EWhisper.cn/tag/dynatrace.html">Dynatrace</a>
      <a href="https://www.EWhisper.cn/tag/observability.html">Observability</a>
    </p>
  </div>

  <div class="center social-share">
    <p>喜欢这篇文章吗？将它与您的朋友分享吧！</p>
    <div class="addthis_native_toolbox"></div>
    <div class="addthis_sharing_toolbox"></div>
    <div class="addthis_inline_share_toolbox"></div>
  </div>

  <div class="neighbors">
    <a class="btn float-left" href="https://www.EWhisper.cn/dynatrace-appmon-handbook-27-use-dynatrace-appmon-web-console.html" title="Dynatrace AppMon 实战手册 - 27.Dynatrace Web 客户端使用说明">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="https://www.EWhisper.cn/dynatrace-appmon-handbook-29-analysis-a-app-slowdown-problem.html" title="Dynatrace AppMon 实战手册 - 29.某保险公司核心系统变慢问题分析">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4>您可能还喜欢</h4>
    <ul class="related-posts">
      <li><a href="https://www.EWhisper.cn/capture-any-method-param-value.html">抓取系统中的任何方法的参数值</a></li>
      <li><a href="https://www.EWhisper.cn/howto-monitor-nonHTTP-or-batchjob-application.html">非HTTP应用或批处理应用如何进行全链路监控</a></li>
      <li><a href="https://www.EWhisper.cn/mule-cannot-receive-TCP-messages-problem-analysis.html">MULE 无法接收TCP报文问题分析</a></li>
      <li><a href="https://www.EWhisper.cn/dynatrace-appmon-handbook-29-analysis-a-app-slowdown-problem.html">Dynatrace AppMon 实战手册 - 29.某保险公司核心系统变慢问题分析</a></li>
      <li><a href="https://www.EWhisper.cn/dynatrace-appmon-handbook-27-use-dynatrace-appmon-web-console.html">Dynatrace AppMon 实战手册 - 27.Dynatrace Web 客户端使用说明</a></li>
    </ul>
  </div>


</article>

    <footer>
<p>
  &copy;  2020 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p><a href="http://beian.miit.gov.cn" target="_blank">沪ICP备19007314号-1</a></p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
<!-- StatusCake -->
<a href="https://www.statuscake.com" title="个人技术分享 Uptime">
  <img src="https://app.statuscake.com/button/index.php?Track=CbJdcjmnCx&amp;Days=7&amp;Design=7" alt="个人技术分享 Uptime"/>
</a>

<!-- End StatusCake --></p>    </footer>
  </main>


    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c98c3e21c4def55" async="async"></script>


<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " 个人技术分享 ",
  "url" : "https://www.EWhisper.cn",
  "image": "//s.gravatar.com/avatar/7c743bc6ac83171e35a5aa8bd66cc1ea?s=120",
  "description": "Focus on Python/Java/DevOps/Observability"
}
</script>

<a href="https://github.com/east4ming/my-pelican" class="github-corner" aria-label="View source on Github">
    <svg width="80"
         height="80"
         viewBox="0 0 250 250"
         style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
         aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor"
              style="transform-origin: 130px 106px;"
              class="octo-arm">
        </path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor"
              class="octo-body">
        </path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></body>
</html>