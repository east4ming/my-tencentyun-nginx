
<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://www.EWhisper.cn/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://www.EWhisper.cn/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://www.EWhisper.cn/theme/font-awesome/css/font-awesome.min.css">

    <link href="https://www.EWhisper.cn/static/custom.css" rel="stylesheet">


    <link href="https://www.EWhisper.cn/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="ä¸œé£å¾®é¸£ Blog RSS">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

<!-- Google Analytics -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-136986082-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- End Google Analytics -->
    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">

<meta name="author" content="ä¸œé£å¾®é¸£" />
<meta name="description" content="ç¼–å†™è‡ªå·±çš„Python Webæ¡†æ¶, å®ç°: WSGIå…¼å®¹; è¯·æ±‚å¤„ç†ç¨‹åº; è·¯ç”±ï¼šç®€å•å’Œå‚æ•°åŒ–" />
<meta name="keywords" content="python, webæ¡†æ¶">

<meta property="og:site_name" content="ä¸œé£å¾®é¸£ Blog"/>
<meta property="og:title" content="å¦‚ä½•ç¼–å†™Python Webæ¡†æ¶ï¼ˆä¸€ï¼‰"/>
<meta property="og:description" content="ç¼–å†™è‡ªå·±çš„Python Webæ¡†æ¶, å®ç°: WSGIå…¼å®¹; è¯·æ±‚å¤„ç†ç¨‹åº; è·¯ç”±ï¼šç®€å•å’Œå‚æ•°åŒ–"/>
<meta property="og:locale" content="zh_CN"/>
<meta property="og:url" content="https://www.EWhisper.cn/write-python-framework-part-one.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-03-01 14:44:00+08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://www.EWhisper.cn/author/dong-feng-wei-ming.html">
<meta property="article:section" content="Python"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="webæ¡†æ¶"/>
<meta property="og:image" content="//s.gravatar.com/avatar/7c743bc6ac83171e35a5aa8bd66cc1ea?s=120">

  <title>ä¸œé£å¾®é¸£ Blog &ndash; å¦‚ä½•ç¼–å†™Python Webæ¡†æ¶ï¼ˆä¸€ï¼‰</title>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-2290120018010607",
      enable_page_level_ads: true
    });
  </script>
<!-- Google Tag Manager -->
<script>
  (function(w,d,s,l,i){
    w[l]=w[l]||[];
    w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
    var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
    j.async=true;
    j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;
    f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-T9334L3');
</script>
<!-- End Google Tag Manager --></head>
<body>
<!-- Google Tag Manager -->
<noscript>
  <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T9334L3" height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<!-- End Google Tag Manager -->  <aside>
    <div>
      <a href="https://www.EWhisper.cn">
        <img src="//s.gravatar.com/avatar/7c743bc6ac83171e35a5aa8bd66cc1ea?s=120" alt="ä¸œé£å¾®é¸£" title="ä¸œé£å¾®é¸£">
      </a>
      <h1><a href="https://www.EWhisper.cn">ä¸œé£å¾®é¸£</a></h1>

<p>Focus on Python/Java/DevOps/Observability</p>
      <nav>
        <ul class="list">
          <li><a href="https://www.EWhisper.cn/pages/about.html#about">About</a></li>
          <li><a href="https://www.EWhisper.cn/pages/contact.html#contact">Contact</a></li>

          <li><a href="http://www.miitbeian.gov.cn/" target="_blank">æ²ªICPå¤‡19007314å·-1</a></li>
        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-wechat" href="/images/wechat_paycode.png" target="_blank"><i class="fa fa-wechat"></i></a></li>
        <li><a class="sc-envelope-o" href="mailto:cuikaidong@foxmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-reddit" href="https://www.jianshu.com/u/0f08daeaa5a9" target="_blank"><i class="fa fa-reddit"></i></a></li>
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/å‡¯ä¸œ-å´”-136128116/" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-weibo" href="https://weibo.com/long5to2gf" target="_blank"><i class="fa fa-weibo"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://www.EWhisper.cn">ä¸»é¡µ</a>

      <a href="/archives/index.html">å­˜æ¡£</a>
      <a href="/categories.html">ç±»åˆ«</a>
      <a href="/tags.html">æ ‡ç­¾</a>
      <a href="/authors.html">ä½œè€…</a>


      <a href="https://www.EWhisper.cn/feeds/all.rss.xml">RSSè®¢é˜…</a>
    </nav>

<article class="single">
  <header>
    <h1 id="write-python-framework-part-one">å¦‚ä½•ç¼–å†™Python Webæ¡†æ¶ï¼ˆä¸€ï¼‰</h1>
    <p>
      åœ¨ 2019-03-01 Friday å‘å¸ƒäº <a href="https://www.EWhisper.cn/category/python.html">Python</a> åˆ†ç±»

        &#8226; 3 min read
    </p>
  </header>


  <div>
    <blockquote>
<p>è¯‘æ–‡:</p>
<p>åŸæ–‡é“¾æ¥: <a href="http://rahmonov.me/posts/write-python-framework-part-one/">How to write a Python web framework. Part I.</a></p>
<p>ä½œè€…: Jahongir Rahmonov</p>
</blockquote>
<p>â€œä¸è¦é‡æ–°å‘æ˜è½®å­â€æ˜¯æˆ‘ä»¬æ¯å¤©å¬åˆ°çš„æœ€å¸¸è§çš„å’’è¯­ä¹‹ä¸€ã€‚ä½†æ˜¯å¦‚æœæˆ‘æƒ³äº†è§£æ›´å¤šæœ‰å…³è½¦è½®çš„ä¿¡æ¯æ€ä¹ˆåŠï¼Ÿå¦‚æœæˆ‘æƒ³å­¦ä¹ å¦‚ä½•åˆ¶ä½œè¿™ä¸ªè¯¥æ­»çš„è½¦è½®æ€ä¹ˆåŠï¼Ÿæˆ‘è®¤ä¸ºä¸ºäº†å­¦ä¹ è€Œé‡æ–°å‘æ˜å®ƒæ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚å› æ­¤ï¼Œåœ¨è¿™äº›ç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬å°†ç¼–å†™è‡ªå·±çš„Python Webæ¡†æ¶ï¼Œä»¥äº†è§£åœ¨Flaskï¼ŒDjangoå’Œå…¶ä»–æ¡†æ¶ä¸­å¦‚ä½•å®Œæˆæ‰€æœ‰è¿™äº›é­”æœ¯ã€‚</p>
<p>åœ¨æœ¬ç³»åˆ—çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºæ¡†æ¶ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ã€‚æœ€åï¼Œæˆ‘ä»¬å°†æœ‰è¯·æ±‚å¤„ç†ç¨‹åº(request handlers)ï¼ˆç±»ä¼¼Django è§†å›¾ viewsï¼‰å’Œè·¯ç”±(routing)ï¼šæ—¢æœ‰ç®€å•ï¼ˆå¦‚<code>/books/</code>ï¼‰è¯·æ±‚ä¹Ÿæœ‰å‚æ•°åŒ–ï¼ˆå¦‚<code>/greet/{name}</code>ï¼‰è¯·æ±‚ã€‚</p>
<p>åœ¨æˆ‘å¼€å§‹åšæ–°äº‹ç‰©ä¹‹å‰ï¼Œæˆ‘æƒ³è€ƒè™‘æœ€ç»ˆç»“æœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨ä¸€å¤©ç»“æŸæ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨ç”Ÿäº§ä¸­ä½¿ç”¨æ­¤æ¡†æ¶ï¼Œå› æ­¤æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„æ¡†æ¶ç”±å¿«é€Ÿï¼Œè½»é‡çº§çš„ç”Ÿäº§çº§åº”ç”¨ç¨‹åºæœåŠ¡å™¨æä¾›æœåŠ¡ã€‚åœ¨è¿‡å»çš„å‡ å¹´é‡Œï¼Œæˆ‘ä¸€ç›´åœ¨æˆ‘çš„æ‰€æœ‰é¡¹ç›®ä¸­ä½¿ç”¨<a href="https://gunicorn.org/">gunicorn</a>ï¼Œæˆ‘å¯¹ç»“æœéå¸¸æ»¡æ„ã€‚é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥ç”¨<code>gunicorn</code>å§ã€‚</p>
<p><code>Gunicorn</code>æ˜¯ä¸€ä¸ª<a href="http://rahmonov.me/posts/what-the-hell-is-wsgi-anyway-and-what-do-you-eat-it-with/">WSGI</a> HTTPæœåŠ¡å™¨ï¼Œå› æ­¤å®ƒéœ€è¦åº”ç”¨ç¨‹åºçš„ç‰¹å®šå…¥å£ç‚¹ã€‚å¦‚æœä½ ä¸çŸ¥é“ä»€ä¹ˆ<code>WSGI</code>æ˜¯ä»€ä¹ˆ, <a href="http://rahmonov.me/posts/what-the-hell-is-wsgi-anyway-and-what-do-you-eat-it-with/">å¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« </a>ï¼Œæˆ‘ä¼šç­‰å¾…ã€‚å¦åˆ™ï¼Œä½ æ— æ³•ç†è§£è¿™ç¯‡åšæ–‡çš„å¤§éƒ¨åˆ†å†…å®¹ã€‚</p>
<p>æ‚¨æ˜¯å¦äº†è§£äº†WSGIæ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœäº†è§£äº†ã€‚é‚£æˆ‘ä»¬å°±ç»§ç»­å§ã€‚</p>
<p>è¦ä¸WSGIå…¼å®¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯è°ƒç”¨çš„å¯¹è±¡ï¼ˆå‡½æ•°æˆ–ç±»ï¼‰ï¼Œå®ƒéœ€è¦ä¸¤ä¸ªå‚æ•°ï¼ˆ<code>environ</code>å’Œ<code>start_response</code>ï¼‰å¹¶è¿”å›ä¸€ä¸ªWSGIå…¼å®¹çš„å“åº”ã€‚é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹å†™ä»£ç ã€‚</p>
<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"> è¯‘è€…æ³¨:</p>
<p>ç¼–ç¨‹ç¯å¢ƒ: Linuxæˆ–MacOS (windowsç³»ç»Ÿä¸é€‚ç”¨è¯¥æ•™ç¨‹)</p>
</blockquote>
<p>æƒ³ä¸€ä¸ªæ¡†æ¶çš„åç§°å¹¶åˆ›å»ºå…·æœ‰è¯¥åç§°çš„æ–‡ä»¶å¤¹ã€‚æˆ‘æŠŠå®ƒå‘½åä¸º<code>bumbo</code>ï¼š</p>
<div class="highlight"><pre><span></span>mkdir bumbo
</pre></div>


<p>è¿›å…¥æ­¤æ–‡ä»¶å¤¹ï¼Œåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒå¹¶æ¿€æ´»å®ƒï¼š</p>
<div class="highlight"><pre><span></span><span class="nb">cd</span> bumbo
python3.6 -m venv venv
<span class="nb">source</span> venv/bin/activate
</pre></div>


<p>ç°åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code>app.py</code> çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œå­˜å‚¨æˆ‘ä»¬çš„<code>gunicorn</code>å…¥å£ç‚¹ï¼š</p>
<div class="highlight"><pre><span></span>touch app.py
</pre></div>


<p>åœ¨è¿™ä¸ª<code>app.py</code>å†…éƒ¨ï¼Œè®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªç®€å•çš„å‡½æ•°æ¥æŸ¥çœ‹å®ƒæ˜¯å¦å¯ä»¥å’Œ<code>gunicorn</code>ä¸€èµ·å·¥ä½œï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># app.py</span>

<span class="k">def</span> <span class="nf">app</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
    <span class="n">response_body</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;Hello, World!&quot;</span>
    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;200 OK&quot;</span>
    <span class="n">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">[])</span>
    <span class="k">return</span> <span class="nb">iter</span><span class="p">([</span><span class="n">response_body</span><span class="p">])</span>
</pre></div>


<p>å¦‚ä¸Šæ‰€è¿°ï¼Œè¿™ä¸ªå¯è°ƒç”¨çš„å…¥å£ç‚¹æ¥æ”¶ä¸¤ä¸ªå‚æ•°ã€‚å…¶ä¸­ä¹‹ä¸€<code>environ</code>æ˜¯å­˜å‚¨æœ‰å…³è¯·æ±‚çš„å„ç§ä¿¡æ¯ï¼Œä¾‹å¦‚è¯·æ±‚æ–¹æ³•ï¼ŒURLï¼ŒæŸ¥è¯¢å‚æ•°ç­‰ã€‚ç¬¬äºŒä¸ª<code>start_response</code>é¡¾åæ€ä¹‰æ˜¯å¼€å§‹å“åº”çš„ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•ç”¨<code>gunicorn</code>è¿è¡Œæ­¤ä»£ç ã€‚å¯¹äº<code>gunicorn</code>å®‰è£…å’Œè¿è¡Œå¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span>pip install gunicorn
gunicorn app:app
</pre></div>


<p>ç¬¬ä¸€ä¸ª<code>app</code>æ˜¯æˆ‘ä»¬åˆ›å»ºçš„æ–‡ä»¶ï¼Œç¬¬äºŒä¸ª<code>app</code>æ˜¯æˆ‘ä»¬åˆšåˆšç¼–å†™çš„å‡½æ•°çš„åç§°ã€‚å¦‚æœä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œæ‚¨å°†åœ¨è¾“å‡ºä¸­çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><pre><span></span>[2019-02-09 17:58:56 +0500] [30962] [INFO] Starting gunicorn 19.9.0
[2019-02-09 17:58:56 +0500] [30962] [INFO] Listening at: http://127.0.0.1:8000 (30962)
[2019-02-09 17:58:56 +0500] [30962] [INFO] Using worker: sync
[2019-02-09 17:58:56 +0500] [30966] [INFO] Booting worker with pid: 30966
</pre></div>


<p>å¦‚æœæ‚¨çœ‹åˆ°æ­¤å†…å®¹ï¼Œè¯·æ‰“å¼€æµè§ˆå™¨å¹¶è½¬åˆ°<code>http://localhost:8000</code>ã€‚ä½ åº”è¯¥çœ‹åˆ°æˆ‘ä»¬çš„è€æœ‹å‹ï¼š<code>Hello, World!</code>ä¿¡æ¯ã€‚çœŸæ£’ï¼</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†è¿™ä¸ªå‡½æ•°å˜æˆä¸€ä¸ªç±»ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å¾ˆå¤šè¾…åŠ©æ–¹æ³•ï¼Œå¹¶ä¸”å®ƒä»¬æ›´å®¹æ˜“åœ¨ç±»ä¸­ç¼–å†™ã€‚åˆ›å»ºä¸€ä¸ª<code>api.py</code>æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre><span></span>touch api.py
</pre></div>


<p>åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œåˆ›å»ºä»¥ä¸‹<code>API</code>ç±»ã€‚æˆ‘ä¼šè§£é‡Šä¸€ä¸‹å®ƒçš„ä½œç”¨ï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># api.py</span>

<span class="k">class</span> <span class="nc">API</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
        <span class="n">response_body</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;Hello, World!&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;200 OK&quot;</span>
        <span class="n">start_response</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">[])</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">([</span><span class="n">response_body</span><span class="p">])</span>
</pre></div>


<p>ç°åœ¨ï¼Œåˆ é™¤<code>app.py</code>é‡Œé¢çš„æ‰€æœ‰å†…å®¹å¹¶ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># app.py</span>
<span class="kn">from</span> <span class="nn">api</span> <span class="kn">import</span> <span class="n">API</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">API</span><span class="p">()</span>
</pre></div>


<p>é‡æ–°å¯åŠ¨<code>gunicorn</code>å¹¶åœ¨æµè§ˆå™¨ä¸­æ£€æŸ¥ç»“æœã€‚å®ƒåº”è¯¥å’Œä»¥å‰ä¸€æ ·ï¼Œå› ä¸ºæˆ‘ä»¬åªæ˜¯ç®€å•åœ°å°†æˆ‘ä»¬çš„<code>app</code>å‡½æ•°æ”¹ä¸ºä¸€ä¸ªè¢«è°ƒç”¨çš„ç±»<code>API</code>å¹¶åœ¨è°ƒç”¨æ­¤ç±»å®ä¾‹æ—¶è¦†ç›–å®ƒçš„<code>__call__</code>æ–¹æ³•ï¼š</p>
<div class="highlight"><pre><span></span>app = API()
app()   #  this is where __call__ is called
</pre></div>


<p>ç°åœ¨æˆ‘ä»¬åˆ›å»ºäº†æˆ‘ä»¬çš„ç±»ï¼Œæˆ‘å¸Œæœ›ä½¿ä»£ç æ›´åŠ ä¼˜é›…ï¼Œå› ä¸ºæ‰€æœ‰è¿™äº›å­—èŠ‚ï¼ˆ<code>b"Hello World"</code>ï¼‰å’Œ<code>start_response</code>ä¼¼ä¹è®©æˆ‘æ„Ÿåˆ°å›°æƒ‘ã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œæœ‰ä¸€ä¸ªåä¸º<a href="https://docs.pylonsproject.org/projects/webob/en/stable/index.html">WebOb</a>çš„é…·åŒ…ï¼Œå®ƒé€šè¿‡åŒ…è£…<code>WSGI</code>è¯·æ±‚ç¯å¢ƒå’Œå“åº”çŠ¶æ€ï¼Œæ ‡é¢˜å’Œæ­£æ–‡æ¥ä¸ºHTTPè¯·æ±‚å’Œå“åº”æä¾›å¯¹è±¡ã€‚é€šè¿‡ä½¿ç”¨è¿™ä¸ªåŒ…ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ­¤åŒ…ä¸­æä¾›çš„ç±»ä¼ é€’<code>environ</code>å’Œ<code>start_response</code>ï¼Œè€Œä¸å¿…è‡ªå·±å¤„ç†ã€‚åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰ï¼Œæˆ‘å»ºè®®ä½ çœ‹ä¸€ä¸‹<a href="https://docs.pylonsproject.org/projects/webob/en/stable/index.html">WebOb</a>çš„<a href="https://docs.pylonsproject.org/projects/webob/en/stable/index.html">æ–‡æ¡£</a>æ¥ç†è§£æˆ‘åœ¨è¯´ä»€ä¹ˆä»¥åŠ<code>WebOb</code>æ›´å¤šçš„API ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬å°†å¦‚ä½•é‡æ„æ­¤ä»£ç ã€‚é¦–å…ˆï¼Œå®‰è£…<code>WebOb</code>ï¼š</p>
<div class="highlight"><pre><span></span>pip install webob
</pre></div>


<p>åœ¨<code>api.py</code>æ–‡ä»¶å¼€å¤´å¯¼å…¥<code>Request</code>å’Œ<code>Response</code>ç±»ï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># api.py</span>
<span class="kn">from</span> <span class="nn">webob</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>

<span class="o">...</span>
</pre></div>


<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨<code>__call__</code>æ–¹æ³•ä¸­ä½¿ç”¨å®ƒä»¬ï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># api.py</span>
<span class="kn">from</span> <span class="nn">webob</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>

<span class="k">class</span> <span class="nc">API</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">()</span>
        <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Hello, World!&quot;</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>
</pre></div>


<p>çœ‹èµ·æ¥å¥½å¤šäº†ï¼é‡æ–°å¯åŠ¨<code>gunicorn</code>ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ä¸ä»¥å‰ç›¸åŒçš„ç»“æœã€‚æœ€å¥½çš„éƒ¨åˆ†æ˜¯æˆ‘ä¸å¿…è§£é‡Šè¿™é‡Œæ­£åœ¨åšä»€ä¹ˆã€‚è¿™ä¸€åˆ‡éƒ½æ˜¯ä¸è¨€è‡ªæ˜çš„ã€‚æˆ‘ä»¬æ­£åœ¨åˆ›å»ºä¸€ä¸ªè¯·æ±‚ï¼Œä¸€ä¸ªå“åº”ï¼Œç„¶åè¿”å›è¯¥å“åº”ã€‚çœŸæ£’ï¼æˆ‘å¿…é¡»æ³¨æ„åˆ°<code>request</code>è¿™é‡Œè¿˜æ²¡æœ‰ä½¿ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å¯¹å®ƒåšä»»ä½•äº‹æƒ…ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªæœºä¼šæ¥ä½¿ç”¨è¯·æ±‚å¯¹è±¡ã€‚å¦å¤–ï¼Œè®©æˆ‘ä»¬å°†<code>response</code>åˆ›å»ºé‡æ„ä¸ºå®ƒè‡ªå·±çš„æ–¹æ³•ã€‚æˆ‘ä»¬ç¨åä¼šçœ‹åˆ°ä¸ºä»€ä¹ˆè¿™ä¹ˆåšä¼šæ›´å¥½ï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># api.py</span>
<span class="kn">from</span> <span class="nn">webob</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>

<span class="k">class</span> <span class="nc">API</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span><span class="n">environ</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handle_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span><span class="p">(</span><span class="n">environ</span><span class="p">,</span> <span class="n">start_response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">user_agent</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;HTTP_USER_AGENT&quot;</span><span class="p">,</span> <span class="s2">&quot;No User Agent Found&quot;</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">()</span>
        <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;Hello, my friend with this user agent: {user_agent}&quot;</span>

        <span class="k">return</span> <span class="n">response</span>
</pre></div>


<p>é‡å¯ä½ çš„<code>gunicorn</code>ï¼Œä½ åº”è¯¥åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°è¿™æ¡æ–°æ¶ˆæ¯ã€‚ä½ çœ‹è§äº†å—ï¼Ÿé…·ã€‚æˆ‘ä»¬ç»§ç»­ã€‚</p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬ä»¥ç›¸åŒçš„æ–¹å¼å¤„ç†æ‰€æœ‰è¯·æ±‚ã€‚æ— è®ºæˆ‘ä»¬æ”¶åˆ°ä»€ä¹ˆè¯·æ±‚ï¼Œæˆ‘ä»¬åªè¿”å›åœ¨<code>handle_request</code>æ–¹æ³•ä¸­åˆ›å»ºçš„ç›¸åŒå“åº”ã€‚æœ€ç»ˆï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒæ˜¯åŠ¨æ€çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¸Œæœ›æä¾›çš„æ¥è‡ª<code>/home/</code>çš„è¯·æ±‚ä¸åŒäºæ¥è‡ª<code>/about/</code>çš„ã€‚</p>
<p>ä¸ºæ­¤ï¼Œåœ¨<code>app.py</code>å†…éƒ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªå¤„ç†è¿™ä¸¤ä¸ªè¯·æ±‚çš„æ–¹æ³•ï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># app.py</span>
<span class="kn">from</span> <span class="nn">api.py</span> <span class="kn">import</span> <span class="n">API</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">API</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Hello from the HOME page&quot;</span>


<span class="k">def</span> <span class="nf">about</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Hello from the ABOUT page&quot;</span>
</pre></div>


<p>ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä»¥æŸç§æ–¹å¼å°†è¿™ä¸¤ç§æ–¹æ³•ä¸ä¸Šè¿°è·¯å¾„è”ç³»èµ·æ¥ï¼š<code>/home/</code>å’Œ<code>/about/</code>ã€‚æˆ‘å–œæ¬¢Flaskçš„åšæ³•ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># app.py</span>
<span class="kn">from</span> <span class="nn">api.py</span> <span class="kn">import</span> <span class="n">API</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">API</span><span class="p">()</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/home&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Hello from the HOME page&quot;</span>


<span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/about&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">about</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
    <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Hello from the ABOUT page&quot;</span>
</pre></div>


<p>ä½ è§‰å¾—æ€ä¹ˆæ ·ï¼Ÿçœ‹èµ·æ¥ä¸é”™ï¼Ÿç„¶åè®©æˆ‘ä»¬å®ç°è¿™ä¸ªbad boyå§ï¼</p>
<p>å¦‚æ‚¨æ‰€è§ï¼Œè¯¥<code>route</code>æ–¹æ³•æ˜¯ä¸€ä¸ªè£…é¥°å™¨ï¼Œæ¥å—ä¸€ä¸ªè·¯å¾„å¹¶åŒ…è£…æ–¹æ³•ã€‚å®æ–½èµ·æ¥åº”è¯¥ä¸ä¼šå¤ªéš¾ï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># api.py</span>

<span class="k">class</span> <span class="nc">API</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">routes</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="n">handler</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">handler</span>
            <span class="k">return</span> <span class="n">handler</span>

        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="o">...</span>
</pre></div>


<p>è¿™æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œæ‰€åšçš„ã€‚åœ¨è¯¥<code>__init__</code>æ–¹æ³•ä¸­ï¼Œåœ¨è¢«è°ƒç”¨çš„<code>self.routes</code>çš„åœ°æ–¹æˆ‘ä»¬ç®€å•åœ°å®šä¹‰äº†ä¸€ä¸ª<code>dict</code>ï¼Œæˆ‘ä»¬å°†è·¯å¾„å­˜å‚¨ä¸ºé”®, å¤„ç†ç¨‹åºhandlersä½œä¸ºå€¼ã€‚å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="p">)</span>

<span class="p">{</span>
    <span class="s2">&quot;/home&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">home</span> <span class="n">at</span> <span class="mh">0x1100a70c8</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s2">&quot;/about&quot;</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">about</span> <span class="n">at</span> <span class="mh">0x1101a80c3</span><span class="o">&gt;</span>
<span class="p">}</span>
</pre></div>


<p>åœ¨è¯¥<code>route</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†è·¯å¾„ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”åœ¨è£…é¥°å™¨æ–¹æ³•ä¸­ï¼Œåªéœ€å°†<code>self.routes</code>è·¯å¾„ä½œä¸ºé”®æ”¾åœ¨å­—å…¸ä¸­ï¼Œå°†å¤„ç†ç¨‹åºä½œä¸ºå€¼ã€‚</p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬æœ‰æ‰€æœ‰çš„æ‹¼å›¾ã€‚æˆ‘ä»¬æœ‰å¤„ç†ç¨‹åºå’Œä¸ä¹‹å…³è”çš„è·¯å¾„ã€‚ç°åœ¨ï¼Œå½“ä¸€ä¸ªè¯·æ±‚è¿›æ¥æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥å®ƒçš„<code>path</code>ï¼Œæ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„å¤„ç†ç¨‹åºï¼Œè°ƒç”¨è¯¥å¤„ç†ç¨‹åºå¹¶è¿”å›ä¸€ä¸ªé€‚å½“çš„å“åº”ã€‚æˆ‘ä»¬è¿™æ ·åšï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># api.py</span>
<span class="kn">from</span> <span class="nn">webob</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>

<span class="k">class</span> <span class="nc">API</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

    <span class="o">...</span>
</pre></div>


<p>ä¸æ˜¯å¤ªéš¾äº†ï¼Œæ˜¯å—ï¼Ÿæˆ‘ä»¬ç®€å•åœ°è¿­ä»£<code>self.routes</code>ï¼Œå°†è·¯å¾„ä¸è¯·æ±‚çš„è·¯å¾„è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå­˜åœ¨åŒ¹é…ï¼Œåˆ™è°ƒç”¨ä¸è¯¥è·¯å¾„å…³è”çš„å¤„ç†ç¨‹åºã€‚</p>
<p>é‡æ–°å¯åŠ¨<code>gunicorn</code>å¹¶åœ¨æµè§ˆå™¨ä¸­å°è¯•è¿™äº›è·¯å¾„ã€‚é¦–å…ˆï¼Œè®¿é—®<code>http://localhost:8000/home/</code>ï¼Œç„¶åå»<code>http://localhost:8000/about/</code>ã€‚æ‚¨åº”è¯¥çœ‹åˆ°ç›¸åº”çš„æ¶ˆæ¯ã€‚å¾ˆé…·ï¼Œå¯¹å—ï¼Ÿ</p>
<p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬å¯ä»¥å›ç­”â€œå¦‚æœæ‰¾ä¸åˆ°è·¯å¾„ä¼šæ€ä¹ˆæ ·ï¼Ÿâ€çš„é—®é¢˜ã€‚è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¿”å›â€œNot found.â€çš„ç®€å•HTTPå“åº”çš„æ–¹æ³•ã€‚çŠ¶æ€ä»£ç ä¸º404ï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># api.py</span>
<span class="kn">from</span> <span class="nn">webob</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>

<span class="k">class</span> <span class="nc">API</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">default_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">=</span> <span class="mi">404</span>
        <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Not found.&quot;</span>

    <span class="o">...</span>
</pre></div>


<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„<code>handle_request</code>æ–¹æ³•ä¸­ä½¿ç”¨å®ƒï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># api.py</span>
<span class="kn">from</span> <span class="nn">webob</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>

<span class="k">class</span> <span class="nc">API</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
                <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">response</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">default_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>

    <span class="o">...</span>
</pre></div>


<p>é‡æ–°å¯åŠ¨<code>gunicorn</code>å¹¶å°è¯•ä¸€äº›ä¸å­˜åœ¨çš„è·¯ç”±ã€‚ä½ åº”è¯¥çœ‹åˆ°è¿™ä¸ªå¯çˆ±çš„â€œNot found.â€ é¡µã€‚ç°åœ¨ï¼Œä¸ºäº†ä¾¿äºé˜…è¯»ï¼Œè®©æˆ‘ä»¬é‡æ„ä¸€ä¸‹æ‰¾åˆ°è‡ªå·±æ–¹æ³•çš„å¤„ç†ç¨‹åºï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># api.py</span>
<span class="kn">from</span> <span class="nn">webob</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>

<span class="k">class</span> <span class="nc">API</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">find_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">path</span> <span class="o">==</span> <span class="n">request_path</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">handler</span>

    <span class="o">...</span>
</pre></div>


<p>å°±åƒä¹‹å‰ä¸€æ ·ï¼Œå®ƒåªæ˜¯è¿­ä»£<code>self.route</code>ï¼Œå°†è·¯å¾„ä¸è¯·æ±‚è·¯å¾„è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœè·¯å¾„ç›¸åŒåˆ™è¿”å›å¯¹åº”å¤„ç†ç¨‹åºã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¤„ç†ç¨‹åºï¼Œåˆ™è¿”å›<code>None</code>ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„<code>handle_request</code>æ–¹æ³•ä¸­ä½¿ç”¨å®ƒï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># api.py</span>
<span class="kn">from</span> <span class="nn">webob</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>

<span class="k">class</span> <span class="nc">API</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">()</span>

        <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_handler</span><span class="p">(</span><span class="n">request_path</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="o">...</span>
</pre></div>


<p>æˆ‘è®¤ä¸ºå®ƒçœ‹èµ·æ¥å¥½å¤šäº†ï¼Œå¹¶ä¸”éå¸¸å®¹æ˜“è§£é‡Šã€‚é‡å¯<code>gunicorn</code>ï¼Œçœ‹çœ‹ä¸€åˆ‡éƒ½åƒä»¥å‰ä¸€æ ·æœ‰æ•ˆã€‚</p>
<p>æ­¤æ—¶ï¼Œæˆ‘ä»¬æœ‰è·¯ç”±å’Œå¤„ç†ç¨‹åºã€‚å®ƒéå¸¸æ£’ï¼Œä½†æˆ‘ä»¬çš„è·¯å¾„å¾ˆç®€å•ã€‚å®ƒä»¬ä¸æ”¯æŒurlè·¯å¾„ä¸­çš„å…³é”®å­—å‚æ•°ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ‹¥æœ‰<code>@app.route("/hello/{person_name}")</code>è¿™æ¡è·¯å¾„å¹¶ä¸”èƒ½å¤Ÿåœ¨æˆ‘ä»¬çš„å¤„ç†ç¨‹åºä¸­ä½¿ç”¨<code>person_name</code>è¿™æ ·çš„å†…å®¹ï¼š</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">person_name</span><span class="p">):</span>
    <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;Hello, {person_name}&quot;</span>
</pre></div>


<p>ä¸ºæ­¤ï¼Œå¦‚æœæœ‰äººè®¿é—®<code>/hello/Matthew/</code>ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿå°†<code>/hello/{person_name}/</code>è·¯å¾„ä¸å·²æ³¨å†Œçš„è·¯å¾„åŒ¹é…å¹¶æ‰¾åˆ°é€‚å½“çš„å¤„ç†ç¨‹åºã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œå·²ç»æœ‰ä¸€ä¸ªåä¸º<code>parse</code>çš„åŒ…æ­£ç¡®åœ°ä¸ºæˆ‘ä»¬åšäº†ã€‚è®©æˆ‘ä»¬ç»§ç»­å®‰è£…å®ƒï¼š</p>
<div class="highlight"><pre><span></span>pip install parse
</pre></div>


<p>è®©æˆ‘ä»¬è¯•ä¸€ä¸‹:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">parse</span> <span class="kn">import</span> <span class="n">parse</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="s2">&quot;Hello, {name}&quot;</span><span class="p">,</span> <span class="s2">&quot;Hello, Matthew&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">named</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Matthew&#39;</span><span class="p">}</span>
</pre></div>


<p>å¦‚æ‚¨æ‰€è§ï¼Œå®ƒè§£æäº†å­—ç¬¦ä¸²<code>Hello, Matthew</code>ï¼Œå¹¶èƒ½å¤Ÿè¯†åˆ«å‡º<code>Matthew</code>æ˜¯ä¸æˆ‘ä»¬æä¾›çš„å­—ç¬¦ä¸²<code>{name}</code>ç›¸å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚</p>
<p>è®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„<code>find_handler</code>æ–¹æ³•ä¸­ä½¿ç”¨å®ƒï¼Œä¸ä»…å¯ä»¥æ‰¾åˆ°ä¸è·¯å¾„å¯¹åº”çš„æ–¹æ³•ï¼Œè¿˜å¯ä»¥æ‰¾åˆ°æä¾›çš„å…³é”®å­—å‚æ•°ï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># api.py</span>
<span class="kn">from</span> <span class="nn">webob</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">parse</span> <span class="kn">import</span> <span class="n">parse</span>

<span class="k">class</span> <span class="nc">API</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">find_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_path</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">path</span><span class="p">,</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">parse_result</span> <span class="o">=</span> <span class="n">parse</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">request_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parse_result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">handler</span><span class="p">,</span> <span class="n">parse_result</span><span class="o">.</span><span class="n">named</span>

        <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>

    <span class="o">...</span>
</pre></div>


<p>æˆ‘ä»¬ä»åœ¨è¿­ä»£<code>self.routes</code>ï¼Œç°åœ¨ä¸æ˜¯æ¯”è¾ƒè¯·æ±‚è·¯å¾„çš„è·¯å¾„ï¼Œè€Œæ˜¯å°è¯•è§£æå®ƒï¼Œå¦‚æœæœ‰ç»“æœï¼Œæˆ‘ä»¬å°†å¤„ç†ç¨‹åºå’Œå…³é”®å­—å‚æ•°ä½œä¸ºå­—å…¸è¿”å›ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨<code>handle_request</code>å†…éƒ¨ä½¿ç”¨è¿™ä¸ªå°†è¿™äº›å‚æ•°ä¼ é€’ç»™å¤„ç†ç¨‹åºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># api.py</span>
<span class="kn">from</span> <span class="nn">webob</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">Response</span>
<span class="kn">from</span> <span class="nn">parse</span> <span class="kn">import</span> <span class="n">parse</span>

<span class="k">class</span> <span class="nc">API</span><span class="p">:</span>
    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">Response</span><span class="p">()</span>

        <span class="n">handler</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_handler</span><span class="p">(</span><span class="n">request_path</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">handler</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_response</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="o">...</span>
</pre></div>


<p>å”¯ä¸€çš„å˜åŒ–æ˜¯ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸¤ä¸ª<code>handler</code>å’Œ<code>kwargs</code>ä»<code>self.find_handler</code>ï¼Œå¹¶ä¼ é€’ä¸€ä¸ª<code>kwargs</code>åƒè¿™æ ·çš„å¤„ç†<code>**kwargs</code>ã€‚</p>
<p>è®©æˆ‘ä»¬ç”¨è¿™ç§ç±»å‹çš„è·¯å¾„ç¼–å†™ä¸€ä¸ªå¤„ç†ç¨‹åºå¹¶è¯•ä¸€è¯•ï¼š</p>
<div class="highlight"><pre><span></span><span class="c1"># app.py</span>
<span class="o">...</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="s2">&quot;/hello/{name}&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">response</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;Hello, {name}&quot;</span>

<span class="o">...</span>
</pre></div>


<p>é‡å¯ä½ çš„<code>gunicorn</code>è®¿é—®<code>http://localhost:8000/hello/Matthew/</code>ã€‚ä½ åº”è¯¥æœ‰è¿™ä¸ªç¾å¦™çš„ä¿¡æ¯: <code>Hello, Matthew</code>ã€‚å¤ªæ£’äº†å§ï¼Ÿå†æ·»åŠ å‡ ä¸ªè¿™æ ·çš„å¤„ç†ç¨‹åºã€‚æ‚¨è¿˜å¯ä»¥æŒ‡å‡ºç»™å®šå‚æ•°çš„ç±»å‹ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å°†å¤„ç†ç¨‹åºå†…çš„<code>@app.route("/tell/{age:d}")</code>å‚æ•°<code>age</code>ä½œä¸ºæ•°å­—ã€‚</p>
<h2 id="_1">ç»“è®º<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>è¿™æ˜¯ä¸€ä¸ªæ¼«é•¿çš„æ—…ç¨‹ï¼Œä½†æˆ‘è®¤ä¸ºè¿™å¾ˆæ£’ã€‚æˆ‘å†™è¿™ç¯‡æ–‡ç« æ—¶äº²è‡ªå­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ã€‚å¦‚æœä½ å–œæ¬¢è¿™ç¯‡åšæ–‡ï¼Œè¯·åœ¨è¯„è®ºä¸­å‘Šè¯‰æˆ‘ä»¬æˆ‘ä»¬åº”è¯¥åœ¨æ¡†æ¶ä¸­å®ç°çš„å…¶ä»–åŠŸèƒ½ã€‚æˆ‘åœ¨è€ƒè™‘åŸºäºç±»çš„å¤„ç†ç¨‹åºï¼Œæ”¯æŒæ¨¡æ¿å’Œé™æ€æ–‡ä»¶ã€‚</p>
<p>Fight on!</p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://www.EWhisper.cn/tag/python.html">python</a>
      <a href="https://www.EWhisper.cn/tag/webkuang-jia.html">webæ¡†æ¶</a>
    </p>
  </div>

  <div class="center social-share">
    <p>å–œæ¬¢è¿™ç¯‡æ–‡ç« å—ï¼Ÿå°†å®ƒä¸æ‚¨çš„æœ‹å‹åˆ†äº«å§ï¼</p>
    <div class="addthis_native_toolbox"></div>
    <div class="addthis_sharing_toolbox"></div>
    <div class="addthis_inline_share_toolbox"></div>
  </div>

  <div class="neighbors">
    <a class="btn float-right" href="https://www.EWhisper.cn/write-python-framework-part-two.html" title="å¦‚ä½•ç¼–å†™Python Webæ¡†æ¶ï¼ˆäºŒï¼‰">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4>æ‚¨å¯èƒ½è¿˜å–œæ¬¢</h4>
    <ul class="related-posts">
      <li><a href="https://www.EWhisper.cn/write-python-framework-part-two.html">å¦‚ä½•ç¼–å†™Python Webæ¡†æ¶ï¼ˆäºŒï¼‰</a></li>
      <li><a href="https://www.EWhisper.cn/write-python-framework-part-three.html">å¦‚ä½•ç¼–å†™Python Webæ¡†æ¶ï¼ˆä¸‰ï¼‰</a></li>
    </ul>
  </div>


<!-- Disqus -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'ewhisperblog';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>
    è¯·å¯ç”¨æµè§ˆå™¨çš„JavascriptåŠŸèƒ½ä»¥æŸ¥çœ‹è¯„è®ºã€‚
</noscript>
<!-- End Disqus -->
</article>

    <footer>
<p>
  &copy;  2019 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>æœ¬ç«™ç”± <a href="http://getpelican.com" target="_blank">Pelican</a> é©±åŠ¨ï¼Œå¹¶ä½¿ç”¨äº† <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a> å¼€å‘çš„ <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> ä¸»é¢˜ã€‚</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
<!-- StatusCake -->
<a href="https://www.statuscake.com" title="ä¸œé£å¾®é¸£ Blog Uptime">
  <img src="https://app.statuscake.com/button/index.php?Track=CbJdcjmnCx&amp;Days=7&amp;Design=7" alt="ä¸œé£å¾®é¸£ Blog Uptime"/>
</a>

<!-- End StatusCake --></p>    </footer>
  </main>

<!-- Gauges -->
<script type="text/javascript">
  var _gauges = _gauges || [];
  (function() {
    var t   = document.createElement('script');
    t.type  = 'text/javascript';
    t.async = true;
    t.id    = 'gauges-tracker';
    t.setAttribute('data-site-id', '5c9a5706a2f54b13557a67d0');
    t.setAttribute('data-track-path', 'https://track.gaug.es/track.gif');
    t.src = 'https://track.gaug.es/track.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(t, s);
  })();
</script>
<!-- End Gauges -->
    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c98c3e21c4def55" async="async"></script>


<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " ä¸œé£å¾®é¸£ Blog ",
  "url" : "https://www.EWhisper.cn",
  "image": "//s.gravatar.com/avatar/7c743bc6ac83171e35a5aa8bd66cc1ea?s=120",
  "description": "Focus on Python/Java/DevOps/Observability"
}
</script>

<a href="https://github.com/east4ming/my-pelican" class="github-corner" aria-label="View source on Github">
    <svg width="80"
         height="80"
         viewBox="0 0 250 250"
         style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
         aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor"
              style="transform-origin: 130px 106px;"
              class="octo-arm">
        </path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor"
              class="octo-body">
        </path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></body>
</html>