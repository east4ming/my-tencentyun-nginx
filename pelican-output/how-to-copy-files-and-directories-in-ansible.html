
<!DOCTYPE html>
<html lang="zh_cn">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://www.EWhisper.cn/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="https://www.EWhisper.cn/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="https://www.EWhisper.cn/theme/font-awesome/css/font-awesome.min.css">

    <link href="https://www.EWhisper.cn/static/custom.css" rel="stylesheet">


    <link href="https://www.EWhisper.cn/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="ä¸ªäººæŠ€æœ¯åˆ†äº« RSS">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">


    <!-- Chrome, Firefox OS and Opera -->
    <meta name="theme-color" content="#333333">
    <!-- Windows Phone -->
    <meta name="msapplication-navbutton-color" content="#333333">
    <!-- iOS Safari -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Microsoft EDGE -->
    <meta name="msapplication-TileColor" content="#333333">

<meta name="author" content="ä¸œé£å¾®é¸£" />
<meta name="description" content="Ansible copyå’Œfetchæ¨¡å—ä½¿ç”¨æ•™ç¨‹. å¦‚ä½•é€šè¿‡è¿™ä¸¤ä¸ªæ¨¡å—å®ç°å¤šç§æ–‡ä»¶å’Œç›®å½•çš„å¤åˆ¶." />
<meta name="keywords" content="python, devops, ansible, linux, è¯‘æ–‡">

<meta property="og:site_name" content="ä¸ªäººæŠ€æœ¯åˆ†äº«"/>
<meta property="og:title" content="å¦‚ä½•åœ¨Ansibleä¸­å¤åˆ¶å¤šä¸ªæ–‡ä»¶å’Œç›®å½•"/>
<meta property="og:description" content="Ansible copyå’Œfetchæ¨¡å—ä½¿ç”¨æ•™ç¨‹. å¦‚ä½•é€šè¿‡è¿™ä¸¤ä¸ªæ¨¡å—å®ç°å¤šç§æ–‡ä»¶å’Œç›®å½•çš„å¤åˆ¶."/>
<meta property="og:locale" content="zh_CN"/>
<meta property="og:url" content="https://www.EWhisper.cn/how-to-copy-files-and-directories-in-ansible.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-10-12 15:00:00+08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="https://www.EWhisper.cn/author/dong-feng-wei-ming.html">
<meta property="article:section" content="DevOps"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="devops"/>
<meta property="article:tag" content="ansible"/>
<meta property="article:tag" content="linux"/>
<meta property="article:tag" content="è¯‘æ–‡"/>
<meta property="og:image" content="//s.gravatar.com/avatar/7c743bc6ac83171e35a5aa8bd66cc1ea?s=120">

  <title>ä¸ªäººæŠ€æœ¯åˆ†äº« &ndash; å¦‚ä½•åœ¨Ansibleä¸­å¤åˆ¶å¤šä¸ªæ–‡ä»¶å’Œç›®å½•</title>

</head>
<body>
  <aside>
    <div>
      <a href="https://www.EWhisper.cn">
        <img src="//s.gravatar.com/avatar/7c743bc6ac83171e35a5aa8bd66cc1ea?s=120" alt="ä¸ªäººæŠ€æœ¯åˆ†äº«" title="ä¸ªäººæŠ€æœ¯åˆ†äº«">
      </a>
      <h1><a href="https://www.EWhisper.cn">ä¸ªäººæŠ€æœ¯åˆ†äº«</a></h1>

<p>Focus on Python/Java/DevOps/Observability</p>
      <nav>
        <ul class="list">
          <li><a href="https://www.EWhisper.cn/pages/about.html#about">About</a></li>
          <li><a href="https://www.EWhisper.cn/pages/contact.html#contact">Contact</a></li>

          <li><a href="http://beian.miit.gov.cn" target="_blank">æ²ªICPå¤‡19007314å·-1</a></li>
        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-wechat" href="/images/wechat_paycode.png" target="_blank"><i class="fa fa-wechat"></i></a></li>
        <li><a class="sc-envelope-o" href="mailto:cuikaidong@foxmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a></li>
        <li><a class="sc-reddit" href="https://www.jianshu.com/u/0f08daeaa5a9" target="_blank"><i class="fa fa-reddit"></i></a></li>
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/å‡¯ä¸œ-å´”-136128116/" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-weibo" href="https://weibo.com/long5to2gf" target="_blank"><i class="fa fa-weibo"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="https://www.EWhisper.cn">ä¸»é¡µ</a>

      <a href="/archives/index.html">å­˜æ¡£</a>
      <a href="/categories.html">ç±»åˆ«</a>
      <a href="/tags.html">æ ‡ç­¾</a>
      <a href="/authors.html">ä½œè€…</a>


      <a href="https://www.EWhisper.cn/feeds/all.rss.xml">RSSè®¢é˜…</a>
    </nav>

<article class="single">
  <header>
    <h1 id="how-to-copy-files-and-directories-in-ansible">å¦‚ä½•åœ¨Ansibleä¸­å¤åˆ¶å¤šä¸ªæ–‡ä»¶å’Œç›®å½•</h1>
    <p>
      åœ¨ 2019-10-12 Saturday å‘å¸ƒäº <a href="https://www.EWhisper.cn/category/devops.html">DevOps</a> åˆ†ç±»

        &#8226; 3 min read
    </p>
  </header>


  <div>
    <div class="toc">
<ul>
<li><a href="#_1">å°†æ–‡ä»¶ä»æœ¬åœ°è®¡ç®—æœºå¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨</a></li>
<li><a href="#_2">å°†ç›®å½•ä»æœ¬åœ°è®¡ç®—æœºå¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨</a></li>
<li><a href="#_3">åœ¨åŒä¸€å°è¿œç¨‹è®¡ç®—æœºä¸Šçš„ä¸åŒæ–‡ä»¶å¤¹ä¹‹é—´å¤åˆ¶æ–‡ä»¶</a></li>
<li><a href="#with_items">ä½¿ç”¨with_itemså¤åˆ¶å¤šä¸ªæ–‡ä»¶/ç›®å½•</a></li>
<li><a href="#_4">å¤åˆ¶å…·æœ‰ä¸åŒæƒé™/ç›®çš„åœ°è®¾ç½®çš„å¤šä¸ªæ–‡ä»¶</a></li>
<li><a href="#pattern">å¤åˆ¶ä¸patternï¼ˆé€šé…ç¬¦ï¼‰åŒ¹é…çš„æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶</a></li>
<li><a href="#_5">å¤åˆ¶ä¹‹å‰åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸­åˆ›å»ºæ–‡ä»¶å¤‡ä»½</a></li>
<li><a href="#ad-hoc">ä½¿ç”¨ä¸´æ—¶(Ad-hoc)æ–¹æ³•å¤åˆ¶æ–‡ä»¶</a></li>
<li><a href="#_6">å°†æ–‡ä»¶ä»è¿œç¨‹è®¡ç®—æœºå¤åˆ¶åˆ°æœ¬åœ°è®¡ç®—æœº</a></li>
<li><a href="#copy">ä½¿ç”¨ copy æ¨¡å—å†™å…¥æ–‡ä»¶</a></li>
<li><a href="#copy_1">copy æ¨¡å—çš„è¿”å›å€¼</a></li>
<li><a href="#_7">å°†æŸ¥æ‰¾åˆ°çš„æ–‡ä»¶å¤åˆ¶</a></li>
</ul>
</div>
<p><img alt="Ansible Logo" src="images/ansible_logo_black-1024x138.png"></p>
<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.5/png/64/1f4d3.png" title=":notebook:" width="20px"> å¤‡æ³¨:</p>
<p>æœ¬æ–‡å¤§éƒ¨åˆ†å†…å®¹ä¸ºè¯‘æ–‡.</p>
<p>åŸæ–‡åœ°å€: <a href="http://www.mydailytutorials.com/how-to-copy-files-and-directories-in-ansible-using-copy-and-fetch-modules/">http://www.mydailytutorials.com/how-to-copy-files-and-directories-in-ansible-using-copy-and-fetch-modules/</a></p>
<p>Thanksâ™ª(ï½¥Ï‰ï½¥)ï¾‰</p>
</blockquote>
<p>Ansible é€šè¿‡ <em>copy</em> å’Œ <em>fetch</em> æ¨¡å—æä¾›äº†åŸºæœ¬çš„å¤åˆ¶æ–‡ä»¶å’Œç›®å½•çš„åŠŸèƒ½.</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨<a href="http://docs.ansible.com/ansible/copy_module.html"><em>copy</em> æ¨¡å—</a>å°†æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ä»æœ¬åœ°æœåŠ¡å™¨å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œåœ¨è¿œç¨‹æœåŠ¡å™¨ä¹‹é—´ï¼ˆä»…æ–‡ä»¶ï¼‰å¤åˆ¶ï¼Œæ›´æ”¹æ–‡ä»¶çš„æƒé™ç­‰ã€‚</p>
<p>å¦‚æœæ‚¨éœ€è¦åœ¨æ›¿æ¢å˜é‡åå¤åˆ¶æ–‡ä»¶ï¼Œä¾‹å¦‚å…·æœ‰IPæ›´æ”¹çš„é…ç½®æ–‡ä»¶ï¼Œè¯·æ”¹ç”¨<a href="http://docs.ansible.com/ansible/template_module.html"><em>template</em> æ¨¡å—</a>ã€‚</p>
<h2 id="_1">å°†æ–‡ä»¶ä»æœ¬åœ°è®¡ç®—æœºå¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<em>copy</em> æ¨¡å—å°†æ£€æŸ¥æœ¬åœ°è®¡ç®—æœºä¸Š <code>src</code> å‚æ•°ä¸­è®¾ç½®çš„æ–‡ä»¶ã€‚ç„¶åå®ƒå°†æ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡è·¯å¾„ä¸­æŒ‡å®šçš„è¿œç¨‹è®¡ç®—æœº <code>dest</code> (ç›®æ ‡)è·¯å¾„ã€‚ä¸‹é¢çš„ç¤ºä¾‹å°†å½“å‰ç”¨æˆ·ï¼ˆåœ¨æœ¬åœ°è®¡ç®—æœºä¸Šï¼‰çš„ä¸»ç›®å½•ä¸­çš„sample.txtæ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„<code>/tmp</code>ç›®å½•ä¸­ã€‚ç”±äºæˆ‘ä»¬æ²¡æœ‰ä¸ºæ–‡ä»¶æŒ‡å®šä»»ä½•æƒé™ï¼Œå› æ­¤è¿œç¨‹æ–‡ä»¶çš„é»˜è®¤æƒé™è®¾ç½®ä¸º<code>-rw-rw-râ€“(0664)</code></p>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blocks</span>
  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ansible copy file to remote server</span>
    <span class="nt">copy</span><span class="p">:</span>
      <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">~/sample.txt</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp</span> 
</pre></div>


<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.5/png/64/1f4d3.png" title=":notebook:" width="20px"> å¤‡æ³¨1:</p>
<p>å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨äºè¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œå¹¶ä¸”å’Œæºæ–‡ä»¶çš„å†…å®¹ä¸åŒï¼Œåˆ™åœ¨è¿è¡Œä»»åŠ¡æ—¶ï¼Œå°†ä¿®æ”¹ç›®æ ‡æ–‡ä»¶ã€‚æ‚¨å¯ä»¥é€šè¿‡è®¾ç½® <code>force</code> å‚æ•°æ¥æ§åˆ¶å®ƒã€‚é»˜è®¤è®¾ç½®ä¸º<code>yes</code>ã€‚å› æ­¤ï¼Œå®ƒé»˜è®¤æƒ…å†µä¸‹ä¼šä¿®æ”¹æ–‡ä»¶ã€‚å¦‚æœæ‚¨ä¸å¸Œæœ›åœ¨æºæ–‡ä»¶ä¸åŒçš„æƒ…å†µä¸‹ä¿®æ”¹æ–‡ä»¶ï¼Œåˆ™å¯ä»¥å°†å…¶è®¾ç½®ä¸º<code>no</code>ã€‚ä»…å½“è¿œç¨‹æœåŠ¡å™¨ä¸Šä¸å­˜åœ¨è¯¥æ–‡ä»¶æ—¶ï¼Œä»¥ä¸‹ä»»åŠ¡æ‰ä¼šå¤åˆ¶è¯¥æ–‡ä»¶ã€‚ç¤ºä¾‹å¦‚ä¸‹:</p>
</blockquote>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blocks</span>
  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ansible copy file force</span>
    <span class="nt">copy</span><span class="p">:</span>
      <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">~/sample.txt</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp</span> 
      <span class="nt">force</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">no</span>
</pre></div>


<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.5/png/64/1f4d3.png" title=":notebook:" width="20px"> å¤‡æ³¨2:</p>
<p>å¦‚æœåœ¨æœ¬åœ°è®¡ç®—æœºä¸Šæ‰¾ä¸åˆ°è¯¥æ–‡ä»¶ï¼Œåˆ™Ansibleå°†å¼•å‘ç±»ä¼¼äºä»¥ä¸‹çš„é”™è¯¯ã€‚</p>
<p><code>fatal: [remote-machine-1]: FAILED! =&gt; {â€œchangedâ€: false, â€œfailedâ€: true, â€œmsgâ€: â€œUnable to find â€˜~/sample.txtâ€™ in expected paths.â€}</code></p>
</blockquote>
<h2 id="_2">å°†ç›®å½•ä»æœ¬åœ°è®¡ç®—æœºå¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨Ansible <em>copy</em> æ¨¡å—å¤åˆ¶æ–‡ä»¶å¤¹/ç›®å½•ã€‚å¦‚æœ<code>src</code>è·¯å¾„æ˜¯ç›®å½•ï¼Œåˆ™å°†ä»¥é€’å½’æ–¹å¼å¤åˆ¶å®ƒã€‚è¿™æ„å‘³ç€å°†å¤åˆ¶æ•´ä¸ªç›®å½•ã€‚</p>
<p>ç°åœ¨ï¼Œæœ‰ä¸¤ä¸ªä¸åŒçš„å˜ä½“ã€‚å–å†³äºæ˜¯å¦åœ¨<code>src</code>è·¯å¾„çš„æœ«å°¾ä½¿ç”¨ <code>/</code>å­—ç¬¦ã€‚</p>
<p>ç¬¬ä¸€ç§æ–¹æ³•å°†<strong>åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªç›®å½•</strong>ï¼Œå…¶åç§°åœ¨<code>src</code>å‚æ•°ä¸­è®¾ç½®ã€‚ç„¶åå®ƒå°†å¤åˆ¶æºæ–‡ä»¶å¤¹çš„å†…å®¹å¹¶å°†å…¶ç²˜è´´åˆ°è¯¥ç›®å½•ã€‚ <strong>å¦‚æœä½ æƒ³è¦è¿™ä¸ªè¡Œä¸ºï¼Œé‚£ä¹ˆä¸è¦åœ¨srcå‚æ•°è·¯å¾„ååŠ <code>/</code>ã€‚</strong></p>
<p>ä¸‹é¢çš„Ansibleå¤åˆ¶ç›®å½•ç¤ºä¾‹å°†é¦–å…ˆåœ¨è¿œç¨‹æœåŠ¡å™¨çš„<code>/tmp</code>ä¸­åˆ›å»ºä¸€ä¸ªåä¸º<code>copy_dir_ex</code>çš„ç›®å½•ã€‚æŸ¥çœ‹<code>tmp</code>æ–‡ä»¶å¤¹ä¸­ä¼šæœ‰ä¸€ä¸ª<code>copy_dir_ex</code>æ–‡ä»¶å¤¹ã€‚</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">hosts</span><span class="p">:</span> <span class="n">blocks</span>
  <span class="n">tasks</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ansible</span> <span class="k">copy</span> <span class="n">directory</span> <span class="k">to</span> <span class="n">the</span> <span class="n">remote</span> <span class="n">server</span>
    <span class="k">copy</span><span class="p">:</span>
      <span class="n">src</span><span class="p">:</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">mdtutorials2</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">Ansible</span><span class="o">/</span><span class="n">copy_dir_ex</span>
      <span class="n">dest</span><span class="p">:</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">mdtutorials2</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">Ansible</span><span class="o">/</span><span class="n">tmp</span>

<span class="k">output</span>
<span class="c1">------</span>
<span class="n">Ansible</span><span class="o">-</span><span class="n">Pro</span><span class="p">:</span><span class="n">Ansible</span> <span class="n">mdtutorials2$</span> <span class="n">tree</span> <span class="n">tmp</span>
<span class="n">tmp</span>
<span class="err">â””â”€â”€</span> <span class="n">copy_dir_ex</span>
    <span class="err">â”œâ”€â”€</span> <span class="n">file1</span>
    <span class="err">â”œâ”€â”€</span> <span class="n">file2</span>
    <span class="err">â”œâ”€â”€</span> <span class="n">file3</span>
    <span class="err">â””â”€â”€</span> <span class="n">tmp2</span>
        <span class="err">â”œâ”€â”€</span> <span class="n">file4</span>
        <span class="err">â””â”€â”€</span> <span class="n">file5</span>
</pre></div>


<p>ç¬¬äºŒç§æ–¹æ³•å°†ä»…å°†æ–‡ä»¶ä»æºç›®å½•å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚å®ƒ<strong>ä¸ä¼š</strong>åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Š<strong>åˆ›å»ºç›®å½•</strong>ã€‚å¦‚æœæ‚¨æƒ³è¦è¿™ç§è¡Œä¸ºï¼Œåˆ™<strong>åœ¨srcå‚æ•°ä¸­çš„è·¯å¾„ä¹‹åè¾“å…¥<code>/</code>ã€‚</strong></p>
<p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>copy_dir_ex</code>å†…éƒ¨çš„æ–‡ä»¶å°†è¢«å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨çš„<code>/tmp</code>æ–‡ä»¶å¤¹ä¸­ã€‚å¦‚æ‚¨æ‰€è§ï¼Œ<code>src</code>ç›®å½•æœªåœ¨ç›®æ ‡ä¸­åˆ›å»ºã€‚ä»…å¤åˆ¶ç›®å½•çš„å†…å®¹ã€‚</p>
<div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">hosts</span><span class="p">:</span> <span class="n">blocks</span>
  <span class="n">tasks</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Ansible</span> <span class="k">copy</span> <span class="n">files</span> <span class="k">from</span> <span class="n">a</span> <span class="n">directory</span> <span class="k">to</span> <span class="n">remote</span> <span class="n">server</span>
    <span class="k">copy</span><span class="p">:</span>
      <span class="n">src</span><span class="p">:</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">mdtutorials2</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">Ansible</span><span class="o">/</span><span class="n">copy_dir_ex</span><span class="o">/</span>
      <span class="n">dest</span><span class="p">:</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">mdtutorials2</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">Ansible</span><span class="o">/</span><span class="n">tmp</span>

<span class="k">output</span>
<span class="c1">------</span>
<span class="n">tmp</span><span class="o">/</span>
<span class="err">â”œâ”€â”€</span> <span class="n">file1</span>
<span class="err">â”œâ”€â”€</span> <span class="n">file2</span>
<span class="err">â”œâ”€â”€</span> <span class="n">file3</span>
<span class="err">â””â”€â”€</span> <span class="n">tmp2</span>
    <span class="err">â”œâ”€â”€</span> <span class="n">file4</span>
    <span class="err">â””â”€â”€</span> <span class="n">file5</span>
</pre></div>


<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.5/png/64/1f4d3.png" title=":notebook:" width="20px"> å¤‡æ³¨:</p>
<ol>
<li>
<p>å¦‚æœéœ€è¦è®¾ç½®è¿œç¨‹ç›®å½•çš„æƒé™ï¼Œå¯ä»¥ä½¿ç”¨  <code>directory_mode</code>å‚æ•°æ¥è¿›è¡Œè®¾ç½®ã€‚ä»…å½“è¿œç¨‹è®¡ç®—æœºä¸Šä¸å­˜åœ¨ç›®å½•æ—¶ï¼Œæ‰è®¾ç½®æƒé™ã€‚</p>
</li>
<li>
<p>æ‚¨è¿˜å¯ä»¥è®¾ç½®ç›®å½•çš„ç»„å’Œæ‰€æœ‰è€…ã€‚æ‚¨åº”è¯¥å°†å„è‡ªçš„åç§°èµ‹å€¼ç»™<code>group</code>å’Œ<code>owner</code>çš„å‚æ•°ã€‚</p>
</li>
</ol>
</blockquote>
<h2 id="_3">åœ¨åŒä¸€å°è¿œç¨‹è®¡ç®—æœºä¸Šçš„ä¸åŒæ–‡ä»¶å¤¹ä¹‹é—´å¤åˆ¶æ–‡ä»¶<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p>æ‚¨è¿˜å¯ä»¥åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å„ä¸ªä½ç½®ä¹‹é—´å¤åˆ¶æ–‡ä»¶ã€‚æ‚¨å¿…é¡»å°†<code>remote_src</code>å‚æ•°è®¾ç½®ä¸º<code>yes</code>ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹å°†å¤åˆ¶è¿œç¨‹æœåŠ¡å™¨çš„<code>/tmp</code>ç›®å½•ä¸­çš„ <em>hello6</em> æ–‡ä»¶ï¼Œå¹¶å°†å…¶ç²˜è´´åˆ°<code>/etc/</code>ç›®å½•ä¸­ã€‚</p>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blocks</span>
  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ansible copy files remote to remote</span>
    <span class="nt">copy</span><span class="p">:</span>
      <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/hello6</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc</span>
      <span class="nt">remote_src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>


<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.5/png/64/1f4d3.png" title=":notebook:" width="20px"> å¤‡æ³¨:</p>
<p>ä»Ansible 2.2.1.0å¼€å§‹ï¼Œä¸æ”¯æŒåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸­å¤åˆ¶ç›®å½•ã€‚å¦‚æœå°è¯•ï¼Œå°†å‡ºç°ä»¥ä¸‹é”™è¯¯:</p>
<p><code>fatal: [remote-machine-1]: FAILED! =&gt; {"changed": false, "failed": true, "msg": "Remote copy does not support recursive copy of directory: /tmp/copy_dir_ex"}</code></p>
</blockquote>
<h2 id="with_items">ä½¿ç”¨with_itemså¤åˆ¶å¤šä¸ªæ–‡ä»¶/ç›®å½•<a class="headerlink" href="#with_items" title="Permanent link">&para;</a></h2>
<p>å¦‚æœè¦å¤åˆ¶å¤šä¸ªæ–‡ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>with_items</code>éå†å®ƒä»¬ã€‚</p>
<p>ä»¥ä¸‹ç¤ºä¾‹å°†å¤åˆ¶ home ç›®å½•åˆ—è¡¨ç»™å‡ºçš„å¤šä¸ªæ–‡ä»¶ã€‚</p>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blocks</span>
  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ansible copy multiple files with_items</span>
    <span class="nt">copy</span><span class="p">:</span>
      <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">~/{{item}}</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp</span>
      <span class="nt">mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0774</span>
    <span class="nt">with_items</span><span class="p">:</span>
      <span class="p p-Indicator">[</span><span class="s">&#39;hello1&#39;</span><span class="p p-Indicator">,</span><span class="s">&#39;hello2&#39;</span><span class="p p-Indicator">,</span><span class="s">&#39;hello3&#39;</span><span class="p p-Indicator">,</span><span class="s">&#39;sub_folder/hello4&#39;</span><span class="p p-Indicator">]</span>
</pre></div>


<h2 id="_4">å¤åˆ¶å…·æœ‰ä¸åŒæƒé™/ç›®çš„åœ°è®¾ç½®çš„å¤šä¸ªæ–‡ä»¶<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>åœ¨ä¸Šè¿°ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬æ­£åœ¨å¤åˆ¶å¤šä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯æ‰€æœ‰æ–‡ä»¶éƒ½å…·æœ‰ç›¸åŒçš„æƒé™å’Œç›¸åŒçš„ç›®çš„åœ°ã€‚ä½†æ˜¯æœ‰æ—¶æˆ‘ä»¬æƒ³ä¸ºä¸åŒçš„æ–‡ä»¶è®¾ç½®æƒé™ï¼Œæˆ–è€…æ¯ä¸ªæ–‡ä»¶çš„ç›®æ ‡æ–‡ä»¶å¤¹éƒ½ä¸åŒã€‚è¿™å¯ä»¥é€šè¿‡ä¸å­—å…¸ç»“æ„ä¸€èµ·ä½¿ç”¨<code>with_items</code>æ¥å®ç°ã€‚</p>
<p>åœ¨ä»¥ä¸‹ä»»åŠ¡ä¸­ï¼Œæˆ‘è¯•å›¾å°†3ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°2ä¸ªä¸åŒçš„æ–‡ä»¶å¤¹ä¸­ã€‚æ­¤å¤–ï¼Œæ¯ä¸ªæ–‡ä»¶çš„æ–‡ä»¶æƒé™ä¹Ÿä¸åŒã€‚æˆ‘æä¾›äº†ä¸€ä¸ªå­—å…¸ç»“æ„ï¼Œå…¶ä¸­æåˆ°äº†æ¯ä¸ªæ–‡ä»¶çš„ä¸åŒè®¾ç½®ã€‚</p>
<p>ä»è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ–‡ä»¶å·²å¤åˆ¶åˆ°ç»™å®šçš„æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”æƒé™è®¾ç½®æ­£ç¡®ã€‚</p>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">all</span>
  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Copy multiple files in Ansible with different permissions</span>
    <span class="nt">copy</span><span class="p">:</span>
      <span class="nt">src</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.src</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.dest</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">mode</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item.mode</span><span class="nv"> </span><span class="s">}}&quot;</span>
    <span class="nt">with_items</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nt"> src</span><span class="p">:</span> <span class="s">&#39;/home/mdtutorials2/test1&#39;</span><span class="p p-Indicator">,</span><span class="nt">dest</span><span class="p">:</span> <span class="s">&#39;/tmp/devops_system1&#39;</span><span class="p p-Indicator">,</span><span class="nt"> mode</span><span class="p">:</span> <span class="s">&#39;0777&#39;</span><span class="p p-Indicator">}</span>
      <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nt"> src</span><span class="p">:</span> <span class="s">&#39;/home/mdtutorials2/test2&#39;</span><span class="p p-Indicator">,</span><span class="nt">dest</span><span class="p">:</span> <span class="s">&#39;/tmp/devops_system2&#39;</span><span class="p p-Indicator">,</span><span class="nt"> mode</span><span class="p">:</span> <span class="s">&#39;0707&#39;</span><span class="p p-Indicator">}</span>
      <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nt"> src</span><span class="p">:</span> <span class="s">&#39;/home/mdtutorials2/test3&#39;</span><span class="p p-Indicator">,</span><span class="nt">dest</span><span class="p">:</span> <span class="s">&#39;/tmp2/devops_system3&#39;</span><span class="p p-Indicator">,</span><span class="nt"> mode</span><span class="p">:</span> <span class="s">&#39;0575&#39;</span><span class="p p-Indicator">}</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="gh">output</span>
<span class="gh">======</span>
mdtutorials2@system01:~$ ls -lrt /tmp
drwxrwxrwx 2 root          root          4096 Oct  9 14:28 devops_system1
drwx---rwx 2 root          root          4096 Oct  9 14:28 devops_system2

mdtutorials2@system01:~$ ls -lrt /tmp2
-r-xrwxr-x 1 root root 0 Oct  9 14:33 devops_system3
</pre></div>


<h2 id="pattern">å¤åˆ¶ä¸patternï¼ˆé€šé…ç¬¦ï¼‰åŒ¹é…çš„æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡ä»¶<a class="headerlink" href="#pattern" title="Permanent link">&para;</a></h2>
<p>å¦‚æœéœ€è¦å¤åˆ¶ç›®å½•ä¸­ä¸é€šé…ç¬¦åŒ¹é…çš„æ‰€æœ‰æ–‡ä»¶ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>with_fileglob</code>ã€‚</p>
<p>åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œå°†æœ¬åœ°è®¡ç®—æœº/ tmpç›®å½•ä¸­æ‰€æœ‰ä»¥'hello'å¼€å¤´çš„æ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚</p>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blocks</span>
  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ansible copy multiple files with wildcard matching.</span>
    <span class="nt">copy</span><span class="p">:</span>
      <span class="nt">src</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}&quot;</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc</span>
    <span class="nt">with_fileglob</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/hello*</span>
</pre></div>


<h2 id="_5">å¤åˆ¶ä¹‹å‰åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸­åˆ›å»ºæ–‡ä»¶å¤‡ä»½<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p>å¤åˆ¶æ–‡ä»¶æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿé”™è¯¯ã€‚æ‚¨å¯èƒ½ä¼šå¤åˆ¶é”™è¯¯çš„æ–‡ä»¶ï¼Œå†™å…¥é”™è¯¯çš„å†…å®¹ç­‰ã€‚è¿™å°†é€ æˆå¾ˆå¤šéº»çƒ¦ã€‚å› æ­¤ï¼Œå¦‚æœåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šåˆ›å»ºè¿œç¨‹æ–‡ä»¶çš„å¤‡ä»½å°†å¾ˆæœ‰å¸®åŠ©ã€‚</p>
<p>Ansibleå¤åˆ¶æ¨¡å—ä¸ºæ­¤æä¾›äº†ä¸€ä¸ª<code>backup</code>å‚æ•°ã€‚å¦‚æœè¿œç¨‹æ–‡ä»¶å­˜åœ¨ä¸”ä¸å¤åˆ¶çš„æ–‡ä»¶ä¸åŒï¼Œåˆ™å°†åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ã€‚æ–°æ–‡ä»¶å°†é€šè¿‡é™„åŠ æ—¶é—´æˆ³å’ŒåŸå§‹æ–‡ä»¶åæ¥å‘½åã€‚å¤‡ä»½å‚æ•°çš„é»˜è®¤å€¼ä¸º<code>no</code>ã€‚</p>
<p>ä¾‹å¦‚ï¼Œä»¥ä¸‹ç¤ºä¾‹å°†åœ¨è¿œç¨‹æœåŠ¡å™¨çš„<code>/tmp</code>ç›®å½•ä¸­åˆ›å»º<code>helloworld.txt</code>çš„å¤‡ä»½ã€‚å®ƒå°†è¢«å‘½åä¸º<code>helloworld.txt.8925.2019-10-12@14:53:13</code>ã€‚</p>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blocks</span>
  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ansible copy file backup example</span>
    <span class="nt">copy</span><span class="p">:</span>
      <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">~/helloworld.txt</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp</span>
      <span class="nt">backup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>


<h2 id="ad-hoc">ä½¿ç”¨ä¸´æ—¶(Ad-hoc)æ–¹æ³•å¤åˆ¶æ–‡ä»¶<a class="headerlink" href="#ad-hoc" title="Permanent link">&para;</a></h2>
<p>ä»¥ä¸Šå¤§å¤šæ•°ä»»åŠ¡ä¹Ÿå¯ä»¥ä»¥ Ad-hoc æ–¹å¼å®Œæˆã€‚</p>
<div class="highlight"><pre><span></span>ansible blocks -m copy -a <span class="s2">&quot;src=~/sample.txt dest=/tmp&quot;</span> -i inventory.ini
ansible blocks -m copy -a <span class="s2">&quot;src=~/copy_dir_ex dest=/tmp&quot;</span> -i inventory.ini
ansible blocks -m copy -a <span class="s2">&quot;src=/tmp/hello6 dest=/tmp/hello7 remote_src=yes&quot;</span> -s -i inventory.ini
</pre></div>


<h2 id="_6">å°†æ–‡ä»¶ä»è¿œç¨‹è®¡ç®—æœºå¤åˆ¶åˆ°æœ¬åœ°è®¡ç®—æœº<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h2>
<p>æ‚¨è¿˜å¯ä»¥å°†æ–‡ä»¶ä»è¿œç¨‹æœåŠ¡å™¨å¤åˆ¶åˆ°æœ¬åœ°è®¡ç®—æœºã€‚è¿™å¯ä»¥ä½¿ç”¨Ansible <em>fetch</em>æ¨¡å—å®Œæˆã€‚å½“æ‚¨è¦å°†æŸäº›æ—¥å¿—æ–‡ä»¶ä»è¿œç¨‹æœåŠ¡å™¨å¤åˆ¶åˆ°æœ¬åœ°è®¡ç®—æœºæ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†åœ¨ç›®æ ‡ç›®å½•ï¼ˆæœ¬åœ°è®¡ç®—æœºï¼‰ä¸­åˆ›å»ºä¸€ä¸ªä»¥æ‚¨æ­£åœ¨è¿æ¥çš„æ¯ä¸ªä¸»æœºå‘½åçš„ç›®å½•ã€‚æå–çš„æ–‡ä»¶å°†è¢«å¤åˆ¶åˆ°æ­¤å¤„ã€‚å¦‚æœè¿œç¨‹æœåŠ¡å™¨ä¸Šä¸å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šå¼•å‘ä»»ä½•é”™è¯¯ã€‚</p>
<p>åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘åœ¨ remote-server-1 ä¸Šè¿è¡Œä»»åŠ¡ã€‚è¯¥æ–‡ä»¶å°†è¢«å¤åˆ¶åˆ° æœ¬åœ°è®¡ç®—æœºçš„<code>/etc/remote-server-1/tmp</code>ç›®å½•ä¸­ã€‚</p>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blocks</span>
  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ansible fetch files from remote server to the local machine using Ansible fetch module</span>
    <span class="nt">fetch</span><span class="p">:</span>
      <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/hello2</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/etc</span>
      <span class="nt">mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0774</span>
</pre></div>


<p>å¦‚æœæ‚¨ä¸å¸Œæœ›å‡ºç°è¿™ç§æƒ…å†µï¼Œå¹¶ä¸”éœ€è¦å°†æ–‡ä»¶ç›´æ¥å¤åˆ¶åˆ°ç›®æ ‡ç›®å½•ï¼Œåˆ™åº”ä½¿ç”¨<code>flat</code>å‚æ•°ã€‚</p>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blocks</span>
  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ansible fetch directory example with flat parameter set</span>
    <span class="nt">fetch</span><span class="p">:</span>
      <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/hello2</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/</span>
      <span class="nt">mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0774</span>
      <span class="nt">flat</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>


<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.5/png/64/1f4d3.png" title=":notebook:" width="20px"> å¤‡æ³¨:</p>
<ol>
<li>å¦‚æœæ‚¨ä½¿ç”¨<code>flat</code>å‚æ•°ï¼Œå¹¶ä¸”æ–‡ä»¶åä¸æ˜¯å”¯ä¸€çš„ï¼Œåˆ™æ¯æ¬¡è·å–æ–‡ä»¶æ—¶éƒ½ä¼šæ›¿æ¢ç°æœ‰æ–‡ä»¶ã€‚</li>
<li>å¦‚æœæ‚¨å¸Œæœ›åœ¨æºæ–‡ä»¶ä¸¢å¤±çš„æƒ…å†µä¸‹å¼•å‘é”™è¯¯ï¼Œåˆ™å°†<code>fail_on_missing</code>å‚æ•°è®¾ç½®ä¸º<code>yes</code>ã€‚å¦‚æœè¿œç¨‹æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä»¥ä¸‹ç¤ºä¾‹å°†å¼•å‘é”™è¯¯ã€‚</li>
</ol>
</blockquote>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">blocks</span>
  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ansible fetch example with fail_on_missing set</span>
    <span class="nt">fetch</span><span class="p">:</span>
      <span class="nt">src</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/fetch.txt</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/tmp/</span>
      <span class="nt">mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0774</span>
      <span class="nt">fail_on_missing</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>


<blockquote>
<p><img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.5/png/64/1f4d3.png" title=":notebook:" width="20px"> å¤‡æ³¨:</p>
<p>å¦‚æœå°è¯•å°†ç›®æ ‡è·¯å¾„<code>dest</code>è®¾ç½®ä¸ºç›®å½•ï¼Œè¯·åœ¨è·¯å¾„æœ«å°¾æ·»åŠ â€œ<code>\</code>ã€‚å¦åˆ™Ansibleå°†è¿è¡Œè¯¥ä»»åŠ¡ï¼Œå°±åƒç›®æ ‡è·¯å¾„<code>dest</code>æ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸€æ ·, å¹¶å°è¯•æ›¿æ¢å®ƒã€‚æ‚¨å¯èƒ½ä¼šæ”¶åˆ°ä»¥ä¸‹é”™è¯¯: (<strong>åªé’ˆå¯¹åŠ å‚æ•°<code>flat</code>çš„æƒ…å†µ</strong>)</p>
<p><code>fatal: [remote-machine-1]: FAILED! =&gt; {â€œfailedâ€: true, â€œmsgâ€: â€œdest is an existing directory, use a trailing slash if you want to fetch src into that directoryâ€}</code></p>
</blockquote>
<h2 id="copy">ä½¿ç”¨ copy æ¨¡å—å†™å…¥æ–‡ä»¶<a class="headerlink" href="#copy" title="Permanent link">&para;</a></h2>
<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨Ansible <em>copy</em> æ¨¡å—ä¸­çš„<code>contents</code>å‚æ•°å†™å…¥æ–‡ä»¶ã€‚ä»¥ä¸‹ç¤ºä¾‹å°†ç»™<code>content</code>å‚æ•°æä¾›çš„å€¼å†™å…¥check4.txtæ–‡ä»¶ã€‚</p>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">all</span>
  <span class="nt">tasks</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Ansible write to a file example</span>
  <span class="p p-Indicator">-</span> <span class="nt">copy</span><span class="p">:</span>
      <span class="nt">content</span><span class="p">:</span> <span class="p p-Indicator">|</span>
        <span class="no">Content parameter example.</span>
        <span class="no">Check4.txt will be created after this task is executed.</span>
      <span class="nt">dest</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/Users/mdtutorials2/Documents/Ansible/check4.txt</span>
      <span class="nt">backup</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">yes</span>
</pre></div>


<h2 id="copy_1">copy æ¨¡å—çš„è¿”å›å€¼<a class="headerlink" href="#copy_1" title="Permanent link">&para;</a></h2>
<p><em>copy</em> æ¨¡å—ä¸ºæ¯ä¸ªä»»åŠ¡è¿”å›ä¸€äº›å€¼ã€‚å®Œæ•´åˆ—è¡¨å¯åœ¨<a href="http://docs.ansible.com/ansible/copy_module.html#return-values">Ansibleæ–‡æ¡£ä¸­æ‰¾åˆ°</a>ã€‚</p>
<p>ä¾‹ï¼š</p>
<div class="highlight"><pre><span></span>    <span class="s">&quot;changed&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true,</span> 
    <span class="s">&quot;checksum&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;98d8fb24e8b2c2cec9c5ae963bd65c3657f50b16&quot;</span><span class="err">,</span> 
    <span class="s">&quot;dest&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;/tmp/sample.txt&quot;</span><span class="err">,</span> 
    <span class="s">&quot;gid&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0,</span> 
    <span class="s">&quot;group&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;root&quot;</span><span class="err">,</span> 
    <span class="s">&quot;md5sum&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;ce83d23d6eb6bf079e1fc5c448ea9a9f&quot;</span><span class="err">,</span> 
    <span class="s">&quot;mode&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;0644&quot;</span><span class="err">,</span> 
    <span class="s">&quot;owner&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;root&quot;</span><span class="err">,</span> 
    <span class="s">&quot;size&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">13,</span> 
    <span class="s">&quot;src&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;/home/mdtutorials2/.ansible/tmp/ansible-tmp-1489974916.02-178756727263160/source&quot;</span><span class="err">,</span> 
    <span class="s">&quot;state&quot;</span><span class="p p-Indicator">:</span> <span class="s">&quot;file&quot;</span><span class="err">,</span> 
    <span class="s">&quot;uid&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0</span>
</pre></div>


<h2 id="_7">å°†æŸ¥æ‰¾åˆ°çš„æ–‡ä»¶å¤åˆ¶<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p>ä½¿ç”¨ <em>find</em> æ¨¡å—é€’å½’æŸ¥æ‰¾<code>/appl/scripts/inq</code>ä¸‹çš„æ‰€æœ‰ç¬¦åˆ<code>patterns="inq.Linux*"</code>çš„æ–‡ä»¶, å¹¶å°†è¿™äº›æ–‡ä»¶èµ‹å€¼åˆ°<code>/usr/local/bin</code> ç›®å½•.</p>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="nt">hosts</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">lnx</span>
  <span class="nt">tasks</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">find</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">paths=&quot;/appl/scripts/inq&quot; recurse=yes patterns=&quot;inq.Linux*&quot;</span>
      <span class="nt">register</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">file_to_copy</span>
    <span class="p p-Indicator">-</span> <span class="nt">copy</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">src={{ item.path }} dest=/usr/local/sbin/</span>
      <span class="nt">owner</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">root</span>
      <span class="nt">mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">0775</span>
      <span class="nt">with_items</span><span class="p">:</span> <span class="s">&quot;{{</span><span class="nv"> </span><span class="s">files_to_copy.files</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>


<p><em>find</em> æ¨¡å—çš„è¿”å›å€¼å¦‚ä¸‹:</p>
<table>
<thead>
<tr>
<th>Key</th>
<th>Returned</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>examined</strong> ç±»å‹:integer</td>
<td>success</td>
<td>æŸ¥æ‰¾çš„æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡æ•°. <strong>ç¤ºä¾‹</strong>: 34</td>
</tr>
<tr>
<td><strong>files</strong> ç±»å‹: list</td>
<td>success</td>
<td>æ‰¾åˆ°ç¬¦åˆæŒ‡å®šæ¡ä»¶çš„æ‰€æœ‰åŒ¹é…é¡¹ <strong>ç¤ºä¾‹:</strong><code>[{'path': '/var/tmp/test1', 'mode': '0644', '...': '...', 'checksum': '16fac7be61a6e4591a33ef4b729c5c3302307523'}, {'path': '/var/tmp/test2', '...': '...'}]</code></td>
</tr>
<tr>
<td><strong>matched</strong> ç±»å‹: integer</td>
<td>success</td>
<td>åŒ¹é…æ•°é‡ <strong>ç¤ºä¾‹:</strong>14</td>
</tr>
</tbody>
</table>
<p>å…·ä½“è§£é‡Š:</p>
<ul>
<li><code>register: file_to_copy</code> æ‰€æœ‰è¿”å›å€¼æ³¨å†Œä¸º<code>file_to_copy</code> å¯¹è±¡</li>
<li><code>files_to_copy.files</code> å³æ‰¾åˆ°çš„ç¬¦åˆæŒ‡å®šæ¡ä»¶çš„æ‰€æœ‰åŒ¹é…é¡¹ <strong>ç¤ºä¾‹:</strong><code>[{'path': '/var/tmp/test1', 'mode': '0644', '...': '...', 'checksum': '16fac7be61a6e4591a33ef4b729c5c3302307523'}, {'path': '/var/tmp/test2', '...': '...'}]</code></li>
<li><code>item.path</code>: å…·ä½“çš„ç¬¦åˆçš„æ–‡ä»¶è·¯å¾„, å³: <code>/var/tmp/test1</code> <code>/var/tmp/test2</code>...</li>
</ul>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://www.EWhisper.cn/tag/python.html">python</a>
      <a href="https://www.EWhisper.cn/tag/devops.html">devops</a>
      <a href="https://www.EWhisper.cn/tag/ansible.html">ansible</a>
      <a href="https://www.EWhisper.cn/tag/linux.html">linux</a>
      <a href="https://www.EWhisper.cn/tag/yi-wen.html">è¯‘æ–‡</a>
    </p>
  </div>

  <div class="center social-share">
    <p>å–œæ¬¢è¿™ç¯‡æ–‡ç« å—ï¼Ÿå°†å®ƒä¸æ‚¨çš„æœ‹å‹åˆ†äº«å§ï¼</p>
    <div class="addthis_native_toolbox"></div>
    <div class="addthis_sharing_toolbox"></div>
    <div class="addthis_inline_share_toolbox"></div>
  </div>

  <div class="neighbors">
    <a class="btn float-left" href="https://www.EWhisper.cn/how-to-manager-nginx-using-ansible.html" title="Ansible æ–°æ‰‹æŒ‡å— - å¦‚ä½•æ‰¹é‡ç®¡ç† NGINX">
      <i class="fa fa-angle-left"></i> Previous Post
    </a>
    <a class="btn float-right" href="https://www.EWhisper.cn/deny-xff-ip-in-nginx.html" title="åœ¨NGINXä¸­æ ¹æ®ç”¨æˆ·çœŸå®IPè¿›è¡Œé™åˆ¶">
      Next Post <i class="fa fa-angle-right"></i>
    </a>
  </div>

  <div class="related-posts">
    <h4>æ‚¨å¯èƒ½è¿˜å–œæ¬¢</h4>
    <ul class="related-posts">
      <li><a href="https://www.EWhisper.cn/how-to-manager-nginx-using-ansible.html">Ansible æ–°æ‰‹æŒ‡å— - å¦‚ä½•æ‰¹é‡ç®¡ç† NGINX</a></li>
      <li><a href="https://www.EWhisper.cn/nginx-handbook-3-11-operation-best-practices.html">NGINX å®æˆ˜æ‰‹å†Œ-è¿ç»´-å®ç”¨è¿ç»´Tipså’Œæ€»ç»“</a></li>
      <li><a href="https://www.EWhisper.cn/nginx-handbook-3-7-ab-test.html">NGINX å®æˆ˜æ‰‹å†Œ-è¿ç»´-ä½¿ç”¨`split_clients`è¿›è¡ŒA-Bæµ‹è¯•</a></li>
      <li><a href="https://www.EWhisper.cn/nginx-handbook-3-8-use-geoip-to-get-users-location.html">NGINX å®æˆ˜æ‰‹å†Œ-è¿ç»´-ä½¿ç”¨GeoIPæ¨¡å—é€šè¿‡IPåœ°å€å®šä½ç”¨æˆ·</a></li>
      <li><a href="https://www.EWhisper.cn/nginx-handbook-3-6-automatation.html">NGINX å®æˆ˜æ‰‹å†Œ-è¿ç»´-è‡ªåŠ¨åŒ–</a></li>
    </ul>
  </div>


</article>

    <footer>
<p>
  &copy;  2020 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p><a href="http://beian.miit.gov.cn" target="_blank">æ²ªICPå¤‡19007314å·-1</a></p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
<!-- StatusCake -->
<a href="https://www.statuscake.com" title="ä¸ªäººæŠ€æœ¯åˆ†äº« Uptime">
  <img src="https://app.statuscake.com/button/index.php?Track=CbJdcjmnCx&amp;Days=7&amp;Design=7" alt="ä¸ªäººæŠ€æœ¯åˆ†äº« Uptime"/>
</a>

<!-- End StatusCake --></p>    </footer>
  </main>


    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5c98c3e21c4def55" async="async"></script>


<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " ä¸ªäººæŠ€æœ¯åˆ†äº« ",
  "url" : "https://www.EWhisper.cn",
  "image": "//s.gravatar.com/avatar/7c743bc6ac83171e35a5aa8bd66cc1ea?s=120",
  "description": "Focus on Python/Java/DevOps/Observability"
}
</script>

<a href="https://github.com/east4ming/my-pelican" class="github-corner" aria-label="View source on Github">
    <svg width="80"
         height="80"
         viewBox="0 0 250 250"
         style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;"
         aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor"
              style="transform-origin: 130px 106px;"
              class="octo-arm">
        </path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor"
              class="octo-body">
        </path>
    </svg>
</a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style></body>
</html>