<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>ä¸œé£å¾®é¸£ Blog - jvm</title><link>https://www.EWhisper.cn/</link><description>Focus on Python/Java/DevOps/Observability</description><lastBuildDate>Tue, 12 Mar 2019 10:48:00 +0800</lastBuildDate><item><title>8ç§Java å†…å­˜æº¢å‡ºä¹‹ä¸€:Java Heap Space</title><link>https://www.EWhisper.cn/java-oom-1-java-heap-space.html</link><description>&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#11-javalangoutofmemoryerror-java-heap-space"&gt;1.1  java.lang.OutOfMemoryError: Java heap space æ¦‚è¿°&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#12"&gt;1.2 åŸå› &lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#13"&gt;1.3 ç¤ºä¾‹&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#131-1"&gt;1.3.1 ç¤ºä¾‹1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#132"&gt;1.3.2 å†…å­˜æ³„æ¼ç¤ºä¾‹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#14"&gt;1.4 è§£å†³æ–¹æ¡ˆ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="11-javalangoutofmemoryerror-java-heap-space"&gt;1.1  java.lang.OutOfMemoryError: Java heap space æ¦‚è¿°&lt;a class="headerlink" href="#11-javalangoutofmemoryerror-java-heap-space" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Java åº”ç”¨åªå…è®¸ä½¿ç”¨æœ‰é™çš„å†…å­˜ã€‚è¿™ä¸ªé™åˆ¶æ˜¯åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™æŒ‡å®šçš„ã€‚å±•å¼€æ¥è¯´ï¼Œ Javaå†…å­˜åˆ†æˆ2ä¸ªä¸åŒçš„åŒºåŸŸã€‚è¿™ä¸¤ä¸ªåŒºåŸŸå«åšHeap Space ï¼ˆå †å†…å­˜ï¼‰å’Œ Permgen ï¼ˆPermanent Generationï¼Œå³æ°¸ä¹…ä»£ï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="javaå†…å­˜ç»“æ„" src="https://www.EWhisper.cn/images/java_memory.png"&gt;&lt;/p&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªåŒºçš„å¤§å°æ˜¯åœ¨JVMå¯åŠ¨çš„æ—¶å€™è®¾ç½®, å¯ä»¥é€šè¿‡JVMå‚æ•°&lt;code&gt;-Xmx&lt;/code&gt; å’Œ &lt;code&gt;-XX:MaxPermSize&lt;/code&gt;è¿›è¡Œè®¾ç½®. å¦‚æœä½ æ²¡æ¬§è¿›è¡Œç‰¹åˆ«çš„è®¾ç½®, &lt;strong&gt;å¹³å°æŒ‡å®š&lt;/strong&gt;çš„é»˜è®¤é…ç½®ä¼šè¢«ä½¿ç”¨.
&lt;code&gt;java.lang.OutOfMemoryError: Java heap space&lt;/code&gt; é”™è¯¯ä¼šåœ¨åº”ç”¨å°è¯•æ·»åŠ æ›´å¤šçš„æ•°æ®åˆ°heap space, ä½†æ˜¯heapåŒºæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ—¶è§¦å‘.&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„çš„æ˜¯å³ä½¿&lt;strong&gt;ç‰©ç†å†…å­˜&lt;/strong&gt;å¯èƒ½æœ‰å¾ˆå¤šå‰©ä½™, ä½†æ˜¯åªè¦JVMè¾¾åˆ°äº†heap sizeçš„é™åˆ¶, å°±ä¼šæŠ›å‡ºè¯¥é”™è¯¯.&lt;/p&gt;
&lt;h2 id="12"&gt;1.2 åŸå› &lt;a class="headerlink" href="#12" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;å¯¹äº &lt;code&gt;java.lang.OutOfMemoryError: Java heap space&lt;/code&gt; , æœ€å¸¸è§çš„åŸå› å¾ˆç®€å• -- ä½ æŠŠä¸€ä¸ªXXLå·çš„åº”ç”¨æ”¾åˆ°äº†ä¸€ä¸ªSå·çš„Java heap spaceé‡Œäº†. ä¹Ÿå°±æ˜¯è¯´ -- åº”ç”¨éœ€è¦æ›´å¤šçš„Java heap space æ¥è®©å®ƒæ­£å¸¸è¿è¡Œ. å¯¹äºè¿™ä¸ªOutOfMemory, å…¶ä»–çš„åŸå› ä¼šæ›´å¤æ‚, é€šå¸¸æ˜¯ç”±äºç¼–ç¨‹é”™è¯¯å¼•èµ·çš„:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç”¨æˆ·/æ•°æ®é‡å‡ºç°å³°å€¼&lt;/strong&gt; è¯¥åº”ç”¨è¢«è®¾è®¡æ¥å¤„ç†ä¸€å®šæ•°é‡çš„ç”¨æˆ·å’Œä¸€å®šæ•°é‡çš„æ•°æ®. å½“ç”¨æˆ·æ•°æˆ–æ•°æ®é‡çªç„¶å†²é«˜, å¹¶ä¸”è¶…è¿‡äº†æœŸæœ›çš„é˜ˆå€¼, åœ¨å‡ºç°å³°å€¼åœæ­¢ä¹‹å‰çš„æ­£å¸¸è¿è¡Œæ—¶çš„æ“ä½œè§¦å‘äº† &lt;code&gt;java.lang.OutOfMemoryError: Java heap space&lt;/code&gt; é”™è¯¯.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†…å­˜æ³„æ¼&lt;/strong&gt; ä¸€ç§ç‰¹å®šç±»å‹çš„ç¼–ç¨‹é”™è¯¯å¯¼è‡´åº”ç”¨é¢‘ç¹æ¶ˆè€—æ›´å¤šçš„å†…å­˜. æ¯å½“åº”ç”¨çš„æ³„æ¼çš„åŠŸèƒ½è¢«ä½¿ç”¨æ—¶, å®ƒå°±ä¼šåœ¨Java heap spaceç§ç”Ÿæˆä¸€äº›å¯¹è±¡. éšç€æ—¶é—´æ¨ç§», æ³„æ¼çš„å¯¹è±¡æ¶ˆè€—äº†æ‰€æœ‰å¯ç”¨çš„Java heap space, å¹¶ä¸”è§¦å‘äº†å¸¸è§çš„&lt;code&gt;java.lang.OutOfMemoryError: Java heap space&lt;/code&gt;  é”™è¯¯.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="13"&gt;1.3 ç¤ºä¾‹&lt;a class="headerlink" href="#13" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="131-1"&gt;1.3.1 ç¤ºä¾‹1&lt;a class="headerlink" href="#131-1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ç¬¬ä¸€ä¸ªä¾‹å­ç›¸å½“ç®€å• -- ä¸‹åˆ—çš„Java ä»£ç å°è¯•åˆ†é…200ä¸‡ä¸ª(2M) æ•´æ•°æ•°ç»„. å½“ä½ ç¼–è¯‘è¯¥ä»£ç , ç”¨ä¸€ä¸ª12MBå¤§å°çš„Java heap space (&lt;code&gt;java -Xmx12m OOM&lt;/code&gt;)è¿è¡Œ. å®ƒä¼šè¿è¡Œå¤±è´¥, æŠ›å‡º &lt;code&gt;java.lang.OutOfMemoryError: Java heap space&lt;/code&gt;  æ¶ˆæ¯. æœ‰13MB Java heap space, è¿™ä¸ªç¨‹åºå°±èƒ½æ­£å¸¸è¿è¡Œ...&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;OOM&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
  &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kd"&gt;final&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;SIZE&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
  &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="n"&gt;SIZE&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="132"&gt;1.3.2 å†…å­˜æ³„æ¼ç¤ºä¾‹&lt;a class="headerlink" href="#132" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ç¬¬äºŒä¸ª, æ›´ç°å®ä¸€ç‚¹çš„ä¾‹å­æ˜¯å†…å­˜æ³„æ¼. åœ¨Javaé‡Œ, å½“å¼€å‘åˆ›å»ºå’Œä½¿ç”¨æ–°å¯¹è±¡, å¦‚: &lt;code&gt;new Integer(5)&lt;/code&gt;, ä»–ä»¬ä¸å¿…è‡ªå·±åˆ†æ´¾å†…å­˜ -- è¿™é€šè¿‡JVMæ¥å¤„ç†. åœ¨åº”ç”¨ç”Ÿå‘½å‘¨æœŸç§, JVMä¼šå‘¨æœŸæ€§åœ°æ£€æŸ¥å†…å­˜ä¸­çš„å“ªä¸ªå¯¹è±¡ä»åœ¨ä½¿ç”¨, å“ªä¸ªæ²¡æœ‰. æ²¡æœ‰è¢«ä½¿ç”¨çš„å¯¹è±¡ä¼šè¢«ä¸¢å¼ƒ, ç„¶åå†…å­˜é‡æ–°å£°æ˜å¹¶é‡æ–°ä½¿ç”¨. è¿™ä¸ªè¿‡ç¨‹å«åš&lt;strong&gt;åƒåœ¾å›æ”¶&lt;/strong&gt;. å¯¹åº”çš„JVMé‡Œçš„æ¨¡å—å«åš&lt;strong&gt;åƒåœ¾æ”¶é›†å™¨&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Javaçš„è‡ªåŠ¨å†…å­˜ç®¡ç†æœºåˆ¶ä»¥æ¥ä¸GCæ¥å‘¨æœŸæ€§åœ°æŸ¥æ‰¾æ²¡ç”¨çš„å¯¹è±¡å¹¶ç§»é™¤ä»–ä»¬. ç®€è€Œè¨€ä¹‹, Javaå†…å­˜æ³„æ¼æ˜¯è¿™ä¹ˆä¸€ç§åœºæ™¯, ä¸€äº›å¯¹è±¡åº”ç”¨å·²ç»ä¸ç”¨äº†, ä½†æ˜¯GCå´æ²¡æœ‰æ£€æŸ¥å‡ºæ¥. ç»“æœå°±æ˜¯è¿™äº›æ²¡ç”¨çš„å¯¹è±¡ä»ç„¶æ— é™æœŸåœ°å­˜åœ¨åœ¨Java heap space ä¸­. å¦‚æ­¤å¾€å¤, æœ€ç»ˆè§¦å‘&lt;code&gt;java.lang.OutOfMemoryError: Java heap space&lt;/code&gt;é”™è¯¯.&lt;/p&gt;
&lt;p&gt;æ„é€ ä¸€ä¸ªæ»¡è¶³å†…å­˜æ³„æ¼å®šä¹‰çš„Javaç¨‹åºä¹Ÿç›¸å½“å®¹æ˜“:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;KeylessEntry&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
  &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kd"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Key&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;Integer&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;

    &lt;span class="n"&gt;Key&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Integer&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="nd"&gt;@Override&lt;/span&gt;
    &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="nf"&gt;hashCode&lt;/span&gt;&lt;span class="o"&gt;()&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;id&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;hashCode&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
    &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kd"&gt;static&lt;/span&gt; &lt;span class="kt"&gt;void&lt;/span&gt; &lt;span class="nf"&gt;main&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;String&lt;/span&gt;&lt;span class="o"&gt;[]&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;Map&lt;/span&gt; &lt;span class="n"&gt;m&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;HashMap&lt;/span&gt;&lt;span class="o"&gt;();&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kc"&gt;true&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;
      &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="kt"&gt;int&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="mi"&gt;10000&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;++)&lt;/span&gt;
        &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(!&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;containsKey&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;Key&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;)))&lt;/span&gt;
          &lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;put&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;Key&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;),&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;Nmber:&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å½“æ‰§è¡Œä¸Šé¢çš„ä»£ç æ—¶ï¼Œæ‚¨å¯èƒ½æœŸæœ›å®ƒæ°¸è¿œè¿è¡Œè€Œæ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œå‡è®¾åŸå§‹ç¼“å­˜è§£å†³æ–¹æ¡ˆåªå°†Mapæ‰©å±•åˆ°10,000ä¸ªå…ƒç´ ï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒHashMapä¸­å·²ç»åŒ…å«äº†æ‰€æœ‰é”®. ç„¶è€Œ, äº‹å®ä¸Šå…ƒç´ ä¼šæŒç»­å¢åŠ å› ä¸ºKeyè¿™ä¸ªç±»æ²¡æœ‰åœ¨å®ƒçš„&lt;code&gt;hashCode()&lt;/code&gt;ç§åŒ…å«ä¸€ä¸ªé€‚å½“çš„&lt;code&gt;equals()&lt;/code&gt;å®ç°.&lt;/p&gt;
&lt;p&gt;ç»“æœ, éšç€æ—¶é—´æ¨ç§», å› ä¸ºæ³„æ¼ä»£ç çš„ä¸æ–­çš„ä½¿ç”¨, "ç¼“å­˜"çš„ç»“æœä¼šæ¶ˆè€—å¤§é‡çš„Java heap space. å½“æ³„æ¼çš„å†…å­˜å¡«æ»¡äº†heapåŒºçš„æ‰€æœ‰çš„å¯ç”¨å†…å­˜, å¹¶ä¸”åƒåœ¾æ”¶é›†å™¨æ— æ³•æ¸…ç†, ä¼šæŠ›å‡º&lt;code&gt;java.lang.OutOfMemoryError: Java heap space&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;è§£å†³åŠæ³•ä¹Ÿç®€å• -- æ·»åŠ ä¸ª&lt;code&gt;equals()&lt;/code&gt;æ–¹æ³•çš„å®ç°åœ¨ä¸‹è¾¹, å°±èƒ½å¾ˆå¥½çš„è¿è¡Œäº†. ä½†æ˜¯åœ¨ä½ æœ€ç»ˆæ‰¾åˆ°è¿™ä¸ªbugä¹‹å‰, ä½ ä¼šè¥¿æ¬§çˆ±å¥½ç›¸å½“å¤šçš„è„‘ç»†èƒ.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nd"&gt;@Override&lt;/span&gt;
&lt;span class="kd"&gt;public&lt;/span&gt; &lt;span class="kt"&gt;boolean&lt;/span&gt; &lt;span class="nf"&gt;equals&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Object&lt;/span&gt; &lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
  &lt;span class="kt"&gt;boolean&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="kc"&gt;false&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt; &lt;span class="k"&gt;instanceof&lt;/span&gt; &lt;span class="n"&gt;Key&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;response&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;(((&lt;/span&gt;&lt;span class="n"&gt;Key&lt;/span&gt;&lt;span class="o"&gt;)&lt;/span&gt;&lt;span class="n"&gt;o&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="o"&gt;).&lt;/span&gt;&lt;span class="na"&gt;equals&lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;&lt;span class="k"&gt;this&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;id&lt;/span&gt;&lt;span class="o"&gt;);&lt;/span&gt;
  &lt;span class="o"&gt;}&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="o"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h2 id="14"&gt;1.4 è§£å†³æ–¹æ¡ˆ&lt;a class="headerlink" href="#14" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;æ˜¾ç„¶ç¬¬ä¸€ä¸ªè§£å†³æ–¹æ¡ˆå°±æ˜¯ -- å½“ä½ çš„JVMç‰¹å®šèµ„æºè€—å°½äº†, ä½ åº”è¯¥å¢åŠ é‚£ä¸ªèµ„æºçš„é‡. åœ¨è¿™ä¸ªæ¡ˆä¾‹ç§: å½“ä½ çš„åº”ç”¨æ²¡æœ‰è¶³å¤Ÿçš„Java heap spaceå†…å­˜æ¥æ­£å¸¸è¿è¡Œ, åªéœ€è¦åœ¨è¿è¡ŒJVMçš„æ—¶å€™é…ç½®å¹¶æ·»åŠ (æˆ–ä¿®æ”¹ç°æœ‰çš„)å¦‚ä¸‹å‚æ•°:
&lt;code&gt;-Xmx1024m&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šè¿°é…ç½®ä¼šç»™åº”ç”¨1024Mçš„Java heap space. ä½ å¯ä»¥ä½¿ç”¨&lt;code&gt;g&lt;/code&gt;æˆ–è€…&lt;code&gt;G&lt;/code&gt;(å•ä½æ˜¯GB), &lt;code&gt;m&lt;/code&gt;æˆ–&lt;code&gt;M&lt;/code&gt;(MB), &lt;code&gt;k&lt;/code&gt;æˆ–&lt;code&gt;K&lt;/code&gt;(KB). ä¾‹å¦‚ä¸‹åˆ—éƒ½æ˜¯è®¾ç½®æœ€å¤§Java heap spaceä¸º1GB:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;java -Xmx1073741824 com.mycompany.MyClass
java -Xmx1048576k com.mycompany.MyClass
java -Xmx1024m com.mycompany.MyClass
java -Xmx1g com.mycompany.MyClass
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç„¶è€Œ, åœ¨å¾ˆå¤šæ¡ˆä¾‹ç§, æä¾›æ›´å¤šçš„Java heap spaceåªæ˜¯é¥®é¸©æ­¢æ¸´. ä¾‹å¦‚, å¦‚æœä½ çš„åº”ç”¨å­˜åœ¨å†…å­˜æ³„æ¼, æ·»åŠ æ›´å¤šçš„heapåªæ˜¯å»¶ç¼“&lt;code&gt;java.lang.OutOfMemoryError: Java heap space&lt;/code&gt;é”™è¯¯çš„å‡ºç°, å¹¶ä¸èƒ½è§£å†³é—®é¢˜. å¦å¤–, å¢åŠ Java heap spaceä¹Ÿä¼šå¯¼è‡´GCæš‚åœæ—¶é—´çš„å¢åŠ , ä»è€Œå½±å“ä½ çš„åº”ç”¨çš„&lt;a href="https://plumbr.eu/blog/gc-impact-on-throughput-and-latency"&gt;ååé‡å’Œå»¶è¿Ÿ&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ å¸Œæœ›è§£å†³æ½œåœ¨çš„é—®é¢˜, è€Œä¸æ˜¯å¤´ç—›åŒ»å¤´, è”ç³»æˆ‘å°±æ˜¯æœ€å¥½çš„æ–¹å¼(ï¼ ï¿£ãƒ¼ï¿£ï¼ ). å½“ç„¶, æœ‰å‡ ä¸ªå·¥å…·é€‚åˆä½ . &lt;strong&gt;Debuggers&lt;/strong&gt;, &lt;strong&gt;profiles&lt;/strong&gt;, &lt;strong&gt;heap dump analyzers&lt;/strong&gt; -- ä¾›ä½ é€‰æ‹©.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;é¢˜å¤–è¯:
Dynatrace ä¹Ÿæ˜¯ä¸ªåˆ†æOOMé—®é¢˜çš„å¥½å·¥å…·.æ„Ÿå…´è¶£çš„å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« :
ã€Šæ¡ˆä¾‹: Dynatraceåˆ†ææŸè´¢é™©æ‰¿ä¿ç³»ç»Ÿå†…å­˜æ³„æ¼é—®é¢˜ã€‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;å–œæ¬¢æˆ‘çš„åšå®¢å—? æ‰“èµä¸€æ¯&lt;img align="absmiddle" alt="â˜•" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2615.png" title=":coffee:" width="20px"&gt;å§ã€‚æ‚¨çš„æ”¯æŒæ˜¯å¯¹æˆ‘çš„æœ€å¤§é¼“åŠ±ï½ å¦å¤–è®°å¾—ç»™æˆ‘ç•™è¨€æˆ–è®¢é˜…å“¦ &lt;img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"&gt;&lt;img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"&gt;&lt;img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"&gt;&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;&lt;a href="https://www.EWhisper.cn/pages/about.html"&gt;ç‚¹å‡»è¿™é‡Œæ‰“èµ&lt;img align="absmiddle" alt="ğŸ‘‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f449.png" title=":point_right:" width="20px"&gt;&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Tue, 12 Mar 2019 10:48:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-03-12:/java-oom-1-java-heap-space.html</guid><category>jvm</category><category>java</category><category>oom</category></item></channel></rss>