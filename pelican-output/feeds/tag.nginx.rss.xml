<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>ä¸œé£å¾®é¸£ Blog - nginx</title><link>https://www.EWhisper.cn/</link><description>Focus on Python/Java/DevOps/Observability</description><lastBuildDate>Sun, 23 Jun 2019 17:08:00 +0800</lastBuildDate><item><title>NGINX å­¦ä¹ ç¬”è®°-Gzipå‹ç¼©-`ngx_http_gunzip_module`</title><link>https://www.EWhisper.cn/nginx-notebook-3-3-gunzip-module.html</link><description>&lt;h2 id="3-ngx_http_gunzip_module"&gt;3 ngx_http_gunzip_module&lt;a class="headerlink" href="#3-ngx_http_gunzip_module" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;å¦‚æœå®¢æˆ·ç«¯æœ¬èº«ä¸æ”¯æŒè§£å‹Gzip, å°±éœ€è¦NginxæœåŠ¡å™¨åœ¨å‘å…¶å‘é€æ•°æ®å‰å…ˆå°†è¯¥æ•°æ®è§£å‹. è¿™äº›å‹ç¼©æ•°æ®å¯èƒ½æ¥è‡ªäºåç«¯æœåŠ¡å™¨å‹ç¼©äº§ç”Ÿæˆ–NginxæœåŠ¡å™¨é¢„å‹ç¼©äº§ç”Ÿ.&lt;/p&gt;
&lt;p&gt;è¯¥æ¨¡å—ä¸æ˜¯é»˜è®¤æ„å»ºçš„ï¼Œåº”è¯¥ä½¿ç”¨ &lt;code&gt;--with-http_gunzip_module&lt;/code&gt; é…ç½®å‚æ•°å¯ç”¨ã€‚&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sun, 23 Jun 2019 17:08:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-23:/nginx-notebook-3-3-gunzip-module.html</guid><category>nginx</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å­¦ä¹ ç¬”è®°-Gzipå‹ç¼©-Gzipå‹ç¼©åŠŸèƒ½çš„ä½¿ç”¨</title><link>https://www.EWhisper.cn/nginx-notebook-3-4-gzip-howto.html</link><description>&lt;h2 id="4-gzip"&gt;4 Gzipå‹ç¼©åŠŸèƒ½çš„ä½¿ç”¨&lt;a class="headerlink" href="#4-gzip" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="gzip"&gt;Gzipå‹ç¼©åŠŸèƒ½ç»¼åˆé…ç½®ç¤ºä¾‹&lt;a class="headerlink" href="#gzip" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;http&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;gzip&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;gzip_min_length&lt;/span&gt; &lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;gzip_buffers&lt;/span&gt; &lt;span class="mi"&gt;32&lt;/span&gt; &lt;span class="mi"&gt;4k&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;gzip_comp_level&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;gzip_types&lt;/span&gt; &lt;span class="s"&gt;text/plain&lt;/span&gt; &lt;span class="s"&gt;application/x-javascript&lt;/span&gt; &lt;span class="s"&gt;text/css&lt;/span&gt; &lt;span class="s"&gt;application/xml&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;gzip_vary&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;gunzip_static&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="gzip-ie6"&gt;Gzip å‹ç¼©åŠŸèƒ½ä¸IE6æµè§ˆå™¨è¿è¡Œè„šæœ¬çš„å…¼å®¹é—®é¢˜&lt;a class="headerlink" href="#gzip-ie6" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;gzip_disable&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;MSIE&lt;/span&gt; &lt;span class="s"&gt;[1-6]\.&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="nginxgzip"&gt;Nginxä¸å…¶ä»–æœåŠ¡å™¨äº¤äº’æ—¶äº§ç”Ÿçš„Gzipå‹ç¼©åŠŸèƒ½ç›¸å…³é—®é¢˜&lt;a class="headerlink" href="#nginxgzip" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸¤ç±»é—®é¢˜:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¤šå±‚æœåŠ¡å™¨åŒæ—¶å¼€å¯Gzipå‹ç¼©åŠŸèƒ½å¯¼è‡´;&lt;/li&gt;
&lt;li&gt;å¤šå±‚æœåŠ¡å™¨ä¹‹é—´å¯¹Gzipå‹ç¼©åŠŸèƒ½æ”¯æŒèƒ½åŠ›ä¸åŒå¯¼è‡´.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Nginxä¸åç«¯æœåŠ¡å™¨(å¦‚Tomcat)åŒæ—¶å¼€å¯Gzipå‹ç¼©åŠŸèƒ½å¯¹JavaScriptè„šæœ¬è¿›è¡Œå‹ç¼©, åœ¨å¤§å¤šæ•°æµè§ˆå™¨ä¸­åˆ·æ–°é¡µé¢ä¼šå¯¼è‡´è„šæœ¬è¿è¡Œå‘ç”Ÿå¼‚å¸¸, å”¯ä¸€å¯ä»¥è¿è¡Œçš„æµè§ˆå™¨æ˜¯Chrome.&lt;/p&gt;
&lt;p&gt;è§£å†³åŠæ³•:&lt;strong&gt;å¯¹äºåŒ…å«å¤šå±‚æœåŠ¡å™¨çš„ç³»ç»Ÿæ¥è¯´, NginxæœåŠ¡å™¨ä½œä¸ºå‰ç«¯æœåŠ¡å™¨å¦‚æœå¼€å¯äº†Gzipå‹ç¼©åŠŸèƒ½, åç«¯æœåŠ¡å™¨æœ€å¥½å°±ä¸è¦å†å¼€å¯äº†.&lt;/strong&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sun, 23 Jun 2019 17:08:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-23:/nginx-notebook-3-4-gzip-howto.html</guid><category>nginx</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å­¦ä¹ ç¬”è®°-Gzipå‹ç¼©-`ngx_http_gzip_static_module`</title><link>https://www.EWhisper.cn/nginx-notebook-3-2-gzip-static-module.html</link><description>&lt;h2 id="2-ngx_http_gzip_static_module"&gt;2 ngx_http_gzip_static_module&lt;a class="headerlink" href="#2-ngx_http_gzip_static_module" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;è¯¥æ¨¡å—ä¸æ˜¯é»˜è®¤æ„å»ºçš„ï¼Œå®ƒåº”è¯¥ä½¿ç”¨ &lt;code&gt;--with-http_gzip_static_module&lt;/code&gt; é…ç½®å‚æ•°å¯ç”¨ã€‚&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sun, 23 Jun 2019 17:05:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-23:/nginx-notebook-3-2-gzip-static-module.html</guid><category>nginx</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å­¦ä¹ ç¬”è®°-é«˜çº§é…ç½®-äº‹ä»¶é©±åŠ¨æ¨¡å‹ç›¸å…³çš„é…ç½®æŒ‡ä»¤</title><link>https://www.EWhisper.cn/nginx-notebook-2-4-events-directives.html</link><description>&lt;h2 id="4"&gt;4 äº‹ä»¶é©±åŠ¨æ¨¡å‹ç›¸å…³çš„é…ç½®æŒ‡ä»¤&lt;a class="headerlink" href="#4" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;use&lt;/code&gt;(æŒ‡å®šäº‹ä»¶é©±åŠ¨æ¨¡å‹)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;worker_connections&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç”¨äºè®¾ç½®NginxæœåŠ¡å™¨çš„&lt;strong&gt;æ¯ä¸ªå·¥ä½œè¿›ç¨‹&lt;/strong&gt;å…è®¸åŒæ—¶è¿æ¥å®¢æˆ·ç«¯çš„æœ€å¤§æ•°é‡(åŒ…æ‹¬å‰ç«¯ç”¨æˆ·è¿æ¥ä¹ŸåŒ…æ‹¬å…¶ä»–è¿æ¥)&lt;/p&gt;
&lt;p&gt;NginxæœåŠ¡å™¨å…è®¸åŒæ—¶è¿æ¥çš„å®¢æˆ·ç«¯æœ€å¤§æ•°é‡ &lt;code&gt;Client = worker_processes * worker_connections / 2&lt;/code&gt;&lt;/p&gt;
&lt;ol start="3"&gt;
&lt;li&gt;&lt;code&gt;worker_rlimit_sigpending&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;äº‹ä»¶é©±åŠ¨æ¨¡å‹rtsigå¯ä»¥ä¿å­˜çš„æœ€å¤§ä¿¡å·æ•°.&lt;/p&gt;
&lt;ol start="4"&gt;
&lt;li&gt;&lt;code&gt;devpoll_changes&lt;/code&gt; &lt;code&gt;devpoll_events&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç”¨äºè®¾ç½®åœ¨&lt;code&gt;/dev/poll&lt;/code&gt;äº‹ä»¶é©±åŠ¨æ¨¡å¼ä¸‹NginxæœåŠ¡å™¨ä¸å†…æ ¸ä¹‹é—´ä¼ é€’äº‹ä»¶çš„æ•°é‡.å‰è€…è®¾ç½®ä¼ é€’ç»™å†…æ ¸çš„äº‹ä»¶æ•°é‡, åè€…è®¾ç½®ä»å†…æ ¸è·å–çš„äº‹ä»¶æ•°é‡.&lt;/p&gt;
&lt;p&gt;é»˜è®¤å€¼ä¸º32&lt;/p&gt;
&lt;ol start="5"&gt;
&lt;li&gt;&lt;code&gt;kqueue_changes&lt;/code&gt; å’Œ &lt;code&gt;kqueue_events&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;kqueueäº‹ä»¶æ¨¡å‹ä¸‹. é»˜è®¤å€¼å‡ä¸º512&lt;/p&gt;
&lt;ol start="6"&gt;
&lt;li&gt;&lt;code&gt;epoll_events&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;epolläº‹ä»¶æ¨¡å‹ä¸‹, ä»Nginxåˆ°å†…æ ¸, ä»å†…æ ¸åˆ°Nginxç›¸ç­‰. é»˜è®¤å€¼ä¸º512.&lt;/p&gt;
&lt;ol start="7"&gt;
&lt;li&gt;&lt;code&gt;rtsig_signo&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;rtsigæ¨¡å¼. é»˜è®¤ç¬¬ä¸€ä¸ªä¿¡å·è®¾ç½®ä¸ºSIGRTMIN+10&lt;/p&gt;
&lt;ol start="8"&gt;
&lt;li&gt;&lt;code&gt;rtsig_overflow_*&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"&gt;å¤‡æ³¨:&lt;/p&gt;
&lt;p&gt;ç°åœ¨çš„Linuxå‘è¡Œç‰ˆä¸€èˆ¬æ¨èä½¿ç”¨&lt;code&gt;epoll&lt;/code&gt;äº‹ä»¶é©±åŠ¨æ¨¡å‹&lt;/p&gt;
&lt;/blockquote&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sun, 23 Jun 2019 16:33:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-23:/nginx-notebook-2-4-events-directives.html</guid><category>nginx</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å­¦ä¹ ç¬”è®°-Gzipå‹ç¼©-`ngx_http_gzip_module`</title><link>https://www.EWhisper.cn/nginx-notebook-3-1-gzip-module.html</link><description>&lt;p&gt;æœ¬ç³»åˆ—æ–‡ç« ä¸»è¦è®¨è®ºä¸gzip å‹ç¼©ç›¸å…³çš„Nginx æŒ‡ä»¤.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ç›¸å…³æ¨¡å—: &lt;code&gt;ngx_http_gzip_module ngx_http_gzip_static_module ngx_http_gunzip_module&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="1-ngx_http_gzip_module"&gt;1 ngx_http_gzip_module&lt;a class="headerlink" href="#1-ngx_http_gzip_module" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;gzip on | off&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;gzip_buffers&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç”¨äºè®¾ç½®Gzipå‹ç¼©æ–‡ä»¶ä½¿ç”¨ç¼“å­˜ç©ºé—´çš„å¤§å°.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;gzip_buffers number size;    # number ç¼“å­˜ç©ºé—´ä¸ªæ•°; size æ¯ä¸ªç©ºé—´å¤§å°&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;é»˜è®¤&lt;em&gt;number Ã— size&lt;/em&gt; ä¸º128. sizeçš„å€¼æ¨èå–ç³»ç»Ÿå†…å­˜é¡µä¸€é¡µçš„å¤§å°, ä¸º4KB æˆ–è€…8KB. å³&lt;code&gt;gzip_buffers 32 4k | 16 8k&lt;/code&gt;&lt;/p&gt;
&lt;ol start="3"&gt;
&lt;li&gt;&lt;code&gt;gzip_comp_level&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è®¾å®šGzipå‹ç¼©ç¨‹åº¦, åŒ…æ‹¬1åˆ°9. 1å‹ç¼©ç¨‹åº¦æœ€ä½, 9æœ€é«˜. é»˜è®¤ä¸º1.&lt;/p&gt;
&lt;ol start="4"&gt;
&lt;li&gt;&lt;code&gt;gzip_disable&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"&gt;å¤‡æ³¨&lt;/p&gt;
&lt;p&gt;é’ˆå¯¹ä¸åŒç§ç±»å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚, å¯ä»¥é€‰æ‹©æ€§åœ°å¼€å¯å’Œå…³é—­gzipåŠŸèƒ½.&lt;/p&gt;
&lt;p&gt;PCç«¯ï¼š&lt;/p&gt;
&lt;p&gt;safari 5.1 â€“ MAC&lt;/p&gt;
&lt;p&gt;User-Agent:Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_8; en-us) AppleWebKit/534.50 &amp;gt; (KHTML, like Gecko) Version/5.1 Safari/534.50&lt;/p&gt;
&lt;p&gt;safari 5.1 â€“ Windows&lt;/p&gt;
&lt;p&gt;User-Agent:Mozilla/5.0 (Windows; U; Windows NT 6.1; en-us) AppleWebKit/534.50 (KHTML, &amp;gt; like Gecko) Version/5.1 Safari/534.50&lt;/p&gt;
&lt;p&gt;IE 9.0&lt;/p&gt;
&lt;p&gt;User-Agent:Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0;&lt;/p&gt;
&lt;p&gt;IE 8.0&lt;/p&gt;
&lt;p&gt;User-Agent:Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0)&lt;/p&gt;
&lt;p&gt;IE 7.0&lt;/p&gt;
&lt;p&gt;User-Agent:Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)&lt;/p&gt;
&lt;p&gt;IE 6.0&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)&lt;/p&gt;
&lt;p&gt;Firefox 4.0.1 â€“ MAC&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.6; rv:2.0.1) Gecko/20100101 &amp;gt; Firefox/4.0.1&lt;/p&gt;
&lt;p&gt;Firefox 4.0.1 â€“ Windows&lt;/p&gt;
&lt;p&gt;User-Agent:Mozilla/5.0 (Windows NT 6.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1&lt;/p&gt;
&lt;p&gt;Opera 11.11 â€“ MAC&lt;/p&gt;
&lt;p&gt;User-Agent:Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; en) Presto/2.8.131 Version/&amp;gt; 11.11&lt;/p&gt;
&lt;p&gt;Opera 11.11 â€“ Windows&lt;/p&gt;
&lt;p&gt;User-Agent:Opera/9.80 (Windows NT 6.1; U; en) Presto/2.8.131 Version/11.11&lt;/p&gt;
&lt;p&gt;Chrome 17.0 â€“ MAC&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_0) AppleWebKit/535.11 (KHTML, &amp;gt; like Gecko) Chrome/17.0.963.56 Safari/535.11&lt;/p&gt;
&lt;p&gt;å‚²æ¸¸ï¼ˆMaxthonï¼‰&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Maxthon 2.0)&lt;/p&gt;
&lt;p&gt;è…¾è®¯TT&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; TencentTraveler 4.0)&lt;/p&gt;
&lt;p&gt;ä¸–ç•Œä¹‹çª—ï¼ˆThe Worldï¼‰ 2.x&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)&lt;/p&gt;
&lt;p&gt;ä¸–ç•Œä¹‹çª—ï¼ˆThe Worldï¼‰ 3.x&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; The World)&lt;/p&gt;
&lt;p&gt;æœç‹—æµè§ˆå™¨ 1.x&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; SE 2.X &amp;gt; MetaSr 1.0; SE 2.X MetaSr 1.0; .NET CLR 2.0.50727; SE 2.X MetaSr 1.0)&lt;/p&gt;
&lt;p&gt;360æµè§ˆå™¨&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; 360SE)&lt;/p&gt;
&lt;p&gt;Avant&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Avant Browser)&lt;/p&gt;
&lt;p&gt;Green Browser&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)&lt;/p&gt;
&lt;p&gt;ç§»åŠ¨è®¾å¤‡ç«¯ï¼š&lt;/p&gt;
&lt;p&gt;safari iOS 4.33 â€“ iPhone&lt;/p&gt;
&lt;p&gt;User-Agent:Mozilla/5.0 (iPhone; U; CPU iPhone OS 4_3_3 like Mac OS X; en-us) &amp;gt; AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8J2 Safari/6533.18.5&lt;/p&gt;
&lt;p&gt;safari iOS 4.33 â€“ iPod Touch&lt;/p&gt;
&lt;p&gt;User-Agent:Mozilla/5.0 (iPod; U; CPU iPhone OS 4_3_3 like Mac OS X; en-us) AppleWebKit/&amp;gt; 533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8J2 Safari/6533.18.5&lt;/p&gt;
&lt;p&gt;safari iOS 4.33 â€“ iPad&lt;/p&gt;
&lt;p&gt;User-Agent:Mozilla/5.0 (iPad; U; CPU OS 4_3_3 like Mac OS X; en-us) AppleWebKit/&amp;gt; 533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8J2 Safari/6533.18.5&lt;/p&gt;
&lt;p&gt;Android N1&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/5.0 (Linux; U; Android 2.3.7; en-us; Nexus One Build/FRF91) &amp;gt; AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1&lt;/p&gt;
&lt;p&gt;Android QQæµè§ˆå™¨ For android&lt;/p&gt;
&lt;p&gt;User-Agent: MQQBrowser/26 Mozilla/5.0 (Linux; U; Android 2.3.7; zh-cn; MB200 Build/&amp;gt; GRJ22; CyanogenMod-7) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/&amp;gt; 533.1&lt;/p&gt;
&lt;p&gt;Android Opera Mobile&lt;/p&gt;
&lt;p&gt;User-Agent: Opera/9.80 (Android 2.3.4; Linux; Opera Mobi/build-1107180945; U; en-GB) &amp;gt; Presto/2.8.149 Version/11.10&lt;/p&gt;
&lt;p&gt;Android Pad Moto Xoom&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/5.0 (Linux; U; Android 3.0; en-us; Xoom Build/HRI39) AppleWebKit/&amp;gt; 534.13 (KHTML, like Gecko) Version/4.0 Safari/534.13&lt;/p&gt;
&lt;p&gt;BlackBerry&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/5.0 (BlackBerry; U; BlackBerry 9800; en) AppleWebKit/534.1+ (KHTML, &amp;gt; like Gecko) Version/6.0.0.337 Mobile Safari/534.1+&lt;/p&gt;
&lt;p&gt;WebOS HP Touchpad&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/5.0 (hp-tablet; Linux; hpwOS/3.0.0; U; en-US) AppleWebKit/534.6 &amp;gt; (KHTML, like Gecko) wOSBrowser/233.70 Safari/534.6 TouchPad/1.0&lt;/p&gt;
&lt;p&gt;Nokia N97&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/5.0 (SymbianOS/9.4; Series60/5.0 NokiaN97-1/20.0.019; Profile/&amp;gt; MIDP-2.1 Configuration/CLDC-1.1) AppleWebKit/525 (KHTML, like Gecko) BrowserNG/7.1.18124&lt;/p&gt;
&lt;p&gt;Windows Phone Mango&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows Phone OS 7.5; Trident/5.0; &amp;gt; IEMobile/9.0; HTC; Titan)&lt;/p&gt;
&lt;p&gt;UCæ— &lt;/p&gt;
&lt;p&gt;User-Agent: UCWEB7.0.2.37/28/999&lt;/p&gt;
&lt;p&gt;UCæ ‡å‡†&lt;/p&gt;
&lt;p&gt;User-Agent: NOKIA5700/ UCWEB7.0.2.37/28/999&lt;/p&gt;
&lt;p&gt;UCOpenwave&lt;/p&gt;
&lt;p&gt;User-Agent: Openwave/ UCWEB7.0.2.37/28/999&lt;/p&gt;
&lt;p&gt;UC Opera&lt;/p&gt;
&lt;p&gt;User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; ) Opera/UCWEB7.0.2.37/28/999&lt;br&gt;
&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ç¤ºä¾‹:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;gzip_disable MSIE [4-6]\.&lt;/code&gt;&lt;/p&gt;
&lt;ol start="5"&gt;
&lt;li&gt;&lt;code&gt;gzip_http_version&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;gzip_http_version 1.0 | 1.1&lt;/code&gt; é»˜è®¤è®¾ç½®ä¸º1.1ç‰ˆæœ¬.å³åªæœ‰å®¢æˆ·ç«¯ä½¿ç”¨1.1åŠä»¥ä¸Šç‰ˆæœ¬çš„HTTPåè®®æ—¶, æ‰ä½¿ç”¨GzipåŠŸèƒ½. ä¸€èˆ¬ä½¿ç”¨é»˜è®¤å€¼.&lt;/p&gt;
&lt;ol start="6"&gt;
&lt;li&gt;&lt;code&gt;gzip_min_length&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å¦‚æœå‹ç¼©å¾ˆå°çš„æ•°æ®, å¯èƒ½å‡ºç°è¶Šå‹ç¼©æ•°æ®é‡è¶Šå¤§çš„æƒ…å†µ. å› æ­¤æ ¹æ®å“åº”é¡µé¢çš„å¤§å°, é€‰æ‹©æ€§åœ°å¼€å¯æˆ–è€…å…³é—­GzipåŠŸèƒ½. è¯¥æŒ‡ä»¤è®¾ç½®é¡µé¢çš„å­—èŠ‚æ•°. &lt;strong&gt;å“åº”é¡µé¢çš„å¤§å°é€šè¿‡HTTPå“åº”å¤´éƒ¨ä¸­çš„Content-LengthæŒ‡ä»¤è·å–, ä½†æ˜¯å¦‚æœä½¿ç”¨äº†Chunk ç¼–ç åŠ¨æ€å‹ç¼©, Content-Lengthæˆ–ä¸å­˜åœ¨æˆ–è¢«å¿½ç•¥, è¯¥æŒ‡ä»¤ä¸èµ·ä½œç”¨&lt;/strong&gt;. é»˜è®¤è®¾ç½®ä¸º20. è®¾ç½®ä¸º0æ—¶ç»Ÿç»Ÿå‹ç¼©. å»ºè®®è¯¥å€¼ä¸º&lt;strong&gt;1KBæˆ–ä»¥ä¸Š&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;gzip_min_length 1024&lt;/code&gt;&lt;/p&gt;
&lt;ol start="7"&gt;
&lt;li&gt;&lt;code&gt;gzip_proxied&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¯¥æŒ‡ä»¤åœ¨ä½¿ç”¨NginxæœåŠ¡å™¨çš„åå‘ä»£ç†åŠŸèƒ½æ—¶æœ‰æ•ˆ, å‰ææ˜¯åœ¨åç«¯æœåŠ¡å™¨è¿”å›çš„å“åº”é¡µå¤´éƒ¨ä¸­, Requests éƒ¨åˆ†åŒ…å«ç”¨äºé€šçŸ¥ä»£ç†æœåŠ¡å™¨çš„Viaå¤´åŸŸ.  ä¸»è¦ç”¨äºè®¾ç½®NginxæœåŠ¡å™¨æ˜¯å¦å¯¹åç«¯æœåŠ¡å™¨è¿”å›çš„ç»“æœè¿›è¡ŒGzipå‹ç¼©.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Syntax&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;gzip_proxied&lt;/span&gt; &lt;span class="n"&gt;off&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;expired&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;no&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;cache&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;no&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;store&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="kd"&gt;private&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt;&lt;span class="n"&gt;no_last_modified&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;no_etag&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;auth&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;any&lt;/span&gt; &lt;span class="o"&gt;...;&lt;/span&gt;
&lt;span class="n"&gt;Default&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;gzip_proxied&lt;/span&gt; &lt;span class="n"&gt;off&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;Context&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;location&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ul&gt;
&lt;li&gt;off å…³é—­, é»˜è®¤è®¾ç½®;&lt;/li&gt;
&lt;li&gt;expired å½“åç«¯æœåŠ¡å™¨å“åº”é¡µå¤´éƒ¨åŒ…å«ç”¨äºæ”¯æŒå“åº”æ•°æ®è¿‡æœŸäº‹ä»¶çš„expiredå¤´åŸŸæ—¶, å¯ç”¨Gzip.&lt;/li&gt;
&lt;li&gt;no-cache å½“åç«¯åŒ…å«Cache-Controlå¤´åŸŸ, ä¸”å…¶æŒ‡ä»¤å€¼ä¸ºno-cacheæ—¶, å¯ç”¨.&lt;/li&gt;
&lt;li&gt;no-store å½“åç«¯åŒ…å«Cache-Controlå¤´åŸŸ, ä¸”å…¶æŒ‡ä»¤å€¼ä¸ºno-storeæ—¶, å¯ç”¨.&lt;/li&gt;
&lt;li&gt;private å½“åç«¯åŒ…å«Cache-Controlå¤´åŸŸ, ä¸”å…¶æŒ‡ä»¤å€¼ä¸ºprivateæ—¶, å¯ç”¨.&lt;/li&gt;
&lt;li&gt;no_last_modified å½“åç«¯æœåŠ¡å™¨å“åº”å¤´ä¸åŒ…å«ç”¨äºæŒ‡æ˜éœ€è¦è·å–æ•°æ®æœ€åä¿®æ”¹æ—¶é—´çš„Last-Modified åŸŸæ—¶, å¯ç”¨.&lt;/li&gt;
&lt;li&gt;no_etag ä¸åŒ…å«ETagæ—¶, å¯ç”¨.&lt;/li&gt;
&lt;li&gt;auth åŒ…å«Authorization, å¯ç”¨&lt;/li&gt;
&lt;li&gt;any æ— æ¡ä»¶å¯ç”¨å‹ç¼©.&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="8"&gt;
&lt;li&gt;&lt;code&gt;gzip_types&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æ ¹æ®å“åº”é¡µçš„MIMEç±»å‹é€‰æ‹©æ€§åœ°å¼€å¯Gzipå‹ç¼©åŠŸèƒ½.  é»˜è®¤ä¸ºtext/html. è¿˜å¯ä»¥å–'*', è¡¨ç¤ºå¯¹æ‰€æœ‰MIMEç±»å‹è¿›è¡ŒGzipå‹ç¼©. æ¨èè®¾ç½®:(é€šå¸¸æ–‡æœ¬/å›¾ç‰‡/jséƒ½å¯ä»¥å‹ç¼©)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;gzip_types       text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;&lt;/code&gt;&lt;/p&gt;
&lt;ol start="9"&gt;
&lt;li&gt;&lt;code&gt;gzip_vary&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é»˜è®¤ä¸ºoff. æ¨èå¼€å¯. å¼€å¯åçš„æ•ˆæœå®åœ¨å“åº”å¤´éƒ¨æ·»åŠ äº†Accept-Encoding: gzip, è¿™å¯¹äºæœ¬èº«ä¸æ”¯æŒGzipå‹ç¼©çš„å®¢æˆ·ç«¯æµè§ˆå™¨æ˜¯æœ‰ç”¨çš„.&lt;/p&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥é€šè¿‡add_headerè¾¾åˆ°ç›¸åŒçš„æ•ˆæœ:&lt;code&gt;add_header Vary Accept-Encoding gzip;&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;:heavy_exclamation_mark: è¯¥æŒ‡ä»¤åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å­˜åœ¨bug, ä¼šå¯¼è‡´IE4åŠä»¥ä¸Šçš„æµè§ˆå™¨çš„æ•°æ®ç¼“å­˜åŠŸèƒ½å¤±æ•ˆ.&lt;/p&gt;
&lt;/blockquote&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sun, 23 Jun 2019 16:33:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-23:/nginx-notebook-3-1-gzip-module.html</guid><category>nginx</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å­¦ä¹ ç¬”è®°-é«˜çº§é…ç½®-ä¸ç½‘ç»œè¿æ¥ç›¸å…³çš„æŒ‡ä»¤</title><link>https://www.EWhisper.cn/nginx-notebook-2-3-network-directives.html</link><description>&lt;h2 id="3"&gt;3 ä¸ç½‘ç»œè¿æ¥ç›¸å…³çš„é…ç½®æŒ‡ä»¤&lt;a class="headerlink" href="#3" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;keepalive_timeout&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;keepalive_timeout 60 50;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;NginxæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯è¿æ¥ä¿æŒæ´»åŠ¨çš„æ—¶é—´ä¸º60s, 60såæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯æ–­å¼€è¿æ¥; ä½¿ç”¨Keep-Alive æ¶ˆæ¯å¤´ä¿æŒä¸å®¢æˆ·ç«¯æŸäº›æµè§ˆå™¨(å¦‚ç«ç‹)çš„è¿æ¥æ—¶é—´ä¸º50s, 50såæµè§ˆå™¨ä¸»åŠ¨ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥.&lt;/p&gt;
&lt;ol start="2"&gt;
&lt;li&gt;send_timeout&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è®¾ç½®NginxæœåŠ¡å™¨å“åº”å®¢æˆ·ç«¯çš„è¶…æ—¶æ—¶é—´, è¿™ä¸ªè¶…æ—¶æ—¶é—´ä»…é’ˆå¯¹ä¸¤ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹è¿æ¥å, æŸæ¬¡æ´»åŠ¨ä¹‹é—´çš„æ—¶é—´. å¦‚æœè¿™ä¸ªæ—¶é—´åå®¢æˆ·ç«¯æ²¡æœ‰ä»»ä½•æ´»åŠ¨, NginxæœåŠ¡å™¨å°†ä¼šå…³é—­è¿æ¥. æ­¤æŒ‡ä»¤çš„è®¾ç½®éœ€è¦è€ƒè™‘æœåŠ¡å™¨è®¿é—®æ•°é‡å’Œç½‘ç»œçŠ¶å†µç­‰æ–¹é¢.&lt;/p&gt;
&lt;ol start="3"&gt;
&lt;li&gt;client_header_buffer_size&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è®¾ç½®NginxæœåŠ¡å™¨å…è®¸çš„å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å†²åŒºå¤§å°, é»˜è®¤ä¸º1KB. æ­¤æŒ‡ä»¤çš„èµ‹å€¼å¯ä»¥æ ¹æ®ç³»ç»Ÿåˆ†é¡µå¤§å°æ¥è®¾ç½®. åˆ†é¡µå¤§å°å¯ä»¥é€šè¿‡ä¸‹åˆ—å‘½ä»¤è·å¾—:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;getconf PAGESIZE&lt;/code&gt; (ä¸€èˆ¬ä¸º4k)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Nginx 400ç±»é”™è¯¯, æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†æƒ…å†µæ˜¯å®¢æˆ·ç«¯çš„è¯·æ±‚å¤´éƒ¨è¿‡å¤§é€ æˆçš„. è¯·æ±‚å¤´éƒ¨è¿‡å¤§, é€šå¸¸æ˜¯å®¢æˆ·ç«¯cookieä¸­å†™å…¥äº†è¾ƒå¤§çš„å€¼å¼•èµ·çš„.&lt;/p&gt;
&lt;p&gt;é€‚å½“å¢å¤§æ­¤æŒ‡ä»¤çš„èµ‹å€¼, å¯ä»¥æ”¹å–„è¯¥é—®é¢˜.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¨èé…ç½®:(ä¸ç³»ç»Ÿåˆ†é¡µå¤§å°ç›¸åŒ)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;client_header_buffer_size 4k;&lt;/code&gt;&lt;/p&gt;
&lt;ol start="4"&gt;
&lt;li&gt;multi_accept&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;NginxæœåŠ¡å™¨æ˜¯å¦å°½å¯èƒ½å¤šåœ°æ¥æ”¶å®¢æˆ·ç«¯çš„ç½‘ç»œè¿æ¥è¯·æ±‚. é»˜è®¤ä¸ºoff.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sun, 23 Jun 2019 16:27:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-23:/nginx-notebook-2-3-network-directives.html</guid><category>nginx</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å­¦ä¹ ç¬”è®°-é«˜çº§é…ç½®-é’ˆå¯¹CPUçš„è°ƒä¼˜æŒ‡ä»¤</title><link>https://www.EWhisper.cn/nginx-notebook-2-2-cpu-tuning.html</link><description>&lt;h2 id="2-cpu"&gt;2 é’ˆå¯¹CPUçš„ä¼˜åŒ–æŒ‡ä»¤&lt;a class="headerlink" href="#2-cpu" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;worker_processes&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;æœ€å¥½æ˜¯èµ‹å€¼ä¸ºæœºå™¨CPUçš„å€æ•°.&lt;/p&gt;
&lt;ol start="2"&gt;
&lt;li&gt;worker_cpu_affinity&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é»˜è®¤çš„&lt;code&gt;auto&lt;/code&gt;å°±è¡Œ.&lt;br&gt;
&lt;code&gt;worker_cpu_affinity 0001 0010 0100 1000;&lt;/code&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sun, 23 Jun 2019 16:22:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-23:/nginx-notebook-2-2-cpu-tuning.html</guid><category>nginx</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å­¦ä¹ ç¬”è®°-é«˜çº§é…ç½®-IPv4 çš„å†…æ ¸7ä¸ªå‚æ•°çš„é…ç½®ä¼˜åŒ–</title><link>https://www.EWhisper.cn/nginx-notebook-2-1-kernel-tuning.html</link><description>&lt;h2 id="1-ipv4-7"&gt;1 IPv4 çš„å†…æ ¸7ä¸ªå‚æ•°çš„é…ç½®ä¼˜åŒ–&lt;a class="headerlink" href="#1-ipv4-7" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;Linux å†…æ ¸å‚æ•°. å¯ä»¥å°†è¿™äº›å†…æ ¸å‚æ•°å€¼è¿½åŠ åˆ°Linuxçš„/etc/sysctl.confæ–‡ä»¶ä¸­.å¹¶ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤ç”Ÿæ•ˆ:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;# /sbin/sysctl -p&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;net.core.netdev_max_backlog&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;è¡¨ç¤ºå½“æ¯ä¸ªç½‘ç»œæ¥å£æ¥æ”¶æ•°æ®åŒ…çš„é€Ÿç‡æ¯”å†…æ ¸å¤„ç†è¿™äº›åŒ…çš„é€Ÿç‡å¿«æ—¶, å…è®¸å‘é€åˆ°é˜Ÿåˆ—çš„æ•°æ®åŒ…çš„æœ€å¤§æ•°ç›®. ä¸€èˆ¬é»˜è®¤ä¸º128. Nginxå®šä¹‰çš„NGX_LISTEN_BACKLOG é»˜è®¤ä¸º511. å°†è¯¥å‚æ•°è°ƒæ•´ä¸º:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;net.core.netdev_max_backlog = 262144&lt;/code&gt;&lt;/p&gt;
&lt;ol start="2"&gt;
&lt;li&gt;net.core.somaxconn&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç”¨äºè°ƒèŠ‚ç³»ç»ŸåŒæ—¶å‘èµ·çš„TCPè¿æ¥æ•°, ä¸€èˆ¬é»˜è®¤ä¸º128. åœ¨å­˜åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹, è¯¥é»˜è®¤å€¼è¾ƒå°, å¯èƒ½å¯¼è‡´é“¾æ¥è¶…æ—¶æˆ–é‡ä¼ é—®é¢˜, å¯ä»¥æ ¹æ®å®é™…éœ€è¦ç»“åˆå¹¶å‘è¯·æ±‚æ•°æ¥è°ƒèŠ‚æ­¤å€¼. å¦‚:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;net.core.somaxconn = 262144&lt;/code&gt;&lt;/p&gt;
&lt;ol start="3"&gt;
&lt;li&gt;net.ipv4.tcp_max_orphans&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç”¨äºè®¾å®šç³»ç»Ÿä¸­æœ€å¤šå…è®¸å­˜åœ¨å¤šå°‘TCPå¥—æ¥å­—ä¸è¢«å…³è”åˆ°ä»»ä½•ä¸€ä¸ªç”¨æˆ·æ–‡ä»¶å¥æŸ„ä¸Š. å¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—, æ²¡æœ‰ä¸ç”¨æˆ·æ–‡ä»¶å¥æŸ„å…³è”çš„TCPå¥—æ¥å­—å°†ç«‹å³è¢«å¤ä½, åŒæ—¶ç»™å‡ºè­¦å‘Šä¿¡æ¯. è¿™ä¸ªé™åˆ¶åªæ˜¯ä¸ºäº†é˜²æ­¢ç®€å•çš„DoSæ”»å‡». ä¸€èˆ¬åœ¨ç³»ç»Ÿå†…å­˜å……è¶³çš„æƒ…å†µä¸‹, å¯ä»¥å¢å¤§è¯¥å€¼:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;net.ipv4.tcp_max_orphans = 262144&lt;/code&gt;&lt;/p&gt;
&lt;ol start="4"&gt;
&lt;li&gt;net.ipv4.tcp_max_syn_backlog&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç”¨äºè®°å½•å°šæœªæ”¶åˆ°å®¢æˆ·ç«¯ç¡®è®¤ä¿¡æ¯çš„è¿æ¥è¯·æ±‚çš„æœ€å¤§å€¼. å¯¹äº128MBå†…å­˜çš„ç³»ç»Ÿ, é»˜è®¤å€¼ä¸º1024. åœ¨ç³»ç»Ÿå†…å­˜å……è¶³çš„æƒ…å†µä¸‹, å¯ä»¥å¢å¤§è¯¥å€¼.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;net.ipv4.tcp_max_syn_backlog = 262144&lt;/code&gt;&lt;/p&gt;
&lt;ol start="5"&gt;
&lt;li&gt;net.ipv4.tcp_timestamps&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç”¨äºè®¾ç½®æ—¶é—´æˆ³, å¯ä»¥é¿å…åºåˆ—å·çš„å·ç»•. åœ¨ä¸€ä¸ª1Gb/sçš„é“¾è·¯ä¸Š, é‡åˆ°ä»¥å‰ç”¨è¿‡çš„åºåˆ—å·çš„æ¦‚ç‡å¾ˆå¤§. å½“æ­¤å€¼ä¸º0æ—¶, ç¦ç”¨å¯¹äºTCPæ—¶é—´æˆ³çš„æ”¯æŒ. åœ¨é»˜è®¤æƒ…å†µä¸‹, TCPä¼šæ¥å—è¿™ç§"å¼‚å¸¸"çš„æ•°æ®åŒ…. å»ºè®®å°†å…¶å…³é—­.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;net.ipv4.tcp_timestamps = 0&lt;/code&gt;&lt;/p&gt;
&lt;ol start="6"&gt;
&lt;li&gt;net.ipv4.tcp_synack_retries&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;ç”¨äºè®¾ç½®å†…æ ¸æ”¾å¼ƒTCPè¿æ¥ä¹‹å‰å‘å®¢æˆ·ç«¯å‘é€SYN+ACKåŒ…çš„æ•°é‡.ä¸€èˆ¬èµ‹å€¼ä¸º1, å³å†…æ ¸æ”¾å¼ƒè¿æ¥ä¹‹å‰å‘é€ä¸€æ¬¡SYN+ACKåŒ….&lt;/p&gt;
&lt;p&gt;&lt;code&gt;net.ipv4.tcp_synack_retries = 1&lt;/code&gt;&lt;/p&gt;
&lt;ol start="7"&gt;
&lt;li&gt;net.ipv4.tcp_syn_retries&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code&gt;net.ipv4.tcp_syn_retries = 1&lt;/code&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sun, 23 Jun 2019 16:15:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-23:/nginx-notebook-2-1-kernel-tuning.html</guid><category>nginx</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å­¦ä¹ ç¬”è®°-å®‰è£…éƒ¨ç½²-æœåŠ¡å™¨åŸºç¡€é…ç½®ç¤ºä¾‹</title><link>https://www.EWhisper.cn/nginx-notebook-1-4-nginx-conf-example.html</link><description>&lt;h2 id="4-nginx"&gt;4 NginxæœåŠ¡å™¨åŸºç¡€é…ç½®ç¤ºä¾‹&lt;a class="headerlink" href="#4-nginx" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;#### å…¨å±€å— å¼€å§‹ #####&lt;/span&gt;
&lt;span class="k"&gt;user&lt;/span&gt; &lt;span class="s"&gt;nobody&lt;/span&gt; &lt;span class="s"&gt;nobody&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    &lt;span class="c1"&gt;# é…ç½®å…è®¸è¿è¡ŒNginxæœåŠ¡å™¨çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„&lt;/span&gt;

&lt;span class="k"&gt;worker_processes&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    &lt;span class="c1"&gt;# é…ç½®å…è®¸Nginxè¿›ç¨‹ç”Ÿæˆçš„worker processæ•°&lt;/span&gt;

&lt;span class="k"&gt;error_log&lt;/span&gt; &lt;span class="s"&gt;logs/error.log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    &lt;span class="c1"&gt;# Nginxé”™è¯¯æ—¥å¿—è¾“å‡ºç›®å½•&lt;/span&gt;

&lt;span class="k"&gt;pid&lt;/span&gt; &lt;span class="s"&gt;nginx.pid&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    &lt;span class="c1"&gt;# é…ç½®NginxæœåŠ¡å™¨è¿è¡Œæ—¶çš„pidæ–‡ä»¶å­˜æ”¾è·¯å¾„å’Œåç§°&lt;/span&gt;
&lt;span class="c1"&gt;#### å…¨å±€å— ç»“æŸ #####&lt;/span&gt;

&lt;span class="c1"&gt;#### eventså— å¼€å§‹ ####&lt;/span&gt;
&lt;span class="k"&gt;events&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;user&lt;/span&gt; &lt;span class="s"&gt;epoll&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    &lt;span class="c1"&gt;# é…ç½®äº‹ä»¶é©±åŠ¨æ¨¡å‹&lt;/span&gt;
    &lt;span class="kn"&gt;worker_connections&lt;/span&gt; &lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    &lt;span class="c1"&gt;# é…ç½®æœ€å¤§è¿æ¥æ•°&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="c1"&gt;#### eventså— ç»“æŸ ####&lt;/span&gt;

&lt;span class="c1"&gt;#### httpå— å¼€å§‹ ####&lt;/span&gt;
&lt;span class="k"&gt;http&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;include&lt;/span&gt; &lt;span class="s"&gt;mime.types&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;   &lt;span class="c1"&gt;# å®šä¹‰MIME-Type&lt;/span&gt;

    &lt;span class="kn"&gt;default_type&lt;/span&gt; &lt;span class="s"&gt;application/octet-stream&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="kn"&gt;sendfile&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    &lt;span class="c1"&gt;# é…ç½®å…è®¸ä½¿ç”¨sendfileæ–¹å¼ä¼ è¾“&lt;/span&gt;

    &lt;span class="kn"&gt;keepalive_timeout&lt;/span&gt; &lt;span class="mi"&gt;65&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    &lt;span class="c1"&gt;# é…ç½®è¿æ¥è¶…æ—¶æ—¶é—´&lt;/span&gt;

    &lt;span class="kn"&gt;log_format&lt;/span&gt; &lt;span class="s"&gt;access.log&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$remote_addr-[$time_local]-&amp;quot;$request&amp;quot;-&amp;quot;$http_user_agent&amp;quot;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    &lt;span class="c1"&gt;# é…ç½®è¯·æ±‚å¤„ç†æ—¥å¿—çš„æ ¼å¼&lt;/span&gt;

    &lt;span class="c1"&gt;#### serverå— å¼€å§‹ ####&lt;/span&gt;
    &lt;span class="c1"&gt;## é…ç½®è™šæ‹Ÿä¸»æœºmyServer1&lt;/span&gt;
    &lt;span class="kn"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="mi"&gt;8081&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    &lt;span class="c1"&gt;# é…ç½®ç›‘å¬ç«¯å£å’Œä¸»æœºåç§°&lt;/span&gt;
        &lt;span class="kn"&gt;server_name&lt;/span&gt; &lt;span class="s"&gt;myServer1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;access_log&lt;/span&gt; &lt;span class="s"&gt;/myweb/server1/log/access.log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    &lt;span class="c1"&gt;# é…ç½®è¯·æ±‚å¤„ç†æ—¥å¿—å­˜æ”¾è·¯å¾„&lt;/span&gt;
        &lt;span class="kn"&gt;error_page&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt; &lt;span class="s"&gt;/404.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    &lt;span class="c1"&gt;# é…ç½®é”™è¯¯é¡µé¢&lt;/span&gt;
        &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/server1/location1&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;    &lt;span class="c1"&gt;# é…ç½®å¤„ç†/server1/location1è¯·æ±‚çš„location&lt;/span&gt;
            &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/myweb&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;index&lt;/span&gt; &lt;span class="s"&gt;index.svr1-loc1.htm&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;

        &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/server1/location2&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;    &lt;span class="c1"&gt;# é…ç½®å¤„ç†/server1/location1è¯·æ±‚çš„location&lt;/span&gt;
            &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/myweb&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;index&lt;/span&gt; &lt;span class="s"&gt;index.svr1-loc2.htm&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;

    &lt;span class="kn"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;    &lt;span class="c1"&gt;## é…ç½®è™šæ‹Ÿä¸»æœº myServer2&lt;/span&gt;
        &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="mi"&gt;8082&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;server_name&lt;/span&gt; &lt;span class="mi"&gt;192&lt;/span&gt;&lt;span class="s"&gt;.168.1.3&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;access_log&lt;/span&gt; &lt;span class="s"&gt;/myweb/server2/log/access.log&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;error_page&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt; &lt;span class="s"&gt;/404.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/server2/location1&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
            &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/myweb&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;index&lt;/span&gt; &lt;span class="s"&gt;index.svr2-loc1.htm&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/svr2/loc2&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
          &lt;span class="kn"&gt;alias&lt;/span&gt; &lt;span class="s"&gt;/myweb/server2/location2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;    &lt;span class="c1"&gt;# å¯¹locationçš„URIè¿›è¡Œæ›´æ”¹&lt;/span&gt;
          &lt;span class="kn"&gt;index&lt;/span&gt; &lt;span class="s"&gt;index.svr2-loc2.htm&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/404.html&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;    &lt;span class="c1"&gt;# é…ç½®é”™è¯¯é¡µé¢è½¬å‘&lt;/span&gt;
            &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/myweb/&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;index&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt;&lt;span class="s"&gt;.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="c1"&gt;#### server å— ç»“æŸ ####&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="c1"&gt;#### httpå— ç»“æŸ ####&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é…ç½®åçš„ç›®å½•ç»“æ„&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;myweb
    404.html
    server1
        location1
            index.svr1-loc1.htm
        location2
            index.svr1-loc2.htm
        log
            access.log
    server2
        location1
            index.svr2-loc1.htm
        location2
            index.svr2-loc2.htm
        log
            access.log
&lt;/pre&gt;&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sun, 23 Jun 2019 16:07:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-23:/nginx-notebook-1-4-nginx-conf-example.html</guid><category>nginx</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å­¦ä¹ ç¬”è®°-å®‰è£…éƒ¨ç½²-åŸºç¡€é…ç½®</title><link>https://www.EWhisper.cn/nginx-notebook-1-3-basic-config.html</link><description>&lt;h2 id="3-nginx"&gt;3 Nginx åŸºç¡€é…ç½®&lt;a class="headerlink" href="#3-nginx" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;#user  nobody;&lt;/span&gt;
&lt;span class="k"&gt;worker_processes&lt;/span&gt;  &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;                        &lt;span class="c1"&gt;# å…¨å±€å—&lt;/span&gt;

&lt;span class="c1"&gt;#error_log  logs/error.log;&lt;/span&gt;
&lt;span class="c1"&gt;#error_log  logs/error.log  notice;&lt;/span&gt;
&lt;span class="c1"&gt;#error_log  logs/error.log  info;&lt;/span&gt;

&lt;span class="c1"&gt;#pid        logs/nginx.pid;&lt;/span&gt;

&lt;span class="k"&gt;events&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;                                    &lt;span class="c1"&gt;# eventså—&lt;/span&gt;
    &lt;span class="kn"&gt;worker_connections&lt;/span&gt;  &lt;span class="mi"&gt;1024&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;http&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;                                        &lt;span class="c1"&gt;# httpå—&lt;/span&gt;
    &lt;span class="kn"&gt;include&lt;/span&gt;       &lt;span class="s"&gt;mime.types&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;                &lt;span class="c1"&gt;# å¼•ç”¨mime.typesè¿™ä¸ªæ–‡ä»¶&lt;/span&gt;

    &lt;span class="kn"&gt;default_type&lt;/span&gt;  &lt;span class="s"&gt;application/octet-stream&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;#log_format  main  &amp;#39;$remote_addr - $remote_user [$time_local] &amp;quot;$request&amp;quot; &amp;#39;&lt;/span&gt;
    &lt;span class="c1"&gt;#                  &amp;#39;$status $body_bytes_sent &amp;quot;$http_referer&amp;quot; &amp;#39;&lt;/span&gt;
    &lt;span class="c1"&gt;#                  &amp;#39;&amp;quot;$http_user_agent&amp;quot; &amp;quot;$http_x_forwarded_for&amp;quot;&amp;#39;;&lt;/span&gt;
    &lt;span class="c1"&gt;#access_log  logs/access.log  main;&lt;/span&gt;

    &lt;span class="kn"&gt;sendfile&lt;/span&gt;        &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="c1"&gt;#tcp_nopush     on;&lt;/span&gt;
    &lt;span class="c1"&gt;#keepalive_timeout  0;&lt;/span&gt;
    &lt;span class="kn"&gt;keepalive_timeout&lt;/span&gt;  &lt;span class="mi"&gt;65&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;# nginxå…è®¸çš„å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å†²åŒºå¤§å°&lt;/span&gt;
    &lt;span class="kn"&gt;client_header_buffer_size&lt;/span&gt; &lt;span class="mi"&gt;4k&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;#gzip  on;&lt;/span&gt;
    &lt;span class="c1"&gt;# proxy buffer&lt;/span&gt;
    &lt;span class="kn"&gt;proxy_buffers&lt;/span&gt; &lt;span class="mi"&gt;8&lt;/span&gt; &lt;span class="mi"&gt;4k&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;proxy_buffer_size&lt;/span&gt; &lt;span class="mi"&gt;4k&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;proxy_temp_file_write_size&lt;/span&gt; &lt;span class="mi"&gt;4k&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;proxy_temp_path&lt;/span&gt; &lt;span class="s"&gt;proxy_temp&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="c1"&gt;# proxy cache&lt;/span&gt;
    &lt;span class="kn"&gt;proxy_cache_path&lt;/span&gt; &lt;span class="s"&gt;NGINX_cache/&lt;/span&gt; &lt;span class="s"&gt;keys_zone=cache_all:10m&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;# 128.236.160.5 CONF&lt;/span&gt;
    &lt;span class="kn"&gt;include&lt;/span&gt; &lt;span class="s"&gt;conf.d/128_236_160_5.conf&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;#server {                                # serverå—&lt;/span&gt;
    &lt;span class="c1"&gt;#   listen       80;&lt;/span&gt;
    &lt;span class="c1"&gt;#   server_name  localhost;&lt;/span&gt;
    &lt;span class="c1"&gt;#   charset koi8-r;&lt;/span&gt;
    &lt;span class="c1"&gt;#   access_log  logs/host.access.log  main;&lt;/span&gt;

    &lt;span class="c1"&gt;#   location / {                        # locationå—&lt;/span&gt;
    &lt;span class="c1"&gt;#        root   html;&lt;/span&gt;
    &lt;span class="c1"&gt;#        index  index.html index.htm;&lt;/span&gt;
    &lt;span class="c1"&gt;#   }&lt;/span&gt;

        &lt;span class="c1"&gt;#error_page  404              /404.html;&lt;/span&gt;
        &lt;span class="c1"&gt;# redirect server error pages to the static page /50x.html&lt;/span&gt;
    &lt;span class="c1"&gt;#    error_page   500 502 503 504  /50x.html;&lt;/span&gt;
    &lt;span class="c1"&gt;#    location = /50x.html {&lt;/span&gt;
    &lt;span class="c1"&gt;#        root   html;&lt;/span&gt;
    &lt;span class="c1"&gt;#    }&lt;/span&gt;

        &lt;span class="c1"&gt;# proxy the PHP scripts to Apache listening on 127.0.0.1:80&lt;/span&gt;
        &lt;span class="c1"&gt;#location ~ \.php$ {&lt;/span&gt;
        &lt;span class="c1"&gt;#    proxy_pass   http://127.0.0.1;&lt;/span&gt;
        &lt;span class="c1"&gt;#}&lt;/span&gt;

        &lt;span class="c1"&gt;# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000&lt;/span&gt;
        &lt;span class="c1"&gt;#location ~ \.php$ {&lt;/span&gt;
        &lt;span class="c1"&gt;#    root           html;&lt;/span&gt;
        &lt;span class="c1"&gt;#    fastcgi_pass   127.0.0.1:9000;&lt;/span&gt;
        &lt;span class="c1"&gt;#    fastcgi_index  index.php;&lt;/span&gt;
        &lt;span class="c1"&gt;#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;&lt;/span&gt;
        &lt;span class="c1"&gt;#    include        fastcgi_params;&lt;/span&gt;
        &lt;span class="c1"&gt;#}&lt;/span&gt;

        &lt;span class="c1"&gt;# deny access to .htaccess files, if Apache&amp;#39;s document root&lt;/span&gt;
        &lt;span class="c1"&gt;# concurs with nginx&amp;#39;s one&lt;/span&gt;
        &lt;span class="c1"&gt;#location ~ /\.ht {&lt;/span&gt;
        &lt;span class="c1"&gt;#    deny  all;&lt;/span&gt;
        &lt;span class="c1"&gt;#}&lt;/span&gt;
    &lt;span class="c1"&gt;#}&lt;/span&gt;

    &lt;span class="c1"&gt;# another virtual host using mix of IP-, name-, and port-based configuration&lt;/span&gt;
    &lt;span class="c1"&gt;#server {&lt;/span&gt;
    &lt;span class="c1"&gt;#    listen       8000;&lt;/span&gt;
    &lt;span class="c1"&gt;#    listen       somename:8080;&lt;/span&gt;
    &lt;span class="c1"&gt;#    server_name  somename  alias  another.alias;&lt;/span&gt;

    &lt;span class="c1"&gt;#    location / {&lt;/span&gt;
    &lt;span class="c1"&gt;#        root   html;&lt;/span&gt;
    &lt;span class="c1"&gt;#        index  index.html index.htm;&lt;/span&gt;
    &lt;span class="c1"&gt;#    }&lt;/span&gt;
    &lt;span class="c1"&gt;#}&lt;/span&gt;

    &lt;span class="c1"&gt;# HTTPS server&lt;/span&gt;
    &lt;span class="c1"&gt;#server {&lt;/span&gt;
    &lt;span class="c1"&gt;#    listen       443 ssl;&lt;/span&gt;
    &lt;span class="c1"&gt;#    server_name  localhost;&lt;/span&gt;
    &lt;span class="c1"&gt;#    ssl_certificate      cert.pem;&lt;/span&gt;
    &lt;span class="c1"&gt;#    ssl_certificate_key  cert.key;&lt;/span&gt;
    &lt;span class="c1"&gt;#    ssl_session_cache    shared:SSL:1m;&lt;/span&gt;
    &lt;span class="c1"&gt;#    ssl_session_timeout  5m;&lt;/span&gt;
    &lt;span class="c1"&gt;#    ssl_ciphers  HIGH:!aNULL:!MD5;&lt;/span&gt;
    &lt;span class="c1"&gt;#    ssl_prefer_server_ciphers  on;&lt;/span&gt;

    &lt;span class="c1"&gt;#    location / {&lt;/span&gt;
    &lt;span class="c1"&gt;#        root   html;&lt;/span&gt;
    &lt;span class="c1"&gt;#        index  index.html index.htm;&lt;/span&gt;
    &lt;span class="c1"&gt;#    }&lt;/span&gt;
    &lt;span class="c1"&gt;#}&lt;/span&gt;

&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;å¦‚æœæŸä¸ªæŒ‡ä»¤åœ¨ä¸¤ä¸ªä¸åŒå±‚çº§çš„å—ä¸­åŒæ—¶å‡ºç°,åˆ™é‡‡ç”¨&lt;strong&gt;å°±è¿‘åŸåˆ™&lt;/strong&gt;,å³ä»¥è¾ƒä½å±‚çº§å—ä¸­çš„é…ç½®ä¸ºå‡†.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="_1"&gt;é”™è¯¯æ—¥å¿—&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;æ—¥å¿—çº§åˆ«ç”±ä½åˆ°é«˜åˆ†ä¸ºdebug(éœ€è¦åœ¨ç¼–è¯‘æ—¶ä½¿ç”¨--with-debugå¼€å¯debug)ã€infoã€noticeã€warnã€errorã€criticalã€alertã€emergã€‚&lt;/p&gt;
&lt;h3 id="_2"&gt;å¼•å…¥é…ç½®æ–‡ä»¶&lt;a class="headerlink" href="#_2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;include file&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="_3"&gt;äº‹ä»¶é©±åŠ¨æ¨¡å‹&lt;a class="headerlink" href="#_3" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;use method&lt;/code&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;methodå†…å®¹æœ‰:select, poll, kqueue, epoll, rtsig, &lt;code&gt;/dev/poll&lt;/code&gt;, eventport&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="_4"&gt;è‡ªå®šä¹‰æœåŠ¡æ—¥å¿—&lt;a class="headerlink" href="#_4" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;log_format&lt;/span&gt; &lt;span class="s"&gt;exampleLog&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$remote_addr&lt;/span&gt; &lt;span class="s"&gt;-&lt;/span&gt; &lt;span class="s"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;$time_local]&lt;/span&gt; &lt;span class="nv"&gt;$request&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;
                &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$status&lt;/span&gt; &lt;span class="nv"&gt;$body_bytes_sent&lt;/span&gt; &lt;span class="nv"&gt;$http_referer&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;
                &lt;span class="s"&gt;&amp;#39;&lt;/span&gt;&lt;span class="nv"&gt;$http_user_agent&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;&lt;a href="http://nginx.org/en/docs/varindex.html"&gt;Nginxå†…ç½®å˜é‡&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="_5"&gt;åŸºäºåç§°çš„è™šæ‹Ÿä¸»æœºé…ç½®&lt;a class="headerlink" href="#_5" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;server_name myserver.com www.myserver.com;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;server_name *.myserver.com www.myserver.*;&lt;/code&gt;  (é€šé…ç¬¦'*'åªèƒ½ç”¨äºä¸‰æ®µå­—ç¬¦ä¸²çš„é¦–æ®µæˆ–å°¾æ®µ)&lt;/p&gt;
&lt;p&gt;&lt;code&gt;server_name ~^www\d+\.myserver\.com$;&lt;/code&gt;  ("~"ä¸ºä½¿ç”¨æ­£åˆ™çš„æ ‡è®°)&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åŒ¹é…ä¼˜å…ˆåº¦&lt;/strong&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;å¯¹äºåŒ¹é…æ–¹å¼ä¸åŒçš„,æŒ‰ç…§ä»¥ä¸‹ä¼˜å…ˆçº§:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å‡†ç¡®åŒ¹é… server_name&lt;/li&gt;
&lt;li&gt;é€šé…ç¬¦åœ¨å¼€å§‹æ—¶åŒ¹é… server_nameæˆåŠŸ&lt;/li&gt;
&lt;li&gt;é€šé…ç¬¦åœ¨ç»“å°¾æ—¶åŒ¹é… server_nameæˆåŠŸ&lt;/li&gt;
&lt;li&gt;æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…server_nameæˆåŠŸ&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å¦‚æœserver_nameå¤„äºåŒä¸€ä¼˜å…ˆçº§çš„åŒ¹é…æ–¹å¼å¤šæ¬¡åŒ¹é…æˆåŠŸ,åˆ™é¦–æ¬¡åŒ¹é…æˆåŠŸçš„è™šæ‹Ÿä¸»æœºå¤„ç†è¯·æ±‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="location"&gt;é…ç½®location&lt;a class="headerlink" href="#location" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Syntax&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;location&lt;/span&gt; &lt;span class="o"&gt;[&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="o"&gt;~&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="o"&gt;~*&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="o"&gt;^~&lt;/span&gt; &lt;span class="o"&gt;]&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;

        &lt;span class="n"&gt;location&lt;/span&gt; &lt;span class="err"&gt;@&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt; &lt;span class="o"&gt;{&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="o"&gt;}&lt;/span&gt;

&lt;span class="n"&gt;Default&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="err"&gt;â€”&lt;/span&gt;

&lt;span class="n"&gt;Context&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;location&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ ‡è¯†å«ä¹‰:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;=&lt;/code&gt; ç”¨äº&lt;strong&gt;æ ‡å‡†uri&lt;/strong&gt;å‰,è¦æ±‚è¯·æ±‚å­—ç¬¦ä¸²ä¸uri&lt;strong&gt;ä¸¥æ ¼åŒ¹é…&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;~&lt;/code&gt; ç”¨äºè¡¨ç¤ºuriåŒ…å«&lt;strong&gt;æ­£åˆ™è¡¨è¾¾å¼&lt;/strong&gt;, å¹¶ä¸”&lt;strong&gt;åŒºåˆ†å¤§å°å†™&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;~*&lt;/code&gt; ç”¨äºè¡¨ç¤ºuriåŒ…å«&lt;strong&gt;æ­£åˆ™è¡¨è¾¾å¼&lt;/strong&gt;, å¹¶ä¸”&lt;strong&gt;ä¸åŒºåˆ†å¤§å°å†™&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;^~&lt;/code&gt; ç”¨äº&lt;strong&gt;æ ‡å‡†uri&lt;/strong&gt;å‰, è¦æ±‚NginxæœåŠ¡å™¨æ‰¾åˆ°æ ‡è¯†uriå’Œè¯·æ±‚å­—ç¬¦ä¸²åŒ¹é…åº¦æœ€é«˜çš„locationå, ç«‹å³ä½¿ç”¨æ­¤locationå¤„ç†è¯·æ±‚, è€Œä¸å†ä½¿ç”¨locationå—ä¸­çš„æ­£åˆ™uriå’Œè¯·æ±‚å­—ç¬¦ä¸²åšåŒ¹é….&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="_6"&gt;é…ç½®è¯·æ±‚çš„æ ¹ç›®å½•&lt;a class="headerlink" href="#_6" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/data/&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/locationtest1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å½“locationå—æ¥æ”¶åˆ°&lt;code&gt;/data/index.htm&lt;/code&gt; çš„è¯·æ±‚æ—¶, å°†åœ¨&lt;code&gt;/locationtest1/data/&lt;/code&gt; ç›®å½•ä¸‹æ‰¾åˆ°index.htm å“åº”è¯·æ±‚.&lt;/p&gt;
&lt;h3 id="alias"&gt;aliasæŒ‡ä»¤&lt;a class="headerlink" href="#alias" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;location&lt;/span&gt; &lt;span class="p"&gt;~&lt;/span&gt; &lt;span class="sr"&gt;^/data/(.+\.(htm|html))$&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;alias&lt;/span&gt; &lt;span class="s"&gt;/locationtest1/other/&lt;/span&gt;&lt;span class="nv"&gt;$1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å½“æ”¶åˆ°&lt;code&gt;/data/index.htm&lt;/code&gt;æ—¶, åŒ¹é…æˆåŠŸ, ä¹‹åæ ¹æ®aliasæŒ‡ä»¤çš„é…ç½®, å°†åˆ° &lt;code&gt;/locationtest1/other&lt;/code&gt; ç›®å½•ä¸‹æ‰¾åˆ°å¯¹åº”è¯·æ±‚. å¯ä»¥çœ‹åˆ°, é€šè¿‡aliasæŒ‡ä»¤çš„é…ç½®, è·Ÿè·¯å¾„å·²ç»ä»&lt;code&gt;/data&lt;/code&gt; æ›´æ”¹ä¸º &lt;code&gt;/locationtest1/other&lt;/code&gt; äº†.&lt;/p&gt;
&lt;h3 id="_7"&gt;è®¾ç½®ç½‘ç«™é»˜è®¤é¦–é¡µ&lt;a class="headerlink" href="#_7" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;location&lt;/span&gt; &lt;span class="p"&gt;~&lt;/span&gt; &lt;span class="sr"&gt;^/data/(.+)/web/$&lt;/span&gt;
&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;index&lt;/span&gt; &lt;span class="s"&gt;index.&lt;/span&gt;&lt;span class="nv"&gt;$1.html&lt;/span&gt; &lt;span class="s"&gt;index.my1.html&lt;/span&gt; &lt;span class="s"&gt;index.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å½“locationå—æ¥æ”¶åˆ°&lt;code&gt;/data/locationtest/web/&lt;/code&gt; æ—¶, åŒ¹é…æˆåŠŸ, å®ƒé¦–å…ˆå°†é¢„ç½®å˜é‡$1ç½®ä¸º&lt;em&gt;locationtest&lt;/em&gt;, ç„¶ååœ¨&lt;code&gt;/data/locationtest/web/&lt;/code&gt; è·¯å¾„ä¸‹æŒ‰ç…§indexçš„é…ç½®æ¬¡åºä¾æ¬¡å¯»æ‰¾ index.locationtest.html index.my1.html å’Œ index.html , é¦–å…ˆæ‰¾åˆ°å“ªä¸ªé¡µé¢, å°±ä½¿ç”¨å“ªä¸ªé¡µé¢å“åº”è¯·æ±‚.&lt;/p&gt;
&lt;h3 id="_8"&gt;é”™è¯¯é¡µé¢&lt;a class="headerlink" href="#_8" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸€èˆ¬æ¥è¯´,HTTP &lt;strong&gt;2XX ä»£è¡¨è¯·æ±‚æ­£å¸¸å®Œæˆ&lt;/strong&gt;, &lt;strong&gt;3XX ä»£è¡¨ç½‘ç«™é‡å®šå‘&lt;/strong&gt;, &lt;strong&gt;4XXä»£è¡¨å®¢æˆ·ç«¯å‡ºç°é”™è¯¯&lt;/strong&gt;, &lt;strong&gt;5XXä»£è¡¨æœåŠ¡å™¨ç«¯å‡ºç°é”™è¯¯&lt;/strong&gt;.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;HTTPæ¶ˆæ¯&lt;/th&gt;
&lt;th&gt;ä»£ç &lt;/th&gt;
&lt;th&gt;å«ä¹‰&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;å·²ç§»åŠ¨&lt;/td&gt;
&lt;td&gt;301&lt;/td&gt;
&lt;td&gt;è¯·æ±‚çš„æ•°æ®å…·æœ‰æ–°çš„ä½ç½®, å¹¶ä¸”æ›´æ”¹æ˜¯&lt;strong&gt;æ°¸ä¹…&lt;/strong&gt;çš„&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;å·²æ‰¾åˆ°&lt;/td&gt;
&lt;td&gt;302&lt;/td&gt;
&lt;td&gt;è¯·æ±‚çš„æ•°æ®&lt;strong&gt;ä¸´æ—¶&lt;/strong&gt;å…·æœ‰ä¸åŒçš„URI&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è¯·å‚é˜…å…¶ä»–&lt;/td&gt;
&lt;td&gt;303&lt;/td&gt;
&lt;td&gt;å¯åœ¨å¦ä¸€URIä¸‹æ‰¾åˆ°å¯¹è¯·æ±‚çš„å“åº”, å¹¶ä¸”åº”ä½¿ç”¨GETæ–¹æ³•æ£€ç´¢æ­¤å“åº”&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœªä¿®æ”¹&lt;/td&gt;
&lt;td&gt;304&lt;/td&gt;
&lt;td&gt;æœªæŒ‰é¢„æœŸä¿®æ”¹æ–‡æ¡£&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä½¿ç”¨ä»£ç†&lt;/td&gt;
&lt;td&gt;305&lt;/td&gt;
&lt;td&gt;å¿…é¡»é€šè¿‡ä½ç½®å­—æ®µä¸­æä¾›çš„ä»£ç†æ¥è®¿é—®è¯·æ±‚çš„èµ„æº&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœªä½¿ç”¨&lt;/td&gt;
&lt;td&gt;306&lt;/td&gt;
&lt;td&gt;ä¸å†ä½¿ç”¨, ä½†ä¿ç•™æ­¤ä»£ç ä»¥ä¾¿å°†æ¥ä½¿ç”¨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ— æ³•æ‰¾åˆ°ç½‘é¡µ&lt;/td&gt;
&lt;td&gt;400&lt;/td&gt;
&lt;td&gt;å¯ä»¥è¿æ¥åˆ°WebæœåŠ¡å™¨, ä½†æ˜¯ç”±äºWebåœ°å€(URL) çš„é—®é¢˜, æ— æ³•æ‰¾åˆ°ç½‘é¡µ&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç½‘ç«™æ‹’ç»æ˜¾ç¤ºæ­¤ç½‘é¡µ&lt;/td&gt;
&lt;td&gt;403&lt;/td&gt;
&lt;td&gt;å¯ä»¥è¿æ¥åˆ°ç½‘ç«™, ä½†æ²¡æœ‰æ˜¾ç¤ºç½‘é¡µçš„æƒé™&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ— æ³•æ‰¾åˆ°ç½‘é¡µ&lt;/td&gt;
&lt;td&gt;404&lt;/td&gt;
&lt;td&gt;å¯ä»¥è¿æ¥åˆ°ç½‘ç«™, ä½†æ‰¾ä¸åˆ°ç½‘é¡µ. å¯¼è‡´æ­¤é”™è¯¯çš„åŸå› æœ‰æ—¶å¯èƒ½æ˜¯è¯¥ç½‘é¡µæš‚æ—¶ä¸å¯ç”¨æˆ–ç½‘é¡µå·²è¢«åˆ é™¤.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç½‘ç«™æ— æ³•æ˜¾ç¤ºè¯¥é¡µé¢&lt;/td&gt;
&lt;td&gt;405&lt;/td&gt;
&lt;td&gt;å¯ä»¥è¿æ¥åˆ°ç½‘ç«™, ä½†ç½‘é¡µå†…å®¹æ— æ³•ä¸‹è½½åˆ°ç”¨æˆ·çš„è®¡ç®—æœº. è¿™é€šå¸¸æ˜¯ç”±ç½‘é¡µç¼–å†™æ–¹å¼é—®é¢˜å¼•èµ·çš„.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ— æ³•è¯»å–æ­¤ç½‘é¡µæ ¼å¼&lt;/td&gt;
&lt;td&gt;406&lt;/td&gt;
&lt;td&gt;èƒ½å¤Ÿä»ç½‘ç«™æ¥æ”¶ä¿¡æ¯, ä½†ä¸èƒ½è¯†åˆ«å…¶æ ¼å¼, å› è€Œæ— æ³•æ­£ç¡®åœ°æ˜¾ç¤ºæ¶ˆæ¯.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;è¯¥ç½‘ç«™å¤ªå¿™, æ— æ³•æ˜¾ç¤ºæ­¤ç½‘é¡µ&lt;/td&gt;
&lt;td&gt;408 409&lt;/td&gt;
&lt;td&gt;æœåŠ¡å™¨æ˜¾ç¤ºè¯¥ç½‘é¡µçš„æ—¶é—´å¤ªé•¿, æˆ–å¯¹åŒä¸€ç½‘é¡µçš„è¯·æ±‚å¤ªå¤š&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç½‘é¡µä¸å¤å­˜åœ¨&lt;/td&gt;
&lt;td&gt;410&lt;/td&gt;
&lt;td&gt;å¯ä»¥è¿æ¥åˆ°ç½‘ç«™, ä½†æ— æ³•æ‰¾åˆ°ç½‘é¡µ. ä¸404ä¸åŒ, æ­¤é”™è¯¯æ˜¯æ°¸ä¹…æ€§çš„, è€Œä¸”ç”±ç½‘ç«™ç®¡ç†å‘˜æ‰“å¼€&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ç½‘ç«™æ— æ³•æ˜¾ç¤ºè¯¥é¡µé¢&lt;/td&gt;
&lt;td&gt;500&lt;/td&gt;
&lt;td&gt;æ­£åœ¨è®¿é—®çš„ç½‘ç«™å‡ºç°äº†æœåŠ¡å™¨é—®é¢˜. è¯¥é—®é¢˜é˜»æ­¢äº†æ­¤ç½‘é¡µçš„æ˜¾ç¤º. å¸¸è§çš„åŸå› æ˜¯ç½‘ç«™æ­£åœ¨ç»´æŠ¤æˆ–ä½¿ç”¨è„šæœ¬çš„äº¤äº’å¼ç½‘ç«™ä¸Šçš„ç¨‹åºå‡ºé”™.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æœªæ‰§è¡Œ&lt;/td&gt;
&lt;td&gt;501&lt;/td&gt;
&lt;td&gt;æ²¡æœ‰å°†æ­£åœ¨è®¿é—®çš„ç½‘ç«™è®¾ç½®ä¸ºæ˜¾ç¤ºæµè§ˆå™¨æ‰€è¯·æ±‚çš„å†…å®¹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ä¸æ”¯æŒçš„ç‰ˆæœ¬&lt;/td&gt;
&lt;td&gt;505&lt;/td&gt;
&lt;td&gt;è¯¥ç½‘ç«™ä¸æ”¯æŒæµè§ˆå™¨ç”¨äºè¯·æ±‚ç½‘é¡µçš„HTTPåè®®(å¦‚HTTP/1.1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Syntax&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;error_page&lt;/span&gt; &lt;span class="n"&gt;code&lt;/span&gt; &lt;span class="o"&gt;...&lt;/span&gt; &lt;span class="o"&gt;[=[&lt;/span&gt;&lt;span class="n"&gt;response&lt;/span&gt;&lt;span class="o"&gt;]]&lt;/span&gt; &lt;span class="n"&gt;uri&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;Default&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="err"&gt;â€”&lt;/span&gt;
&lt;span class="n"&gt;Context&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;location&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="k"&gt;in&lt;/span&gt; &lt;span class="n"&gt;location&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç¤ºä¾‹:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;error_page&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt;             &lt;span class="s"&gt;/404.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;error_page&lt;/span&gt; &lt;span class="mi"&gt;500&lt;/span&gt; &lt;span class="mi"&gt;502&lt;/span&gt; &lt;span class="mi"&gt;503&lt;/span&gt; &lt;span class="mi"&gt;504&lt;/span&gt; &lt;span class="s"&gt;/50x.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;error_page&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;200&lt;/span&gt; &lt;span class="s"&gt;/empty.gif&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="c1"&gt;#If an error response is processed by a proxied server or a FastCGI/uwsgi/SCGI server, and the server may return different response codes (e.g., 200, 302, 401 or 404), it is possible to respond with the code it returns:&lt;/span&gt;
&lt;span class="k"&gt;error_page&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/404.php&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

&lt;span class="c1"&gt;#If there is no need to change URI and method during internal redirection it is possible to pass error processing into a named location:&lt;/span&gt;
&lt;span class="k"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;error_page&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;@fallback&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;location&lt;/span&gt; &lt;span class="s"&gt;@fallback&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;proxy_pass&lt;/span&gt; &lt;span class="s"&gt;http://backend&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="c1"&gt;#It is also possible to use URL redirects for error processing:&lt;/span&gt;
&lt;span class="k"&gt;error_page&lt;/span&gt; &lt;span class="mi"&gt;403&lt;/span&gt;      &lt;span class="s"&gt;http://example.com/forbidden.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;error_page&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;301&lt;/span&gt; &lt;span class="s"&gt;http://example.com/notfound.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="ipnginx"&gt;åŸºäºIPé…ç½®Nginxçš„è®¿é—®æƒé™&lt;a class="headerlink" href="#ipnginx" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;deny&lt;/span&gt;  &lt;span class="mi"&gt;192&lt;/span&gt;&lt;span class="s"&gt;.168.1.1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;allow&lt;/span&gt; &lt;span class="mi"&gt;192&lt;/span&gt;&lt;span class="s"&gt;.168.1.0/24&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;allow&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="s"&gt;.1.1.0/16&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;allow&lt;/span&gt; &lt;span class="n"&gt;2001&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="s"&gt;db8::/32&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;deny&lt;/span&gt;  &lt;span class="s"&gt;all&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Syntax&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;allow&lt;/span&gt; &lt;span class="n"&gt;address&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;CIDR&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;unix&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;all&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;Default&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="err"&gt;â€”&lt;/span&gt;
&lt;span class="n"&gt;Context&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;location&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;limit_except&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;address: å®¢æˆ·ç«¯IP, ä¸æ”¯æŒåŒæ—¶è®¾ç½®å¤šä¸ª.å¦‚æœæœ‰å¤šä¸ªIPéœ€è¦è®¾ç½®, éœ€è¦é‡å¤ä½¿ç”¨allowæŒ‡ä»¤.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Nginxé…ç½®åœ¨è§£æçš„è¿‡ç¨‹ä¸­, é‡åˆ°denyæŒ‡ä»¤æˆ–è€…allowæŒ‡ä»¤æ˜¯æŒ‰ç…§é¡ºåºå¯¹å½“å‰å®¢æˆ·ç«¯çš„è¿æ¥è¿›è¡Œè®¿é—®æƒé™æ£€æŸ¥çš„. å¦‚æœé‡åˆ°åŒ¹é…çš„è®¾ç½®æ—¶, åˆ™åœæ­¢ç»§ç»­å‘ä¸‹æœç´¢ç›¸å…³é…ç½®.&lt;/p&gt;
&lt;h3 id="nginx"&gt;åŸºäºå¯†ç çš„Nginxè®¿é—®æƒé™&lt;a class="headerlink" href="#nginx" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Syntax&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;auth_basic&lt;/span&gt; &lt;span class="n"&gt;string&lt;/span&gt; &lt;span class="o"&gt;|&lt;/span&gt; &lt;span class="n"&gt;off&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;Default&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;auth_basic&lt;/span&gt; &lt;span class="n"&gt;off&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;Context&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;location&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;limit_except&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Syntax&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;auth_basic_user_file&lt;/span&gt; &lt;span class="n"&gt;file&lt;/span&gt;&lt;span class="o"&gt;;&lt;/span&gt;
&lt;span class="n"&gt;Default&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="err"&gt;â€”&lt;/span&gt;
&lt;span class="n"&gt;Context&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;    &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;server&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;location&lt;/span&gt;&lt;span class="o"&gt;,&lt;/span&gt; &lt;span class="n"&gt;limit_except&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ˜æ–‡å¯†ç æ ¼å¼:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;## comment
name1:password1
name2:password2:comment
name3:password3
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åŠ å¯†å¯†ç å¯ä»¥ä½¿ç”¨&lt;code&gt;crypt()&lt;/code&gt; å‡½æ•°è¿›è¡Œå¯†ç åŠ å¯†çš„æ ¼å¼, åœ¨Linuxå¹³å°ä¸Šå¯ä»¥ä½¿ç”¨ &lt;code&gt;htpasswd&lt;/code&gt; å‘½ä»¤ç”Ÿæˆ. åœ¨PHPå’ŒPerlç­‰è¯­è¨€ä¸­, ä¹Ÿæä¾›&lt;code&gt;crypt()&lt;/code&gt;å‡½æ•°. ä½¿ç”¨htpasswdå‘½ä»¤çš„ä¸€ä¸ªç¤ºä¾‹ä¸º:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;htpasswd -c -d /nginx/conf/pass_file username&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¿è¡Œåè¾“å…¥å¯†ç å³å¯.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sun, 23 Jun 2019 15:30:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-23:/nginx-notebook-1-3-basic-config.html</guid><category>nginx</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å­¦ä¹ ç¬”è®°-å®‰è£…éƒ¨ç½²-å¯åœæ§åˆ¶</title><link>https://www.EWhisper.cn/nginx-notebook-1-2-start-stop.html</link><description>&lt;h2 id="nginx"&gt;Nginxå¯åœæ§åˆ¶&lt;a class="headerlink" href="#nginx" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;nginx -t&lt;/code&gt; æ£€æŸ¥NginxæœåŠ¡å™¨é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nginx&lt;/code&gt; å¯åŠ¨&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nginx -s stop&lt;/code&gt; åœæ­¢&lt;/li&gt;
&lt;li&gt;&lt;code&gt;nginx -s reload&lt;/code&gt;  æˆ– &lt;code&gt;kill HUP `/Nginx/logs/nginx.pid`&lt;/code&gt;  å¹³æ»‘é‡å¯&lt;/li&gt;
&lt;li&gt;å¹³æ»‘å‡çº§: å…ˆæ‰§è¡Œ&lt;code&gt;kill USR2 `/Nginx/logs/nginx.pid`&lt;/code&gt;å®ç°NginxæœåŠ¡çš„å¹³æ»‘å‡çº§; å†ä½¿ç”¨&lt;code&gt;kill WINCH `/Nginx/logs/nginx.pid`&lt;/code&gt;å¹³æ»‘åœæ­¢æ—§æœåŠ¡ä¿¡å·&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sun, 23 Jun 2019 15:25:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-23:/nginx-notebook-1-2-start-stop.html</guid><category>nginx</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å­¦ä¹ ç¬”è®°-å®‰è£…éƒ¨ç½²-åŸºæœ¬é…ç½®</title><link>https://www.EWhisper.cn/nginx-notebook-1-1-basic-config.html</link><description>&lt;h1 id="_1"&gt;åŸºæœ¬é…ç½®&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h1&gt;
&lt;h2 id="_2"&gt;ä¾èµ–&lt;a class="headerlink" href="#_2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;GCCç¼–è¯‘å™¨&lt;/li&gt;
&lt;li&gt;Automakeå·¥å…·&lt;/li&gt;
&lt;li&gt;pcreåº“(æ”¯æŒrewriteæ¨¡å—)&lt;/li&gt;
&lt;li&gt;zlibåº“(æ”¯æŒgzipæ¨¡å—)&lt;/li&gt;
&lt;li&gt;opensslåº“(æ”¯æŒsslæ¨¡å—)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;å‚è€ƒæŒ‡ä»¤&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;yum -y install gcc gcc-c++ automake pcre pcre-devel zlib zlib-devel openssl openssl-devel&lt;/code&gt;&lt;/p&gt;
&lt;h2 id="_3"&gt;ç›®å½•ç»“æ„&lt;a class="headerlink" href="#_3" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="nginx"&gt;nginxè§£å‹åè½¯ä»¶åŒ…&lt;a class="headerlink" href="#nginx" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;src&lt;/strong&gt;: æºä»£ç &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;man&lt;/strong&gt;: å¸®åŠ©æ–‡ä»¶(å¯ä»¥é€šè¿‡&lt;code&gt;man nginx&lt;/code&gt;æŸ¥çœ‹)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;html&lt;/strong&gt;: htmlæ–‡ä»¶&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;conf&lt;/strong&gt;: é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;auto&lt;/strong&gt;: è„šæœ¬æ–‡ä»¶,å’Œconfigure&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;configure&lt;/strong&gt;: è‡ªåŠ¨è„šæœ¬ç¨‹åº&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"&gt;å¤‡æ³¨:&lt;/p&gt;
&lt;p&gt;configure 2é¡¹å·¥ä½œ&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ£€æŸ¥ç¯å¢ƒ,æ ¹æ®ç¯å¢ƒæ£€æŸ¥ç»“æœç”ŸæˆCä»£ç ;&lt;/li&gt;
&lt;li&gt;ç”Ÿæˆç¼–è¯‘ä»£ç éœ€è¦çš„Makefileæ–‡ä»¶.&lt;br&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h3 id="nginx_1"&gt;nginxæœåŠ¡å™¨è½¯ä»¶ç›®å½•&lt;a class="headerlink" href="#nginx_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;conf&lt;/strong&gt;: Nginxçš„æ‰€æœ‰é…ç½®æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;html&lt;/strong&gt;: NginxæœåŠ¡å™¨åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è°ƒç”¨çš„ä¸€äº›htmlç½‘é¡µæ–‡ä»¶.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;logs&lt;/strong&gt;: æ—¥å¿—&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;sbin&lt;/strong&gt;: nginxä¸€ä¸ªæ–‡ä»¶,å³å¯åŠ¨çš„ä¸»ç¨‹åº&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;å¯ä»¥åœ¨htmlç›®å½•ä¸‹è‡ªå®šä¹‰ä¸€äº›ç½‘é¡µæ–‡ä»¶,å¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®å‘ç”Ÿä»€ä¹ˆæƒ…å†µæ—¶è½¬åˆ°ç›¸åº”çš„æ–‡ä»¶&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="configure"&gt;configure è„šæœ¬æ”¯æŒçš„å¸¸ç”¨é€‰é¡¹&lt;a class="headerlink" href="#configure" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;--prefix=&amp;lt;path&amp;gt;  æŒ‡å®šå®‰è£…è·¯å¾„,é»˜è®¤/usr/local/nginx

--user=&amp;lt;user&amp;gt;  æœªæŒ‡å®š,é»˜è®¤nobody

--with-debug  å¯ç”¨Nginxçš„è°ƒè¯•æ—¥å¿—

--add-module=&amp;lt;path&amp;gt;  å£°æ˜ç¬¬ä¸‰æ–¹æ¨¡å—çš„è·¯å¾„,ç”¨ä»¥ç¼–è¯‘åˆ€NginxæœåŠ¡å™¨ä¸­

--with-poll_module  å£°æ˜å¯ç”¨pollæ¨¡å—.pollæ¨¡å—æ˜¯ä¿¡å·å¤„ç†çš„ä¸€ç§æ–¹æ³•.

--with-http_ssl_module  å¯ç”¨HTTPçš„sslæ¨¡å—.

--with-http_stub_status_module  å¯ç”¨Server Statusé¡µ.é»˜è®¤ä¸å¯ç”¨

--http-proxy-temp-path=&amp;lt;path&amp;gt;  æŒ‡å®šå­˜æ”¾HTTPä»£ç†ä¸´æ—¶æ–‡ä»¶çš„è·¯å¾„

--without-http  å£°æ˜ç¦ç”¨HTTP Server

--with-pcre=&amp;lt;dir&amp;gt;  æŒ‡å®špcreåº“æºä»£ç çš„è·¯å¾„.è¿™æ ·å¯ä»¥åœ¨**ç¼–è¯‘Nginxæºä»£ç çš„åŒæ—¶ç¼–è¯‘pcreåº“**,ä¸éœ€è¦æå‰å®‰è£…pcreåº“

--with-zilb=&amp;lt;dir&amp;gt;  æŒ‡å®šzlibåº“æºä»£ç çš„è·¯å¾„.åŒpcre

--with-openssl=&amp;lt;dir&amp;gt;  æŒ‡å®šOpenSSLåº“æºä»£ç çš„è·¯å¾„.
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;æ¸…é™¤ä¸Šæ¬¡ç¼–è¯‘çš„é—ç•™æ–‡ä»¶ &lt;code&gt;make clean&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;./configure

    --sbin-path&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nginx/nginx

    --conf-path&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nginx/nginx.conf

    --pid-path&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nginx/nginx.pid

    --with-http_ssl_module

    --with-pcre&lt;span class="o"&gt;=&lt;/span&gt;../pcre-8.40

    --with-zlib&lt;span class="o"&gt;=&lt;/span&gt;../zlib-1.2.11
&lt;/pre&gt;&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sun, 23 Jun 2019 15:10:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-23:/nginx-notebook-1-1-basic-config.html</guid><category>nginx</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-è¿ç»´-å®ç”¨è¿ç»´Tipså’Œæ€»ç»“</title><link>https://www.EWhisper.cn/nginx-handbook-3-11-operation-best-practices.html</link><description>&lt;h2 id="311-tips"&gt;3.11 å®ç”¨è¿ç»´Tipså’Œæ€»ç»“&lt;a class="headerlink" href="#311-tips" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="3110"&gt;3.11.0 ä»‹ç»&lt;a class="headerlink" href="#3110" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;æœ€åç« èŠ‚ä¼šåŒ…æ‹¬ä½¿ç”¨è¿ç»´tipså’Œæœ¬ä¹¦çš„æ€»ç»“. é€šè¿‡è¿™ä¸‰ä¸ªå¤§éƒ¨åˆ†, æˆ‘ä»¬è®¨è®ºäº†ä¸è¿ç»´å·¥ç¨‹å¸ˆæœ‰å…³çš„å¾ˆå¤šæƒ³æ³•å’Œæ¦‚å¿µ. ç„¶è€Œ, æˆ‘è®¤ä¸ºå†å¤šè®²ä¸€ç‚¹ä¼šæœ‰åŠ©äºç†è§£çš„æ›´åŠ å…¨é¢. åœ¨æœ¬ç« , æˆ‘ä¼šç¡®ä¿ä½ çš„é…ç½®æ–‡ä»¶å¹²å‡€å’Œç®€æ´, ä»¥åŠå¦‚ä½•è°ƒè¯•é…ç½®æ–‡ä»¶.&lt;/p&gt;
&lt;h3 id="3111-includes"&gt;3.11.1 ä½¿ç”¨ Includes æ¥ç¼©å‡é…ç½®&lt;a class="headerlink" href="#3111-includes" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦æ¸…ç†å¤§é‡çš„é…ç½®æ–‡ä»¶æ¥ä¿è¯ä½ çš„é…ç½®æ–‡ä»¶ä»¥æ¨¡å—åŒ–çš„é…ç½®é›†åˆ†ç»„.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;include&lt;/code&gt;æŒ‡ä»¤æ¥å¼•ç”¨é…ç½®æ–‡ä»¶, ç›®å½•æˆ–é€šé…ç¬¦:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;http&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;include&lt;/span&gt; &lt;span class="s"&gt;config.d/compression.conf&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;include&lt;/span&gt; &lt;span class="s"&gt;sites-enabled/*.conf&lt;/span&gt;
&lt;span class="err"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;ç•¥&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="3112"&gt;3.11.2 è°ƒè¯•é…ç½®&lt;a class="headerlink" href="#3112" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä»NGINX server , ä½ å¾—åˆ°çš„éé¢„æœŸçš„ç»“æœ.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;è°ƒè¯•é…ç½®, è®°ä½ä»¥ä¸‹å»ºè®®:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;NGINXè¿›ç¨‹è¯·æ±‚æŸ¥æ‰¾æœ€åŒ¹é…çš„è§„åˆ™.&lt;/li&gt;
&lt;li&gt;ä½ å¯ä»¥æ‰“å¼€è°ƒè¯•æ—¥å¿—. å¯¹äºè°ƒè¯•æ—¥å¿—, ä½ éœ€è¦ç¡®ä¿ä½ çš„NGINXåŒ…é…ç½®äº†&lt;code&gt;--with-debug&lt;/code&gt; flag. å¤§éƒ¨åˆ†å¸¸è§åŒ…éƒ½æœ‰; ä½†æ˜¯å¦‚æœä½ æ„å»ºä½ è‡ªå·±çš„åŒ…, æˆ–åœ¨è¿è¡Œä¸€ä¸ªæœ€å°åŒ–çš„åŒ…, ä½ å¯èƒ½è‡³å°‘éœ€è¦å†æ¬¡ä»”ç»†æ£€æŸ¥. ä¸€æ—¦ä½ ç¡®å®šäº†ä½ æœ‰debug, ä½ å¯ä»¥è®¾ç½®&lt;code&gt;error_log&lt;/code&gt;æŒ‡ä»¤çš„æ—¥å¿—çº§åˆ«ä¸º&lt;code&gt;debug&lt;/code&gt;: &lt;code&gt;error_log /var/log/nginx/error.log debug;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä½ å¯ä»¥ä¸ºç‰¹å®šçš„è¿æ¥å¯ç”¨è°ƒè¯•. &lt;code&gt;debug_connection&lt;/code&gt;æŒ‡ä»¤åœ¨&lt;code&gt;events&lt;/code&gt;ä¸Šä¸‹æ–‡æ˜¯åˆæ³•çš„, ä½¿ç”¨IPæˆ–CIDR rangeä½œä¸ºå‚æ•°. è¯¥æŒ‡ä»¤å¯ä»¥å£°æ˜å¤šæ¬¡æ¥æ·»åŠ å¤šä¸ªè¦è°ƒè¯•çš„IPåœ°å€æˆ–CIDR ranges. è¿™åœ¨ç”Ÿäº§ç¯å¢ƒ, ä½†æ˜¯è°ƒè¯•æ‰€æœ‰è¿æ¥ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™çš„æƒ…å†µä¸‹, è°ƒè¯•ä¸€ä¸ªé—®é¢˜ä¼šå¾ˆæœ‰ç”¨&lt;/li&gt;
&lt;li&gt;ä½ å¯ä»¥è°ƒè¯•ç‰¹å®šçš„virtual servers. å› ä¸º&lt;code&gt;error_log&lt;/code&gt;åœ¨&lt;code&gt;main&lt;/code&gt; &lt;code&gt;http&lt;/code&gt; &lt;code&gt;mail&lt;/code&gt; &lt;code&gt;stream&lt;/code&gt; &lt;code&gt;server&lt;/code&gt; å’Œ&lt;code&gt;location&lt;/code&gt;ä¸Šä¸‹æ–‡éƒ½æœ‰æ•ˆ. ä½ å¯ä»¥åœ¨ä½ éœ€è¦è°ƒè¯•çš„ä¸Šä¸‹æ–‡è®¾ç½®&lt;code&gt;debug&lt;/code&gt;æ—¥å¿—çº§åˆ«.&lt;/li&gt;
&lt;li&gt;ä½ å¯ä»¥å¯ç”¨core dumps, æ¥ä»ä¸­è·å–backtraces. Core dumpså¯ä»¥é€šè¿‡æ“ä½œç³»ç»Ÿå¯ç”¨, æˆ–é€šè¿‡NGINXé…ç½®æ–‡ä»¶.&lt;/li&gt;
&lt;li&gt;ä½ å¯ä»¥ä½¿ç”¨&lt;code&gt;rewrite_log&lt;/code&gt;è®°å½•rewrite å£°æ˜çš„æ—¥å¿—: &lt;code&gt;rewrite_log on;&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;NGINXèƒ½åšå¾ˆå¤šç¥å¥‡çš„é…ç½®, ä½†æ˜¯ä¹Ÿæœ‰æ€§èƒ½ä¸‹é™çš„é£é™©. è°ƒè¯•æ—¶, ç¡®ä¿ä½ çŸ¥é“å¦‚ä½•é€šè¿‡ä½ çš„é…ç½®æ¥è¿½è¸ªä½ çš„è¯·æ±‚; å¦‚æœæœ‰é—®é¢˜, å¢åŠ è°ƒè¯•æ—¥å¿—çº§åˆ«æ¥å¸®åŠ©åˆ†æ. debugæ—¥å¿—æ—¶ç›¸å½“è¯¦ç»†, æ‰¾å‡ºNGINXå¯¹ä½ çš„è¯·æ±‚åšäº†ä»€ä¹ˆä»¥åŠä½ çš„é…ç½®åœ¨å“ªå„¿å‡ºé”™äº†å¾ˆæœ‰å¸®åŠ©.&lt;/p&gt;
&lt;h4&gt;å‚è§&lt;/h4&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2crNKVM"&gt;NGINXå¦‚ä½•å¤„ç†è¯·æ±‚&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2iQYNsZ"&gt;ç®¡ç†å‘˜è°ƒè¯•å‘å¯¼&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2j96jAH"&gt;Rewrite log&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="3113"&gt;3.11.3 æ€»ç»“&lt;a class="headerlink" href="#3113" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;è¿™æœ¬ä¹¦çš„ä¸‰ä¸ªéƒ¨åˆ†é›†ä¸­äºé«˜æ€§èƒ½è´Ÿè½½å‡è¡¡, å®‰å…¨, ä»¥åŠéƒ¨ç½²å’Œç»´æŠ¤NGINXå’ŒNGINX Plus servers. è¿™æœ¬ä¹¦å±•ç¤ºäº†NGINXåº”ç”¨äº¤ä»˜å¹³å°çš„ä¸€äº›æœ€å¼ºå¤§çš„åŠŸèƒ½. NGINXä¼šç»§ç»­å¼€å‘ç¥å¥‡çš„åŠŸèƒ½, ä¿æŒèµ›é“é¢†å…ˆ.&lt;/p&gt;
&lt;p&gt;è¿™æœ¬ä¹¦å±•ç¤ºäº†å¾ˆå¤š"ç®€çŸ­é£Ÿè°±", å…è®¸ä½ å¯¹æŒ‡ä»¤å’Œæ¨¡å—(è¿™äº›è®©NGINXæˆä¸ºå½“ä»Šç½‘ç»œä¹‹å¿ƒ)æœ‰æ›´å¥½çš„ç†è§£. NGINX serverä¸ä»…ä»…æ˜¯web server, ä¸ä»…ä»…æ—¶åå‘ä»£ç†, è€Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨äº¤ä»˜å¹³å°, å®Œå…¨æœ‰èƒ½åŠ›é€šè¿‡è®¤è¯, å¹¶åœ¨æœªæ¥ç¯å¢ƒä¸­ä½¿ç”¨.  è¯·çŸ¥æ‚‰.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:39:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-3-11-operation-best-practices.html</guid><category>nginx</category><category>devops</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-è¿ç»´-ä½¿ç”¨`split_clients`è¿›è¡ŒA-Bæµ‹è¯•</title><link>https://www.EWhisper.cn/nginx-handbook-3-7-ab-test.html</link><description>&lt;h2 id="37-split_clientsa-b"&gt;3.7 ä½¿ç”¨&lt;code&gt;split_clients&lt;/code&gt;è¿›è¡ŒA-Bæµ‹è¯•&lt;a class="headerlink" href="#37-split_clientsa-b" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="370"&gt;3.7.0 ä»‹ç»&lt;a class="headerlink" href="#370" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;NGINXæœ‰ä¸€ä¸ªå«åš&lt;code&gt;split_clients&lt;/code&gt;çš„æ¨¡å—, å…è®¸ä½ æ¥ç³»ç»Ÿåœ°ç»™äºˆæŸä¸€ä¸ªå˜é‡keyæ¥æ‹†åˆ†ç”¨æˆ·. NGINXé€šè¿‡ä½¿ç”¨è½»é‡çš„å“ˆå¸Œç®—æ³•æ¥å“ˆå¸Œä¸€ä¸ªç»™å®šçš„å­—ç¬¦ä¸²æ¥æ‹†åˆ†ç”¨æˆ·. ç„¶åæ•°å­¦åœ°é€šè¿‡ç™¾åˆ†æ¯”æ‹†åˆ†, æ˜ å°„é¢„å®šä¹‰çš„å€¼åˆ°ä¸€ä¸ªå˜é‡, è¿™ä¸ªå€¼å¯ä»¥ç”¨æ¥æ”¹å˜æœåŠ¡å™¨çš„å“åº”ã€‚&lt;/p&gt;
&lt;h3 id="371-ab"&gt;3.7.1 A/B æµ‹è¯•&lt;a class="headerlink" href="#371-ab" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦æ‹†åˆ†ä¸¤ä¸ªæˆ–æ›´å¤šç‰ˆæœ¬çš„æ–‡ä»¶æˆ–ç¨‹åºçš„ç”¨æˆ·æ¥æµ‹è¯•æ¥å—åº¦.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;split_clients&lt;/code&gt;æ¨¡å—æ¥ç›´æ¥ä¸ºä½ çš„å®¢æˆ·ç«¯è®¾ç½®ä¸åŒçš„upstream pool:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;split_clients&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;${remote_addr}AAA&amp;quot;&lt;/span&gt; &lt;span class="nv"&gt;$variant&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;20.0%&lt;/span&gt;    &lt;span class="s"&gt;&amp;quot;backendv2&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;*&lt;/span&gt;        &lt;span class="s"&gt;&amp;quot;backendv1&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;split_clients&lt;/code&gt;æŒ‡ä»¤å“ˆå¸Œç”±ä½ æä¾›çš„å­—ç¬¦ä¸²ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°, å¹¶ä¸”å°†æ•£åˆ—çš„ç™¾åˆ†æ¯”æä¾›æ˜ å°„ä¸€ä¸ªå˜é‡çš„å€¼ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°æä¾›ã€‚ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«key-valueå¯¹çš„å¯¹è±¡, keyæ˜¯ç™¾åˆ†æ¯”æƒé‡, å€¼æ˜¯è¦è¢«åˆ†é…çš„å€¼. keyå¯ä»¥æ˜¯ä¸€ä¸ªç™¾åˆ†æ¯”æˆ–ä¸€ä¸ªæ˜Ÿå·. æ˜Ÿå·å°±æ˜¯å‰©ä¸‹çš„ç™¾åˆ†æ¯”. å˜é‡&lt;code&gt;$variant&lt;/code&gt;çš„å€¼å°†æ˜¯20%çš„å®¢æˆ·ç«¯IPæ˜¯&lt;code&gt;backendv2&lt;/code&gt;, å‰©ä¸‹çš„80%æ˜¯&lt;code&gt;backendv1&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;åœ¨æœ¬ä¾‹ä¸­, &lt;code&gt;backendv1&lt;/code&gt;å’Œ&lt;code&gt;backendv2&lt;/code&gt;ä»£è¡¨upstream serveræ± , å¯ä»¥è¢«ç”¨äº&lt;code&gt;proxy_pass&lt;/code&gt;æŒ‡ä»¤, å¦‚ä¸‹:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;proxy_pass&lt;/span&gt; &lt;span class="s"&gt;http://&lt;/span&gt;&lt;span class="nv"&gt;$variant&lt;/span&gt;
&lt;span class="err"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä½¿ç”¨å˜é‡&lt;code&gt;$variant&lt;/code&gt;, æˆ‘ä»¬çš„æµé‡ä¼šè¢«åˆ†ä¸º2ä¸ªä¸åŒçš„åº”ç”¨serveræ± .&lt;/p&gt;
&lt;p&gt;å¦ä¸€ä¸ªæ¡ˆä¾‹:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;http&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
 &lt;span class="kn"&gt;split_clients&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;${remote_addr}AAA&amp;quot;&lt;/span&gt; &lt;span class="nv"&gt;$variant&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
                &lt;span class="kn"&gt;0.5%&lt;/span&gt;               &lt;span class="s"&gt;.one&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                &lt;span class="kn"&gt;2.0%&lt;/span&gt;               &lt;span class="s"&gt;.two&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
                   &lt;span class="kn"&gt;*&lt;/span&gt;                  &lt;span class="s"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
 &lt;span class="p"&gt;}&lt;/span&gt;
 &lt;span class="kn"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
     &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
         &lt;span class="kn"&gt;index&lt;/span&gt; &lt;span class="s"&gt;index&lt;/span&gt;&lt;span class="nv"&gt;${variant}.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;A/Bæµ‹è¯•çš„ç±»å‹å¾ˆæœ‰ç”¨, å¦‚æµ‹è¯•ä¸åŒç±»å‹çš„å¸‚åœºå’Œå‰ç«¯åŠŸèƒ½çš„ç”µå•†ç½‘ç«™è½¬åŒ–ç‡. å¯¹äºåº”ç”¨, ä½¿ç”¨é‡‘ä¸é›€å‘å¸ƒå¾ˆå¸¸è§. è¿™ç§éƒ¨ç½²ä¸­, æµé‡è¢«ç¼“æ…¢åœ°åˆ‡æ¢åˆ°æ–°çš„ç‰ˆæœ¬. æ‹†åˆ†ä¸åŒåº”ç”¨ç‰ˆæœ¬çš„å®¢æˆ·ç«¯æ˜¯å¾ˆæœ‰ç”¨çš„, å½“å›æ»šæ–°ç‰ˆæœ¬çš„ä»£ç , é™åˆ¶å› ä¸ºä¸€ä¸ªé”™è¯¯å¯¼è‡´çš„çˆ†ç‚¸åŠå¾„. ä¸è®ºæ˜¯å› ä¸ºä»€ä¹ˆåŸå› è¦æ‹†åˆ†ä¸¤ä¸ªä¸åŒåº”ç”¨é›†çš„å®¢æˆ·ç«¯, NGINXé€šè¿‡ä½¿ç”¨&lt;code&gt;split_client&lt;/code&gt;æ¨¡å—éƒ½èƒ½å¾ˆå®¹æ˜“å®ç°.&lt;/p&gt;
&lt;h4&gt;å‚è§&lt;/h4&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2jsdkw4"&gt;split_client documentation&lt;/a&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:39:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-3-7-ab-test.html</guid><category>nginx</category><category>devops</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-è¿ç»´-ä½¿ç”¨GeoIPæ¨¡å—é€šè¿‡IPåœ°å€å®šä½ç”¨æˆ·</title><link>https://www.EWhisper.cn/nginx-handbook-3-8-use-geoip-to-get-users-location.html</link><description>&lt;h2 id="38-geoipip"&gt;3.8 ä½¿ç”¨GeoIPæ¨¡å—é€šè¿‡IPåœ°å€å®šä½ç”¨æˆ·&lt;a class="headerlink" href="#38-geoipip" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="380"&gt;3.8.0 ä»‹ç»&lt;a class="headerlink" href="#380" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;è·Ÿè¸ª, åˆ†æ, å’Œåˆ©ç”¨ä½ çš„åº”ç”¨æˆ–åº¦é‡çš„å®¢æˆ·ç«¯çš„ä½ç½®ä¿¡æ¯å¯ä»¥å¸®åŠ©ä½ åŠ æ·±å¯¹å®¢æˆ·çš„ç†è§£. æœ‰å¾ˆå¤šæ–¹æ³•è·å–ä½ çš„å®¢æˆ·çš„ä½ç½®ä¿¡æ¯, NGINXé€šè¿‡ä½¿ç”¨GeoIPæ¨¡å—å’Œå‡ ä¸ªæŒ‡ä»¤å¾ˆå®¹æ˜“åœ°å®šä½ä»–ä»¬. è¯¥æ¨¡å—è®©åŸºäºå®¢æˆ·ä½ç½®ä¿¡æ¯è®°å½•ä½ç½®, æ§åˆ¶è®¿é—®, æˆ–è€…åŸºäºå®¢æˆ·ä½ç½®åšå†³å®šå˜å¾—å¾ˆå®¹æ˜“.  å®ƒä¹Ÿå…è®¸å®¢æˆ·çš„ä½ç½®ä¿¡æ¯è¢«å†…éƒ¨æŸ¥æ‰¾åªè¦è¯·æ±‚è¢«ä¼ è¾“åˆ°upstreamåº”ç”¨, è€Œä¸éœ€è¦å†è¿›è¡ŒæŸ¥æ‰¾. è¯¥NGINXæ¨¡å—é»˜è®¤ä¸å®‰è£…, å¯ä»¥ä»æºç é™æ€ç¼–è¯‘, åŠ¨æ€å¯¼å…¥, æˆ–é€šè¿‡åœ¨Ubuntuå®‰è£…&lt;code&gt;nginx-full&lt;/code&gt;æˆ–&lt;code&gt;nginx-extras&lt;/code&gt;æ¥å®‰è£…. åœ¨RHELå‘è¡Œç‰ˆ, å¦‚CentOS, ä½ å¯ä»¥å®‰è£…&lt;code&gt;nginx-mod-http-geoip&lt;/code&gt;åŒ…å¹¶é€šè¿‡&lt;code&gt;load_module&lt;/code&gt;åŠ¨æ€å¯¼å…¥. æœ¬ç« ä¼šè¦†ç›–&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¯¼å…¥GeoIPåŠ¨æ€æ¨¡å—,&lt;/li&gt;
&lt;li&gt;å®‰è£…GeoIPæ•°æ®åº“,&lt;/li&gt;
&lt;li&gt;è¯¥æ¨¡å—å¯ç”¨çš„å†…å»ºå˜é‡,&lt;/li&gt;
&lt;li&gt;æ§åˆ¶è®¿é—®,&lt;/li&gt;
&lt;li&gt;å’Œä»£ç†ä¸€èµ·ä½¿ç”¨.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="381-geoip"&gt;3.8.1 ä½¿ç”¨GeoIPæ¨¡å—å’Œæ•°æ®åº“&lt;a class="headerlink" href="#381-geoip" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦å®‰è£…GeoIPæ•°æ®åº“, å¹¶å¯ç”¨åœ¨NGINXçš„å†…å»ºå‘½ä»¤, æ¥è®°å½•å’Œå‘Šè¯‰ä½ çš„åº”ç”¨ä½ çš„å®¢æˆ·ç«¯çš„åœ°ç†ä½ç½®.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä¸‹è½½GeoIPå›½å®¶å’ŒåŸå¸‚æ•°æ®åº“, å¹¶unzipå®ƒä»¬:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# mkdir /etc/nginx/geoip&lt;/span&gt;
&lt;span class="c1"&gt;# cd /etc/nginx/geoip&lt;/span&gt;
&lt;span class="c1"&gt;# wget &amp;quot;http://geolite.maxmind.com/\&lt;/span&gt;
download/geoip/database/GeoLiteCountry/GeoIP.dat.gz&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="s2"&gt;# gunzip GeoIP.dat.gz&lt;/span&gt;
&lt;span class="s2"&gt;# wget &amp;quot;&lt;/span&gt;http://geolite.maxmind.com/&lt;span class="se"&gt;\&lt;/span&gt;
download/geoip/database/GeoLiteCity.dat.gz&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="s2"&gt;# gunzip GeoLiteCity.dat.gz&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¿™äº›å‘½ä»¤åœ¨&lt;em&gt;/etc/nginx&lt;/em&gt;ä¸‹åˆ›å»ºä¸€ä¸ª&lt;em&gt;geoip&lt;/em&gt;ç›®å½•, è·³è½¬åˆ°æ–°ç›®å½•, å¹¶ä¸‹è½½å’Œè§£å‹åŒ….&lt;/p&gt;
&lt;p&gt;é€šè¿‡åœ¨æœ¬åœ°ç£ç›˜ä¸Šçš„ å›½å®¶å’ŒåŸå¸‚çš„GeoIPæ•°æ®åº“, æˆ‘ä»¬å¯ä»¥æ„å»ºNGINX GeoIPæ¨¡å—å¹¶ä½¿ç”¨å®ƒä»¬æ¥æš´éœ²å‡ºç»™äºˆå®¢æˆ·ç«¯IPåœ°å€çš„å†…å»ºæŒ‡ä»¤:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;load_module&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/usr/lib64/nginx/modules/ngx_http_geoip_module.so&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;http&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;geoip_country&lt;/span&gt; &lt;span class="s"&gt;/etc/nginx/geoip/GeoIP.dat&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;geoip_city&lt;/span&gt; &lt;span class="s"&gt;/etc/nginx/geoip/GeoLiteCity.dat&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="kn"&gt;...&lt;/span&gt;
&lt;span class="err"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;geoip_country&lt;/code&gt;æŒ‡ä»¤æŒ‡å®šåˆ°&lt;em&gt;GeoIP.dat&lt;/em&gt;æ–‡ä»¶çš„è·¯å¾„, &lt;em&gt;GeoIP.dat&lt;/em&gt;åŒ…å«IPåœ°å€åˆ°å›½å®¶ä»£ç çš„æ˜ å°„, åªèƒ½åœ¨HTTPä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨.&lt;/p&gt;
&lt;h3 id="_1"&gt;è®¨è®º&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;æ¨¡å—çš„&lt;code&gt;geoip_country&lt;/code&gt;å’Œ&lt;code&gt;geoip_city&lt;/code&gt;æš´éœ²ä¸€ç³»åˆ—å¯ç”¨å˜é‡. &lt;code&gt;geoip_country&lt;/code&gt;æŒ‡ä»¤å…è®¸ä½ å»æœ¬ä½ çš„å®¢æˆ·çš„å›½å®¶. è¿™äº›å˜é‡åŒ…æ‹¬&lt;code&gt;$geoip_country_code&lt;/code&gt;, &lt;code&gt;geoip_country_code3&lt;/code&gt;å’Œ&lt;code&gt;geoip_country_name&lt;/code&gt;. å›½å®¶ä»£ç å˜é‡è¿”å›ä¸€ä¸ª2ä½å›½å®¶å­—æ¯. &lt;code&gt;geoip_country_code3&lt;/code&gt;è¿”å›3ä½å›½å®¶å­—æ¯. å›½å®¶åå˜é‡è¿”å›å›½å®¶çš„å…¨å.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;geoip_city&lt;/code&gt;æŒ‡ä»¤ä¹Ÿä¼šå¯ç”¨å‡ ä¸ªå˜é‡. å’Œ&lt;code&gt;geoip_country&lt;/code&gt;ç±»ä¼¼. æœ‰&lt;code&gt;$geoip_city_country_code&lt;/code&gt; &lt;code&gt;geoip_city_country_code3&lt;/code&gt; &lt;code&gt;geoip_city_contry_name&lt;/code&gt;. å…¶ä»–å˜é‡æœ‰&lt;code&gt;$geoip_city&lt;/code&gt; &lt;code&gt;$geoip_city_continent_code&lt;/code&gt; &lt;code&gt;$geoip_latitude&lt;/code&gt; &lt;code&gt;$geoip_longitude&lt;/code&gt;å’Œ&lt;code&gt;$geoip_postal_code&lt;/code&gt;. &lt;code&gt;$geoip_region&lt;/code&gt; &lt;code&gt;$geoip_region_name&lt;/code&gt;æè¿°åŒºåŸŸ, é¢†åŸŸ, å·, çœ, è”é‚¦æ”¿åºœåœ°ç­‰. åŒºåŸŸæ˜¯ä¸€ä¸ªä¸¤å­—ç¬¦ä»£ç , åŒºåŸŸåæ˜¯å…¨å. &lt;code&gt;geoip_area_code&lt;/code&gt;, åªåœ¨ç¾å›½æœ‰æ•ˆ, è¿”å›3ä½æ•°å­—ç”µè¯åŒºåŸŸç .&lt;/p&gt;
&lt;p&gt;é€šè¿‡è¿™äº›å˜é‡, ä½ èƒ½å¤Ÿè®°å½•ä½ çš„å®¢æˆ·ç«¯çš„ä¿¡æ¯. ä½ å¯ä»¥é€‰æ‹©ä¼ é€’ä¿¡æ¯åˆ°ä½ çš„åº”ç”¨ä½œä¸ºä¸€ä¸ªheaderæˆ–å˜é‡, æˆ–ä½¿ç”¨NGINXæ¥ä»¥ç‰¹å®šæ–¹å¼routeæµé‡.&lt;/p&gt;
&lt;h4&gt;å‚è§&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://github.com/maxmind/geoipupdate"&gt;GeoIP å‡çº§&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="382"&gt;3.8.2 åŸºäºå›½å®¶é™åˆ¶è®¿é—®&lt;a class="headerlink" href="#382" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;æ ¹æ®åˆçº¦æˆ–åº”ç”¨éœ€æ±‚, ä½ éœ€è¦é™åˆ¶æ¥è‡ªç‰¹å®šå›½å®¶çš„è®¿é—®.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;æ˜ å°„ä½ æƒ³è¦å±è”½æˆ–å…è®¸çš„å›½å®¶ä»£ç åˆ°ä¸€ä¸ªå˜é‡&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;load_module&lt;/span&gt;
  &lt;span class="s"&gt;&amp;quot;/usr/lib64/nginx/modules/ngx_http_geoip_module.so&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;http&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;map&lt;/span&gt; &lt;span class="nv"&gt;$geoip_country_code&lt;/span&gt; &lt;span class="nv"&gt;$country_access&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;&amp;quot;US&amp;quot;&lt;/span&gt;    &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;&amp;quot;RU&amp;quot;&lt;/span&gt;    &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;default&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="kn"&gt;...&lt;/span&gt;
&lt;span class="err"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¿™ä¸ªæ˜ å°„ä¼šè®¾ç½®æ–°çš„å˜é‡&lt;code&gt;$country_access&lt;/code&gt;ä¸º1æˆ–0. å¦‚æœå®¢æˆ·ç«¯IPåœ°å€æ¥è‡ªç¾å›½æˆ–ä¿„ç½—æ–¯, å˜é‡ä¼šè¢«è®¾ç½®ä¸º0, å…¶ä»–å›½å®¶ä¼šè®¾ç½®ä¸º1.&lt;/p&gt;
&lt;p&gt;ç„¶å, åœ¨&lt;code&gt;server&lt;/code&gt;å¿«, ä½¿ç”¨&lt;code&gt;if&lt;/code&gt;å£°æ˜æ¥æ‹’ç»ä¸æ˜¯æ¥è‡ªç¾å›½å’Œä¿„ç½—æ–¯çš„ç”¨æˆ·è®¿é—®:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;if&lt;/span&gt; &lt;span class="s"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$country_access&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;1&amp;#39;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="kn"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;403&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="kn"&gt;...&lt;/span&gt;
&lt;span class="err"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å½“æ¡ä»¶åˆ¤æ–­ä¸ºTrueæ—¶, ä¼šè¿”å›403 æœªè®¤è¯. å¦åˆ™æ­£å¸¸è®¿é—®.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªç®€çŸ­çš„ä¾‹å­, æ¥è¯´æ˜å¦‚ä½•å…è®¸ç‰¹å®šå›½å®¶è®¿é—®. è¿™ä¸ªä¾‹å­å¯ä»¥è¢«æ‰©å±•, ä»¥ç¬¦åˆä½ çš„éœ€è¦.&lt;/p&gt;
&lt;h3 id="383"&gt;3.8.3 æ‰¾åˆ°æºå®¢æˆ·ç«¯&lt;a class="headerlink" href="#383" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦æ‰¾åˆ°å®¢æˆ·æºIP, å› ä¸ºåœ¨NGINX serverå‰è¾¹æœ‰ä»£ç†.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;geoip_proxy&lt;/code&gt;æŒ‡ä»¤æ¥å®šä¹‰ä½ çš„ä»£ç†IPåœ°å€èŒƒå›´, &lt;code&gt;geoip_proxy_recursive&lt;/code&gt;æŒ‡ä»¤æ¥æŸ¥æ‰¾æºIP:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;load_module&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/usr/lib64/nginx/modules/ngx_http_geoip_module.so&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;http&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;geoip_country&lt;/span&gt; &lt;span class="s"&gt;/etc/nginx/geoip/GeoIP.dat&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;geoip_city&lt;/span&gt; &lt;span class="s"&gt;/etc/nginx/geoip/GeoLiteCity.dat&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;geoip_proxy&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="s"&gt;.0.16.0/26&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;geoip_proxy_recursive&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="kn"&gt;...&lt;/span&gt;
&lt;span class="err"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;geoip_proxy&lt;/code&gt;æŒ‡ä»¤å®šä¹‰æˆ‘ä»¬çš„ä»£ç†æœåŠ¡å™¨çš„CIDRèŒƒå›´, æŒ‡ç¤ºNGINXåˆ©ç”¨&lt;code&gt;X-Forwarded-For&lt;/code&gt;å¤´æ¥æŸ¥æ‰¾å®¢æˆ·ç«¯IPåœ°å€. &lt;code&gt;geoip_proxy_recursive&lt;/code&gt;æŒ‡ä»¤æŒ‡ç¤ºNGINXæ¥é€’å½’åœ°æŸ¥æ‰¾ä¸Šä¸ªçŸ¥é“çš„å®¢æˆ·ç«¯IPçš„&lt;code&gt;X-Forwarded-For&lt;/code&gt; header.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;ä½ å¯èƒ½ä¼šå‘ç°ä½ åœ¨NGINXå‰è¾¹ä½¿ç”¨äº†ä»£ç†, NGINXä¼šé€‰æ‹©ä»£ç†çš„IPåœ°å€è€Œä¸æ˜¯å®¢æˆ·ç«¯çš„. å¯¹äºè¿™ç§æƒ…å†µä½ å¯ä»¥ä½¿ç”¨&lt;code&gt;geoip_proxy&lt;/code&gt;æŒ‡ä»¤æ¥æŒ‡ç¤ºåœ¨ç»™å®šçš„èŒƒå›´å†…, NGINXä½¿ç”¨&lt;code&gt;X-Forwarded-For&lt;/code&gt; header. &lt;code&gt;geoip_proxy&lt;/code&gt;æŒ‡ä»¤é…ç½®ä¸€ä¸ªåœ°å€æˆ–CIDRèŒƒå›´. å½“NGINXå‰è¾¹æœ‰å¤šä¸ªä»£ç†, å¯ä»¥ä½¿ç”¨&lt;code&gt;geoip_proxy_recursive&lt;/code&gt;æŒ‡ä»¤æ¥é€’å½’åœ°æŸ¥æ‰¾&lt;code&gt;X-Forwarded-For&lt;/code&gt;æŒ‡ä»¤, æ¥æ‰¾åˆ°æºå®¢æˆ·ç«¯. ä½ å¯èƒ½ä¼šåœ¨å¦‚åœ¨NGINXå‰è¾¹ä½¿ç”¨AWS ELB, è°·æ­Œçš„è´Ÿè½½å‡è¡¡, æˆ–Azureçš„è´Ÿè½½å‡è¡¡æ—¶ç”¨åˆ°è¿™äº›.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:39:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-3-8-use-geoip-to-get-users-location.html</guid><category>nginx</category><category>devops</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-è¿ç»´-è‡ªåŠ¨åŒ–</title><link>https://www.EWhisper.cn/nginx-handbook-3-6-automatation.html</link><description>&lt;h2 id="36"&gt;3.6 è‡ªåŠ¨åŒ–&lt;a class="headerlink" href="#36" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="360"&gt;3.6.0 ä»‹ç»&lt;a class="headerlink" href="#360" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;æœ‰å¾ˆå¤šæ–¹å¼æ¥è‡ªåŠ¨åŒ–NGINXå’ŒNGINX Plusçš„é…ç½®æ–‡ä»¶, å¦‚: ä½¿ç”¨é…ç½®ç®¡ç†å·¥å…·æˆ–å®šæ—¶ä»»åŠ¡æ¥ä»æ¨¡æ¿é…ç½®æ–‡ä»¶é…ç½®. éšç€åŠ¨æ€ç¯å¢ƒçš„å¢åŠ , è‡ªåŠ¨åŒ–é…ç½®çš„éœ€æ±‚å˜å¾—æ›´æ€¥éœ€. åœ¨ä¸Šä¸€ç« , æˆ‘ä»¬ç¡®ä¿¡NGINXé…ç½®æ–‡ä»¶è¢«é…ç½®åéœ€è¦reload.åœ¨æœ¬ç« , æˆ‘ä»¬ä¼šè®¨è®ºæ›´è¿›ä¸€æ­¥çš„ä½¿ç”¨NGINX Plus APIå’Œ&lt;strong&gt;Consul Template&lt;/strong&gt;çš„å®æ—¶(on-the-fly)NGINXé…ç½®æ–‡ä»¶é‡é…ç½®.&lt;/p&gt;
&lt;h3 id="361-nginx-plus"&gt;3.6.1 ä½¿ç”¨NGINX Plusè‡ªåŠ¨åŒ–&lt;a class="headerlink" href="#361-nginx-plus" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦ä¸ºåŠ¨æ€ç¯å¢ƒé‡å®æ—¶é…ç½®NGINX Plusçš„load balance.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨NGINX Plus APIæ¥é‡é…ç½®NGINX Plus upstream æ± :&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ curl &lt;span class="s1"&gt;&amp;#39;http://nginx.local/upstream_conf?\&lt;/span&gt;
&lt;span class="s1"&gt;  add=&amp;amp;upstream=backend&amp;amp;server=10.0.0.42:8080&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;curl&lt;/code&gt;è°ƒç”¨åˆ°NGINX Plusçš„è¯·æ±‚, è¯·æ±‚ä¸€ä¸ªæŠŠä¸€ä¸ªæ–°çš„serveråŠ åˆ°&lt;code&gt;backend&lt;/code&gt; upstreamé…ç½®.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;æ›´å¤šç¬¬ä¸€æ¬¡å®‰è£…çš„ç»†èŠ‚è§ 3.8 ç« èŠ‚, NGINX Plusæä¾›ä¸€ä¸ªAPIæ¥é‡æ–°å®æ—¶é…ç½®NGINX Plus. NGINX Plus APIå…è®¸ä»upstream æ± ä¸­æ·»åŠ å’Œç§»é™¤server, åŒæ—¶draining è¿æ¥. ä½ å¯ä»¥ä½¿ç”¨è¯¥APIæ¥è‡ªåŠ¨åŒ–NGINX Plusçš„åº”ç”¨æœåŠ¡å™¨çš„åˆ›å»ºå’Œé‡Šæ”¾çš„é…ç½®.&lt;/p&gt;
&lt;h3 id="362-consul-templating"&gt;3.6.2 ä½¿ç”¨Consul Templating è‡ªåŠ¨åŒ–é…ç½®&lt;a class="headerlink" href="#362-consul-templating" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦è‡ªåŠ¨åŒ–NGINXé…ç½®æ¥é€šè¿‡ä½¿ç”¨Consulåœ¨ç¯å¢ƒä¸­åšå‡ºå˜æ›´.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;consul-template&lt;/code&gt; daemonå’Œä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶æ¥æ¨¡æ¿åŒ–NGINXé…ç½®æ–‡ä»¶:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="x"&gt;upstream backend { &lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt;&lt;span class="nv"&gt;range&lt;/span&gt; &lt;span class="nv"&gt;service&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;app.backend&amp;quot;&lt;/span&gt;&lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;span class="x"&gt;    server &lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt;&lt;span class="nv"&gt;.Address&lt;/span&gt;&lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="x"&gt;;&lt;/span&gt;&lt;span class="cp"&gt;{{&lt;/span&gt;&lt;span class="nv"&gt;end&lt;/span&gt;&lt;span class="cp"&gt;}}&lt;/span&gt;&lt;span class="x"&gt;&lt;/span&gt;
&lt;span class="x"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¿™ä¸ªä¾‹å­æ˜¯Consulæ¨¡æ¿æ–‡ä»¶çš„ä¸€ä¸ªupstreamé…ç½®å—æ¨¡æ¿. è¿™ä¸ªæ¨¡æ¿ä¼šéå†åœ¨Consulä¸Šæ ‡è®°ä¸º&lt;code&gt;app.backend&lt;/code&gt;çš„èŠ‚ç‚¹. å¯¹äºConsulä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹, è¿™ä¸ªæ¨¡æ¿ä¼šä½¿ç”¨é‚£ä¸ªèŠ‚ç‚¹çš„IPåœ°å€äº§ç”Ÿä¸€æ¡serveræŒ‡ä»¤.&lt;/p&gt;
&lt;p&gt;è¿™ä¸ª&lt;code&gt;consul-template&lt;/code&gt; daemoné€šè¿‡å‘½ä»¤è¡Œè¿è¡Œ, å¯ä»¥è¢«ç”¨äºåœ¨æ¯æ¬¡é…ç½®æ–‡ä»¶è¢«æ¨¡æ¿åŒ–å˜æ›´åreload NGINX:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# consul-template -consul consul.example.internal -template \&lt;/span&gt;
template:/etc/nginx/conf.d/upstream.conf:&lt;span class="s2"&gt;&amp;quot;nginx -s reload&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¯¥æŒ‡ä»¤æŒ‡ç¤º&lt;code&gt;consul-template&lt;/code&gt; daemon æ¥è¿æ¥åˆ°ä¸€ä¸ªä½äº&lt;code&gt;consul.example.internal&lt;/code&gt;çš„Consul é›†ç¾¤, å¹¶ä½¿ç”¨åœ¨å½“å‰å·¥ä½œç›®å½•çš„åä¸º&lt;code&gt;template&lt;/code&gt;çš„æ–‡ä»¶æ¥æ¨¡æ¿åŒ–è¯¥æ–‡ä»¶, å¹¶è¾“å‡ºç”Ÿæˆçš„å†…å®¹åˆ°&lt;code&gt;/etc/nginx/conf.d/upstream.conf&lt;/code&gt;ä¸­, ç„¶ååœ¨æ¯æ¬¡æ¨¡æ¿åŒ–æ–‡ä»¶å˜æ›´æ—¶reload NGINX. &lt;code&gt;-template&lt;/code&gt; æ ‡å¿—æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²,åŒ…æ‹¬: æ¨¡æ¿æ–‡ä»¶,è¾“å‡ºä½ç½®,å’Œè¿è¡Œæ¨¡æ¿è¿‡ç¨‹åæ‰§è¡Œçš„å‘½ä»¤; è¿™3ä¸ªå˜é‡ä»¥å†’å·åˆ†éš”. å¦‚æœè¿è¡Œçš„å‘½ä»¤ç”±ç©ºæ ¼, ç¡®ä¿ä½¿ç”¨åŒå¼•å·åŒ…è£¹. &lt;code&gt;-consul&lt;/code&gt;æ ‡å¿—æŒ‡ç¤ºè¦è¿æ¥çš„Consulé›†ç¾¤.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;Consulæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æœåŠ¡å‘ç°å·¥å…·å’Œé…ç½®ä»“åº“. Consulä»¥key-value å¯¹ä»¥ç±»ä¼¼ç›®å½•çš„ç»“æ„å­˜å‚¨èŠ‚ç‚¹ä¿¡æ¯, å…è®¸restful APIäº¤äº’.Consulä¹Ÿåœ¨æ¯ä¸ªå®¢æˆ·ç«¯ä¸Šæä¾›ä¸€ä¸ªDNSç•Œé¢, å…è®¸è¿›è¡Œè¿æ¥åˆ°é›†ç¾¤çš„èŠ‚ç‚¹çš„åŸŸåæŸ¥æ‰¾. ä¸€ä¸ªå•ç‹¬çš„, åˆ©ç”¨Consulé›†ç¾¤çš„é¡¹ç›®æ˜¯&lt;code&gt;consul-template&lt;/code&gt; daemon; è¿™ä¸ªå·¥å…·æ¨¡æ¿åŒ–åœ¨Consul èŠ‚ç‚¹, æœåŠ¡æˆ– key-valueå¯¹çš„æ–‡ä»¶å˜åŒ–. è¿™è®©Consulæˆä¸ºä¸€ä¸ªè‡ªåŠ¨åŒ–NGINXçš„éå¸¸å¼ºå¤§çš„é€‰æ‹©. ä½¿ç”¨&lt;code&gt;consul-template&lt;/code&gt;ä½ ä¹Ÿå¯ä»¥æŒ‡ç¤ºè¯¥daemonåœ¨æ¨¡æ¿æ›¿æ¢å˜æ›´åæ¥è¿è¡Œä¸€ä¸ªå‘½ä»¤. é€šè¿‡è¿™æ ·, å¯ä»¥reload NGINXé…ç½®, å¹¶å…è®¸NGINXé…ç½®åœ¨ç¯å¢ƒä¸­ç”Ÿæ•ˆ. é€šè¿‡Consul, ä½ å¯ä»¥åœ¨æ¯ä¸ªå®¢æˆ·ç«¯ä¸Šè®¾ç½®å¥åº·æ£€æŸ¥æ¥æ£€æŸ¥å…³æ³¨çš„æœåŠ¡çš„ç›‘æ§çŠ¶å†µ. é€šè¿‡å¤±è´¥æ£€æµ‹, ä½ èƒ½å¤Ÿé€šè¿‡æ¨¡æ¿åŒ–ä½ çš„NGINXé…ç½®æ¥åªç»™å¥åº·çš„ä¸»æœºå‘é€æµé‡.&lt;/p&gt;
&lt;h4&gt;å‚è§&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.consul.io/"&gt;Consul home page&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2iosmkV"&gt;Introduction to Consul Template&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/hashicorp/consul-template"&gt;Consul template GitHub&lt;/a&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:33:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-3-6-automatation.html</guid><category>nginx</category><category>devops</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-è¿ç»´-å‰è¨€å’Œä»‹ç»</title><link>https://www.EWhisper.cn/nginx-handbook-3-0-foreword.html</link><description>&lt;h2 id="30"&gt;3.0 å‰è¨€å’Œä»‹ç»&lt;a class="headerlink" href="#30" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;åœ¨NGINX CookBookçš„ç¬¬ä¸€éƒ¨åˆ†, ä¸»é¢˜æ˜¯è´Ÿè½½å‡è¡¡å’Œç¼“å­˜. ç¬¬äºŒéƒ¨åˆ†æ˜¯NGINXçš„å®‰å…¨åŠŸèƒ½, å¦‚è®¤è¯å’ŒåŠ å¯†. ç¬¬ä¸‰éƒ¨åˆ†é›†ä¸­äºNGINXçš„è¿ç»´é—®ä½ , åŒ…æ‹¬éƒ¨ç½², æ€§èƒ½è°ƒä¼˜å’Œè§£å†³é—®é¢˜.&lt;/p&gt;
&lt;p&gt;åœ¨è¿™éƒ¨åˆ†, ä½ ä¼šçœ‹åˆ°åŸºäºä¸‰ä¸ªå¤§å‹å…¬æœ‰äº‘çš„NGINXéƒ¨ç½²å®è·µ: Amazon Web Services(AWS), Google Cloud Platform(GCP), å’Œå¾®è½¯Azure, åŒ…æ‹¬å¦‚ä½•è‡ªåŠ¨åŒ–åœ¨AWSä¸Šéƒ¨ç½². å¦‚æœä½ è®¡åˆ’ä½¿ç”¨Docker, ä¹Ÿæœ‰ç›¸å…³å†…å®¹.&lt;/p&gt;
&lt;p&gt;å®‰è£…ä¹Ÿä¼šæ·±å…¥è®¨è®ºä½¿ç”¨Puppet, Chef, Ansibleå’ŒSaltStackçš„è‡ªåŠ¨åŒ–é…ç½®ç®¡ç†. ä¹Ÿä»‹ç»äº†ä½¿ç”¨NGINX Plus APIæ¥å®æ–½é‡é…ç½®, ä½¿ç”¨Consulè¿›è¡ŒæœåŠ¡å‘ç°å’Œæ¨¡ç‰ˆé…ç½®.&lt;/p&gt;
&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹, å¤§éƒ¨åˆ†ç³»ç»Ÿé…ç½®æ˜¯åŸºäºå…¼å®¹æ€§è€Œä¸æ˜¯æ€§èƒ½. ç„¶åä½ è¦æ ¹æ®ä½ çš„ç‰¹å®šéœ€æ±‚è¿›è¡Œæ€§èƒ½è°ƒä¼˜. åœ¨æœ¬ä¹¦ä¸­, ä½ ä¼šæ‰¾åˆ°åœ¨ä¿æŒå…¼å®¹æ€§çš„å‰æä¸‹, è¯¦ç»†çš„æœ€å¤§åŒ–NGINXæ€§èƒ½çš„æ–¹æ³•.&lt;/p&gt;
&lt;p&gt;å½“æˆ‘ç¢°åˆ°éƒ¨ç½²é—®é¢˜, æˆ‘é¦–å…ˆä¼šçœ‹æ—¥å¿—æ–‡ä»¶, æ˜¯å¾ˆå¤šè°ƒè¯•ä¿¡æ¯çš„æ¥æº. NGINXæœ‰ç»´æŠ¤è¯¦ç»†çš„, é«˜åº¦é…ç½®åŒ–çš„æ—¥å¿—æ¥å¸®åŠ©ä½ å®šä½é—®é¢˜. æœ¬ä¹¦ä¸­åŒ…å«NGINXæ—¥å¿—çš„è¯¦ç»†å†…å®¹.&lt;/p&gt;
&lt;p&gt;å®ƒä¼šå¸®åŠ©ä½ å®‰è£…, ç›‘æ§, ç»´æŠ¤NGINXåº”ç”¨äº¤ä»˜å¹³å°.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:28:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-3-0-foreword.html</guid><category>nginx</category><category>devops</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-è¿ç»´-åœ¨Docker ä¸Šéƒ¨ç½²</title><link>https://www.EWhisper.cn/nginx-handbook-3-4-nginx-docker.html</link><description>&lt;h2 id="34-docker"&gt;3.4 åœ¨Dockerä¸Šéƒ¨ç½²&lt;a class="headerlink" href="#34-docker" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="340"&gt;3.4.0 ä»‹ç»&lt;a class="headerlink" href="#340" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Dockeræ˜¯ä¸ªå¼€æºé¡¹ç›®, ä¼šè‡ªåŠ¨æŠŠLinuxåº”ç”¨éƒ¨ç½²åˆ°è½¯ä»¶å®¹å™¨ä¸­. Dockeræä¾›ä¸€ä¸ªé¢å¤–çš„æŠ½è±¡å±‚, åœ¨linuxä¸Šè‡ªåŠ¨åŒ–æ“ä½œç³»ç»Ÿçº§åˆ«çš„è™šæ‹ŸåŒ–. å®¹å™¨åŒ–ç¯å¢ƒå·²ç»å¯¹ç”Ÿäº§ä¸–ç•Œé€ æˆäº†å·¨å¤§çš„å˜é©. Dockerå’Œå…¶ä»–å®¹å™¨å¹³å°å…è®¸å¿«é€Ÿ, å¯é , è·¨å¹³å°çš„åº”ç”¨éƒ¨ç½². æœ¬ç« ä¸­, æˆ‘ä»¬ä¼šè®¨è®ºNGINXå®˜æ–¹NGINX Dockerjingxiang,åˆ›å»ºä½ è‡ªå·±çš„Dockeræ–‡ä»¶æ¥è¿è¡ŒNGINX, åœ¨NGINXä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡, é€šç”¨Dockerå®è·µ.&lt;/p&gt;
&lt;h3 id="341-nginx"&gt;3.4.1 ä½¿ç”¨NGINXé•œåƒå¿«é€Ÿè¿è¡Œ&lt;a class="headerlink" href="#341-nginx" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦ä½¿ç”¨Docker Hubä¸­çš„NGINXé•œåƒå¿«é€Ÿå¯åŠ¨å’Œè¿è¡Œ.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ docker pull nginx:latest
$ docker run -it -p &lt;span class="m"&gt;80&lt;/span&gt;:80 -v &lt;span class="nv"&gt;$PWD&lt;/span&gt;/nginx-conf:/etc/nginx &lt;span class="se"&gt;\&lt;/span&gt;
                                   nginx:latest
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;NGINXå·²ç»åœ¨Docker Hubä¸Šåˆ¶ä½œäº†ä¸€ä¸ªå®˜æ–¹Dockeré•œåƒ. å®˜æ–¹Dockeré•œåƒå¾ˆå®¹æ˜“åœ¨Dockerä¸­å¯åŠ¨å’Œå¿«é€Ÿè¿è¡Œ. åœ¨æœ¬èŠ‚ä¸­æˆ‘ä»¬é€šè¿‡2ä¸ªå‘½ä»¤å°±èƒ½å¯åŠ¨å’Œè¿è¡ŒNGINX å®¹å™¨. å®˜æ–¹é•œåƒæ˜¯åŸºäºDebian Jessie Dockeré•œåƒ. ä½†æ˜¯ä½ ä¹Ÿå¯ä»¥é€‰æ‹©åŸºäºAlpine Linuxæ„å»ºçš„å®˜æ–¹é•œåƒ. è¿™äº›å®˜æ–¹é•œåƒçš„Dockerfileå’Œæºç å¯ä»¥åœ¨GitHubä¸­æ‰¾åˆ°.&lt;/p&gt;
&lt;h4&gt;å‚è§&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://hub.docker.com/_/nginx/"&gt;Official NGINX Docker image, NGINX&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/nginxinc/docker-nginx/"&gt;Docker repo on GitHub&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="342-nginx-dockerfile"&gt;3.4.2 åˆ›å»ºä¸€ä¸ªNGINX Dockerfile&lt;a class="headerlink" href="#342-nginx-dockerfile" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦åˆ›å»ºä¸€ä¸ªNGINX Dockerfile, ç”¨Dockerfileåˆ›å»ºDockeré•œåƒ.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;CMD&lt;/code&gt;æ¥åœ¨é•œåƒå®ä¾‹åŒ–ä¸ºå®¹å™¨æ—¶å¯åŠ¨NGINX. ä½ éœ€è¦åœ¨å‰å°è¿è¡ŒNGINX. è¦è¿™ä¹ˆåš, éœ€è¦å¯åŠ¨NGINXä½¿ç”¨&lt;code&gt;-g "daemon off;"&lt;/code&gt;æˆ–å¢åŠ &lt;code&gt;daemon off;&lt;/code&gt;åˆ°é…ç½®. æœ¬ä¾‹ä¸­ç¨åä½¿ç”¨&lt;code&gt;daemon off;&lt;/code&gt;åŠ åˆ°main context. ä½ ä¹Ÿæƒ³è°ƒèŠ‚ä½ çš„accessæ—¥å¿—è¾“å‡ºåˆ°&lt;code&gt;/dev/stdout&lt;/code&gt;, é”™è¯¯æ—¥å¿—è¾“å‡ºåˆ°&lt;code&gt;/dev/stderr&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="s"&gt; centos:7&lt;/span&gt;
&lt;span class="c"&gt;# Install epel repo to get nginx and install nginx&lt;/span&gt;
&lt;span class="k"&gt;RUN&lt;/span&gt; yum -y install epel-release &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    yum -y install nginx
&lt;span class="c"&gt;# add local configuration files into the image&lt;/span&gt;
&lt;span class="k"&gt;ADD&lt;/span&gt; /nginx-conf /etc/nginx
&lt;span class="k"&gt;EXPOSE&lt;/span&gt;&lt;span class="s"&gt; 80 443&lt;/span&gt;
&lt;span class="k"&gt;CMD&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;nginx&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤º:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;.
â”œâ”€â”€ Dockerfile
â””â”€â”€ nginx-conf
    â”œâ”€â”€ conf.d
    â”‚   â””â”€â”€ default.conf
    â”œâ”€â”€ fastcgi.conf
    â”œâ”€â”€ fastcgi_params
    â”œâ”€â”€ koi-utf
    â”œâ”€â”€ koi-win
    â”œâ”€â”€ mime.types
    â”œâ”€â”€ nginx.conf
    â”œâ”€â”€ scgi_params
    â”œâ”€â”€ uwsgi_params
    â””â”€â”€ win-utf
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åœ¨æœ¬ä¾‹ä¸­, æˆ‘é€‰æ‹©ç›´æ¥å§nginx-confç›®å½•ä¸‹æ‰€æœ‰æˆ‘çš„NGINXé…ç½®éƒ½æ·»åŠ åˆ°Dockerfileä¸­.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;å½“ä½ éœ€è¦å®Œå…¨æ§åˆ¶åŒ…çš„å®‰è£…å’Œå‡çº§, ä½ ä¼šå‘ç°åˆ›å»ºè‡ªå·±çš„Dockerfileå¾ˆæœ‰ç”¨. å¸¸è§æ“ä½œæ˜¯ä¿å­˜åœ¨ä½ è‡ªå·±çš„é•œåƒä»“åº“ä¸­, è¿™æ ·ä½ ä¼šçŸ¥é“ä½ çš„åŸºç¡€é•œåƒåœ¨ä¸Šç”Ÿäº§ä¹‹å‰æ˜¯å¯é çš„, ç»è¿‡å›¢é˜Ÿæµ‹è¯•çš„.&lt;/p&gt;
&lt;h3 id="343-nginx-plus"&gt;3.4.3 æ„å»ºNGINX Plusé•œåƒ&lt;a class="headerlink" href="#343-nginx-plus" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ç•¥&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="344-nginx"&gt;3.4.4 åœ¨NGINXä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡&lt;a class="headerlink" href="#344-nginx" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†åœ¨ä¸åŒçš„ç¯å¢ƒä¸­ä½¿ç”¨ç›¸åŒçš„å®¹å™¨é•œåƒ, ä½ éœ€è¦åœ¨NGINXé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;ngx_http_perl_module&lt;/code&gt;æ¥ä»ä½ çš„ç¯å¢ƒçš„NGINXä¸­è®¾ç½®å˜é‡.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;daemon&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;env&lt;/span&gt; &lt;span class="s"&gt;APP_DNS&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="k"&gt;include&lt;/span&gt; &lt;span class="n"&gt;/usr/share/nginx/modules/*.conf&lt;/span&gt;;
&lt;span class="k"&gt;...&lt;/span&gt;
&lt;span class="s"&gt;http&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kn"&gt;perl_set&lt;/span&gt; &lt;span class="nv"&gt;$upstream_app&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;sub&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="kn"&gt;return&lt;/span&gt; &lt;span class="nv"&gt;$ENV{&amp;quot;APP_DNS&amp;quot;}&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;&lt;span class="kn"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kn"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;...&lt;/span&gt;
    &lt;span class="s"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="kn"&gt;proxy_pass&lt;/span&gt; &lt;span class="s"&gt;https://&lt;/span&gt;&lt;span class="nv"&gt;$upstream_app&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¦ä½¿ç”¨&lt;code&gt;perl_set&lt;/code&gt;, ä½ å¿…é¡»å®‰è£…&lt;code&gt;ngx_http_perl_module&lt;/code&gt;; ä½ å¯ä»¥é€šè¿‡åŠ¨æ€æ¨¡å—åŠ è½½æˆ–ä»æºç é™æ€æ„å»º. NGINXé»˜è®¤ä»ç¯å¢ƒä¸­æ“¦é™¤ç¯å¢ƒå˜é‡; ä½ éœ€è¦åœ¨&lt;code&gt;env&lt;/code&gt;æŒ‡ä»¤ä¸­å£°æ˜ä»»ä½•ä½ ä¸æƒ³ç§»é™¤çš„å˜é‡. &lt;code&gt;perl_set&lt;/code&gt;æŒ‡ä»¤æœ‰2ä¸ªå‚æ•°: ä½ æƒ³è¦è®¾ç½®çš„å˜é‡åå’Œæ¸²æŸ“ç»“æœçš„perlå­—ç¬¦ä¸².&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªDockerfile, ä¼šåŠ¨æ€åŠ è½½&lt;code&gt;ngx_http_perl_module&lt;/code&gt;, ä»åŒ…ç®¡ç†å·¥å…·å®‰è£…è¯¥æ¨¡å—. å½“ä»CentOSçš„åŒ…ç®¡ç†ä¸­å®‰è£…æ¨¡å—, ä»–ä»¬è¢«æ”¾åœ¨&lt;code&gt;/usr/lib64/nginx/modules/&lt;/code&gt;ç›®å½•, é…ç½®æ–‡ä»¶ä¼šåŠ¨æ€åŠ è½½åœ¨&lt;code&gt;/usr/share/nginx/modules/&lt;/code&gt;ç›®å½•çš„æ¨¡å—. è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸Šé¢çš„é…ç½®å—ä¸­, è¦åŒ…å«å®Œæ•´çš„è·¯å¾„.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="s"&gt; centos:7&lt;/span&gt;
&lt;span class="c"&gt;# Install epel repo to get nginx and install nginx&lt;/span&gt;
&lt;span class="k"&gt;RUN&lt;/span&gt; yum -y install epel-release &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    yum -y install nginx nginx-mod-http-perl
&lt;span class="c"&gt;# add local configuration files into the image&lt;/span&gt;
&lt;span class="k"&gt;ADD&lt;/span&gt; /nginx-conf /etc/nginx
&lt;span class="k"&gt;EXPOSE&lt;/span&gt;&lt;span class="s"&gt; 80 443&lt;/span&gt;
&lt;span class="k"&gt;CMD&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;nginx&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;å½“ä½¿ç”¨Docker, å…¸å‹å®è·µå°±æ˜¯åˆ©ç”¨ç¯å¢ƒå˜é‡æ¥ä¿®æ”¹å®¹å™¨æ“ä½œçš„æ–¹å¼. ä½ å¯ä»¥åœ¨NGINXé…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ç¯å¢ƒå˜é‡, è¿™æ ·NGINXå¯ä»¥ç”¨äºå¤šä¸ª, ä¸åŒçš„ç¯å¢ƒ.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:28:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-3-4-nginx-docker.html</guid><category>nginx</category><category>devops</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category><category>docker</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-è¿ç»´-ä½¿ç”¨Puppet/Chef/Ansible/SaltStackéƒ¨ç½²</title><link>https://www.EWhisper.cn/nginx-handbook-3-5-nginx-autoconf-tools.html</link><description>&lt;h2 id="35-puppetchefansiblesaltstack"&gt;3.5 ä½¿ç”¨Puppet/Chef/Ansible/SaltStack&lt;a class="headerlink" href="#35-puppetchefansiblesaltstack" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="350"&gt;3.5.0 ä»‹ç»&lt;a class="headerlink" href="#350" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;åœ¨äº‘çš„æ—¶ä»£, é…ç½®ç®¡ç†å·¥å…·æ˜¯æ— ä»·ä¹‹å®. å¤§è§„æ¨¡webåº”ç”¨çš„å·¥ç¨‹å¸ˆæ— æ³•é€šè¿‡ä»£ç æ‰‹æŠŠæ‰‹é…ç½®servers, ä½†æ˜¯ä½¿ç”¨å…¶ä¸­ä»»ä½•ä¸€ä¸ªé…ç½®ç®¡ç†å·¥å…·éƒ½å¯ä»¥åšåˆ°. é…ç½®ç®¡ç†å·¥å…·å…è®¸å·¥ç¨‹å¸ˆä¸€æ¬¡å†™å…¥é…ç½®å’Œä»£ç åˆ°å¾ˆå¤šæœ‰ç›¸åŒé…ç½®çš„server, é€šè¿‡ä½¿ç”¨ä¸€ç§å¯é‡å¤, å¯æµ‹è¯•, æ¨¡å—åŒ–çš„æ–¹å¼. æœ¬ç« è®¨è®ºå‡ ä¸ªæµè¡Œçš„é…ç½®ç®¡ç†å·¥å…·, ä»¥åŠå¦‚ä½•ä½¿ç”¨ä»–ä»¬å®‰è£…NIGINXå’Œä»æ¨¡ç‰ˆåˆ›å»ºä¸€ä¸ªåŸºæœ¬é…ç½®. è¿™äº›ä¾‹å­éå¸¸åŸºç¡€, ä½†æ˜¯å±•ç¤ºäº†å¦‚ä½•é€šè¿‡æ¯ä¸ªå¹³å°æ¥å¯åŠ¨NGINX.&lt;/p&gt;
&lt;h3 id="351-puppet"&gt;3.5.1 ä½¿ç”¨Puppetå®‰è£…&lt;a class="headerlink" href="#351-puppet" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦é€šè¿‡Puppetå®‰è£…å’Œé…ç½®NGINX, ä»¥ä»£ç å½¢å¼ç®¡ç†NGINXé…ç½®, å¹¶ç¡®è®¤ä½ çš„å…¶ä»–Puppeté…ç½®.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªæ¨¡å—, ç”¨äºå®‰è£…NGINX, ç®¡ç†ä½ éœ€è¦çš„æ–‡ä»¶, ç¡®ä¿NGINXåœ¨è¿è¡Œ:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="n"&gt;nginx&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="n"&gt;package&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;nginx&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;ensure&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;installed&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,}&lt;/span&gt;
    &lt;span class="n"&gt;service&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;nginx&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;ensure&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;true&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;hasrestart&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;true&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;restart&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/etc/init.d/nginx reload&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="n"&gt;file&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;nginx.conf&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;path&lt;/span&gt;    &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/etc/nginx/nginx.conf&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="nb"&gt;require&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="no"&gt;Package&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;nginx&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;notify&lt;/span&gt;  &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="no"&gt;Service&lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;nginx&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;content&lt;/span&gt; &lt;span class="o"&gt;=&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;template&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;nginx/templates/nginx.conf.erb&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt;
        &lt;span class="n"&gt;user&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;root&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;group&lt;/span&gt;&lt;span class="o"&gt;=&amp;gt;&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;root&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;mode&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;0644&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¯¥æ¨¡å—ä½¿ç”¨åŒ…ç®¡ç†å·¥å…·æ¥ç¡®ä¿NGINXè¢«å®‰è£…. ä¹Ÿä¼šç¡®ä¿NGINXåœ¨å¯åŠ¨æ—¶åœ¨è¿è¡Œå’Œå¯ç”¨. è¯¥é…ç½®é€šçŸ¥Puppet, è¯¥æœåŠ¡æœ‰é‡å¯å‘½ä»¤, é€šè¿‡&lt;code&gt;hasrestart&lt;/code&gt;æŒ‡ä»¤, å¹¶ä¸”æˆ‘ä»¬ç”¨NGINX reloadå‘½ä»¤è¦†ç›–&lt;code&gt;restart&lt;/code&gt;å‘½ä»¤. å®ƒé€šè¿‡å†…ç½®Ruby(ERB)æ¨¡ç‰ˆè¯­è¨€æ¥ç®¡ç†å’Œæ¨¡æ¿åŒ–&lt;code&gt;nginx.conf&lt;/code&gt;æ–‡ä»¶. æ–‡ä»¶çš„æ¨¡æ¿åŒ–ä¼šå‘ç”Ÿåœ¨NGINXåŒ…è¢«å®‰è£…ä¹‹å(é€šè¿‡&lt;code&gt;require&lt;/code&gt;æŒ‡ä»¤). ä½†æ˜¯, å®ƒä¼šé€šè¿‡&lt;code&gt;notify&lt;/code&gt;æŒ‡ä»¤é€šçŸ¥NGINXæœåŠ¡æ¥reload. è¯¥æ¨¡ç‰ˆåŒ–é…ç½®æ–‡ä»¶æ²¡æœ‰åŒ…æ‹¬. å¦å¤–, å®ƒå¯ä»¥ç®€å•å®‰è£…ä¸€ä¸ªé»˜è®¤çš„NGINXé…ç½®æ–‡ä»¶, æˆ–æ˜¯ä½¿ç”¨å†…ç½®Ruby(ERB)æˆ–å†…ç½®Puppet(EPP)æ¨¡ç‰ˆè¯­è¨€çš„å¾ªç¯å’Œå˜é‡æ›¿æ¢.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;Puppetæ˜¯åŸºäºRubyè¯­è¨€çš„é…ç½®ç®¡ç†å·¥å…·. æ¨¡å—è¢«æ„å»ºè¿›ä¸€ä¸ªç‰¹å®šåŸŸçš„è¯­è¨€, å¹¶é€šè¿‡å®šä¹‰ç»™å®šserveré…ç½®çš„manifestæ–‡ä»¶è°ƒç”¨. Puppetå¯ä»¥ç”¨ä¸»ä»æˆ–masterlessæ¨¡å¼è¿è¡Œ. ä½¿ç”¨Puppet, manifestè¿è¡Œåœ¨masterä¸Š, ç„¶åå‘åˆ°slaveä¸Š. è¿™å¾ˆé‡è¦, å› ä¸ºå®ƒç¡®ä¿slaveåªæ˜¯è¢«äº¤ä»˜å¯¹å®ƒæœ‰ç”¨çš„é…ç½®, å¯¹å…¶ä»–serverçš„å…¶ä»–é…ç½®æ˜¯ä¸ä¼šç»™è¿™ä¸ªslaveçš„. Puppetæœ‰å¾ˆå¤šéå¸¸é«˜çº§çš„å…¬ç”¨æ¨¡å—. é€šè¿‡è¿™äº›æ¨¡å—, ä¼šåœ¨é…ç½®ä¸Šå¸®åŠ©ä½ é£èµ·. åœ¨GitHubä¸Šæ¥è‡ªvoxpupuliçš„å…¬å…±NGINXæ¨¡å—ä¼šä¸ºä½ æ¨¡æ¿åŒ–NGINXé…ç½®.&lt;/p&gt;
&lt;h4&gt;å‚è§&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://docs.puppet.com/"&gt;Puppet documentation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2jfgpm4"&gt;Puppet package documentation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2jMq2cx"&gt;Puppet service documentation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2jMz4q3"&gt;Puppet file documentation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2isqAlP"&gt;Puppet templating documentation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2jMspMn"&gt;Voxpupuli NGINX module&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="352-chef"&gt;3.5.2 ä½¿ç”¨Chefå®‰è£…&lt;a class="headerlink" href="#352-chef" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ç•¥&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="353-ansible"&gt;3.5.3 ä½¿ç”¨Ansibleå®‰è£…&lt;a class="headerlink" href="#353-ansible" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦ä½¿ç”¨Ansibleæ¥å®‰è£…å’Œé…ç½®NGINX, ä»¥ä»£ç å½¢å¼ç®¡ç†NGINXé…ç½®, å¹¶ç¡®è®¤ä½ çš„å…¶ä»–Ansibleé…ç½®.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªå®‰è£…NGINXå’Œç®¡ç†&lt;em&gt;nginx.conf&lt;/em&gt;æ–‡ä»¶playbook. ä¸‹åˆ—æ˜¯ä¸€ä¸ªç¤ºä¾‹çš„ä»»åŠ¡æ–‡ä»¶.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;NGINX | Installing NGINX&lt;/span&gt;
  &lt;span class="nt"&gt;package&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;name=nginx state=present&lt;/span&gt;

&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;NGINX | Starting NGINX&lt;/span&gt;
  &lt;span class="nt"&gt;service&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;nginx&lt;/span&gt;
    &lt;span class="nt"&gt;state&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;started&lt;/span&gt;
    &lt;span class="nt"&gt;enabled&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;yes&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Copy nginx configuration in place.&lt;/span&gt;
  &lt;span class="nt"&gt;template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;src&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;nginx.conf.j2&lt;/span&gt;
    &lt;span class="nt"&gt;dest&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/etc/nginx/nginx.conf&amp;quot;&lt;/span&gt;
    &lt;span class="nt"&gt;owner&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;root&lt;/span&gt;
    &lt;span class="nt"&gt;group&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;root&lt;/span&gt;
    &lt;span class="nt"&gt;mode&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;0644&lt;/span&gt;
  &lt;span class="nt"&gt;notify&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;reload nginx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;package&lt;/code&gt;å—å®‰è£…NGINX. &lt;code&gt;service&lt;/code&gt;å—ç¡®ä¿NGINXåœ¨å¯åŠ¨æ—¶è¢«å¯åŠ¨å’Œå¯ç”¨. &lt;code&gt;template&lt;/code&gt;å—æ¨¡æ¿åŒ–ä¸€ä¸ª&lt;em&gt;Jinja2&lt;/em&gt;æ–‡ä»¶, å¹¶æŠŠç»“æœä»¥rootç”¨æˆ·å’Œç»„æ”¾åˆ°&lt;code&gt;/etc/nginx.conf&lt;/code&gt;ä¸­. è¯¥æ¨¡ç‰ˆå—ä¹Ÿè®¾ç½®&lt;em&gt;mode&lt;/em&gt;ä¸º644, å¹¶é€šçŸ¥nginxæœåŠ¡reload. æ¨¡æ¿åŒ–é…ç½®æ–‡ä»¶æ²¡æœ‰åŒ…å«åœ¨å†…. ä½†æ˜¯, å¯ä»¥é€šè¿‡é»˜è®¤çš„NGINXé…ç½®æ–‡ä»¶æ¥ç®€å•, æˆ–è€…é€šè¿‡Jinja2æ¨¡ç‰ˆè¯­è¨€çš„å¾ªç¯å’Œå˜é‡æ›¿æ¢ç”Ÿæˆå¾ˆå¤æ‚çš„æ¨¡ç‰ˆ.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;Ansibleæ˜¯ç”¨Pythonç¼–å†™çš„å¹¿æ³›ä½¿ç”¨çš„å¼ºå¤§é…ç½®ç®¡ç†å·¥å…·. ä»»åŠ¡é…ç½®ä½¿ç”¨YAML, ä½¿ç”¨Jinja2æ¨¡ç‰ˆè¯­è¨€ç”Ÿæˆæ–‡ä»¶æ¨¡ç‰ˆ. Ansibleæä¾›ä¸€ä¸ªæœ‰masterçš„å«åšAnsible Towerçš„è®¢é˜…ç‰ˆ. ä½†æ˜¯, å®ƒç»å¸¸ç”¨äºæœ¬åœ°æœºå™¨æˆ–æ„å»ºæœåŠ¡å™¨ç›´æ¥åˆ°å®¢æˆ·ç«¯æˆ–è€…ä½¿ç”¨masterlessæ¨¡å¼. Ansibleæ‰“åŒ…SSHåˆ°å®ƒçš„serverå¹¶è¿è¡Œé…ç½®. å’Œå…¶ä»–é…ç½®å·¥å…·ç±»ä¼¼, æœ‰å¾ˆå¤šç¤¾åŒºæä¾›çš„å…¬å…±roles, AnsibleæŠŠå®ƒå«åšAnsible Galaxy. ä½ å¯ä»¥æ‰¾åˆ°å¯ä»¥ç”¨äºä½ çš„playbookçš„éå¸¸å¤æ‚çš„roles.&lt;/p&gt;
&lt;h4&gt;å‚è§&lt;/h4&gt;
&lt;p&gt;&lt;a href="http://docs.ansible.com/"&gt;Ansible documentation&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2jfiwGv"&gt;Ansible packages&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2jMGF7E"&gt;Ansible service&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2j8j526"&gt;Ansible template&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://galaxy.ansible.com/"&gt;Ansible Galaxy&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="354-saltstack"&gt;3.5.4 ä½¿ç”¨SaltStackå®‰è£…&lt;a class="headerlink" href="#354-saltstack" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦ä½¿ç”¨SaltStackæ¥å®‰è£…å’Œé…ç½®NGINX, ä»¥ä»£ç å½¢å¼ç®¡ç†NGINXé…ç½®, å¹¶ç¡®è®¤ä½ çš„å…¶ä»–SaltStacké…ç½®.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;nginx&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;pkg&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;installed&lt;/span&gt;
  &lt;span class="nt"&gt;service&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;nginx&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;running&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;enable&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;True&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;reload&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;True&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;watch&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;file&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/etc/nginx/nginx.conf&lt;/span&gt;

&lt;span class="nt"&gt;/etc/nginx/nginx.conf&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;file&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;managed&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;source&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;salt://path/to/nginx.conf&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;root&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;group&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;root&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;jinja&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;mode&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;644&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;require&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;pkg&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;nginx&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:28:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-3-5-nginx-autoconf-tools.html</guid><category>nginx</category><category>devops</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-å®‰å…¨-å®ç”¨å®‰å…¨æŠ€å·§</title><link>https://www.EWhisper.cn/nginx-handbook-2-10-security-tips.html</link><description>&lt;h2 id="210"&gt;2.10 å®ç”¨å®‰å…¨æŠ€å·§&lt;a class="headerlink" href="#210" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="2100"&gt;2.10.0 ä»‹ç»&lt;a class="headerlink" href="#2100" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;å®‰å…¨æ˜¯åˆ†å±‚çš„, å°±åƒä¸€ä¸ªæ´‹è‘±, ä½ çš„å®‰å…¨æ¨¡å‹ç¡®å®è¦è¢«å¤šå±‚åŠ å›º. åœ¨è¿™éƒ¨åˆ†, æˆ‘ä»¬ä»‹ç»è®¸å¤šä¸åŒçš„æ–¹æ³•æ¥ç¡®ä¿webåº”ç”¨ç¨‹åºNGINXå’ŒNGINX Plus. å¾ˆå¤šçš„è¿™äº›å®‰å…¨æ–¹æ³•å¯ä»¥ç”¨æ¥åŠ å›ºå®‰å…¨. ä¸‹é¢æ˜¯ä¸€äº›å®ç”¨çš„å®‰å…¨æç¤º,ä»¥ç¡®ä¿æ‚¨çš„ç”¨æˆ·åœ¨ä½¿ç”¨HTTPSå’Œå‘Šè¯‰NGINXæ»¡è¶³ä¸€ä¸ªæˆ–å¤šä¸ªå®‰å…¨æ–¹æ³•ã€‚&lt;/p&gt;
&lt;h3 id="2101-https"&gt;2.10.1 HTTPS é‡å®šå‘&lt;a class="headerlink" href="#2101-https" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦é‡å®šå‘æœªåŠ å¯†çš„è¯·æ±‚åˆ°HTTPS.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;rewrite&lt;/code&gt;æ¥å‘é€æ‰€æœ‰HTTPæµé‡åˆ°HTTPS:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="mi"&gt;80&lt;/span&gt; &lt;span class="s"&gt;default_server&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="s"&gt;[::]:80&lt;/span&gt; &lt;span class="s"&gt;default_server&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;server_name&lt;/span&gt; &lt;span class="s"&gt;_&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;301&lt;/span&gt; &lt;span class="s"&gt;https://&lt;/span&gt;&lt;span class="nv"&gt;$host$request_uri&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¿™ä¸ªé…ç½®ç›‘å¬æ‰€æœ‰hostnameçš„IPv4å’ŒIPv6çš„80ç«¯å£ä½œä¸ºé»˜è®¤çš„server. &lt;code&gt;return&lt;/code&gt;å£°æ˜è¿”å›301æ°¸ä¹…é‡å®šå‘åˆ°åŒæ ·çš„hostå’Œè¯·æ±‚URIçš„HTTPSä¸Š.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;æ€»æ˜¯æŠŠé€‚å½“çš„è¯·æ±‚é‡å®šå‘åˆ°HTTPSæ˜¯éå¸¸é‡è¦çš„. ä½ å¯èƒ½ä¼šå‘ç°ä½ ä¸éœ€è¦é‡å®šå‘æ‰€æœ‰çš„è¯·æ±‚, è€Œæ˜¯åœ¨å®¢æˆ·ç«¯å’Œserverä¹‹é—´ä¼ è¾“æ•æ„Ÿä¿¡æ¯çš„é‚£äº›è¯·æ±‚. åœ¨æœ¬ä¾‹ä¸­, ä½ å¯èƒ½æƒ³è¦æŠŠ&lt;code&gt;return&lt;/code&gt;å£°æ˜æ”¾åˆ°ç‰¹å®šçš„locationé‡Œ, å¦‚&lt;code&gt;/login&lt;/code&gt;.&lt;/p&gt;
&lt;h3 id="2102-ssltlsnginxhttps"&gt;2.10.2 é‡å®šå‘SSL/TLSåœ¨NGINXä¹‹å‰å·²ç»ç»“æŸçš„åˆ°HTTPS&lt;a class="headerlink" href="#2102-ssltlsnginxhttps" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦é‡å®šå‘åˆ°HTTPS, ç„¶è€Œ, åœ¨NGINXä¹‹å‰, ä½ å·²ç»ç»“æŸäº†SSL/TLS.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨æ ‡å‡†çš„&lt;code&gt;HTTP_X_Forwarded_Proto&lt;/code&gt; å¤´æ¥å†³å®šæ˜¯å¦ä½ éœ€è¦è¿›è¡Œé‡å®šå‘:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="mi"&gt;80&lt;/span&gt; &lt;span class="s"&gt;default_server&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="s"&gt;[::]:80&lt;/span&gt; &lt;span class="s"&gt;default_server&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;server_name&lt;/span&gt; &lt;span class="s"&gt;_&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;if&lt;/span&gt; &lt;span class="s"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$http_x_forwarded_proto&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;http&amp;#39;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;301&lt;/span&gt; &lt;span class="s"&gt;https://&lt;/span&gt;&lt;span class="nv"&gt;$host$request_uri&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¿™ä¸ªé…ç½®å’ŒHTTPSé‡å®šå‘å¾ˆåƒ. ä½†æ˜¯, åœ¨è¿™ä¸ªé…ç½®ä¸­, åªæœ‰å¤´&lt;code&gt;X_Forwarded_Proto&lt;/code&gt;ç­‰äºHTTPæ‰ä¼šé‡å®šå‘.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªåœ¨NGINXä¹‹å‰å°±ç»“æŸäº†SSL/TLSçš„å¸¸è§æ¡ˆä¾‹. ä½ å¯èƒ½è¦è¿™ä¹ˆåšçš„ä¸€ä¸ªåŸå› æ˜¯èŠ‚çœè®¡ç®—å¼€é”€. ä½†æ˜¯, ä½ éœ€è¦ç¡®ä¿æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯HTTPS, ä½†æ˜¯ç»“æŸäº†SSL/TLSçš„å±‚æ²¡æœ‰é‡å®šå‘çš„èƒ½åŠ›. ä½†æ˜¯, å¯ä»¥è®¾ç½®ä»£ç†å¤´éƒ¨. è¿™ä¸ªé…ç½®å¯ä»¥åœ¨Amazon Web Services Elastic Load Balancerä¸Šå·¥ä½œ, å› ä¸ºè¿™ä¸ªå¦‚æœæ²¡æœ‰é¢å¤–çš„èŠ±é’±çš„è¯å°±ä¼šå¸è½½æ‰SSL/TLS. è¿™æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„æŠ€å·§ä»¥ç¡®ä¿ä½ çš„HTTPæµé‡æ˜¯å®‰å…¨çš„ã€‚&lt;/p&gt;
&lt;h3 id="2103"&gt;2.10.3 æ»¡è¶³ä»»æ„æ•°é‡çš„å®‰å…¨æ–¹æ³•&lt;a class="headerlink" href="#2103" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦æä¾›å¤šç§æ–¹å¼æ¥ä¼ è¾“å®‰å…¨åˆ°ä¸€ä¸ªä¸å…¬å¼€çš„ç«™ç‚¹.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;satisfy&lt;/code&gt;æŒ‡ä»¤æ¥è¯´æ˜ä½ æƒ³è¦ä½¿ç”¨ä»»æ„æ•°é‡çš„å®‰å…¨æ–¹æ³•:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;satisfy&lt;/span&gt; &lt;span class="s"&gt;any&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;allow&lt;/span&gt; &lt;span class="mi"&gt;192&lt;/span&gt;&lt;span class="s"&gt;.168.1.0/24&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;deny&lt;/span&gt;  &lt;span class="s"&gt;all&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;auth_basic&lt;/span&gt;           &lt;span class="s"&gt;&amp;quot;closed&lt;/span&gt; &lt;span class="s"&gt;site&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;auth_basic_user_file&lt;/span&gt; &lt;span class="s"&gt;conf/htpasswd&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¯¥é…ç½®å‘Šè¯‰NGINXç”¨æˆ·è¯·æ±‚&lt;code&gt;location /&lt;/code&gt;éœ€è¦æ»¡è¶³å…¶ä¸­çš„ä¸€ä¸ªå®‰å…¨æ–¹æ³•: æˆ–è€…è¯¥è¯·æ±‚éœ€è¦æ¥è‡ª&lt;em&gt;192.168.1.0/24&lt;/em&gt; CIDR block, æˆ–è€…èƒ½å¤Ÿæä¾›åœ¨å¯ä»¥åœ¨&lt;code&gt;conf/htpasswd&lt;/code&gt;ä¸­æ‰¾åˆ°çš„ç”¨æˆ·åå¯†ç . &lt;code&gt;satisfy&lt;/code&gt;æŒ‡ä»¤æœ‰2ä¸ªé€‰é¡¹: &lt;code&gt;any&lt;/code&gt;æˆ–&lt;code&gt;all&lt;/code&gt;&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;satifsy&lt;/code&gt;æŒ‡ä»¤æ˜¯ä¸€ä¸ªæä¾›å¤šç§è®¤è¯çš„å¾ˆå¥½çš„æ–¹å¼. é€šè¿‡æŒ‡å®š&lt;code&gt;any&lt;/code&gt;ç»™&lt;code&gt;satisfy&lt;/code&gt;æŒ‡ä»¤, ç”¨æˆ·å¿…é¡»æ»¡è¶³å…¶ä¸­ä¸€ä¸ªå®‰å…¨. æŒ‡å®š&lt;code&gt;all&lt;/code&gt;ç»™&lt;code&gt;satisfy&lt;/code&gt;æŒ‡ä»¤, ç”¨æˆ·å¿…é¡»æ»¡è¶³æ‰€æœ‰çš„å®‰å…¨è®¤è¯. è¯¥æŒ‡ä»¤å¯ä»¥å’Œ2.1çš„&lt;code&gt;http_access_module&lt;/code&gt;ç»“åˆ, 2.4çš„&lt;code&gt;http_auth_basic_module&lt;/code&gt;, 2.5çš„&lt;code&gt;http_auth_request_module&lt;/code&gt;, 2.7çš„&lt;code&gt;http_auth_jwt_module&lt;/code&gt;. åªæœ‰å„ä¸ªå±‚éƒ½å®‰å…¨, æ‰æ˜¯çœŸæ­£çš„å®‰å…¨. &lt;code&gt;satisfy&lt;/code&gt;æŒ‡ä»¤ä¼šå¸®åŠ©ä½ ä¸ºè¿™ä¸ªlocationæˆ–serverå®ç°éœ€è¦çš„æ·±åº¦å®‰å…¨è§„åˆ™.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:24:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-2-10-security-tips.html</guid><category>nginx</category><category>å®‰å…¨</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-å®‰å…¨-ModSecurity Webåº”ç”¨é˜²ç«å¢™</title><link>https://www.EWhisper.cn/nginx-handbook-2-9-waf.html</link><description>&lt;h2 id="29-modsecurity-web"&gt;2.9 ModSecurity Webåº”ç”¨é˜²ç«å¢™&lt;a class="headerlink" href="#29-modsecurity-web" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="290"&gt;2.9.0 ä»‹ç»&lt;a class="headerlink" href="#290" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ModSecurity æ˜¯ä¸€ä¸ªå¼€æºçš„webåº”ç”¨é˜²ç«å¢™(WAF), é¦–æ¬¡è¢«æ„å»ºä»…Apache web server. åœ¨2012å¹´, å®ƒä½œä¸ºNGINXçš„ä¸€ä¸ªæ¨¡å—å¯ä¾›ä½¿ç”¨, 2016åŠ å…¥NGINX Plusä½œä¸ºä¸€ä¸ªå¯é€‰åŠŸèƒ½. æœ¬ç« å°†è¯¦ç»†ä»‹ç»ä½¿ç”¨NGINX Plusçš„åŠ¨æ€æ¨¡å—åŠŸèƒ½å®‰è£…ModSecurity 3.0, ä½¿ç”¨å¼€æºNGINXå®‰è£…ModeSecurity 2.9. ModSecurity 3.0æ¯”ModSecurity 2.xçš„å®‰å…¨å’Œæ€§èƒ½æ›´å‡ºä¼—. å½“ä»å¼€æºè¿è¡ŒModSecurity 2.9, å› ä¸ºå®ƒä»ç„¶æ˜¯åœ¨Apacheä¸Šæ„é€ , å› æ­¤éœ€è¦æ¯”3.0æ›´å¤šçš„å¼€é”€, è€Œ3.0æ˜¯åŸºäºNGINXåŸç”Ÿè®¾è®¡çš„.  ModSecurity 3.0 åªèƒ½ç”¨äºNGINX Plusè®¢é˜….&lt;/p&gt;
&lt;h3 id="291-nginx-plusmodesecurity"&gt;2.9.1 ä¸ºNGINX Pluså®‰è£…ModeSecurity&lt;a class="headerlink" href="#291-nginx-plusmodesecurity" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;ç•¥è¿‡&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="292-nginx-plusmodsecurity"&gt;2.9.2 åœ¨NGINX Plusä¸­é…ç½®ModSecurity&lt;a class="headerlink" href="#292-nginx-plusmodsecurity" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦é…ç½®NGINX Plusä½¿ç”¨ModSecurityæ¨¡å—.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;åœ¨NGINX Plusé…ç½®ä¸­å¯ç”¨åŠ¨æ€æ¨¡å—, ä½¿ç”¨&lt;code&gt;modsecurity_rules_file&lt;/code&gt;æ¥æŒ‡å‘ä¸€ä¸ªModSecurityè§„åˆ™æ–‡ä»¶:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;load_module modules/ngx_http_modsecurity.so;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;load_module&lt;/code&gt;æŒ‡ä»¤é€‚ç”¨äºä¸»context, æ„å‘³ç€è¯¥æŒ‡ä»¤å¯ä»¥åœ¨æ‰“å¼€HTTPæˆ–Streamå—ä¹‹å‰ä½¿ç”¨.&lt;/p&gt;
&lt;p&gt;å¼€å¯ModeSecurity, ä½¿ç”¨æŒ‡å®šè§„åˆ™é›†:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="k"&gt;modsecurity&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="k"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;proxy_pass&lt;/span&gt; &lt;span class="s"&gt;http://backend&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;modsecurity_rules_file&lt;/span&gt; &lt;span class="s"&gt;rule-set-file&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
     &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;ModSecurityçš„è§„åˆ™å¯ä»¥é˜»æ­¢å¯¹å¸¸è§çš„web serverså’Œåº”ç”¨çš„æ¼æ´åˆ©ç”¨. ModSecurityå·²çŸ¥å¯ä»¥é˜²å¾¡åº”ç”¨å±‚çš„æ”»å‡», å¦‚HTTP violations, SQLæ³¨å…¥, è·¨ç«™è„šæœ¬, åº”ç”¨å±‚, DDoS, è¿œç¨‹å’Œæœ¬åœ°æ–‡ä»¶æ”»å‡». ä½¿ç”¨ModSecurity, ä½ å¯ä»¥è®¢é˜…æ¶æ„ç”¨äºçš„å®æ—¶çš„é»‘åå•, æ¥å¸®åŠ©åœ¨æœåŠ¡è¢«æ”»å‡»ä¹‹å‰é˜»æ­¢é—®é¢˜. ModSecurityæ¨¡å—ä¹Ÿå¯ä»¥å¯ç”¨æ—¥å¿—å¸®åŠ©è¯†åˆ«æ–°çš„æ”»å‡»æ¨¡å¼å’Œå¼‚å¸¸.&lt;/p&gt;
&lt;h4&gt;å‚è§&lt;/h4&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2fdZ7Dd"&gt;OWASP ModSecurity æ ¸å¿ƒè§„åˆ™é›†&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2eJYuAx"&gt;TrustWave ModSecurity ä»˜è´¹è§„åˆ™é›†&lt;/a&gt;&lt;/p&gt;
&lt;h3 id="293-modsecurity"&gt;2.9.3 æºç å®‰è£…ModSecurity&lt;a class="headerlink" href="#293-modsecurity" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦åœ¨CentOSæˆ–RHELç³»ç»Ÿä¸Šä½¿ç”¨NGINXè¿è¡ŒModSecurity.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä»æºç ç¼–è¯‘ModSecurityå’ŒNGINXæ¥ä½¿ç”¨ModSecurityæ¨¡å—.&lt;/p&gt;
&lt;p&gt;é¦–å…ˆå‡çº§securityå¹¶å®‰è£…ä¾èµ–:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ yum --security update -y &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    yum -y install automake &lt;span class="se"&gt;\&lt;/span&gt;
    autoconf &lt;span class="se"&gt;\&lt;/span&gt;
    curl &lt;span class="se"&gt;\&lt;/span&gt;
    curl-devel &lt;span class="se"&gt;\&lt;/span&gt;
    gcc &lt;span class="se"&gt;\&lt;/span&gt;
    gcc-c++ &lt;span class="se"&gt;\&lt;/span&gt;
    httpd-devel &lt;span class="se"&gt;\&lt;/span&gt;
    libxml2 &lt;span class="se"&gt;\&lt;/span&gt;
    libxml2-devel &lt;span class="se"&gt;\&lt;/span&gt;
    make &lt;span class="se"&gt;\&lt;/span&gt;
    openssl &lt;span class="se"&gt;\&lt;/span&gt;
    openssl-devel &lt;span class="se"&gt;\&lt;/span&gt;
    perl &lt;span class="se"&gt;\&lt;/span&gt;
    wget
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ¥ä¸‹æ¥, ä¸‹è½½å®‰è£…PCREåº“:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;cd&lt;/span&gt; /opt &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    wget http://ftp.exim.org/pub/pcre/pcre-8.39.tar.gz &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    tar -zxf pcre-8.39.tar.gz &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="nb"&gt;cd&lt;/span&gt; pcre-8.39 &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    ./configure &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    make &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    make install
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¸‹è½½zlibæºç å¹¶å®‰è£…:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;cd&lt;/span&gt; /opt &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    wget http://zlib.net/zlib-1.2.8.tar.gz &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    tar -zxf zlib-1.2.8.tar.gz &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="nb"&gt;cd&lt;/span&gt; zlib-1.2.8 &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    ./configure &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    make &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    make install
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¸‹è½½ModSecurityæºç å¹¶å®‰è£…:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;cd&lt;/span&gt; /opt &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  wget &lt;span class="se"&gt;\&lt;/span&gt;
  https://www.modsecurity.org/tarball/2.9.1/modsecurity-2.9.1.&lt;span class="se"&gt;\&lt;/span&gt;
tar.gz&lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  tar -zxf modsecurity-2.9.1.tar.gz &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  &lt;span class="nb"&gt;cd&lt;/span&gt; modsecurity-2.9.1 &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  ./configure --enable-standalone-module &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  make
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä»æºç ä¸‹è½½å®‰è£…NGINX, å¹¶åœ¨é…ç½®è„šæœ¬é‡ŒåŒ…å«ä½ éœ€è¦çš„æ‰€æœ‰æ¨¡å—. æœ¬æ¬¡æˆ‘ä»¬çš„å…³æ³¨ç‚¹æ˜¯ModSecurity:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;cd&lt;/span&gt; /opt &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    wget http://nginx.org/download/nginx-1.11.4.tar.gz &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    tar zxf nginx-1.11.4.tar.gz &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="nb"&gt;cd&lt;/span&gt; nginx-1.11.4 &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    ./configure &lt;span class="se"&gt;\&lt;/span&gt;
        --sbin-path&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nginx/nginx &lt;span class="se"&gt;\&lt;/span&gt;
        --conf-path&lt;span class="o"&gt;=&lt;/span&gt;/etc/nginx/nginx.conf &lt;span class="se"&gt;\&lt;/span&gt;
        --pid-path&lt;span class="o"&gt;=&lt;/span&gt;/usr/local/nginx/nginx.pid &lt;span class="se"&gt;\&lt;/span&gt;
        --with-pcre&lt;span class="o"&gt;=&lt;/span&gt;../pcre-8.39 &lt;span class="se"&gt;\&lt;/span&gt;
        --with-zlib&lt;span class="o"&gt;=&lt;/span&gt;../zlib-1.2.8 &lt;span class="se"&gt;\&lt;/span&gt;
        --with-http_ssl_module &lt;span class="se"&gt;\&lt;/span&gt;
        --with-stream &lt;span class="se"&gt;\&lt;/span&gt;
        --with-http_ssl_module &lt;span class="se"&gt;\&lt;/span&gt;
        --with-http_secure_link_module &lt;span class="se"&gt;\&lt;/span&gt;
        --add-module&lt;span class="o"&gt;=&lt;/span&gt;../modsecurity-2.9.1/nginx/modsecurity &lt;span class="se"&gt;\&lt;/span&gt;
    &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    make &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    make install &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
    ln -s /usr/local/nginx/nginx /usr/bin/nginx
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¿™å°†ä¼šæŠŠModSecurity 2.9.1 æ¨¡å—ç¼–è¯‘å¹¶å’ŒNGINXä¸€èµ·å®‰è£…. ä»ç°åœ¨å¼€å§‹, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨&lt;code&gt;ModSecurityEnabled&lt;/code&gt;å’Œ&lt;code&gt;ModSecurityConfig&lt;/code&gt;æŒ‡ä»¤:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="mi"&gt;80&lt;/span&gt; &lt;span class="s"&gt;default_server&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="s"&gt;[::]:80&lt;/span&gt; &lt;span class="s"&gt;default_server&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;server_name&lt;/span&gt; &lt;span class="s"&gt;_&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
      &lt;span class="kn"&gt;ModSecurityEnabled&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
      &lt;span class="kn"&gt;ModSecurityConfig&lt;/span&gt; &lt;span class="s"&gt;modsecurity.conf&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;NGINX serverçš„é…ç½®ä¼šä¸º&lt;code&gt;location /&lt;/code&gt;å¯ç”¨ModSecurity, å¹¶ä½¿ç”¨ä½äºNGINXé…ç½®ç›®å½•ä¸‹çš„ModSecurityé…ç½®æ–‡ä»¶.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;è¿™ä¸€èŠ‚ä»NGINXæºç ç¼–è¯‘, å¹¶æŠŠModSecurityç¼–è¯‘åˆ°NGINXä¸­. æ¨èä»æºç ç¼–è¯‘NGINXçš„æ—¶å€™, æ€»æ˜¯æ£€æŸ¥ä½ æ˜¯å¦ä½¿ç”¨äº†æœ€æ–°çš„ç¨³å®šç‰ˆçš„åŒ…. é€šè¿‡ä¹‹å‰çš„æ¡ˆä¾‹, ä½ å¯ä»¥ä½¿ç”¨æœ‰ModSecurityçš„å¼€æºç‰ˆæœ¬çš„NGINXæ¥æ„å»ºä½ çš„å¼€æºwebåº”ç”¨é˜²ç«å¢™.&lt;/p&gt;
&lt;h4&gt;å‚è§&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://github.com/SpiderLabs/ModSecurity"&gt;ModSecurityæºç &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://bit.ly/2eJYuAx"&gt;Updated and maintained ModSecurity Rules from SpiderLabs&lt;/a&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:22:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-2-9-waf.html</guid><category>nginx</category><category>å®‰å…¨</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-å®‰å…¨-å®‰å…¨é“¾æ¥</title><link>https://www.EWhisper.cn/nginx-handbook-2-6-secure-link.html</link><description>&lt;h2 id="26"&gt;2.6 å®‰å…¨é“¾æ¥&lt;a class="headerlink" href="#26" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="260"&gt;2.6.0 ä»‹ç»&lt;a class="headerlink" href="#260" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;å®‰å…¨é“¾æ¥(secure links)æ˜¯ä¸€ç§ä½¿ç”¨&lt;em&gt;md5&lt;/em&gt;å“ˆå¸Œç®—æ³•ä¿è¯é™æ€èµ„æºå®‰å…¨çš„æ–¹å¼. ä½¿ç”¨è¿™ä¸ªæ¨¡å—, ä½ ä¹Ÿå¯ä»¥é™åˆ¶è¯¥é“¾æ¥æ¥æ”¶è¯·æ±‚çš„æ—¶é•¿. ä½¿ç”¨å®‰å…¨é“¾æ¥ä½¿NGINXåº”ç”¨ç¨‹åºæœåŠ¡å™¨ç¡®ä¿é™æ€å†…å®¹å®‰å…¨è€Œæ— éœ€åº”ç”¨æœåŠ¡å™¨æ‰¿æ‹…è¿™ç§è´£ä»». è¿™ä¸ªæ¨¡å—åŒ…å«åœ¨å…è´¹å¼€æºçš„NGINXé‡Œ. ä½†æ˜¯, å®ƒæ²¡æœ‰æ‰“è¿›æ ‡å‡†çš„NGINXåŒ…, è€Œæ˜¯æ”¾åˆ°äº†&lt;code&gt;nginx-extras&lt;/code&gt;åŒ…é‡Œ. å½“ä»æºç æ„å»ºNGINXæ—¶, å¯ä»¥é€‰æ‹©ä½¿ç”¨é…ç½®å‚æ•°&lt;code&gt;--with-http_secure_link_module&lt;/code&gt;æ¥å¯ç”¨.&lt;/p&gt;
&lt;h3 id="261-location"&gt;2.6.1 åŠ å¯†Location&lt;a class="headerlink" href="#261-location" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªå¯†é’¥æ¥åŠ å¯†ä¸€ä¸ªlocationå—.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨å®‰å…¨é“¾æ¥æ¨¡å—, &lt;code&gt;secure_link_secret&lt;/code&gt;æŒ‡ä»¤æ¥é™åˆ¶å¯¹èµ„æºçš„è®¿é—®çš„ç”¨æˆ·æœ‰ä¸€ä¸ªå®‰å…¨çš„é“¾æ¥:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="k"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/resources&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;secure_link_secret&lt;/span&gt; &lt;span class="s"&gt;mySecret&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;if&lt;/span&gt; &lt;span class="s"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$secure_link&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="kn"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;403&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
        &lt;span class="kn"&gt;rewrite&lt;/span&gt; &lt;span class="s"&gt;^&lt;/span&gt; &lt;span class="s"&gt;/secured/&lt;/span&gt;&lt;span class="nv"&gt;$secure_link&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/secured&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;internal&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/var/www&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¯¥é…ç½®åˆ›å»ºäº†ä¸€ä¸ªå†…éƒ¨å’Œä¸€ä¸ªå¤–éƒ¨çš„locationå—. å¤–éƒ¨çš„locationå—&lt;code&gt;/resources&lt;/code&gt;ä¼šè¿”å›403 Forbidden, é™¤éè¯·æ±‚URIåŒ…å«ä¸€ä¸ª&lt;em&gt;md5&lt;/em&gt;å“ˆå¸Œå­—ç¬¦ä¸², è¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥è¢«&lt;code&gt;secure_link_secret&lt;/code&gt;æŒ‡ä»¤æä¾›çš„secretéªŒè¯. &lt;code&gt;$secure_link&lt;/code&gt;å˜é‡æ˜¯ä¸€ä¸ªç©ºå­—ç¬¦ä¸², é™¤éåœ¨URIçš„å“ˆå¸Œè¢«éªŒè¯.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨secretåŠ å¯†èµ„æºæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç¡®ä¿ä½ çš„æ–‡ä»¶å—ä¿æŠ¤çš„æ–¹æ³•. è¯¥secretç”¨äºå’ŒURIä¸²è” . è¯¥å­—ç¬¦ä¸²ç„¶åä¼šè¢«&lt;code&gt;md5&lt;/code&gt;å“ˆå¸Œ, &lt;code&gt;md5&lt;/code&gt;å“ˆå¸Œåçš„16ç¦æ­¢æ•°å­—è¢«ç”¨åœ¨è¯¥URIä¸­. è¯¥å“ˆå¸Œè¢«æ”¾åˆ°é“¾æ¥ä¸­, ç”±NGINXè®¡ç®—. NGINXä¼šçŸ¥é“URIæƒ³è¦è®¿é—®çš„è·¯å¾„, å› ä¸ºå“ˆå¸Œåå°±åœ¨URIä¸­ . NGINXä¹Ÿä¼šç›´åˆ°ä½ çš„secret, å› ä¸ºæŒ‡ä»¤&lt;code&gt;secure_link_secret&lt;/code&gt;ä¼šæä¾›. NGINXèƒ½å¤Ÿè¿…é€ŸéªŒè¯&lt;code&gt;md5&lt;/code&gt;å“ˆå¸Œ, å¹¶å­˜å‚¨åœ¨URIçš„&lt;code&gt;$secure_link&lt;/code&gt;å˜é‡ä¸­. å¦‚æœå“ˆå¸Œæ— æ³•éªŒè¯, è¯¥å˜é‡å°±æ˜¯ç©ºå­—ç¬¦ä¸². éœ€è¦æ³¨æ„, ä¼ ç»™&lt;code&gt;secure_link_secret&lt;/code&gt;çš„å‚æ•°å¿…é¡»æ˜¯ä¸€ä¸ªé™æ€å­—ç¬¦ä¸², ä¸èƒ½æ˜¯å˜é‡.&lt;/p&gt;
&lt;h3 id="262-secret"&gt;2.6.2 ä½¿ç”¨secretç”Ÿæˆä¸€ä¸ªå®‰å…¨é“¾æ¥&lt;a class="headerlink" href="#262-secret" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦ä½¿ç”¨secretä»ä½ çš„åº”ç”¨ç”Ÿæˆä¸€ä¸ªå®‰å…¨é“¾æ¥.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;NGINXçš„å®‰å…¨é“¾æ¥æ¨¡å—æ¥æ”¶ä¸€ä¸ªmd5å“ˆå¸Œ(URIè·¯å¾„å’Œsecretçš„è”æ¥)è¿‡çš„16è¿›åˆ¶å­—ç¬¦ä¸². åŸºäºä¸Šä¸€èŠ‚, æˆ‘ä»¬ä¼šåˆ›å»ºå®‰å…¨çš„è¿æ¥, å¯ä»¥å·¥ä½œåœ¨ä¸Šä¸ªé…ç½®, æ¯”å¦‚&lt;code&gt;/var/www/secured/index.html&lt;/code&gt;. è¦ç”Ÿæˆmd5å“ˆå¸Œçš„16è¿›åˆ¶å­—ç¬¦ä¸², æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Unix opensslå‘½ä»¤:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s1"&gt;&amp;#39;index.htmlmySecret&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; openssl md5 -hex
&lt;span class="o"&gt;(&lt;/span&gt;stdin&lt;span class="o"&gt;)=&lt;/span&gt; a53bee08a4bf0bbea978ddf736363a12
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¿æŠ¤çš„URI: &lt;em&gt;index.html&lt;/em&gt;; secret: &lt;em&gt;mySecret&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;ä¸‹è¾¹æ˜¯ä½¿ç”¨Python 2.7å’Œ&lt;em&gt;md5&lt;/em&gt;åº“ç”Ÿæˆçš„:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;md5&lt;/span&gt;
&lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;index.htmlmySecret&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;a53bee08a4bf0bbea978ddf736363a12&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é‚£ä¹ˆæˆ‘ä»¬è®¿é—®çš„åœ°å€åº”è¯¥æ˜¯å¦‚ä¸‹æ‰€ç¤º, è¦è®¿é—®&lt;code&gt;/var/www/secured/index.html&lt;/code&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;www.example.com/resources/a53bee08a4bf0bbea978ddf736363a12/\
index.html
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;è¦ç”Ÿæˆè¿™ä¸ªæ•°å­—å¯ä»¥ç”±å¾ˆå¤šç§æ–¹å¼, å¾ˆå¤šè¯­è¨€éƒ½å¯ä»¥å®ç°. è¦è®°ä½çš„æ˜¯: URIè·¯å¾„åœ¨secretä¹‹å‰, å­—ç¬¦ä¸²ä¸­æ²¡æœ‰å›è½¦, å¹¶ä¸”ä½¿ç”¨&lt;em&gt;md5&lt;/em&gt;å“ˆå¸Œçš„16è¿›åˆ¶æ•°å­—.&lt;/p&gt;
&lt;h3 id="263-expire-datelocation"&gt;2.6.3 ä½¿ç”¨Expire DateåŠ å¯†Location&lt;a class="headerlink" href="#263-expire-datelocation" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦ç”Ÿæˆä¸€ä¸ªåœ¨ä¸€æ®µæ—¶é—´åè¿‡æœŸçš„é“¾æ¥.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;åˆ©ç”¨åœ¨å®‰å…¨é“¾æ¥æ¨¡å—çš„å…¶ä»–æŒ‡ä»¤æ¥åœ¨ä½ çš„åŠ å¯†é“¾æ¥ä¸­è®¾ç½®è¿‡æœŸæ—¥å¿—å’Œä½¿ç”¨å˜é‡:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;location&lt;/span&gt; &lt;span class="s"&gt;/resources&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;root&lt;/span&gt; &lt;span class="s"&gt;/var/www&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;secure_link&lt;/span&gt; &lt;span class="nv"&gt;$arg_md5,$arg_expires&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;secure_link_md5&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&lt;/span&gt;&lt;span class="nv"&gt;$secure_link_expires$uri$remote_addr&lt;/span&gt;
   &lt;span class="s"&gt;mySecret&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;if&lt;/span&gt; &lt;span class="s"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$secure_link&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;&amp;quot;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="kn"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;403&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="kn"&gt;if&lt;/span&gt; &lt;span class="s"&gt;(&lt;/span&gt;&lt;span class="nv"&gt;$secure_link&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;0&amp;quot;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="kn"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;410&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;secure_link&lt;/code&gt;æŒ‡ä»¤æœ‰2ä¸ªç”¨é€—å·éš”å¼€çš„å­—æ®µ. ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯&lt;em&gt;md5&lt;/em&gt;å“ˆå¸Œçš„å˜é‡. è¿™ä¸ªä¾‹å­ä½¿ç”¨ä¸€ä¸ªHTTPå‚æ•°çš„md5ã€‚ç¬¬äºŒä¸ªå­—æ®µæ˜¯æ”¾ç½®ä»¥Unixå…ƒå¹´æ—¶é—´æ ¼å¼çš„é“¾æ¥è¿‡æœŸæ—¶é—´çš„å˜é‡. &lt;code&gt;secure_link_md5&lt;/code&gt;æŒ‡ä»¤å ç”¨ä¸€ä¸ªå•ç‹¬çš„å­—æ®µ, å£°æ˜ç”¨äºæ„é€ &lt;em&gt;md5&lt;/em&gt;å“ˆå¸Œçš„çš„æ ¼å¼çš„å­—ç¬¦ä¸². å’Œå…¶ä»–é…ç½®ä¸€æ ·, å¦‚æœhashæ²¡æœ‰é€šè¿‡éªŒè¯, &lt;code&gt;$secure_link&lt;/code&gt;å˜é‡è®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸². æˆ–è€…, å¦‚æœå“ˆå¸ŒåŒ¹é…ä½†æ˜¯æ—¶é—´è¿‡æœŸ, &lt;code&gt;$secure_link&lt;/code&gt;å˜é‡è®¾ç½®ä¸º0.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;è¿™ç§ç”¨æ³•æ¯”ä¹‹å‰2.6.1ä¸­çš„æ›´çµæ´», çœ‹èµ·æ¥æ›´å¹²å‡€. ä½¿ç”¨è¿™äº›æŒ‡ä»¤, ä½ å¯ä»¥ä½¿ç”¨å¯ä»¥ç”¨åœ¨NGINXå“ˆå¸Œå­—ç¬¦ä¸²ä¸­çš„ä»»æ„æ•°é‡çš„å˜é‡. åœ¨å“ˆå¸Œå­—ç¬¦ä¸²ä¸­ä½¿ç”¨ç”¨æˆ·ç›¸å…³çš„å˜é‡ä¼šåŠ å¼ºå®‰å…¨æ€§, å› ä¸ºç”¨æˆ·ä¸èƒ½å¤Ÿå¾—åˆ°åŠ å¯†çš„èµ„æº. æ¨èä½¿ç”¨åƒæ˜¯&lt;code&gt;$remote_addr&lt;/code&gt;æˆ–&lt;code&gt;$http_x_forwarded_for&lt;/code&gt;æˆ–ç”±åº”ç”¨ç”Ÿæˆçš„ä¼šè¯cookieä½œä¸ºå˜é‡. &lt;code&gt;secure_link&lt;/code&gt;çš„å‚æ•°å¯ä»¥æ¥è‡ªä½ å–œæ¬¢çš„ä»»ä½•å˜é‡, ä»–ä»¬å¯ä»¥è¢«å‘½åä¸ºä»»æ„åˆé€‚çš„åå­—. åœ¨&lt;code&gt;$secure_link&lt;/code&gt;å˜é‡ä¸­çš„æ¡ä»¶å¯ä»¥è¢«è®¾ç½®è¿”å›å·²çŸ¥çš„Forbidderå’ŒGoneçš„HTTPä»£ç . HTTP 410, Gone, å¯¹äºè¿‡æœŸé“¾æ¥éå¸¸é€‚ç”¨, å› ä¸ºè¿™ä¸ªæ¡ä»¶è¢«è®¤ä¸ºæ˜¯æ°¸ä¹…çš„.&lt;/p&gt;
&lt;h3 id="264"&gt;2.6.4 ç”Ÿæˆä¸€ä¸ªæœ‰è¿‡æœŸæ—¶é—´çš„é“¾æ¥&lt;a class="headerlink" href="#264" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦ç”Ÿæˆä¸€ä¸ªæœ‰è¿‡æœŸæ—¶é—´çš„é“¾æ¥.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ç”¨Unixæ—¶é—´æˆ³æ ¼å¼ç”Ÿæˆä¸€ä¸ªè¿‡æœŸæ—¶é—´æˆ³. åœ¨Unixç³»ç»Ÿä¸Š, ä½ å¯ä»¥è¿™æ ·æ“ä½œ:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ date -d &lt;span class="s2"&gt;&amp;quot;2020-12-31 00:00&amp;quot;&lt;/span&gt; +%s
&lt;span class="m"&gt;1609390800&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ¥ä¸‹æ¥ä½ éœ€è¦è¿æ¥ç”¨åœ¨&lt;code&gt;secure_link_md5&lt;/code&gt;æŒ‡ä»¤ä¸­çš„å“ˆå¸Œå­—ç¬¦ä¸². åœ¨æœ¬ä¾‹ä¸­, ä½¿ç”¨&lt;code&gt;1293771600/resources/index.html127.0.0.1  mySecret&lt;/code&gt;. md5å“ˆå¸Œå’Œåˆšåˆšçš„16è¿›åˆ¶æ•°å­—æœ‰ä¸€äº›ä¸åŒ. å®ƒæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ ¼å¼çš„md5å“ˆå¸Œ, é‡‡ç”¨base64åŠ å¯†, ç”¨åŠ å·(+)è½¬æ¢ä¸ºè¿æ¥ç¬¦(-), æ–œæ (/)è½¬æ¢ä¸ºä¸‹åˆ’çº¿(_), ç­‰å·(=)è¢«ç§»é™¤. å¦‚ä¸‹æ‰€ç¤º:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;echo&lt;/span&gt; -n &lt;span class="s1"&gt;&amp;#39;1609390800/resources/index.html127.0.0.1 mySecret&amp;#39;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  &lt;span class="p"&gt;|&lt;/span&gt; openssl md5 -binary &lt;span class="se"&gt;\&lt;/span&gt;
  &lt;span class="p"&gt;|&lt;/span&gt; openssl base64 &lt;span class="se"&gt;\&lt;/span&gt;
  &lt;span class="p"&gt;|&lt;/span&gt; tr +/ -_ &lt;span class="se"&gt;\&lt;/span&gt;
  &lt;span class="p"&gt;|&lt;/span&gt; tr -d &lt;span class="o"&gt;=&lt;/span&gt;
81CYyxXFADhLHaQD36_BK
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;å°±å¾—åˆ°äº†å“ˆå¸Œ, æˆ‘ä»¬å¯ä»¥ç”¨å®ƒåè¾¹è·Ÿç€è¿‡æœŸæ—¥æœŸä½œä¸ºå‚æ•°.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;/resources/index.html?md5=81CYyxXFADhLHaQD36_BK&amp;amp;expires=1609390800'&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯ä½¿ç”¨Python 2.7çš„æ ‡å‡†åº“çš„ä¾‹å­:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;datetime&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;base64&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;b64encode&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;md5&lt;/span&gt;
&lt;span class="n"&gt;resource&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;/resources/index.html&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;remote_addr&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;127.0.0.1&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;host&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;www.example.com&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;expire&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2020&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;12&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;31&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;strftime&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;uncoded&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;expire&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;resource&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;remote_addr&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39; mySecret&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;md5hashed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;uncoded&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;digest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;b64&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b64encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;md5hashed&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;hash&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;b64&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;+&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;-&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;_&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;replace&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;=&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;linkformat&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;{}{}?md5={}?expires{}&amp;quot;&lt;/span&gt;
&lt;span class="n"&gt;securelink&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;linkformat&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;host&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="nb"&gt;hash&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="n"&gt;expire&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨è¿™ç§æ–¹å¼, æˆ‘ä»¬èƒ½ç”Ÿæˆç”¨äºURLä¸­çš„ç‰¹æ®Šæ ¼å¼çš„åŠ å¯†é“¾æ¥. æä¾›å®‰å…¨ä¿éšœçš„secretç»ä¸ä¼šå‘ç»™å®¢æˆ·ç«¯. ä½ å¯ä»¥ç”¨å°½å¯èƒ½çš„ä½ éœ€è¦çš„å…¶ä»–å˜é‡æ¥åŠ å¯†location. md5å“ˆå¸Œå’Œbase64åŠ å¯†å¾ˆå¸¸è§, è½»é‡, å‡ ä¹åœ¨æ‰€æœ‰è¯­è¨€ä¸­éƒ½å¯ç”¨.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:15:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-2-6-secure-link.html</guid><category>nginx</category><category>å®‰å…¨</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-å®‰å…¨-ä½¿ç”¨JWT APIçš„å®‰å…¨è®¤è¯</title><link>https://www.EWhisper.cn/nginx-handbook-2-7-jwt-api-auth.html</link><description>&lt;h2 id="27-jwtapi"&gt;2.7 ä½¿ç”¨JWTçš„APIè®¤è¯&lt;a class="headerlink" href="#27-jwtapi" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="270"&gt;2.7.0 ä»‹ç»&lt;a class="headerlink" href="#270" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;JSON Web Tokens (JWTs)è¿…é€Ÿæˆä¸ºä¸€ç§å¹¿ä¸ºä½¿ç”¨å’Œå—æ¬¢è¿çš„è®¤è¯æ–¹å¼. è¿™äº›è®¤è¯tokensæœ‰èƒ½åŠ›å­˜å‚¨ä¸€äº›ç”¨æˆ·å’Œç”¨æˆ·çš„è®¤è¯ä¿¡æ¯åˆ°tokené‡Œ. è¿™äº›tokensä¹Ÿå¯ä»¥å¼‚æ­¥éªŒè¯, è¿™æ„å‘³ç€è´Ÿè½½å‡è¡¡å’Œä»£ç†å¯ä»¥ä½¿ç”¨å…¬é’¥æ¥éªŒè¯è¯¥token, è€Œä¸éœ€è¦ç”¨äºç­¾å‘tokençš„ç§é’¥, ä»¥æ­¤æé«˜å®‰å…¨å’Œçµæ´»æ€§.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;NGINX Plusçš„åŠŸèƒ½, ç•¥è¿‡.&lt;/p&gt;
&lt;/blockquote&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:15:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-2-7-jwt-api-auth.html</guid><category>nginx</category><category>å®‰å…¨</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-å®‰å…¨-HTTP å­è¯·æ±‚è®¤è¯</title><link>https://www.EWhisper.cn/nginx-handbook-2-5-http-subrequest-auth.html</link><description>&lt;h3 id="251"&gt;2.5.1 ä»‹ç»&lt;a class="headerlink" href="#251" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¼´éšç€å¾ˆå¤šä¸åŒçš„è®¤è¯æ–¹æ³•, NGINXé€šè¿‡å¯ç”¨è‡ªè¯·æ±‚mid-flight æ¥ä½¿éªŒè¯è®¤è¯å¹¿æ³›çš„è®¤è¯ç³»ç»Ÿå˜å¾—å®¹æ˜“. HTTPè®¤è¯è¯·æ±‚æ¨¡å—å¯ä»¥å¯ç”¨å¦‚LDAPæˆ–è‡ªå®šä¹‰è®¤è¯å¾®æœåŠ¡çš„è®¤è¯ç³»ç»Ÿ. åœ¨è¯·æ±‚è¢«æ‰§è¡Œä¹‹å‰, è®¤è¯æœºåˆ¶ä¼šä»£ç†è¯¥è¯·æ±‚åˆ°è®¤è¯æœåŠ¡. åœ¨è¿™ä¸ªä»£ç†ä¸­, é€šè¿‡NGINXçš„èƒ½åŠ›å¯ä»¥æ“çºµéœ€è¦èº«ä»½éªŒè¯æœåŠ¡çš„è¯·æ±‚ã€‚å› æ­¤,å®ƒéå¸¸çµæ´»ã€‚&lt;/p&gt;
&lt;h3 id="252"&gt;2.5.2 è®¤è¯å­è¯·æ±‚&lt;a class="headerlink" href="#252" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ æœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„è®¤è¯ç³»ç»Ÿ, è¯·æ±‚è®¤è¯éœ€è¦ç”¨åˆ°è¿™ä¸ªç³»ç»Ÿ.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;http_auth_request_module&lt;/code&gt;åœ¨è¯·æ±‚æ‰§è¡Œå‰, è®©è¯·æ±‚åˆ°å¯¹åº”çš„è®¤è¯æœåŠ¡æ¥è¿›è¡ŒéªŒè¯:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;location&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;private&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="err"&gt;auth_request&lt;/span&gt; &lt;span class="err"&gt;/auth&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="err"&gt;auth_request_set&lt;/span&gt; &lt;span class="err"&gt;$auth_status&lt;/span&gt; &lt;span class="err"&gt;$upstream_status&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="nt"&gt;location&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="nt"&gt;auth&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="err"&gt;internal&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="err"&gt;proxy_pass&lt;/span&gt; &lt;span class="n"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;auth-server&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="err"&gt;proxy_pass_request_body&lt;/span&gt; &lt;span class="err"&gt;off&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="err"&gt;proxy_set_header&lt;/span&gt; &lt;span class="err"&gt;Content-length&lt;/span&gt; &lt;span class="err"&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="err"&gt;proxy_set_header&lt;/span&gt; &lt;span class="err"&gt;X-Original-URI&lt;/span&gt; &lt;span class="err"&gt;$request_uri&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;auth_request&lt;/code&gt;æŒ‡ä»¤ä½¿ç”¨å¿…é¡»æ˜¯local internal locationçš„URIå‚æ•°. &lt;code&gt;auth_request_set&lt;/code&gt;æŒ‡ä»¤å…è®¸ä½ ä»è®¤è¯è‡ªè¯·æ±‚æ¥è®¾ç½®å˜é‡.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;http_auth_request_module&lt;/code&gt;å…è®¸å¯¹æ¯ä¸ªNGINXå¤„ç†çš„è¯·æ±‚åšè®¤è¯. åœ¨å“åº”åŸæœåŠ¡ä¹‹å‰, ä¼šç”Ÿæˆä¸€ä¸ªå­è¯·æ±‚, æ¥å†³å®šè¿™ä¸ªè¯·æ±‚æ˜¯å¦å¯ä»¥è®¿é—®å®ƒè¯·æ±‚çš„èµ„æº.  æ•´ä¸ªè¯·æ±‚ä¼šè¢«ä»£ç†åˆ°è‡ªè¯·æ±‚å— location. é€šè¿‡è‡ªè¯·æ±‚çš„çŠ¶æ€ç æ¥ç¡®å®šæ˜¯å¦å¯ä»¥è®¿é—®èµ„æº. å¦‚æœè‡ªè¯·æ±‚è¿”å›200 HTTP çŠ¶æ€ç , è®¤è¯æˆåŠŸ, è¯·æ±‚è¢«å“åº”. å¦‚æœè¿”å›HTTP 401æˆ–403, ä¼šå‘åŸè¯·æ±‚è¿”å›åŒæ ·çš„ä»£ç .&lt;/p&gt;
&lt;p&gt;å¦‚æœä½ çš„è®¤è¯æœåŠ¡ä¸éœ€è¦è¯·æ±‚body, ä½ å¯ä»¥æŠ›å¼ƒæ‰è¯·æ±‚body, é€šè¿‡&lt;code&gt;proxy_pass_reqeust_body&lt;/code&gt;æŒ‡ä»¤(å¦‚ä¸Šä¾‹å­æ‰€ç¤º). è¿™ä¼šå‡å°‘è¯·æ±‚sizeå’Œæ—¶é—´. å› ä¸ºè¯·æ±‚ä½“è¢«å¿½ç•¥, &lt;code&gt;Content-Length&lt;/code&gt; headerå¯ä»¥è®¾ä¸ºç©ºå­—ç¬¦ä¸². å¦‚æœä½ çš„è®¤è¯æœåŠ¡éœ€è¦ç›´åˆ°åŸè¯·æ±‚çš„URI, ä½ å¯ä»¥æŠŠè¿™ä¸ªå€¼æ”¾åˆ°ä¸€ä¸ªè‡ªå®šä¹‰çš„header, è®©ä½ çš„è®¤è¯æœåŠ¡æ¥æ£€æŸ¥å’ŒéªŒè¯. å¦‚æœä»å­è¯·æ±‚åˆ°è®¤è¯æœåŠ¡è§ä½ æƒ³è¦ä¿ç•™ä¸€äº›ä¸œè¥¿, ä½ å¯ä»¥ä½¿ç”¨  &lt;code&gt;auth_request_set&lt;/code&gt;æŒ‡ä»¤æ¥åˆ›å»ºç›¸åº”æ•°æ®ä¹‹å¤–æ–°çš„å˜é‡.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:13:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-2-5-http-subrequest-auth.html</guid><category>nginx</category><category>å®‰å…¨</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-å®‰å…¨-åŠ å¯†</title><link>https://www.EWhisper.cn/nginx-handbook-2-3-encrypt.html</link><description>&lt;h2 id="23"&gt;2.3 åŠ å¯†&lt;a class="headerlink" href="#23" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="230"&gt;2.3.0 ä»‹ç»&lt;a class="headerlink" href="#230" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ç½‘ç»œæ˜¯ä¸ªå¾ˆå¯æ€•çš„åœ°æ–¹, ä½†ä¸éœ€å¤ªè¿‡æ‹…å¿ƒ. åŠ å¯†ä¼ è¾“ä¿¡æ¯å˜å¾—è¶Šæ¥è¶Šå®¹æ˜“, è¶Šæ¥è¶Šå”¾æ‰‹å¯å¾—, å› ä¸ºç­¾åè¯ä¹¦åœ¨&lt;em&gt;Let's Encrypt&lt;/em&gt;å’Œ&lt;em&gt;Amazon Web Services&lt;/em&gt;å˜å¾—è¶Šæ¥è¶Šä¾¿å®œ. äºŒè€…éƒ½æä¾›æœ‰é™ç”¨é€”çš„å…è´¹è¯ä¹¦. åœ¨æœ¬ç« , æˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•ç¡®ä¿NGINXå’Œå®¢æˆ·ç«¯ä¹‹é—´, ä»¥åŠNGINXå’Œupstreamä¹‹é—´çš„ä¿¡æ¯å®‰å…¨.&lt;/p&gt;
&lt;h3 id="231"&gt;2.3.1 å®¢æˆ·ç«¯åŠ å¯†&lt;a class="headerlink" href="#231" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;éœ€è¦åŠ å¯†NGINXå’Œå®¢æˆ·ç«¯ä¹‹é—´çš„æµé‡.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨SSLæ¨¡å—, å¦‚&lt;code&gt;ngx_http_ssl_module&lt;/code&gt;æˆ–&lt;code&gt;ngx_stream_ssl_module&lt;/code&gt;æ¥åŠ å¯†æµé‡.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;http&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;All&lt;/span&gt; &lt;span class="err"&gt;directives&lt;/span&gt; &lt;span class="err"&gt;used&lt;/span&gt; &lt;span class="err"&gt;below&lt;/span&gt; &lt;span class="err"&gt;are&lt;/span&gt; &lt;span class="err"&gt;also&lt;/span&gt; &lt;span class="err"&gt;valid&lt;/span&gt; &lt;span class="err"&gt;in&lt;/span&gt; &lt;span class="err"&gt;stream&lt;/span&gt;
    &lt;span class="err"&gt;server&lt;/span&gt; &lt;span class="err"&gt;{&lt;/span&gt;
        &lt;span class="err"&gt;listen&lt;/span&gt; &lt;span class="err"&gt;8083&lt;/span&gt; &lt;span class="err"&gt;ssl&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="err"&gt;ssl_protocols&lt;/span&gt;       &lt;span class="err"&gt;TLSv1.2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;åè®®&lt;/span&gt;
        &lt;span class="err"&gt;ssl_ciphers&lt;/span&gt;         &lt;span class="n"&gt;AES128-SHA&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;AES256-SHA&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;å¯†ç å¥—ä»¶&lt;/span&gt;
        &lt;span class="err"&gt;ssl_certificate&lt;/span&gt;     &lt;span class="err"&gt;/usr/local/nginx/conf/cert.pem&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;è¯ä¹¦&lt;/span&gt;
        &lt;span class="err"&gt;ssl_certificate_key&lt;/span&gt; &lt;span class="err"&gt;/usr/local/nginx/conf/cert.key&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;å¯†é’¥&lt;/span&gt;
        &lt;span class="err"&gt;ssl_session_cache&lt;/span&gt;   &lt;span class="n"&gt;shared&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;SSL&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="n"&gt;m&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;sslä¼šè¯ç¼“å­˜&lt;/span&gt;
        &lt;span class="err"&gt;ssl_session_timeout&lt;/span&gt; &lt;span class="err"&gt;10m&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="err"&gt;#&lt;/span&gt; &lt;span class="err"&gt;sslä¼šè¯è¶…æ—¶&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="err"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;ä¸è¦ä½¿ç”¨SSL(Secure Socket Layer)åè®®, 1 - 3ç‰ˆéƒ½è¢«è®¤ä¸ºä¸å®‰å…¨&lt;/li&gt;
&lt;li&gt;TLSæ˜¯é»˜è®¤çš„åè®®(Transport Layer Security), TLSè¿˜ç®—å®‰å…¨.&lt;/li&gt;
&lt;li&gt;å½“ä½¿ç”¨ç­¾åè¯ä¹¦, ä½ éœ€è¦æŠŠè¯ä¹¦å’Œè¯ä¹¦è®¤è¯é“¾è¿æ¥åˆ°ä¸€å—. ä½ çš„è¯ä¹¦åº”è¯¥åœ¨è¯ä¹¦é“¾æ–‡ä»¶çš„ä¸Šæ–¹.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;SSLä¼šè¯ç¼“å­˜, ç¼“å­˜åæ— éœ€negotiate ç‰ˆæœ¬å’Œå¯†ç å¥—ä»¶, å¯ä»¥æå‡æ€§èƒ½.&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="232-upstream"&gt;2.3.2 Upstream åŠ å¯†&lt;a class="headerlink" href="#232-upstream" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä¸ºäº†åˆè§„, æˆ–è€…ä½ çš„upstreamåœ¨ä½ çš„å®‰å…¨ç½‘ç»œä¹‹å¤–, ä½ éœ€è¦åŠ å¯†NGINXå’Œupstreamä¹‹é—´çš„æµé‡.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨HTTP ä»£ç†æ¨¡å—çš„SSLæŒ‡ä»¤&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;location&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="err"&gt;proxy_pass&lt;/span&gt; &lt;span class="n"&gt;https&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;//&lt;/span&gt;&lt;span class="n"&gt;upstream&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;example&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;com&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="err"&gt;proxy_ssl_verify&lt;/span&gt; &lt;span class="err"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="err"&gt;proxy_ssl_verify_depth&lt;/span&gt; &lt;span class="err"&gt;2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="err"&gt;proxy_ssl_protocols&lt;/span&gt; &lt;span class="err"&gt;TLSv1.2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é…ç½®çš„æŒ‡ä»¤ç¡®ä¿NGINXåœ¨upsteamä¸ŠéªŒè¯è¯ä¹¦å’Œè¯ä¹¦é“¾2å±‚è®¤è¯æ·±åº¦æ˜¯åˆæ³•çš„. é»˜è®¤NGINX&lt;strong&gt;ä¸éªŒè¯&lt;/strong&gt;upstreamè¯ä¹¦, æ¥æ”¶æ‰€æœ‰TLSç‰ˆæœ¬.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;å¦‚æœè¦åŠ å¯†upstream æµé‡, ä½ è‡³å°‘åº”è¯¥å¼€å¯éªŒè¯.&lt;/li&gt;
&lt;li&gt;å…¶ä»–å¯ç”¨æŒ‡ä»¤, å¦‚&lt;code&gt;proxy_ssl_certificate&lt;/code&gt;å’Œ&lt;code&gt;proxy_ssl_certificate_key&lt;/code&gt;, å…è®¸ä½ é”å®šupstreamåŠ å¯†ä»¥å¢å¼ºå®‰å…¨æ€§.&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:08:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-2-3-encrypt.html</guid><category>nginx</category><category>å®‰å…¨</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-å®‰å…¨-HTTP åŸºæœ¬è®¤è¯</title><link>https://www.EWhisper.cn/nginx-handbook-2-4-http-basic-auth.html</link><description>&lt;h2 id="24-http"&gt;2.4 HTTPåŸºæœ¬è®¤è¯&lt;a class="headerlink" href="#24-http" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="240"&gt;2.4.0 ä»‹ç»&lt;a class="headerlink" href="#240" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;åŸºæœ¬è®¤è¯æ˜¯ä¸€ä¸ªä¿æŠ¤ç§æœ‰å†…å®¹çš„ç®€å•æ–¹æ³•. è¿™ä¸ªè®¤è¯æ–¹æ³•å¯ä»¥å¾ˆå®¹æ˜“çš„ç”¨äºéšè—&lt;strong&gt;å¼€å‘ç½‘ç«™&lt;/strong&gt;æˆ–è€…éšè—ç‰¹æƒçš„å†…å®¹. æ¨èåœ¨éœ€è¦åŸºæœ¬è®¤è¯çš„locationsæˆ–serversä¸Šè®¾ç½®ä¸€ä¸ªé€Ÿç‡é™åˆ¶æ¥ç»„ç»‡æš´åŠ›æ”»å‡». ä¹Ÿæ¨èå¦‚ä¸Šç« é‚£æ ·, ä½¿ç”¨HTTPS, å› ä¸ºæ¯ä¸ªè®¤è¯è¯·æ±‚, ç”¨æˆ·åå’Œå¯†ç æ˜¯é€šè¿‡base64åŠ å¯†å­—ç¬¦ä¸², ä½œä¸ºä¸€ä¸ªheaderå‘é€åˆ°serverçš„. å¦‚æœä½¿ç”¨HTTP, æ„å‘³ç€ç”¨æˆ·åå’Œå¯†ç éƒ½å¯ä»¥è¢«æ•è·.&lt;/p&gt;
&lt;h3 id="241-user-file"&gt;2.4.1 åˆ›å»ºä¸€ä¸ªUser File&lt;a class="headerlink" href="#241-user-file" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦ä¸€ä¸ªHTTPåŸºæœ¬è®¤è¯ç”¨æˆ·æ–‡ä»¶æ¥å­˜å‚¨ç”¨æˆ·åå’Œå¯†ç .&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;ç”Ÿæˆä¸€ä¸ªä¸‹åˆ—æ ¼å¼çš„æ–‡ä»¶, å¯†ç å¯ä»¥é€šè¿‡ä»¥ä¸‹å…è®¸çš„æ ¼å¼æ¥åŠ å¯†æˆ–å“ˆå¸Œ:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# comment
name1:password1
name2:password2:comment
name3:password3
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;NGINXå¯ä»¥ç†è§£å‡ ç§æ ¼å¼çš„å¯†ç , å…¶ä¸­ä¸€ç§åŠ å¯†æ˜¯ç”¨Cå‡½æ•°&lt;code&gt;crypt()&lt;/code&gt;. è¯¥å‡½æ•°è¢«æš´éœ²ç»™&lt;code&gt;openssl passwd&lt;/code&gt;å‘½ä»¤, å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼ç”ŸæˆåŠ å¯†å­—ç¬¦ä¸²:&lt;/p&gt;
&lt;p&gt;&lt;code&gt;$ openssl passwd MyPassword1234&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;ä¼šè¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸², NGINXå¯ä»¥ç”¨åœ¨å¯†ç æ–‡ä»¶é‡Œ.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥ç”¨Apacheçš„&lt;code&gt;htpasswd&lt;/code&gt;æ¥ç”Ÿæˆå¯†ç . &lt;code&gt;htpasswd&lt;/code&gt;å’Œ&lt;code&gt;openssl&lt;/code&gt; éƒ½ä¼šç”Ÿæˆ&lt;em&gt;apr1&lt;/em&gt; ç®—æ³•çš„å¯†ç . å¯†ç ä¹Ÿå¯ä»¥ç”¨LDAPå’ŒDovecotä½¿ç”¨çš„åŠ ç›sha-1 æ ¼å¼. NGINXæ”¯æŒæ›´å¤šçš„æ ¼å¼å’Œå“ˆå¸Œç®—æ³•, ä½†æ˜¯, å¤§éƒ¨åˆ†éƒ½è¢«è®¤ä¸ºä¸å®‰å…¨, å› ä¸ºå¯ä»¥è¢«è½»æ˜“ç ´è§£.&lt;/p&gt;
&lt;h3 id="242"&gt;2.4.2 ä½¿ç”¨åŸºæœ¬è®¤è¯&lt;a class="headerlink" href="#242" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦ç”¨åŸºæœ¬è®¤è¯æ¥ä¿æŠ¤NGINX locationæˆ–server.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;location / {
    auth_basic          &amp;quot;Private site&amp;quot;;
    auth_basic_user_file conf.d/passwd;
}
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;code&gt;auth_basic&lt;/code&gt;æŒ‡ä»¤å¯ä»¥ç”¨äºHTTP, server, æˆ–locationå—é‡Œ. å½“æœªè®¤è¯ç”¨æˆ·è®¿é—®, &lt;code&gt;auth_basic&lt;/code&gt;æŒ‡ä»¤ä¼šæŠŠå­—ç¬¦ä¸²æ˜¾ç¤ºåˆ°åŸºæœ¬è®¤è¯çš„å¼¹å‡ºçª—å£.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;åŸºæœ¬è®¤è¯é€šè¿‡serverè¿”å›ä¸€ä¸ªå¸¦æœ‰&lt;code&gt;WWW-Authenticate&lt;/code&gt;çš„401æœªè®¤è¯HTTP code. è¯¥headerä¼šæœ‰ä¸€ä¸ªå€¼&lt;code&gt;Basic realm="your string."&lt;/code&gt;. è¯¥å“åº”ä¼šå¯¼è‡´æµè§ˆå™¨æç¤ºè¾“å…¥ç”¨æˆ·åå’Œå¯†ç . è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç ä¼šé€šè¿‡base64åŠ å¯†, é€šè¿‡ä¸€ä¸ªå«åš&lt;code&gt;Authorization&lt;/code&gt;çš„è¯·æ±‚å¤´å‘é€. Serverä¼šæœºå¯†å¯†ç , å¹¶æ ¹æ®&lt;code&gt;auth_basic_user_file&lt;/code&gt;æä¾›çš„å¯†ç åšéªŒè¯. å› ä¸ºç”¨æˆ·åå¯†ç ä»…ä»…æ˜¯é€šè¿‡base64åŠ å¯†. æ‰€ä»¥æ¨èä½¿ç”¨HTTPSä¼ è¾“.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:08:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-2-4-http-basic-auth.html</guid><category>nginx</category><category>å®‰å…¨</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-å®‰å…¨-é™åˆ¶ä½¿ç”¨</title><link>https://www.EWhisper.cn/nginx-handbook-2-2-limit-usage.html</link><description>&lt;h2 id="22"&gt;2.2 é™åˆ¶ä½¿ç”¨&lt;a class="headerlink" href="#22" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="220"&gt;2.2.0 ä»‹ç»&lt;a class="headerlink" href="#220" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;è¯¥ç« èŠ‚å…³æ³¨äº: é™åˆ¶ä½¿ç”¨å’Œæ»¥ç”¨, è¿æ¥æ•°, è¯·æ±‚æœåŠ¡é€Ÿç‡, å¸¦å®½ä½¿ç”¨é‡. åŒºåˆ†å¼€è¿æ¥å’Œè¯·æ±‚æ˜¯å¾ˆé‡è¦çš„: è¿æ¥(TCPè¿æ¥)æ˜¯ç½‘ç»œå±‚, åœ¨è¿™å±‚ä¸Š, è¯·æ±‚è¢«æ‰§è¡Œ, å› æ­¤ä¸¤è€…å¹¶ä¸ä¸€æ ·.&lt;/p&gt;
&lt;p&gt;åœ¨HTTP/1å’ŒHTTP/1.1ä¸­, ä¸€ä¸ªè¿æ¥è¯·æ±‚åªèƒ½ä½¿ç”¨ä¸€æ¬¡; è€Œåœ¨HTTP/2ä¸­, å¤šä¸ªè¯·æ±‚å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªTCPè¿æ¥.&lt;/p&gt;
&lt;h3 id="221"&gt;2.2.1 é™åˆ¶è¿æ¥&lt;a class="headerlink" href="#221" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦åŸºäºé¢„å®šä¹‰çš„keyæ¥é™åˆ¶è¿æ¥æ•°, æ¯”å¦‚keyæ˜¯å®¢æˆ·ç«¯IPåœ°å€.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;åˆ›å»ºä¸€ä¸ªå…±äº«å†…å­˜åŒºåŸŸæ¥å­˜æ”¾è¿æ¥metrics, å¹¶ä½¿ç”¨&lt;code&gt;limit_conn&lt;/code&gt; æŒ‡ä»¤æ¥é™åˆ¶æ‰“å¼€çš„è¿æ¥æ•°:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;http&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kn"&gt;limit_conn_zone&lt;/span&gt; &lt;span class="nv"&gt;$binary_remote_addr&lt;/span&gt; &lt;span class="s"&gt;zone=limitbyaddr:10m&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kn"&gt;limit_conn_status&lt;/span&gt; &lt;span class="mi"&gt;429&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kn"&gt;...&lt;/span&gt;
  &lt;span class="s"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;...&lt;/span&gt;
      &lt;span class="s"&gt;limit_conn&lt;/span&gt; &lt;span class="s"&gt;limitbyaddr&lt;/span&gt; &lt;span class="mi"&gt;40&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;...&lt;/span&gt;
  &lt;span class="err"&gt;}&lt;/span&gt;
&lt;span class="err"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;&lt;img align="absmiddle" alt="âœ”" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2714.png" title=":heavy_check_mark:" width="20px"&gt;  &lt;/p&gt;
&lt;p&gt;429: Too Many Requests&lt;/p&gt;
&lt;p&gt;é¢„å®šä¹‰çš„keyç”¨çš„æ˜¯:äºŒè¿›åˆ¶æ ¼å¼çš„å®¢æˆ·ç«¯IPåœ°å€.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;ä½¿ç”¨IPåœ°å€, å°±åƒä¸Šä¸ªä¾‹å­ä¸­é‚£æ ·, å¦‚æœå¾ˆå¤šç”¨æˆ·éƒ½åœ¨åŒä¸€ä¸ªç½‘ç»œæ¥è‡ªåŒä¸€ä¸ªIPå¯èƒ½å¾ˆå±é™©, æ¯”å¦‚ç”¨çš„æ˜¯ä¸€ä¸ªNAT(ç½‘ç»œåœ°å€è½¬æ¢). æ•´ä¸ªç»„éƒ½ä¼šè¢«é™åˆ¶. &lt;code&gt;limit_conn_zone&lt;/code&gt;æŒ‡ä»¤åªé€‚ç”¨äºHTTPå—. å¯ä»¥åˆ©ç”¨åœ¨HTTPå—ä¸­çš„NGINXçš„ä»»ä½•å˜é‡æ¥æ„å»ºä¸€ä¸ªå­—ç¬¦ä¸²æ¥é™åˆ¶. åˆ©ç”¨å˜é‡å¯ä»¥åœ¨åº”ç”¨çº§åˆ«è¯†åˆ«å…·ä½“çš„ç”¨æˆ·, åƒæ˜¯session cookie, åŸºäºä½¿ç”¨æ¡ˆä¾‹å¯èƒ½æ˜¯ä¸€ä¸ªæ›´å¹²å‡€çš„è§£å†³æ–¹æ¡ˆ. &lt;code&gt;limit_conn&lt;/code&gt;å’Œ&lt;code&gt;limit_conn_status&lt;/code&gt;æŒ‡ä»¤åœ¨HTTP, server, å’Œlocationå—ä¸­éƒ½èƒ½ç”¨. &lt;code&gt;limit_conn_status&lt;/code&gt;é»˜è®¤æ˜¯503, æœåŠ¡ä¸å¯ç”¨. 429ä¼šæ›´åˆé€‚, å› ä¸º500ç•Œåˆ«çš„æœåŠ¡ä¸å¯ç”¨æ„å‘³ç€é”™è¯¯.&lt;/p&gt;
&lt;h3 id="222"&gt;2.2.2 é™åˆ¶é€Ÿç‡&lt;a class="headerlink" href="#222" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;h4&gt;é—®é¢˜&lt;/h4&gt;
&lt;p&gt;ä½ éœ€è¦åŸºäºé¢„å®šä¹‰çš„keyæ¥é™åˆ¶è¯·æ±‚é€Ÿç‡, æ¯”å¦‚å®¢æˆ·ç«¯IPåœ°å€.&lt;/p&gt;
&lt;h4&gt;è§£å†³æ–¹æ¡ˆ&lt;/h4&gt;
&lt;p&gt;åˆ©ç”¨é€Ÿç‡é™åˆ¶æ¨¡å—æ¥é™åˆ¶:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;http&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="kn"&gt;limit_req_zone&lt;/span&gt; &lt;span class="nv"&gt;$binary_remote_addr&lt;/span&gt; &lt;span class="s"&gt;zone=limitbyaddr:10m&lt;/span&gt; &lt;span class="s"&gt;rate=1r/s&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kn"&gt;limit_req_status&lt;/span&gt; &lt;span class="mi"&gt;429&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kn"&gt;...&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="kn"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;...&lt;/span&gt;
      &lt;span class="s"&gt;limit_req&lt;/span&gt; &lt;span class="s"&gt;zone=limitbyaddr&lt;/span&gt; &lt;span class="s"&gt;burst=10&lt;/span&gt; &lt;span class="s"&gt;nodelay&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;...&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¿™ä¸ªzoneç”¨å…³é”®å­—å‚æ•°è®¾ç½®äº†é€Ÿç‡. &lt;code&gt;limit_req&lt;/code&gt;æŒ‡ä»¤æœ‰2ä¸ªå…³é”®å­—å‚æ•°: &lt;code&gt;zone&lt;/code&gt;å’Œ&lt;code&gt;burst&lt;/code&gt;. å½“ç»™å®šzoneçš„è¯·æ±‚é€Ÿç‡è¶…å‡ºäº†, è¯·æ±‚ä¼šå»¶è¿Ÿç›´åˆ°è¾¾åˆ°ä»–ä»¬çš„æœ€å¤§burst size, è¿™ä¸ªç”±&lt;code&gt;burst&lt;/code&gt;å…³é”®å­—å‚æ•°æä¾›. é»˜è®¤&lt;code&gt;burst&lt;/code&gt;å…³é”®å­—å‚æ•°ä¸º0. &lt;code&gt;limit_req&lt;/code&gt;ä¹Ÿæœ‰ç¬¬ä¸‰ä¸ªå¯é€‰çš„å‚æ•°, &lt;code&gt;nodelay&lt;/code&gt;. è¿™ä¸ªå‚æ•°å…è®¸å®¢æˆ·ç«¯åœ¨è¢«é™åˆ¶ä¹‹å‰ä½¿ç”¨å®ƒçš„&lt;code&gt;burst&lt;/code&gt;è€Œä¸ç”¨å»¶è¿Ÿ. &lt;code&gt;limit_req_status&lt;/code&gt; å’Œ&lt;code&gt;limit_req&lt;/code&gt; å¯ä»¥ç”¨åœ¨HTTP, server, å’Œlocation. &lt;code&gt;limit_req_zone&lt;/code&gt;åªé€‚ç”¨äºHTTPå—.&lt;/p&gt;
&lt;h4&gt;è®¨è®º&lt;/h4&gt;
&lt;p&gt;é€Ÿç‡é™åˆ¶æ¨¡å—åœ¨ç»„ç»‡æ¶æ„è¯·æ±‚, åŒæ—¶ä»ä¸ºæ¯ä¸ªäººæä¾›ä¸€å®šè´¨é‡çš„æœåŠ¡æ—¶éå¸¸æœ‰ç”¨. æœ‰å¾ˆå¤šé™åˆ¶è¯·æ±‚é€Ÿç‡çš„åŸå› , å…¶ä¸­ä¹‹ä¸€å°±æ˜¯å®‰å…¨. ä½ å¯ä»¥é€šè¿‡åœ¨ä½ çš„ç™»é™†é¡µé¢è®¾ç½®éå¸¸ä¸¥æ ¼çš„é™åˆ¶æ¥é˜²æ­¢æ¶æ„æ”»å‡». ä½ å¯ä»¥é€šè¿‡è®¾ç½®å¯¹æ‰€æœ‰è¯·æ±‚çš„å®Œå–„çš„é™åˆ¶æ¥é˜»æ­¢æ¶æ„ç”¨æˆ·å°è¯•å¯¹ä½ çš„åº”ç”¨ä½¿ç”¨æ‹’ç»å¼æœåŠ¡æ”»å‡»æˆ–æµªè´¹èµ„æºçš„è®¡åˆ’. é€Ÿç‡é™åˆ¶æ¨¡å—çš„é…ç½®å’Œ2.2.1ä¸­çš„å¾ˆç±»ä¼¼. é€Ÿç‡å¯ä»¥è¢«è®¾ç½®ä¸ºæ¯ç§’å¤šå°‘è¯·æ±‚æˆ–æ¯åˆ†é’Ÿå¤šå°‘è¯·æ±‚. å½“è¶…è¿‡é™åˆ¶, ä¼šè®°å½•äº‹ä»¶æ—¥å¿—. ä¾‹å­ä¸­æ²¡æœ‰æåˆ°è¿™ä¸ªæŒ‡ä»¤&lt;code&gt;limit_req_log_level&lt;/code&gt; , é»˜è®¤æ˜¯&lt;code&gt;error&lt;/code&gt;, ä½†æ˜¯ä¹Ÿå¯ä»¥è®¾ç½®ä¸º&lt;code&gt;info&lt;/code&gt; , &lt;code&gt;notice&lt;/code&gt;, &lt;code&gt;warn&lt;/code&gt;.&lt;/p&gt;
&lt;h3 id="223"&gt;2.2.3 é™åˆ¶å¸¦å®½&lt;a class="headerlink" href="#223" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;blockquote&gt;
&lt;p&gt;å¾…è¡¥å……&lt;/p&gt;
&lt;/blockquote&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:05:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-2-2-limit-usage.html</guid><category>nginx</category><category>å®‰å…¨</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX å®æˆ˜æ‰‹å†Œ-å®‰å…¨-è®¿é—®æ§åˆ¶</title><link>https://www.EWhisper.cn/nginx-handbook-2-1-control-access.html</link><description>&lt;h2 id="211"&gt;2.1.1 ä»‹ç»&lt;a class="headerlink" href="#211" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;æ§åˆ¶ä½ çš„webåº”ç”¨æˆ–ä½ çš„webåº”ç”¨çš„å­ç½‘çš„è®¿é—®æ˜¯å¾ˆé‡è¦çš„ä¸šåŠ¡. åœ¨NGINXä¸­, è®¿é—®æ§åˆ¶æœ‰å¤šç§å½¢å¼, åƒæ˜¯åœ¨ç½‘ç»œå±‚æ‹’ç»æ‰, åŸºäºè®¤è¯ç­–ç•¥çš„å…è®¸, æˆ– HTTPæŒ‡ä»¤æµè§ˆå™¨å¦‚ä½•å“åº”. æœ¬ç« æˆ‘ä»¬å°†è®¨è®ºåŸºäºç½‘ç»œå±æ€§, è®¤è¯å’Œå¦‚ä½•é˜²æ­¢&lt;em&gt;è·¨åŸŸèµ„æºå…±äº«(Cross-Origin Resource Sharing(CORS))&lt;/em&gt;çš„è®¿é—®æ§åˆ¶.&lt;/p&gt;
&lt;h2 id="212-ip"&gt;2.1.2 åŸºäºIPåœ°å€çš„è®¿é—®&lt;a class="headerlink" href="#212-ip" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="_1"&gt;é—®é¢˜&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä½ éœ€è¦åŸºäºå®¢æˆ·ç«¯çš„IPåœ°å€çš„æ§åˆ¶.&lt;/p&gt;
&lt;h3 id="_2"&gt;è§£å†³æ–¹æ¡ˆ&lt;a class="headerlink" href="#_2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä½¿ç”¨HTTPè®¿é—®æ¨¡å—æ¥æ§åˆ¶å¯¹å—ä¿æŠ¤èµ„æºçš„è®¿é—®:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;location&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
  &lt;span class="err"&gt;deny&lt;/span&gt; &lt;span class="err"&gt;10.0.0.1&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="err"&gt;allow&lt;/span&gt; &lt;span class="err"&gt;10.0.0.0/20&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="err"&gt;allow&lt;/span&gt; &lt;span class="err"&gt;2001:0&lt;/span&gt;&lt;span class="n"&gt;db8&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="o"&gt;:/&lt;/span&gt;&lt;span class="mi"&gt;32&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
  &lt;span class="err"&gt;deny&lt;/span&gt; &lt;span class="err"&gt;all&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;åœ¨HTTP, server, å’Œlocationä¸Šä¸‹æ–‡ä¸­, &lt;code&gt;allow&lt;/code&gt;å’Œ&lt;code&gt;deny&lt;/code&gt;æŒ‡ä»¤æä¾›å¯¹ç»™å‡ºçš„client, IP, CIDR range, Unix socket, æˆ–all å…³é”®å­—çš„å…è®¸å’Œç¦æ­¢è®¿é—®çš„èƒ½åŠ›. è§„åˆ™è¢«ä¾æ¬¡æ£€æŸ¥, ç›´åˆ°å‘ç°åŒ¹é…çš„åœ°å€.&lt;/p&gt;
&lt;h3 id="_3"&gt;è®¨è®º&lt;a class="headerlink" href="#_3" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¿æŠ¤åœ¨äº’è”ç½‘ä¸Šçš„æœ‰ä»·å€¼çš„èµ„æºå’ŒæœåŠ¡å¿…é¡»åœ¨å¯¹åº”çš„å±‚ä¸Šåš. NGINXæä¾›å¯¹å…¶ä¸­ä¸€äº›å±‚çš„èƒ½åŠ›. &lt;code&gt;deny&lt;/code&gt; æŒ‡ä»¤ç»„ç»‡è®¿é—®ç»™å®šçš„ä¸Šä¸‹æ–‡, &lt;code&gt;allow&lt;/code&gt;æŒ‡ä»¤å¯ä»¥ç”¨äºé™åˆ¶è®¿é—®. ä½ å¯ä»¥ä½¿ç”¨IPåœ°å€, IPv4æˆ–IPv6, CIDR block ranges, å…³é”®å­—&lt;code&gt;all&lt;/code&gt;, å’ŒUnix socket. é€šå¸¸è¦ä¿æŠ¤æŸä¸ªèµ„æº, åº”è¯¥å…è®¸ç‰¹å®šåŒºåŸŸçš„å†…ç½‘IPåœ°å€, å¹¶æ‹’ç»æ‰€æœ‰.&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 20:00:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-handbook-2-1-control-access.html</guid><category>nginx</category><category>å®‰å…¨</category><category>è¯‘æ–‡</category><category>æœ€ä½³å®è·µ</category></item><item><title>NGINX é…ç½®SSL æ”¯æŒ</title><link>https://www.EWhisper.cn/nginx-conf-add-ssl-support.html</link><description>&lt;p&gt;&lt;img alt="nginx+ssl" src="./images/nginx-ssl-certificate.jpg"&gt;&lt;/p&gt;
&lt;h2 id="_1"&gt;å‰è¨€&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;a href="https://www.EWhisper.cn/tencentyun-apply-ssl-certificate.html"&gt;ä¸Šç¯‡æ–‡ç« &lt;/a&gt;ä¸­, æˆ‘ä»¬å·²ç»ç”³è¯·å¥½äº†SSLè¯ä¹¦. é‚£ä¹ˆç°åœ¨, æˆ‘ä»¬å°±è¦é…ç½®å…¨ç«™SSLäº†! &lt;img align="absmiddle" alt="ğŸ’ª" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4aa.png" title=":muscle:" width="20px"&gt;&lt;img align="absmiddle" alt="ğŸ’ª" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4aa.png" title=":muscle:" width="20px"&gt;&lt;img align="absmiddle" alt="ğŸ’ª" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4aa.png" title=":muscle:" width="20px"&gt;&lt;/p&gt;
&lt;p&gt;è¿™æ¬¡çš„å·¥ä½œä¸»è¦æ˜¯NGINXçš„é…ç½®, åŒæ—¶ä¼šæœ‰ä¸€äº›æˆ‘çš„åšå®¢æœ¬èº«çš„é…ç½®.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;åšå®¢æœ¬èº«é…ç½®æ›´æ”¹åŒ…æ‹¬: (è¿™ç¯‡æ–‡ç« å°±å…ˆä¸ç»†è¯´äº†)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ç½‘é¡µå†…é“¾æ¥å…¨éƒ¨ä»httpæ”¹ä¸ºhttps(å…¶å®é…ç½®ä¸‹SITEURL, å·¥å…·ä¼šè‡ªåŠ¨ç”Ÿæˆå¥½) å¹¶é‡æ–°å‘å¸ƒ. (ç‰¹åˆ«è¦æ³¨æ„, å¦‚æœæœ‰çš„ç«™å†…css, jsç­‰æ²¡æœ‰ç”¨httpså°±å°´å°¬äº†, ä¼šè¢«å„ç±»æµè§ˆå™¨æ‹¦æˆªæ‰, å¹¶æç¤º"ä¸å®‰å…¨çš„è„šæœ¬")&lt;/li&gt;
&lt;li&gt;ç½‘ç«™æœ‰ç”¨åˆ°çš„ç¬¬ä¸‰æ–¹å·¥å…·(å¦‚æ‹¨æµ‹), æŠŠç½‘ç«™çš„åœ°å€æ”¹ä¸º httpså¼€å¤´çš„.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h2 id="nginx"&gt;NGINXé…ç½®&lt;a class="headerlink" href="#nginx" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆ, åˆ›å»ºå¹¶ä¸Šä¼ å‡†å¤‡å¥½çš„è¯ä¹¦æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•: (crtå’Œkeyæ–‡ä»¶)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo mkdir -p /etc/pki/nginx/
&lt;span class="c1"&gt;# é€šè¿‡sftpä¸Šä¼ åˆ°è¯¥ç›®å½•&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¿›è¡Œnginx.conf çš„sslé…ç½®, æœ¬æ¬¡ä¸»è¦æ¶‰åŠåˆ°serverå—çš„é…ç½®æ›´æ”¹, å¦‚ä¸‹: (å…·ä½“çš„æŒ‡ä»¤ä½œç”¨è§æ³¨é‡Š)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;    &lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;listen&lt;/span&gt;       &lt;span class="mi"&gt;80&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;server_name&lt;/span&gt;  &lt;span class="s"&gt;www.ewhisper.cn&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;301&lt;/span&gt; &lt;span class="s"&gt;https://&lt;/span&gt;&lt;span class="nv"&gt;$host$request_uri&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="kn"&gt;listen&lt;/span&gt;       &lt;span class="mi"&gt;443&lt;/span&gt; &lt;span class="s"&gt;ssl&lt;/span&gt; &lt;span class="s"&gt;http2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;server_name&lt;/span&gt;  &lt;span class="s"&gt;www.ewhisper.cn&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
        &lt;span class="kn"&gt;root&lt;/span&gt;         &lt;span class="s"&gt;/usr/share/nginx/html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# é™æ€åšå®¢çš„å­˜æ”¾ä½ç½®&lt;/span&gt;

        &lt;span class="kn"&gt;ssl_certificate&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/etc/pki/nginx/1_www.ewhisper.cn_bundle.crt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# è¯ä¹¦è·¯å¾„&lt;/span&gt;
        &lt;span class="kn"&gt;ssl_certificate_key&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;/etc/pki/nginx/2_www.ewhisper.cn.key&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# è¯ä¹¦å¯†é’¥è·¯å¾„&lt;/span&gt;
        &lt;span class="kn"&gt;ssl_session_cache&lt;/span&gt; &lt;span class="s"&gt;shared:SSL:50m&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# ssl session cacheåˆ†é…50mç©ºé—´, ç¼“å­˜ssl session&lt;/span&gt;
        &lt;span class="kn"&gt;ssl_session_timeout&lt;/span&gt;  &lt;span class="s"&gt;1d&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# ssl session è¶…æ—¶æ—¶é—´ä¸º1å¤©&lt;/span&gt;
        &lt;span class="kn"&gt;ssl_session_tickets&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# ssl session ticket æœºåˆ¶, éƒ¨åˆ†ç‰ˆæœ¬æœ‰bug, è§†æƒ…å†µå¼€å¯.&lt;/span&gt;

        &lt;span class="kn"&gt;ssl_protocols&lt;/span&gt; &lt;span class="s"&gt;TLSv1.2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# ssl åè®®ç‰ˆæœ¬&lt;/span&gt;
        &lt;span class="kn"&gt;ssl_ciphers&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# ssl ciphers&lt;/span&gt;
        &lt;span class="kn"&gt;ssl_prefer_server_ciphers&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# å€¾å‘äºä½¿ç”¨serverç«¯çš„ciphers&lt;/span&gt;

        &lt;span class="c1"&gt;# HSTS 6 months&lt;/span&gt;
        &lt;span class="kn"&gt;add_header&lt;/span&gt; &lt;span class="s"&gt;Strict-Transport-Security&lt;/span&gt; &lt;span class="s"&gt;max-age=15768000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  
        &lt;span class="c1"&gt;# æ·»åŠ ä¸ªhttp header, å‘Šè¯‰æµè§ˆå™¨ç›´æ¥è½¬åˆ°https, æ­¤åŠŸèƒ½æœ‰é£é™©, æ…é‡é€‰æ‹©. &lt;/span&gt;
        &lt;span class="c1"&gt;# (æ¯”å¦‚ä½ çš„è¯ä¹¦è¿‡æœŸå¿˜è®°ç»­äº†, é‚£ä¹ˆç”¨æˆ·æƒ³è½¬åˆ°httpéƒ½æ²¡åŠæ³•)&lt;/span&gt;

        &lt;span class="kn"&gt;ssl_stapling&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# å¯ç”¨ssl OCSP staplingåŠŸèƒ½, æœåŠ¡ç«¯ä¸»åŠ¨æŸ¥è¯¢OCSPç»“æœ, æé«˜TLSæ•ˆç‡&lt;/span&gt;
        &lt;span class="kn"&gt;ssl_stapling_verify&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# å¼€å¯OCSP stapling éªŒè¯&lt;/span&gt;

        &lt;span class="c1"&gt;# Load configuration files for the default server block.&lt;/span&gt;
        &lt;span class="kn"&gt;include&lt;/span&gt; &lt;span class="s"&gt;/etc/nginx/default.d/*.conf&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;  &lt;span class="c1"&gt;# æˆ‘çš„åšå®¢çš„locationåœ¨è¿™é‡Œé…ç½®&lt;/span&gt;

        &lt;span class="c1"&gt;#location / {&lt;/span&gt;
        &lt;span class="c1"&gt;#}&lt;/span&gt;

        &lt;span class="kn"&gt;error_page&lt;/span&gt; &lt;span class="mi"&gt;404&lt;/span&gt; &lt;span class="s"&gt;/404.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/40x.html&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;

        &lt;span class="kn"&gt;error_page&lt;/span&gt; &lt;span class="mi"&gt;500&lt;/span&gt; &lt;span class="mi"&gt;502&lt;/span&gt; &lt;span class="mi"&gt;503&lt;/span&gt; &lt;span class="mi"&gt;504&lt;/span&gt; &lt;span class="s"&gt;/50X.html&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
            &lt;span class="kn"&gt;location&lt;/span&gt; &lt;span class="p"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/50X.html&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
        &lt;span class="p"&gt;}&lt;/span&gt;
    &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;blockquote&gt;
&lt;p&gt;&lt;img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"&gt; è¯´æ˜:&lt;/p&gt;
&lt;p&gt;ä»¥ä¸Šçš„æŸäº›æŒ‡ä»¤, æˆ‘å…ˆå¤§æ¦‚ä»‹ç»ä¸‹, åç»­ä¼šæœ‰æ–‡ç« åšè¯¦ç»†ä»‹ç».&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;return 301 https://$host$request_uri;&lt;/code&gt;   HTTPçš„å…¨éƒ¨æ°¸ä¹…é‡å®šå‘åˆ°httpså¯¹åº”çš„URL&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/usr/share/nginx/html&lt;/code&gt;  é™æ€åšå®¢çš„å­˜æ”¾ä½ç½®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ssl_session_timeout  1d;&lt;/code&gt;  ssl session è¶…æ—¶æ—¶é—´ä¸º1å¤©&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ssl_session_tickets off;  #&lt;/code&gt;  ssl session ticket æœºåˆ¶, éƒ¨åˆ†ç‰ˆæœ¬æœ‰bug, è§†æƒ…å†µå¼€å¯.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ssl_prefer_server_ciphers on;&lt;/code&gt;  å€¾å‘äºä½¿ç”¨serverç«¯çš„ciphers&lt;/li&gt;
&lt;li&gt;HSTSåŠŸèƒ½:ã€€æ·»åŠ ä¸ªHTTP header, å‘Šè¯‰æµè§ˆå™¨ç›´æ¥è½¬åˆ°https, &lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;æ­¤åŠŸèƒ½æœ‰é£é™©, æ…é‡é€‰æ‹©.  (æ¯”å¦‚ä½ çš„è¯ä¹¦è¿‡æœŸå¿˜è®°ç»­äº†, é‚£ä¹ˆç”¨æˆ·æƒ³è½¬åˆ°HTTPéƒ½æ²¡åŠæ³•)&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ssl_stapling on;&lt;/code&gt;  å¯ç”¨ssl OCSP staplingåŠŸèƒ½, æœåŠ¡ç«¯ä¸»åŠ¨æŸ¥è¯¢OCSPç»“æœ, æé«˜TLSæ¡æ‰‹æ•ˆç‡&lt;/li&gt;
&lt;li&gt;&lt;code&gt;/etc/nginx/default.d/*.conf;&lt;/code&gt;  æˆ‘çš„åšå®¢&lt;code&gt;location&lt;/code&gt;é…ç½®&lt;br&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;br/&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"&gt; å°æŠ€å·§:&lt;/p&gt;
&lt;p&gt;ç«ç‹æµè§ˆå™¨èƒŒåçš„åŸºé‡‘ä¼š, å¼€æºäº†ä¸€ä¸ªéå¸¸å¥½ç”¨çš„å·¥å…·: &lt;a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/"&gt;ssl-config-generator&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;åœ¨è¿™ä¸Šè¾¹, ç‚¹ä¸€ç‚¹å°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆæ¨èçš„SSLé…ç½®äº†.&lt;/p&gt;
&lt;p&gt;&lt;img alt="ssl-config-generator" src="./images/ssl-config-generator.png"&gt;&lt;/p&gt;
&lt;p&gt;æä¸€ç‚¹, å¦‚ä¸Šå›¾æ‰€ç¤º, ç¬¬äºŒåˆ—ä¸€å®šè¦æ ¹æ®ä½ çš„å®¢æˆ·æµè§ˆå™¨æˆ–å®¢æˆ·ç«¯çš„ç‰ˆæœ¬ä½¿ç”¨æƒ…å†µæ…é‡é€‰æ‹©. &lt;/p&gt;
&lt;p&gt;æ¯”å¦‚, ç”¨æˆ·è¿˜åœ¨ç”¨Windows XP, IE6, Java 6, é‚£ä¹ˆåªèƒ½é€‰æ‹©Old.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¥ä¸‹æ¥, å°±æ˜¯è¦é‡å¯nginxæ¥ç”Ÿæ•ˆäº†. &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ sudo nginx -t  &lt;span class="c1"&gt;# æµ‹è¯•é…ç½®, æ²¡é—®é¢˜å†é‡å¯&lt;/span&gt;
$ sudo systemctl reload nginx.service
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;é‡å¯å, æµ‹è¯•å‘ç° css jséƒ½æ²¡æœ‰ç”Ÿæ•ˆ. &lt;img align="absmiddle" alt="ğŸ˜±" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f631.png" title=":scream:" width="20px"&gt;&lt;img align="absmiddle" alt="ğŸ˜±" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f631.png" title=":scream:" width="20px"&gt;&lt;img align="absmiddle" alt="ğŸ˜±" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f631.png" title=":scream:" width="20px"&gt;&lt;/p&gt;
&lt;p&gt;å› ä¸ºä¹‹å‰nginxåˆšé…ç½®è¿‡ç¼“å­˜. å½“æ—¶è„‘å­æ²¡è½¬è¿‡æ¥, æ²¡æœ‰ç¬¬ä¸€æ—¶é—´æ„è¯†åˆ°å¯èƒ½æ˜¯æµè§ˆå™¨ç¼“å­˜çš„é—®é¢˜. å°±ç›´æ¥nginx stop å†startäº†ä¸‹. ç»“æœæ‚²å‚¬çš„æˆ‘çš„ç½‘ç«™å¯ç”¨æ€§å°±ä»100%è·Œåˆ°99.81%äº†.&lt;/p&gt;
&lt;p&gt;&lt;img alt="ç½‘ç«™å¯ç”¨æ€§" src="images/index.png"&gt;&lt;/p&gt;
&lt;p&gt;åæ¥ç»ˆäºæ„è¯†åˆ°å¯èƒ½æ˜¯æµè§ˆå™¨ç¼“å­˜çš„é—®é¢˜äº†, æ¸…ç†äº†ç¼“å­˜å, å†å¯åŠ¨, ç»ˆäºé¡µé¢æ˜¾ç¤ºæ­£å¸¸, å›¾æ ‡ä¹Ÿä»"ä¸å®‰å…¨"å˜æˆäº†å°é”.&lt;/p&gt;
&lt;p&gt;&lt;img alt="" src="./images/ssl-ewhisper.png"&gt;&lt;/p&gt;
&lt;p&gt;æµ‹è¯•è®¿é—®http://www.ewhisper.cn, ä¹Ÿä¼šè¢«å¼ºåˆ¶è½¬åˆ° https://www.ewhisper.cn. å®Œç¾!&lt;img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"&gt;&lt;img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"&gt;&lt;img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"&gt;&lt;/p&gt;
&lt;h2 id="ssl"&gt;æˆ‘çš„SSLè¯„çº§&lt;a class="headerlink" href="#ssl" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;å†æ¥ä»‹ç»ä¸ªå¥½ä¸œè¥¿ - &lt;a href="https://www.ssllabs.com/ssltest/analyze.html"&gt;SSL Labs&lt;/a&gt;. å¯ä»¥å¯¹ä½ çš„ç½‘ç«™è¿›è¡ŒSSL å®‰å…¨è¯„çº§. &lt;/p&gt;
&lt;p&gt;ç‚¹å‡»é“¾æ¥, è¾“å…¥ç½‘ç«™åœ°å€, å–æ¯èŒ¶, ç»“æœå°±å‡ºæ¥äº† - &lt;strong&gt;A+&lt;/strong&gt; å“ˆå“ˆå“ˆå“ˆå“ˆ!!!!&lt;/p&gt;
&lt;p&gt;&lt;img alt="æˆ‘çš„ç½‘ç«™SSLè¯„åˆ†" src="./images/ewhisper-ssl-report.png"&gt;&lt;/p&gt;
&lt;p&gt;æœ€åé™„ä¸Šæˆ‘çš„&lt;a href="https://www.EWhisper.cn/assets/SSL_Server_Test_ www.ewhisper.cn.pdf"&gt;å®Œæ•´æŠ¥å‘Š&lt;/a&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Wed, 19 Jun 2019 19:26:20 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-06-19:/nginx-conf-add-ssl-support.html</guid><category>nginx</category><category>ssl</category><category>æ‹¨æµ‹</category><category>å¯ç”¨æ€§</category></item><item><title>æˆ‘çš„ä¸ªäººåšå®¢è¿ç§»åˆ°Dockerå•¦</title><link>https://www.EWhisper.cn/ewhisper-blog-moved-to-docker.html</link><description>&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;ç½‘ç«™æ¶æ„&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#_2"&gt;æ•°æ®æµå‘&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_3"&gt;ç½‘ç«™æ¶æ„&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_4"&gt;å®¹å™¨åŒ–ç®€å•æ­¥éª¤&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#nginx"&gt;ç›´æ¥å¯åŠ¨NGINXå®¹å™¨&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_5"&gt;å…¶ä»–å®¹å™¨åŒ–æ–¹å¼&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#dockerfile"&gt;Dockerfile å°è£…é•œåƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#-docker-compose"&gt;ç®€å•å®¹å™¨ç¼–æ’å·¥å…· - docker compose&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_6"&gt;æŸ¥çœ‹çŠ¶æ€å’Œæ—¥å¿—&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;p&gt;2019å¹´5æœˆ10æ—¥èµ·, æˆ‘çš„ä¸ªäººåšå®¢ - https://www.EWhisper.cn æ­£å¼è¿è¡Œåœ¨dockeré‡Œè¾¹äº†! &lt;img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"&gt;&lt;img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"&gt;&lt;img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"&gt; &lt;/p&gt;
&lt;p&gt;æˆ‘æŠŠç›¸å…³çš„æºç , Dockeré•œåƒåˆ†åˆ«ä¸Šä¼ åˆ°äº†GitHubå’ŒDocker Hub. åœ°å€å¦‚ä¸‹:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GitHub: https://github.com/east4ming/my-tencentyun-nginx&lt;/li&gt;
&lt;li&gt;Docker Hub: https://cloud.docker.com/u/caseycui/repository/docker/caseycui/my-tencentyun-nginx&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="æ¬¢è¿ä¸Š&amp;quot;èˆ¹&amp;quot;" src="./images/illustration-com-container-party.png"&gt;&lt;/p&gt;
&lt;h2 id="_1"&gt;ç½‘ç«™æ¶æ„&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="_2"&gt;æ•°æ®æµå‘&lt;a class="headerlink" href="#_2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;æˆ‘çš„åšå®¢ç½‘ç«™çš„æ¶æ„å…¶å®&lt;strong&gt;éå¸¸éå¸¸&lt;/strong&gt;ç®€å•. è¯´ç™½äº†, å°±æ˜¯&lt;strong&gt;NGINX + é™æ€é¡µé¢&lt;/strong&gt;. (å¯¹çš„, ä½ æ²¡æœ‰çœ‹é”™, æˆ‘çš„ç½‘ç«™æ˜¯ä¸ªå…¨é™æ€ç½‘ç«™, æ²¡æœ‰åŠ¨æ€é¡µé¢). &lt;/p&gt;
&lt;p&gt;ä¹‹å‰çš„æ•°æ®æµå‘å¤§æ¦‚æ˜¯:&lt;/p&gt;
&lt;p&gt;ç”¨æˆ· -&amp;gt; åŸŸå -&amp;gt; DNS -&amp;gt; è…¾è®¯äº‘ä¸»æœºå¤–ç½‘IP -&amp;gt; è…¾è®¯äº‘ä¸»æœºå†…ç½‘IP -&amp;gt; NGINX 80å’Œ443ç«¯å£  (NGINXä½œä¸ºWeb Server, åç«¯æ²¡æœ‰App Serverå’ŒDB)&lt;/p&gt;
&lt;p&gt;ç°åœ¨åŠ äº†ä¸€å±‚Docker, å¤šäº†ä¸€å±‚ ä¸»æœº -&amp;gt; docker sdnçš„è½¬å‘. å¦‚ä¸‹:&lt;/p&gt;
&lt;p&gt;ç”¨æˆ· -&amp;gt; åŸŸå -&amp;gt; DNS -&amp;gt; è…¾è®¯äº‘ä¸»æœºå¤–ç½‘IP -&amp;gt; è…¾è®¯äº‘ä¸»æœºå†…ç½‘IP -&amp;gt; &lt;strong&gt;Docker SDNç«¯å£æ˜ å°„&lt;/strong&gt;(443æŒ‡å‘dockerçš„443, 80ä¹‹ä¸‹é‚£ä¸ªdockerçš„80) -&amp;gt; Dockerçš„NGINXå®¹å™¨çš„ 80å’Œ443ç«¯å£ &lt;/p&gt;
&lt;h3 id="_3"&gt;ç½‘ç«™æ¶æ„&lt;a class="headerlink" href="#_3" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä»å¤´å¼€å§‹è¯´èµ·å§, æˆ‘çš„åšå®¢æ˜¯ä¸€ä¸ª&lt;strong&gt;é™æ€ç«™ç‚¹&lt;/strong&gt;. &lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘å†™åšæ–‡æ˜¯å…ˆé€šè¿‡MarkDown å†™.mdæ ¼å¼çš„æ–‡æœ¬.&lt;/li&gt;
&lt;li&gt;ç„¶åé€šè¿‡&lt;strong&gt;é™æ€ç«™ç‚¹ç”Ÿæˆå™¨&lt;/strong&gt;(static site generator) -- &lt;a href="http://www.getpelican.com/"&gt;Pelican&lt;/a&gt; (æˆ‘ç”¨çš„è¿™ä¸ªä¸ç®—æœ€ä¸»æµçš„, ä¸»æµçš„å¦‚: Hexoç­‰)å°†æˆ‘çš„MarkDown æ–‡æœ¬, æ ¹æ®Pelicanä¸­å®šä¹‰çš„ä¸»é¢˜, æ¸²æŸ“ä¸ºä¸€ä¸ªç›¸åº”é£æ ¼HTMLæ–‡ä»¶. &lt;/li&gt;
&lt;li&gt;æ•´ä¸ªç«™ç‚¹, åŒ…æ‹¬ä»¥ä¸‹å†…å®¹éƒ½æ˜¯ä¸€ä¸ªä¸ªçš„HTMLé¡µé¢.&lt;ol&gt;
&lt;li&gt;Indexé¡µé¢&lt;/li&gt;
&lt;li&gt;about  å’Œ contact é¡µé¢&lt;/li&gt;
&lt;li&gt;æ ‡ç­¾ ç±»åˆ«é¡µé¢&lt;/li&gt;
&lt;li&gt;RSS è®¢é˜…é¡µé¢&lt;/li&gt;
&lt;li&gt;æ¯ä¸€ç¯‡åšæ–‡&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;æ•´ä¸ªç½‘ç«™å‘¢, å®é™…ä¸Šå°±æ˜¯:&lt;ol&gt;
&lt;li&gt;HTML(å’ŒCSS JS)&lt;/li&gt;
&lt;li&gt;é™æ€å†…å®¹(å¦‚: å›¾ç‰‡, å›¾ç‰‡ç›®å‰éƒ¨åˆ†åœ¨æœ¬åœ°, éƒ¨åˆ†è°ƒç”¨å›¾åºŠå¤–é“¾å¦‚&lt;a href="https://www.yupoo.com"&gt;åˆæ‹&lt;/a&gt; ä¸ƒç‰› CNDç­‰)&lt;/li&gt;
&lt;li&gt;å…¶ä»–åŠŸèƒ½é€šè¿‡æ’ä»¶(ä¹Ÿæ˜¯JS, å¤–éƒ¨çš„JS)å®ç°, å¦‚:&lt;ol&gt;
&lt;li&gt;è¯„è®ºæ¡† (å›½å†…å¯èƒ½çœ‹ä¸è§, è¢«å±è”½äº†....)&lt;/li&gt;
&lt;li&gt;è½¬å‘æ¡&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Pelican ç”Ÿæˆçš„æ‰€æœ‰çš„é™æ€ç«™ç‚¹å†…å®¹, éƒ½å…¨éƒ¨é€šè¿‡rsyncç­‰å·¥å…·åŒæ­¥åˆ°æˆ‘çš„è…¾è®¯äº‘ä¸»æœºçš„&lt;code&gt;/usr/share/nginx/html&lt;/code&gt; ç›®å½•ä¸‹, å¹¶å¯åŠ¨NGINX, é…ç½®80, 443ç«¯å£ç›‘å¬å¹¶å¤„ç†é™æ€å†…å®¹å°±å¯ä»¥äº†.  &lt;ol&gt;
&lt;li&gt;ä»¥å‰, æˆ‘æ˜¯ç›´æ¥é€šè¿‡&lt;code&gt;systemctl&lt;/code&gt; åœ¨äº‘ä¸»æœºä¸Šå¯åŠ¨çš„NGINX&lt;/li&gt;
&lt;li&gt;ç°åœ¨, æ˜¯é€šè¿‡dockerå¯åŠ¨çš„NGINXé•œåƒ.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="_4"&gt;å®¹å™¨åŒ–ç®€å•æ­¥éª¤&lt;a class="headerlink" href="#_4" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;å› ä¸ºæˆ‘è¿™ä¸ªåªæ¶‰åŠNGINXçš„å®¹å™¨åŒ–, è€Œä¸”NGINXæœ‰å®˜æ–¹æä¾›çš„æ ‡å‡†é•œåƒ. æ‰€ä»¥å®¹å™¨åŒ–éå¸¸ç®€å•, æœ€ç®€å•çš„æ–¹å¼, å°±æ˜¯&lt;strong&gt;ç›´æ¥å¯åŠ¨NGINXå®¹å™¨&lt;/strong&gt;, å¦‚ä¸‹:&lt;/p&gt;
&lt;h3 id="nginx"&gt;ç›´æ¥å¯åŠ¨NGINXå®¹å™¨&lt;a class="headerlink" href="#nginx" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;å…¶å®, ç›´æ¥å¯åŠ¨&lt;strong&gt;NGINX&lt;/strong&gt;å®¹å™¨å°±å¥½äº†, ä½ åªéœ€è¦æŠŠä»¥ä¸‹å†…å®¹æŒ‚è½½å·æˆ–è€…æš´éœ²å‡ºæ¥:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æŒ‚è½½å·&lt;ol&gt;
&lt;li&gt;NGINXç›¸å…³é…ç½®(åŒ…æ‹¬: &lt;code&gt;/etc/nginx&lt;/code&gt;ä¸‹é¢çš„nginx.confæ–‡ä»¶, conf.då’Œdefault.dæ–‡ä»¶å¤¹)&lt;/li&gt;
&lt;li&gt;é™æ€ç«™ç‚¹æ–‡ä»¶(pelicanç”Ÿæˆçš„, æ”¾åˆ°&lt;code&gt;/usr/share/nginx/html&lt;/code&gt;çš„æ–‡ä»¶)&lt;/li&gt;
&lt;li&gt;è¯ä¹¦æ–‡ä»¶(å‘äº‘ä¾›åº”å•†æˆ–è¯ä¹¦ä¾›åº”å•†ç”³è¯·åˆ°çš„è¯ä¹¦, æ”¾åˆ°&lt;code&gt;/etc/pki/nginx&lt;/code&gt; æ–‡ä»¶å¤¹)&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;æš´éœ²ç«¯å£&lt;ol&gt;
&lt;li&gt;80&lt;/li&gt;
&lt;li&gt;443&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;å‘½ä»¤å¦‚ä¸‹: &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo docker run --name my-tencentyun-nginx -d &lt;span class="se"&gt;\&lt;/span&gt;
  -p &lt;span class="m"&gt;80&lt;/span&gt;:80 -p &lt;span class="m"&gt;443&lt;/span&gt;:443 &lt;span class="se"&gt;\&lt;/span&gt;
  -v /etc/nginx/nginx.conf:/etc/nginx/nginx.conf &lt;span class="se"&gt;\&lt;/span&gt;
  -v /etc/nginx/conf.d:/etc/nginx/conf.d &lt;span class="se"&gt;\&lt;/span&gt;
  -v /etc/nginx/default.d:/etc/nginx/default.d &lt;span class="se"&gt;\&lt;/span&gt;
  -v /usr/share/nginx/html:/usr/share/nginx/html &lt;span class="se"&gt;\&lt;/span&gt;
  -v /etc/pki/nginx:/etc/pki/nginx:ro &lt;span class="se"&gt;\&lt;/span&gt;
  nginx
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¸Šé¢çš„å‘½ä»¤å°±ä¸ç»†è¯´äº†, å¾ˆå®¹æ˜“ç†è§£çš„. &lt;code&gt;-p&lt;/code&gt;æ˜¯æš´éœ²ç«¯å£, &lt;code&gt;-v&lt;/code&gt;æ˜¯æŠŠä¸»æœºçš„ç£ç›˜æŒ‚è½½åˆ°å®¹å™¨é‡Œ, &lt;code&gt;-d&lt;/code&gt;æ˜¯åå°è¿è¡Œ.&lt;/p&gt;
&lt;p&gt;å¯åŠ¨å, ä½ çš„NGINX dockerå®¹å™¨å°±ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å¯åŠ¨è¿è¡Œ, ä½ çš„ç½‘ç«™ä¹Ÿå¯ä»¥æ­£å¼å¯¹å¤–æœåŠ¡å•¦. &lt;img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"&gt;&lt;img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"&gt;&lt;img align="absmiddle" alt="ğŸ‰" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f389.png" title=":tada:" width="20px"&gt;&lt;/p&gt;
&lt;h2 id="_5"&gt;å…¶ä»–å®¹å™¨åŒ–æ–¹å¼&lt;a class="headerlink" href="#_5" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;è‡ªå·±æœ¬åœ°æˆ–å•æœºç©ç©, ä¸Šè¾¹çš„å®¹å™¨åŒ–æ–¹å¼å®Œå…¨å¤Ÿç”¨äº†. ä½†æ˜¯å¦‚æœæˆ‘ä»¬æœ‰ä»¥ä¸‹éœ€æ±‚:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¤šäººåˆä½œ. éœ€è¦å°è£…æˆæ–°çš„é•œåƒ, å°†é•œåƒæä¾›ç»™åˆ«äººä½¿ç”¨.&lt;/li&gt;
&lt;li&gt;æ›´å¥½åœ°ç¼–æ’ä¸ç®¡ç†. ç®¡ç†ä¸€ä¸ªé¡¹ç›®, éœ€è¦å¯åŠ¨å¤šå°‘ä¸ªweb server, å¤šå°‘ä¸ªapp server, å¤šå°‘ä¸ªdb. ç›¸äº’ä¹‹é—´å¦‚ä½•äº¤äº’.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;é‚£ä¹ˆä¹…éœ€è¦å…¶ä»–çš„å®¹å™¨åŒ–æ–¹å¼.&lt;/p&gt;
&lt;h3 id="dockerfile"&gt;Dockerfile å°è£…é•œåƒ&lt;a class="headerlink" href="#dockerfile" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;è¿™ç§å…¶å®æ˜¯å›¢é˜Ÿ, å…¬å¸, æˆ–ç”Ÿäº§ä¸Šæ¨èçš„ä¸€ç§æ–¹å¼. å¼€å‘è´Ÿè´£å†™ä»£ç , ç¼–è¯‘ä»£ç , å†™Dockerfile, æ„å»ºé•œåƒ. å¹¶æŠŠé•œåƒä¸Šä¼ åˆ°å…±æœ‰æˆ–ç§æœ‰çš„é•œåƒä»“åº“. ç„¶åå¦å¤–çš„å›¢é˜Ÿè§’è‰², å¦‚: æµ‹è¯•, è¿ç»´, å†ä»ä»“åº“ä¸­æ‹‰å–é•œåƒå¹¶å¯åŠ¨, æµ‹è¯•, ä¸Šçº¿. &lt;/p&gt;
&lt;p&gt;è¿™ä¹Ÿå®ç°äº†dockerçš„æœ€å¤§ä¼˜åŠ¿, ä»–ä»¬çš„slogan: &lt;strong&gt;"build, share and run any application, anywhere"&lt;/strong&gt;. &lt;/p&gt;
&lt;p&gt;èƒ½åšåˆ°è¿™ä¸€ç‚¹, ä¹Ÿæ˜¯å› ä¸ºOS+è¯­è¨€+ç»„ä»¶+åº”ç”¨åŒ…, æ•´ä¸ªæ‰“åŒ…æˆäº†ä¸€ä¸ªé•œåƒ, å®ç°äº†ç¯å¢ƒçš„ä¸€è‡´æ€§.&lt;/p&gt;
&lt;p&gt;è¿˜æœ‰ä¸€ä¸ªæœ‰ç‚¹, å› ä¸ºæœ‰Dockerfile, ä¹Ÿæ–¹ä¾¿è¿›è¡Œè¿½æº¯å’Œç†è§£é•œåƒ. (å¦‚æœåªæ˜¯ä¸€ä¸ªé•œåƒçš„è¯, å¾ˆéš¾çŸ¥é“é•œåƒæ˜¯æ€ä¹ˆåšå‡ºæ¥çš„).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æ­¥éª¤&lt;/strong&gt;&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»ºä¸ªé¡¹ç›®, æœ¬åœ°æ–‡ä»¶å¤¹æ˜¯&lt;strong&gt;my-tencentyun-nginx&lt;/strong&gt;, GitHubæ˜¯: https://github.com/east4ming/my-tencentyun-nginx&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;å°†ç›¸å…³æºç å’Œç«™ç‚¹æ–‡ä»¶æ”¾åˆ°è¯¥ç›®å½•ä¸­(é…ç½®æ–‡ä»¶, ç«™ç‚¹æ–‡ä»¶, è¯ä¹¦)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;Â æ³¨æ„: &lt;/p&gt;
&lt;p&gt;è¯ä¹¦keyåŒ…å«é‡è¦çš„ç§å¯†ä¿¡æ¯, åƒä¸‡ä¸è¦ä¸Šä¼ åˆ°å…¬ç½‘ä¸Š!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;åˆ›å»º&lt;code&gt;Dockerfile&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;æ„å»ºé•œåƒ: &lt;code&gt;sudo docker build -t caseycui/my-tencentyun-nginx .&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;(å¯é€‰) æ¨é€é•œåƒåˆ°Docker Hub: &lt;code&gt;sudo docker push caseycui/my-tencentyun-nginx&lt;/code&gt; (æˆ‘è¿™è¾¹æ˜¯Docker Hubç›´æ¥oauthè¿æ¥åˆ°Github, æˆ‘çš„å¯¹åº”çš„Githubä»“åº“ä»£ç æœ‰æ›´æ–°, å°±ä¼šè‡ªåŠ¨æ„å»º)&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿è¡Œé•œåƒ: &lt;code&gt;sudo docker run --name my-tencentyun-nginx -v /etc/pki/nginx:/etc/pki/nginx:ro -d -p 80:80 -p 443:443 caseycui/my-tencentyun-nginx&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Dockerfile å¦‚ä¸‹:&lt;/p&gt;
&lt;p&gt;æœ€ç®€å•çš„Dockerfile, å°±æ˜¯åœ¨nginxé•œåƒçš„åŸºç¡€ä¸Š, æŠŠæˆ‘ä»¬è‡ªå·±çš„nginxé…ç½®æ–‡ä»¶å’Œé™æ€ç«™ç‚¹æ–‡ä»¶å¤åˆ¶è¿›å», ç”Ÿæˆä¸€ä¸ªæ–°é•œåƒ.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;FROM&lt;/span&gt;&lt;span class="s"&gt; nginx:latest&lt;/span&gt;

&lt;span class="k"&gt;COPY&lt;/span&gt; pelican-output /usr/share/nginx/html
&lt;span class="k"&gt;COPY&lt;/span&gt; nginx.conf /etc/nginx/nginx.conf
&lt;span class="k"&gt;COPY&lt;/span&gt; default.d /etc/nginx/default.d
&lt;span class="c"&gt;#COPY conf.d /etc/nginx/conf.d  # è¿™è¾¹æ³¨é‡Šæ‰, æ˜¯å› ä¸ºè¿™ä¸ªç›®å½•é‡Œè¿˜æ²¡æœ‰å†…å®¹&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="-docker-compose"&gt;ç®€å•å®¹å™¨ç¼–æ’å·¥å…· - docker compose&lt;a class="headerlink" href="#-docker-compose" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;é€‚ç”¨åœºæ™¯&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;docker composeæ˜¯dockerå®˜æ–¹å‡ºå“çš„å®¹å™¨ç¼–æ’å·¥å…·, ç®€å•æ˜“ç”¨. å°è§„æ¨¡ç”¨ç”¨è¿˜æ˜¯æŒºèˆ’æœçš„. å¤§è§„æ¨¡, ä¼ä¸šçº§çš„ç°åœ¨éƒ½æ˜¯ä½¿ç”¨Kubernetes.&lt;/p&gt;
&lt;p&gt;æˆ‘è¿™é‡Œç”¨docker composeå…¶å®æ˜¯æ€é¸¡ç”¨ç‰›åˆ€äº†, æ²¡å•¥å¿…è¦. å®ƒé€‚ç”¨äºå“ªç§åœºæ™¯å‘¢? &lt;/p&gt;
&lt;p&gt;æ¯”å¦‚, æˆ‘ä¸€ä¸ªé¡¹ç›®è¦ä¸Šçº¿, åŒ…æ‹¬: web server, app server, db. é‚£ä¹ˆè¿™æ—¶å€™docker composeå°±å¾ˆåˆé€‚äº†. é€šè¿‡å®ƒæ¥ç¼–æ’è¿™3ç±»å®¹å™¨, ä½¿å®ƒä»¬ç›¸äº’åä½œå’Œäº¤äº’. &lt;/p&gt;
&lt;p&gt;docker-composeæ˜¯é€šè¿‡&lt;code&gt;docker-compose.yaml&lt;/code&gt;æ¥å®šä¹‰è¿™äº›ç¼–æ’å†…å®¹çš„. ç¤ºä¾‹å¦‚ä¸‹:&lt;/p&gt;
&lt;p&gt;ä¸€ä¸ªwebå®¹å™¨, ä¸€ä¸ªrediså®¹å™¨. æŒ‚è½½å“ªäº›å·, æ€ä¹ˆç¼–è¯‘...&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;version&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;3&amp;#39;&lt;/span&gt;
&lt;span class="nt"&gt;services&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;web&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;build&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;.&lt;/span&gt;
    &lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;5000:5000&amp;quot;&lt;/span&gt;
    &lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;.:/code&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;logvolume01:/var/log&lt;/span&gt;
    &lt;span class="nt"&gt;links&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
  &lt;span class="nt"&gt;redis&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;redis&lt;/span&gt;
&lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;logvolume01&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;&lt;strong&gt;æ­¥éª¤&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;åˆ›å»º&lt;code&gt;docker-compose.yaml&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;web&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;nginx&lt;/span&gt;
  &lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
   &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;./nginx.conf:/etc/nginx/nginx.conf&lt;/span&gt;
   &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;./default.d:/etc/nginx/default.d&lt;/span&gt;
   &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;./conf.d:/etc/nginx/conf.d&lt;/span&gt;
   &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;./pelican-output:/usr/share/nginx/html&lt;/span&gt;
   &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/etc/pki/nginx:/etc/pki/nginx:ro&lt;/span&gt;
  &lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
   &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;80:80&amp;quot;&lt;/span&gt;
   &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;443:443&amp;quot;&lt;/span&gt;
  &lt;span class="nt"&gt;command&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;nginx&lt;/span&gt;&lt;span class="p p-Indicator"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;-g&amp;#39;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;daemon&lt;/span&gt;&lt;span class="nv"&gt; &lt;/span&gt;&lt;span class="s"&gt;off;&amp;#39;&lt;/span&gt;&lt;span class="p p-Indicator"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¿è¡Œ: &lt;code&gt;sudo nohup docker-compose up &amp;amp;&lt;/code&gt;&lt;/p&gt;
&lt;h2 id="_6"&gt;æŸ¥çœ‹çŠ¶æ€å’Œæ—¥å¿—&lt;a class="headerlink" href="#_6" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;æŸ¥çœ‹çŠ¶æ€: &lt;code&gt;sudo docker ps &amp;lt;container name&amp;gt;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;æŸ¥çœ‹æ—¥å¿—: &lt;code&gt;sudo dockerÂ logsÂ &amp;lt;containerÂ name&amp;gt;&lt;/code&gt;&lt;/p&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Fri, 10 May 2019 10:32:00 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-05-10:/ewhisper-blog-moved-to-docker.html</guid><category>nginx</category><category>github</category><category>docker</category><category>containers</category></item><item><title>è‹¹æœATSåˆè§„å¯¹WebæœåŠ¡å™¨çš„å½±å“</title><link>https://www.EWhisper.cn/apple-ats-effect-on-web-server.html</link><description>&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;ä¸€ å‰è¨€&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#11-ats"&gt;1.1 ATSè¦æ±‚&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;äºŒ æ£€æŸ¥é¡¹&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#21-apache"&gt;2.1 Apache æ£€æŸ¥é¡¹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#22-nginx"&gt;2.2 NGINXæ£€æŸ¥é¡¹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#23-weblogic"&gt;2.3 WebLogic æ£€æŸ¥é¡¹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_3"&gt;ä¸‰ ä¿®æ”¹é…ç½®é¡¹&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#31-apache"&gt;3.1 Apache é…ç½®é¡¹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#32-nginx"&gt;3.2 NGINX é…ç½®é¡¹&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#33-weblogic"&gt;3.3 WebLogic é…ç½®é¡¹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href="#_4"&gt;å›› æ³¨æ„é¡¹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="_1"&gt;ä¸€ å‰è¨€&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"&gt; è¯´æ˜:&lt;/p&gt;
&lt;p&gt;è¿™ç¯‡æ–‡ç« æ˜¯åœ¨å¤ªå¹³ä¿é™©æœŸé—´, æˆ‘å’ŒåŒæ—¶Huang Wentaoä¸€èµ·æ”¶é›†èµ„æ–™å¹¶å®éªŒååä½œå®Œæˆçš„.&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡å†™äº2å¹´å‰, æ—¶è‡³ä»Šæ—¥å¯èƒ½è§„èŒƒ, è½¯ä»¶ç‰ˆæœ¬æˆ–é…ç½®é¡¹éƒ½å‘ç”Ÿå˜åŒ–. å¦‚æœè¦åº”ç”¨, è¯·åº”ç”¨å‰è¿›è¡Œå®Œå–„æµ‹è¯•.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="11-ats"&gt;1.1 ATSè¦æ±‚&lt;a class="headerlink" href="#11-ats" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;åå•†çš„ä¼ è¾“å±‚å®‰å…¨ï¼ˆTLSï¼‰ç‰ˆæœ¬å¿…é¡»ä¸ºTLS 1.2;&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿æ¥å¿…é¡»ä½¿ç”¨AES-128æˆ–AES-256å¯¹ç§°å¯†ç ï¼Œåå•†çš„ç§˜é’¥äº¤æ¢åè®®å¿…é¡»æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384&lt;/li&gt;
&lt;li&gt;TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256&lt;/li&gt;
&lt;li&gt;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384&lt;/li&gt;
&lt;li&gt;TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA&lt;/li&gt;
&lt;li&gt;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256&lt;/li&gt;
&lt;li&gt;TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA&lt;/li&gt;
&lt;li&gt;TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384&lt;/li&gt;
&lt;li&gt;TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256&lt;/li&gt;
&lt;li&gt;TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384&lt;/li&gt;
&lt;li&gt;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256&lt;/li&gt;
&lt;li&gt;TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Leaf serverï¼ˆè®¾å¤‡æœåŠ¡å™¨ï¼‰è¯ä¹¦å¿…é¡»ä½¿ç”¨ä»¥ä¸‹ç±»å‹çš„å¯†é’¥ä¹‹ä¸€ç­¾å&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Rivest-Shamir-Adleman (RSA)ç§˜é’¥ï¼Œé•¿åº¦è‡³å°‘ä¸º2048ä½&lt;/li&gt;
&lt;li&gt;Elliptic-Curve Cryptography (ECC) ç§˜é’¥ï¼Œé•¿åº¦è‡³å°‘ä¸º256ä½&lt;/li&gt;
&lt;li&gt;æ­¤å¤–ï¼Œleaf serverè¯ä¹¦æ•£åˆ—ç®—æ³•å¿…é¡»æ˜¯å…·æœ‰è‡³å°‘256ï¼ˆå³SHA-256æˆ–æ›´å¤§ï¼‰çš„æ‘˜è¦é•¿åº¦ï¼ˆæœ‰æ—¶ç§°ä¸ºâ€œæŒ‡çº¹â€ï¼‰çš„å®‰å…¨æ•£åˆ—ç®—æ³•2ï¼ˆSHA-2ï¼‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="_2"&gt;äºŒ æ£€æŸ¥é¡¹&lt;a class="headerlink" href="#_2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="21-apache"&gt;2.1 Apache æ£€æŸ¥é¡¹&lt;a class="headerlink" href="#21-apache" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;OpenSSLç‰ˆæœ¬: éœ€è¦å¤§äº &lt;a href="https://www.openssl.org/news/changelog.txt"&gt;1.0.1&lt;/a&gt; (OpenSSLä»1.0.1ä»¥åå¼€å§‹æ”¯æŒTLS 1.2)&lt;/li&gt;
&lt;li&gt;å½“å‰åŠ å¯†å¥—ä»¶ä½¿ç”¨çš„å¯†é’¥äº¤æ¢åè®®.&lt;ol&gt;
&lt;li&gt;æŸ¥çœ‹å½“å‰åŠ å¯†å¥—ä»¶æ”¯æŒçš„åè®®. è¦ä¿è¯æ”¯æŒçš„åè®®ä¸­æœ‰ä»¥ä¸ŠATS ä¸­æ‰€è¦æ±‚çš„.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;å½“å‰å¯†é’¥é•¿åº¦/æŒ‡çº¹ç®—æ³•æ˜¯å¦æ»¡è¶³:&lt;ol&gt;
&lt;li&gt;å¦‚æœæ˜¯RSAå¯†é’¥, åˆ™è‡³å°‘è¦ä¸º2048ä½;&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯ECCå¯†é’¥, åˆ™è‡³å°‘ä¸º256ä½.&lt;/li&gt;
&lt;li&gt;æŒ‡çº¹å®‰å…¨æ•£åˆ—ç®—æ³•è¦ä¸º SHA-2&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;Apacheç‰ˆæœ¬:&lt;ol&gt;
&lt;li&gt;&lt;a href="http://svn.apache.org/repos/asf/httpd/httpd/branches/2.2.x/CHANGES"&gt;Apache 2.2.23&lt;/a&gt; æˆ–&lt;a href="http://svn.apache.org/repos/asf/httpd/httpd/branches/2.4.x/CHANGES"&gt;2.4.0&lt;/a&gt; ä»¥ä¸Šç‰ˆæœ¬éƒ½æ˜¯æ”¯æŒçš„.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="22-nginx"&gt;2.2 NGINXæ£€æŸ¥é¡¹&lt;a class="headerlink" href="#22-nginx" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;OpenSSL ç‰ˆæœ¬: éœ€è¦å¤§äº1.0.1&lt;/li&gt;
&lt;li&gt;å½“å‰åŠ å¯†å¥—ä»¶ä½¿ç”¨çš„å¯†é’¥äº¤æ¢åè®®.&lt;ol&gt;
&lt;li&gt;æŸ¥çœ‹å½“å‰åŠ å¯†å¥—ä»¶æ”¯æŒçš„åè®®. è¦ä¿è¯æ”¯æŒçš„åè®®ä¸­æœ‰ä»¥ä¸ŠATS ä¸­æ‰€è¦æ±‚çš„.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;å½“å‰å¯†é’¥é•¿åº¦/æŒ‡çº¹ç®—æ³•æ˜¯å¦æ»¡è¶³:&lt;ol&gt;
&lt;li&gt;å¦‚æœæ˜¯RSAå¯†é’¥, åˆ™è‡³å°‘è¦ä¸º2048ä½;&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯ECCå¯†é’¥, åˆ™è‡³å°‘ä¸º256ä½.&lt;/li&gt;
&lt;li&gt;æŒ‡çº¹å®‰å…¨æ•£åˆ—ç®—æ³•è¦ä¸º SHA-2&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;NGINXç‰ˆæœ¬: å»ºè®®ä½¿ç”¨&lt;a href="http://nginx.org/en/CHANGES-1.12"&gt;1.1.13&lt;/a&gt;ä»¥ä¸Šç‰ˆæœ¬.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="23-weblogic"&gt;2.3 WebLogic æ£€æŸ¥é¡¹&lt;a class="headerlink" href="#23-weblogic" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;JDKç‰ˆæœ¬: éœ€è¦ç‰ˆæœ¬ä¸ºJDK 7 ä»¥ä¸Š.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="_3"&gt;ä¸‰ ä¿®æ”¹é…ç½®é¡¹&lt;a class="headerlink" href="#_3" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"&gt; è¯´æ˜:&lt;/p&gt;
&lt;p&gt;é™¤äº†ä»¥ä¸Šæ£€æŸ¥é¡¹ä¸­ç‰ˆæœ¬ä¸ç¬¦åˆçš„éœ€è¦å‡çº§ã€è¯ä¹¦çš„ç®—æ³•ã€ç§˜é’¥é•¿åº¦éœ€è¦è¾¾åˆ°è¦æ±‚å¤–ï¼Œè¿˜æœ‰å…¶ä»–é…ç½®é¡¹è¦è¿›è¡Œé…ç½®.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="31-apache"&gt;3.1 Apache é…ç½®é¡¹&lt;a class="headerlink" href="#31-apache" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ç¤ºä¾‹: Apacheç‰ˆæœ¬2.2.23(~~å¾…ç¡®å®š~~)ï¼ŒOpenSSLç‰ˆæœ¬1.0.1e. (æœ€å¤§å…¼å®¹æ€§é…ç½®)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;&amp;lt;VirtualHost&lt;/span&gt; &lt;span class="err"&gt;*:443&lt;/span&gt;&lt;span class="nt"&gt;&amp;gt;&lt;/span&gt;
    ...
    SSLEngine on
    SSLCertificateFile      /path/to/signed_certificate
    SSLCertificateChainFile /path/to/intermediate_certificate
    SSLCertificateKeyFile   /path/to/private/key

    # Uncomment the following directive when using client certificate authentication
    #SSLCACertificateFile    /path/to/ca_certs_for_client_authentication


    # HSTS (mod_headers is required) (15768000 seconds = 6 months)
    Header always set Strict-Transport-Security &amp;quot;max-age=15768000&amp;quot;
    ...
&lt;span class="nt"&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/span&gt;

# old configuration, tweak to your needs
SSLProtocol             all -SSLv2
SSLCipherSuite          ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:ECDHE-ECDSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:DES-CBC3-SHA:HIGH:SEED:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!RSAPSK:!aDH:!aECDH:!EDH-DSS-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA:!SRP
SSLHonorCipherOrder     on
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="32-nginx"&gt;3.2 NGINX é…ç½®é¡¹&lt;a class="headerlink" href="#32-nginx" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¸¾ä¾‹ï¼šNginxç‰ˆæœ¬1.11.0ï¼ŒOpenSSLç‰ˆæœ¬1.0.1e (æœ€å¤§å…¼å®¹æ€§é…ç½®)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="mi"&gt;80&lt;/span&gt; &lt;span class="s"&gt;default_server&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="s"&gt;[::]:80&lt;/span&gt; &lt;span class="s"&gt;default_server&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;# Redirect all HTTP requests to HTTPS with a 301 Moved Permanently response.&lt;/span&gt;
    &lt;span class="kn"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;301&lt;/span&gt; &lt;span class="s"&gt;https://&lt;/span&gt;&lt;span class="nv"&gt;$host$request_uri&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;

&lt;span class="k"&gt;server&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="mi"&gt;443&lt;/span&gt; &lt;span class="s"&gt;ssl&lt;/span&gt; &lt;span class="s"&gt;http2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;listen&lt;/span&gt; &lt;span class="s"&gt;[::]:443&lt;/span&gt; &lt;span class="s"&gt;ssl&lt;/span&gt; &lt;span class="s"&gt;http2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;# certs sent to the client in SERVER HELLO are concatenated in ssl_certificate&lt;/span&gt;
    &lt;span class="kn"&gt;ssl_certificate&lt;/span&gt; &lt;span class="s"&gt;/path/to/signed_cert_plus_intermediates&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;ssl_certificate_key&lt;/span&gt; &lt;span class="s"&gt;/path/to/private_key&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;ssl_session_timeout&lt;/span&gt; &lt;span class="s"&gt;1d&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;ssl_session_cache&lt;/span&gt; &lt;span class="s"&gt;shared:SSL:50m&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;ssl_session_tickets&lt;/span&gt; &lt;span class="no"&gt;off&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;# Diffie-Hellman parameter for DHE ciphersuites, recommended 2048 bits&lt;/span&gt;
    &lt;span class="kn"&gt;ssl_dhparam&lt;/span&gt; &lt;span class="s"&gt;/path/to/dhparam.pem&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;# old configuration. tweak to your needs.&lt;/span&gt;
    &lt;span class="kn"&gt;ssl_protocols&lt;/span&gt; &lt;span class="s"&gt;SSLv3&lt;/span&gt; &lt;span class="s"&gt;TLSv1&lt;/span&gt; &lt;span class="s"&gt;TLSv1.1&lt;/span&gt; &lt;span class="s"&gt;TLSv1.2&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;ssl_ciphers&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:ECDHE-ECDSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:DES-CBC3-SHA:HIGH:SEED:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!RSAPSK:!aDH:!aECDH:!EDH-DSS-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA:!SRP&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;ssl_prefer_server_ciphers&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;# HSTS (ngx_http_headers_module is required) (15768000 seconds = 6 months)&lt;/span&gt;
    &lt;span class="kn"&gt;add_header&lt;/span&gt; &lt;span class="s"&gt;Strict-Transport-Security&lt;/span&gt; &lt;span class="s"&gt;max-age=15768000&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;# OCSP Stapling ---&lt;/span&gt;
    &lt;span class="c1"&gt;# fetch OCSP records from URL in ssl_certificate and cache them&lt;/span&gt;
    &lt;span class="kn"&gt;ssl_stapling&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
    &lt;span class="kn"&gt;ssl_stapling_verify&lt;/span&gt; &lt;span class="no"&gt;on&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="c1"&gt;## verify chain of trust of OCSP response using Root CA and Intermediate certs&lt;/span&gt;
    &lt;span class="kn"&gt;ssl_trusted_certificate&lt;/span&gt; &lt;span class="s"&gt;/path/to/root_CA_cert_plus_intermediates&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="kn"&gt;resolver&lt;/span&gt; &lt;span class="s"&gt;&amp;lt;IP&lt;/span&gt; &lt;span class="s"&gt;DNS&lt;/span&gt; &lt;span class="s"&gt;resolver&amp;gt;&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;

    &lt;span class="kn"&gt;....&lt;/span&gt;
&lt;span class="err"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="33-weblogic"&gt;3.3 WebLogic é…ç½®é¡¹&lt;a class="headerlink" href="#33-weblogic" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;éœ€è¦åœ¨Oracleå®˜ç½‘ä¸‹è½½java 7ç›¸å…³çš„policyfile&lt;br&gt;
è§£å‹åï¼Œæ›¿æ¢&lt;code&gt;JAVA_HOME/jre/lib/security&lt;/code&gt;ä¸‹çš„&lt;code&gt;local_policy.jar&lt;/code&gt;ã€&lt;code&gt;US_export_policy.jar&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h2 id="_4"&gt;å›› æ³¨æ„é¡¹&lt;a class="headerlink" href="#_4" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;å‡çº§OpenSSLï¼Œå¯èƒ½ä¼šå½±å“sftpã€sshç­‰å’Œsslæœ‰å…³çš„åè®®ï¼Œéœ€è°¨æ…æ“ä½œã€‚&lt;/li&gt;
&lt;li&gt;è€ƒè™‘åˆ°æ—§çš„sslç‰ˆæœ¬æ¼æ´ï¼Œä»¥åŠå…¼å®¹æ€§ï¼Œå»ºè®®éƒ½è¦ç¦ç”¨æ‰ssl V2åŠä»¥ä¸‹ç‰ˆæœ¬åè®®ã€‚(æœ€æ–°çš„å»ºè®®æ˜¯SSL v3ä¹Ÿç¦ç”¨)&lt;/li&gt;
&lt;/ol&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sat, 30 Mar 2019 19:37:41 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-03-30:/apple-ats-effect-on-web-server.html</guid><category>ATS</category><category>apple</category><category>ssl</category><category>nginx</category><category>apache</category><category>tls</category><category>openssl</category></item><item><title>HTTPSåŸºç¡€åŸç†å’Œé…ç½® - åŠ å¯†åè®®SSLå’ŒTLS</title><link>https://www.EWhisper.cn/https-101-chapter-1.html</link><description>&lt;blockquote&gt;
&lt;p&gt;è¿‘æœŸåˆç¢°åˆ°äº†SSLç›¸å…³çš„äº‹æƒ…, å°±å¿ƒè¡€æ¥æ½®å¼€ä¸ªæ–°ä¸“é¢˜ - ã€ŠHTTPSåŸºç¡€åŸç†å’Œé…ç½®ã€‹&lt;/p&gt;
&lt;p&gt;æœ¬æ–‡æ˜¯ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œ ä¸»è¦ä»‹ç»SSL TLSåŠ å¯†åè®®çš„ç›¸å…³å†…å®¹ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="_1"&gt;åŠ å¯†åè®®å†å²æ¦‚è¦&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;SSL TLSåŠ å¯†åè®®å…¶å®å¹¶æ²¡æœ‰å¾ˆé•¿çš„å†å²ï¼Œ1995å¹´&lt;strong&gt;ç½‘æ™¯&lt;/strong&gt;å‘å¸ƒäº†SSL v2.0ï¼Œè¿™ä¹Ÿæ˜¯webåŠ å¯†çš„å¼€å§‹ã€‚è¿™ä½¿å¾—ç”µå­å•†åŠ¡é¢†åŸŸï¼Œäººä»¬å¯ä»¥åœ¨çº¿æäº¤å¯†ç å’Œä¿¡ç”¨å¡ï¼Œå¹¶ä¸”è‡³å°‘æ˜¯ç›¸å½“å®‰å…¨çš„ã€‚&lt;/p&gt;
&lt;p&gt;SSLv3.0å¾ˆå¿«å‘å¸ƒï¼Œè¿™ç‰ˆè¢«ä¿ç½—Â·æŸ¯å…‹ï¼ˆPaul Cokerï¼‰åŠå…¶ä»–äººå®Œå…¨é‡å†™ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸åšå®çš„åè®®ã€‚äº‹å®ä¸Šï¼ŒIETFé‡‡ç”¨SSL v3.0ï¼Œå¹¶ä½¿å®ƒæˆä¸ºå¹¶ä¸æ˜¯ç½‘æ™¯ç‹¬æœ‰çš„åè®®ï¼Œå«åšTLSï¼ˆTransport Layer Securityï¼‰ã€‚SSLæ„æ€æ˜¯å®‰å…¨å¥—æ¥å­—å±‚ï¼Œä½†ç°åœ¨å«ä¼ è¾“å±‚å®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼ŒTLS v1.0å‡ ä¹å’ŒSSL v3.0 ä¸€æ¨¡ä¸€æ ·ï¼Œåªæ˜¯è¿›è¡Œäº†ä¸€ä¸¤ä¸ªå°ä¼˜åŒ–ï¼Œå¹¶ä¸”IAFä½¿ä¹‹æ ‡å‡†åŒ–ã€‚å¦‚æœä½ æ·±ç©¶è¿™äº›åè®®ï¼ŒTLS v1.0å®é™…ä¸Šå°±æ˜¯SSL v3.1ï¼›æ‰€ä»¥ä½ å¯ä»¥è®¤ä¸ºä»–ä»¬æ˜¯è¿ç»­çš„ã€‚&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯æœ€ç»ˆIETFæå‡ºäº†æ–°ç‰ˆæœ¬v1.1ï¼ˆä¸€äº›å°ä¼˜åŒ–ï¼‰ï¼Œç„¶åæ˜¯v1.2ï¼Œå¼•å…¥äº†ä¸€äº›æ–°çš„åŠ å¯†ç®—æ³•ã€‚ä½†æ˜¯çœ‹åˆ°è¿™ä½ å¯èƒ½ä¼šæƒ³â€œå¥½å§ï¼Œæœ‰äº›å®¢æˆ·ç«¯æ”¯æŒè¿™äº›ï¼Œæœ‰äº›å®¢æˆ·ç«¯æ”¯æŒæ›´æ–°çš„ï¼Œè¿™å–å†³äºå®ƒä»¬å‘å¸ƒçš„æ—¶é—´. å®‰å…¨æ€§ä¸Šå¯èƒ½å·®ä¸å¤ªå¤š". ä½†å®é™…åœ¨å®‰å…¨æ„ä¹‰ä¸Šï¼Œè¿™äº›ä¸­çš„å¤§å¤šæ•°å·²ç»ä»¥è¢«ç ´è§£äº†ã€‚&lt;/p&gt;
&lt;h3 id="_2"&gt;å…³é”®å†å²èŠ‚ç‚¹&lt;a class="headerlink" href="#_2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;SSL v2.0 1995å¹´ ç½‘æ™¯ å‘å¸ƒ&lt;/li&gt;
&lt;li&gt;SSL v3.0 1996å¹´å‘å¸ƒ ä¿®å¤v2çš„ä¸»è¦é—®é¢˜&lt;/li&gt;
&lt;li&gt;TLS v1.0 1999å¹´ IETFå‘å¸ƒï¼›å¯¹SSLv3å°ä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;TLS v1.1 2006å¹´ å‘å¸ƒ å°ä¼˜åŒ–&lt;/li&gt;
&lt;li&gt;TLS v1.2 2008å¹´å‘å¸ƒ æ”¹è¿›hashå’ŒAEADæ¨¡å¼&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="_3"&gt;&lt;img align="absmiddle" alt="ğŸ˜‚" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f602.png" title=":joy:" width="20px"&gt;è¢«ç ´è§£å†å²æ¦‚è¦&lt;a class="headerlink" href="#_3" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;é¦–å…ˆæ˜¯SSL v2.0, è®¾è®¡ä¹‹åˆå°±è¢«ç ´è§£&lt;img align="absmiddle" alt="ğŸ˜‚" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f602.png" title=":joy:" width="20px"&gt;&lt;img align="absmiddle" alt="ğŸ˜‚" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f602.png" title=":joy:" width="20px"&gt;&lt;img align="absmiddle" alt="ğŸ˜‚" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f602.png" title=":joy:" width="20px"&gt;, æ‰€ä»¥ï¼Œssl v2.0ç¡®å®ä¸æ¨èä½¿ç”¨ï¼›å·²ç»è¢«ç ´è§£å¾ˆé•¿å¾ˆé•¿æ—¶é—´äº†ï¼Œä¸å®‰å…¨ã€‚ æˆ‘ä»¬ç»å¸¸å¬åˆ°çš„æ”¯æŒçš„SSLç‰ˆæœ¬ä¸€èˆ¬ä¹Ÿæ˜¯ä»SSL v3.0å¼€å§‹çš„.&lt;/p&gt;
&lt;p&gt;SSL v3.0å‘¢, ä¹‹å‰ä¸€ç›´åœ¨ç”¨ï¼Œç›´åˆ°2014å¹´11æœˆè¢«ç ´è§£ã€‚&lt;/p&gt;
&lt;p&gt;TLSå‘¢, v1.0å’Œv1.1åŸºæœ¬å®‰å…¨ã€‚&lt;/p&gt;
&lt;p&gt;æœ€æ–°çš„v1.2(å…¶å®ç°åœ¨å·²ç»ä¸ç®—æœ€æ–°çš„äº†, TLS v1.3å·²ç»å‡ºæ¥äº†, ä½†æ˜¯ç›®å‰ä¸»æµçš„æœ€æ–°åè®®è¿˜æ˜¯1.2), æ˜¯å”¯ä¸€ä¸€ä¸ªè¿˜æ²¡æœ‰é’ˆå¯¹æ€§æ”»å‡»çš„ç‰ˆæœ¬(PS: å½“ç„¶, è¿‘æœŸä¹Ÿæœ‰é’ˆå¯¹TLS v1.2çš„æ¼æ´çˆ†å‡º, ä½†è¿˜ç®—OK)ã€‚&lt;/p&gt;
&lt;p&gt;TLSæœ‰ä¸€ä¸ªæ··ä¹±çš„å†å²ï¼Œå¹¶æ²¡æœ‰çœŸæ­£æœ€å¥½çš„å®‰å…¨è®°å½•ï¼Œä½†TLS v1.2ä¸€ç›´è¿˜æ˜¯æœ€å¥½çš„ï¼Œå½“æ¶‰åŠåˆ°ä¸æµè§ˆå™¨å’ŒæœåŠ¡çš„äº¤äº’ï¼Œå®ƒå†…ç½®åœ¨å‡ ä¹ä¸€åˆ‡çš„æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¸­(æœ€æ–°çš„)ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥ï¼ŒTLS v1.2æ˜¯å¤§åŠ¿æ‰€è¶‹, å¦‚æœæ¶‰åŠåˆ°å…³é”®ä¸šåŠ¡æ•°æ®äº¤äº’, å¦‚&lt;strong&gt;ç”¨æˆ·å…³é”®ä¿¡æ¯&lt;/strong&gt; &lt;strong&gt;æ”¯ä»˜&lt;/strong&gt; &lt;strong&gt;é‡‘è&lt;/strong&gt;ç­‰åœºæ™¯, TLS v1.2æ‰èƒ½çœŸæ­£æœ‰ä¿éšœ, è€Œå…¶ä»–è€çš„åŠ å¯†åè®®, éƒ½å·²ç»è¢«ç ´è§£äº†, é»‘å®¢æƒ³æ‹¿åˆ°ä½ çš„æ•°æ®(å¦‚æœä½ ç”¨è€çš„åŠ å¯†åè®®)åªæ˜¯æ—¶é—´é—®é¢˜, å¹¶ä¸å­˜åœ¨æŠ€æœ¯ä¸Šçš„éš¾ç‚¹ã€‚æ‰€ä»¥è¯„ä¼°ATS(è‹¹æœçš„å®‰å…¨ç›¸å…³è¦æ±‚)åˆè§„ä¹Ÿè¦æ±‚è¯¥ç‰ˆæœ¬ã€‚&lt;/p&gt;
&lt;h3 id="_4"&gt;&lt;img align="absmiddle" alt="ğŸ˜‚" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f602.png" title=":joy:" width="20px"&gt;è¢«ç ´è§£å…³é”®å†å²èŠ‚ç‚¹&lt;a class="headerlink" href="#_4" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;SSL v2.0 1995å‘å¸ƒ - è®¾è®¡ä¹‹åˆè¢«ç ´è§£&lt;/li&gt;
&lt;li&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;SSL v3.0 1996å‘å¸ƒ â€“ è¢«POODLEç ´è§£ï¼ˆ2014 .11ï¼‰&lt;/li&gt;
&lt;li&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;TSL v1.0 1999å‘å¸ƒ â€“ BEAST(2011)å’ŒLucky 13(2013)å‘ç°æ¼æ´&lt;/li&gt;
&lt;li&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;Tâ€‹LS v1.1 2006å‘å¸ƒ â€“ è¢«Lucky 13(2013)å’ŒRC4(2013,2015)å‘ç°æ¼æ´&lt;/li&gt;
&lt;li&gt;TLS v1.2 2008å‘å¸ƒ â€“ åªæœ‰åœ¨AEADæ¨¡å¼ä¸‹æ˜¯å®‰å…¨çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="_5"&gt;å®¢æˆ·ç«¯å…¼å®¹æ€§&lt;a class="headerlink" href="#_5" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt; æ³¨æ„:&lt;/p&gt;
&lt;p&gt;å¦‚æœæœ‰æ¡ä»¶, å¼ºçƒˆå»ºè®®&lt;strong&gt;åªé€‰æ‹© TLS v1.2&lt;/strong&gt;ç‰ˆæœ¬. (å¯¹äºä¼ ç»Ÿä¼ä¸š, çœŸçš„æŒºéš¾åšåˆ°çš„)â€‹&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ ¹æ®ä»¥ä¸Šçš„å†…å®¹æ¥çœ‹, é‚£æˆ‘åªé€‰æ‹©TLS v1.2åè®®å¥½äº†, ä½†å®é™…æƒ…å†µæ˜¯, TLS v1.2 æ˜¯&lt;strong&gt;2008&lt;/strong&gt;å¹´æ‰å‘å¸ƒçš„(æ ‡æ³¨å‘å¸ƒ), è€ŒçœŸæ­£è¦è½åˆ°å®å¤„æ‰€éœ€è¦çš„æ—¶é—´æ›´é•¿. æ‰€ä»¥å¾ˆå¤šå®¢æˆ·ç«¯å¹¶ä¸æ”¯æŒTLS v1.2. &lt;/p&gt;
&lt;p&gt;è¿™äº›å®¢æˆ·ç«¯, æ˜¯&lt;strong&gt;å¹¿ä¹‰&lt;/strong&gt;çš„å®¢æˆ·ç«¯, åŒ…æ‹¬: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ“ä½œç³»ç»Ÿ&lt;/li&gt;
&lt;li&gt;æµè§ˆå™¨&lt;/li&gt;
&lt;li&gt;æ‰‹æœº&lt;/li&gt;
&lt;li&gt;èƒ–å®¢æˆ·ç«¯(å¦‚Javaå®¢æˆ·ç«¯)&lt;/li&gt;
&lt;li&gt;...&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;æ‰€ä»¥ï¼Œå¦‚æœä½ è®¡åˆ’æœåŠ¡å™¨åªé€‰æ‹©1.2ç‰ˆæœ¬ï¼Œä½ å°±å¯èƒ½å¤±å»äº†å¾ˆå¤šæ½œåœ¨å®¢æˆ·(è¿˜åœ¨ç”¨æ—§çš„å®¢æˆ·ç«¯çš„å®¢æˆ·, å½“ç„¶, è¯´ä¸å®šç”¨ç€æ—§ç”µè„‘çš„å‘˜å·¥ä¹Ÿè¢«æ‹’ä¹‹é—¨å¤–äº†...)ã€‚è¿™å¹¶ä¸æ˜¯æœ€å¥½çš„ä¸¾åŠ¨ï¼Œé™¤éå¯¹ç»å¯¹å®‰å…¨éå¸¸æ•æ„Ÿã€‚å¦åˆ™çš„è¯, è¿˜æ˜¯å»ºè®®æ”¯æŒæ›´å¤šçš„å®‰å…¨åè®®è®©æ›´å¤šçš„å®¢æˆ·å¯ä»¥å…¼å®¹. æ˜¯å§? æ¯•ç«Ÿæ¯”èµ·httpè¿™ç§è£¸å¥”, å…¶ä»–æ—§çš„åè®®å¥½æ­¹è¿˜æ˜¯ç©¿ç€è¡£æœçš„.&lt;img align="absmiddle" alt="ğŸ˜" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f60f.png" title=":smirk:" width="20px"&gt;&lt;/p&gt;
&lt;p&gt;ä½†æ˜¯, å¦ä¸€äº›å¤§å¹³å°, å·²ç»å¼€å§‹å€¾å‘äºv1.2ã€‚æ¯”å¦‚iosä¹‹å‰çš„&lt;a href="https://developer.apple.com/news/?id=12212016b&amp;amp;1482372961"&gt;ATSåˆè§„è¦æ±‚&lt;/a&gt;, æ¯”å¦‚&lt;a href="https://www.microsoft.com/security/blog/2017/06/20/tls-1-2-support-at-microsoft/"&gt;å¾®è½¯å»ºè®®ä½ æ”¾å¼ƒTLS v1.0å’Œ TLS v1.1çš„æ”¯æŒ&lt;/a&gt;ã€‚å› æ­¤ï¼Œè¡Œä¸šæ­£åœ¨æœç€æ ‡å‡†è¿ˆè¿›ã€‚&lt;/p&gt;
&lt;h3 id="tls-v12"&gt;æ”¯æŒTLS v1.2å®¢æˆ·ç«¯åˆ—è¡¨&lt;a class="headerlink" href="#tls-v12" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Windows 8 ä»¥ä¸Š (Windows Server 2008ä»¥ä¸Š - 2017å¹´ä¸‹åŠå¹´æ‰æ”¯æŒ) (&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt; win7ä¸æ”¯æŒ! æ›´åˆ«æwin xpäº†)&lt;/li&gt;
&lt;li&gt;&lt;a href="https://access.redhat.com/blogs/766093/posts/1976123"&gt;RHEL æˆ– CentOS â‰¥ 6.5&lt;/a&gt; (&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;ç”¨CentOS 5.Xçš„æ³¨æ„äº†å•Š, ä¸æ”¯æŒTLS v1.2 â€‹)&lt;/li&gt;
&lt;li&gt;Chrome â‰¥ 30&lt;/li&gt;
&lt;li&gt;å®‰å“ â‰¥ 5.0&lt;/li&gt;
&lt;li&gt;ç«ç‹æµè§ˆå™¨ â‰¥ 27&lt;/li&gt;
&lt;li&gt;IE/Edge â‰¥ 11 (&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;ä¸»æµçš„IE8 9 10éƒ½ä¸æ”¯æŒ!)&lt;/li&gt;
&lt;li&gt;iOS â‰¥ 5&lt;ul&gt;
&lt;li&gt;æ³¨æ„ï¼šiOS 9åº”ç”¨éœ€è¦TLS 1.2æ”¯æŒã€‚(ATSåˆè§„è¦æ±‚, å½“æ—¶åæ¥å¥½åƒå¾ˆéš¾æ¨ä¸‹å»)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="tls-10"&gt;æ”¯æŒTLS 1.0 å®¢æˆ·ç«¯åˆ—è¡¨&lt;a class="headerlink" href="#tls-10" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;TLS 1.0 ï¼ˆçœŸæ­£å®‰å…¨çš„æœ€è€ç‰ˆæœ¬ï¼‰å‡ ä¹éƒ½æ”¯æŒï¼ˆé™¤äº†win xp sp2)ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img alt="win xp sp2" src="./images/winxpsp2.png"&gt;&lt;/p&gt;
&lt;h2 id="_6"&gt;é…ç½®å»ºè®®&lt;a class="headerlink" href="#_6" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;å†æ¬¡æ¨è&lt;a href="https://www.ssllabs.com/"&gt;SSL Labs&lt;/a&gt;, æ‰“åˆ†å¦‚ä¸‹:&lt;/p&gt;
&lt;p&gt;&lt;img alt="SSL Labsæ‰“åˆ†ç¤ºä¾‹" src="./images/ssl-labs-example.png"&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="_7"&gt;é«˜å®‰å…¨æ€§ ä½å…¼å®¹æ€§&lt;a class="headerlink" href="#_7" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;SSLProtocol             all -SSLv3 -TLSv1 -TLSv1.1&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åªæ”¯æŒTLS v1.2.&lt;/strong&gt; å½“ä½ é…ç½®åŠ å¯†åè®®æ—¶ï¼Œå¦‚æœåªé€‰æ‹©TLS&lt;br&gt;
1.2,å¾—åˆ†ä¼šæ˜¯&lt;strong&gt;A&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h3 id="_8"&gt;ä¸­å®‰å…¨æ€§ é«˜å…¼å®¹æ€§&lt;a class="headerlink" href="#_8" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;SSLProtocol             all -SSLv3&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;åªæ”¯æŒ&lt;strong&gt;TLS&lt;/strong&gt;åè®®, å¾—åˆ†ä¹Ÿä¼šæ˜¯&lt;strong&gt;A&lt;/strong&gt;. (ä¹‹å‰çš„, è¿‘æœŸä¸ç¡®å®š, æ„Ÿå…´è¶£çš„å¯ä»¥æµ‹ä¸€ä¸‹).&lt;/p&gt;
&lt;h3 id="_9"&gt;ä½å®‰å…¨æ€§ æœ€å¤§å…¼å®¹æ€§&lt;a class="headerlink" href="#_9" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;SSLProtocol             all&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å¦‚æœä½¿ç”¨SSLv3.0ï¼Œæœ‰é£é™©ï¼Œå¾—Cã€‚&lt;/p&gt;
&lt;h2 id="_10"&gt;æ€»ç»“&lt;a class="headerlink" href="#_10" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;é€‰æ‹©åŠ å¯†åè®®, è¦æ ¹æ®å…·ä½“çš„éœ€æ±‚, æœ‰ä¾§é‡, ä¹Ÿè¦åšåˆ°å®‰å…¨æ€§å’Œå…¼å®¹æ€§çš„å…¼é¡¾.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä¹‹å‰æœ‰ä¸ªç›¸å…³çš„PPT, æ„Ÿå…´è¶£çš„è¯åç»­å‘ä¸Šæ¥.&lt;/p&gt;
&lt;/blockquote&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sat, 30 Mar 2019 00:08:23 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-03-30:/https-101-chapter-1.html</guid><category>linux</category><category>openssl</category><category>ssl</category><category>nginx</category><category>centos</category></item></channel></rss>