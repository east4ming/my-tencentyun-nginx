<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"><channel><title>ä¸œé£å¾®é¸£ Blog - k8s</title><link>https://www.EWhisper.cn/</link><description>Focus on Python/Java/DevOps/Observability</description><lastBuildDate>Sun, 26 May 2019 21:24:52 +0800</lastBuildDate><item><title>ä½¿ç”¨ Docker å®‰è£… Gitlab</title><link>https://www.EWhisper.cn/install-gitlab-with-docker.html</link><description>&lt;h2 id="docker"&gt;Docker å®‰è£…&lt;a class="headerlink" href="#docker" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"&gt; è¯´æ˜:&lt;/p&gt;
&lt;p&gt;å®˜ç½‘é“¾æ¥:&lt;a href="https://docs.gitlab.com/omnibus/docker/"&gt;GitLab Docker images&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/docker/Dockerfile"&gt;å®˜ç½‘ Dockerfile&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo docker pull gitlab/gitlab-ce  &lt;span class="c1"&gt;# ä¸‹è½½&lt;/span&gt;
sudo docker run --detach &lt;span class="se"&gt;\&lt;/span&gt;
  --hostname gitlab.example.com &lt;span class="se"&gt;\&lt;/span&gt;
  --publish &lt;span class="m"&gt;443&lt;/span&gt;:443 --publish &lt;span class="m"&gt;80&lt;/span&gt;:80 --publish &lt;span class="m"&gt;22&lt;/span&gt;:22 &lt;span class="se"&gt;\&lt;/span&gt;
  --name gitlab &lt;span class="se"&gt;\&lt;/span&gt;
  --restart always &lt;span class="se"&gt;\&lt;/span&gt;
  --volume /srv/gitlab/config:/etc/gitlab &lt;span class="se"&gt;\&lt;/span&gt;
  --volume /srv/gitlab/logs:/var/log/gitlab &lt;span class="se"&gt;\&lt;/span&gt;
  --volume /srv/gitlab/data:/var/opt/gitlab &lt;span class="se"&gt;\&lt;/span&gt;
  gitlab/gitlab-ce:latest  &lt;span class="c1"&gt;# è¿è¡Œå®¹å™¨&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="_1"&gt;æ•°æ®å­˜åœ¨å“ªå„¿:&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;æœ¬åœ°ä½ç½®&lt;/th&gt;
&lt;th align="left"&gt;å®¹å™¨ä½ç½®&lt;/th&gt;
&lt;th align="left"&gt;ç”¨é€”&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;&lt;code&gt;/srv/gitlab/data&lt;/code&gt;&lt;/td&gt;
&lt;td align="left"&gt;&lt;code&gt;/var/opt/gitlab&lt;/code&gt;&lt;/td&gt;
&lt;td align="left"&gt;ç”¨äºå­˜å‚¨åº”ç”¨æ•°æ®&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;&lt;code&gt;/srv/gitlab/logs&lt;/code&gt;&lt;/td&gt;
&lt;td align="left"&gt;&lt;code&gt;/var/log/gitlab&lt;/code&gt;&lt;/td&gt;
&lt;td align="left"&gt;ç”¨äºå­˜å‚¨æ—¥å¿—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;&lt;code&gt;/srv/gitlab/config&lt;/code&gt;&lt;/td&gt;
&lt;td align="left"&gt;&lt;code&gt;/etc/gitlab&lt;/code&gt;&lt;/td&gt;
&lt;td align="left"&gt;ç”¨äºå­˜å‚¨GitLabé…ç½®æ–‡ä»¶&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="gitlab"&gt;é…ç½®Gitlab:&lt;a class="headerlink" href="#gitlab" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;é…ç½®æ–‡ä»¶ä½äº: &lt;code&gt;/etc/gitlab/gitlab.rb&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;å‡ ç§é…ç½®æ–¹å¼:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;sudo docker exec -it gitlab /bin/bash&lt;/code&gt; è¿›å…¥åˆ°å®¹å™¨å†…, ç„¶åé€šè¿‡&lt;code&gt;vi&lt;/code&gt;ç¼–è¾‘ä¿å­˜&lt;/li&gt;
&lt;li&gt;&lt;code&gt;sudo docker exec -it gitlab editor /etc/gitlab/gitlab.rb&lt;/code&gt; &lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ç¼–è¾‘å®Œä¹‹å, é‡å¯å®¹å™¨:&lt;code&gt;sudo docker restart gitlab&lt;/code&gt;&lt;/p&gt;
&lt;h3 id="docker_1"&gt;é¢„é…ç½® Docker å®¹å™¨&lt;a class="headerlink" href="#docker_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä¹Ÿå¯ä»¥é€šè¿‡å°†ç¯å¢ƒå˜é‡&lt;code&gt;GITLAB_OMNIBUS_CONFIG&lt;/code&gt;æ·»åŠ åˆ°docker runå‘½ä»¤æ¥é¢„é…ç½®GitLab Dockeræ˜ åƒã€‚æ­¤å˜é‡å¯ä»¥åŒ…å«ä»»ä½•&lt;code&gt;gitlab.rb&lt;/code&gt;è®¾ç½®ï¼Œå¹¶åœ¨åŠ è½½å®¹å™¨&lt;code&gt;gitlab.rb&lt;/code&gt;æ–‡ä»¶ä¹‹å‰è¿›è¡ŒåŠ è½½ã€‚&lt;/p&gt;
&lt;p&gt;ç¤ºä¾‹å¦‚ä¸‹:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo docker run --detach &lt;span class="se"&gt;\&lt;/span&gt;
  --hostname gitlab.example.com &lt;span class="se"&gt;\&lt;/span&gt;
  --env &lt;span class="nv"&gt;GITLAB_OMNIBUS_CONFIG&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;external_url &amp;#39;http://my.domain.com/&amp;#39;; gitlab_rails[&amp;#39;lfs_enabled&amp;#39;] = true;&amp;quot;&lt;/span&gt; &lt;span class="se"&gt;\&lt;/span&gt;
  --publish &lt;span class="m"&gt;443&lt;/span&gt;:443 --publish &lt;span class="m"&gt;80&lt;/span&gt;:80 --publish &lt;span class="m"&gt;22&lt;/span&gt;:22 &lt;span class="se"&gt;\&lt;/span&gt;
  --name gitlab &lt;span class="se"&gt;\&lt;/span&gt;
  --restart always &lt;span class="se"&gt;\&lt;/span&gt;
  --volume /srv/gitlab/config:/etc/gitlab &lt;span class="se"&gt;\&lt;/span&gt;
  --volume /srv/gitlab/logs:/var/log/gitlab &lt;span class="se"&gt;\&lt;/span&gt;
  --volume /srv/gitlab/data:/var/opt/gitlab &lt;span class="se"&gt;\&lt;/span&gt;
  gitlab/gitlab-ce:latest
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="_2"&gt;å¯åŠ¨å®¹å™¨å&lt;a class="headerlink" href="#_2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡&lt;a href="http://localhost"&gt;http://localhost&lt;/a&gt; è¿›è¡Œè®¿é—®.&lt;/p&gt;
&lt;p&gt;å¯ä»¥é€šè¿‡ &lt;code&gt;sudo docker logs -f gitlab&lt;/code&gt; æŸ¥çœ‹æ—¥å¿—.&lt;/p&gt;
&lt;h3 id="ip"&gt;å‘å¸ƒåˆ°å…¬ç½‘IP&lt;a class="headerlink" href="#ip" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo docker run --detach &lt;span class="se"&gt;\&lt;/span&gt;
  --hostname gitlab.example.com &lt;span class="se"&gt;\&lt;/span&gt;
  --publish &lt;span class="m"&gt;198&lt;/span&gt;.51.100.1:443:443 &lt;span class="se"&gt;\&lt;/span&gt;
  --publish &lt;span class="m"&gt;198&lt;/span&gt;.51.100.1:80:80 &lt;span class="se"&gt;\&lt;/span&gt;
  --publish &lt;span class="m"&gt;198&lt;/span&gt;.51.100.1:22:22 &lt;span class="se"&gt;\&lt;/span&gt;
  --name gitlab &lt;span class="se"&gt;\&lt;/span&gt;
  --restart always &lt;span class="se"&gt;\&lt;/span&gt;
  --volume /srv/gitlab/config:/etc/gitlab &lt;span class="se"&gt;\&lt;/span&gt;
  --volume /srv/gitlab/logs:/var/log/gitlab &lt;span class="se"&gt;\&lt;/span&gt;
  --volume /srv/gitlab/data:/var/opt/gitlab &lt;span class="se"&gt;\&lt;/span&gt;
  gitlab/gitlab-ce:latest
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="docker-composegitlab"&gt;ä½¿ç”¨docker-composeå®‰è£…GitLab&lt;a class="headerlink" href="#docker-composegitlab" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;å®‰è£… docker compose&lt;/li&gt;
&lt;li&gt;åˆ›å»º&lt;code&gt;docker-compose.yml&lt;/code&gt; æ–‡ä»¶ï¼ˆæˆ–&lt;a href="https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/docker/docker-compose.yml"&gt;ä¸‹è½½ç¤ºä¾‹&lt;/a&gt;ï¼‰: &lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt; &lt;span class="nt"&gt;web&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
   &lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;gitlab/gitlab-ce:latest&amp;#39;&lt;/span&gt;
   &lt;span class="nt"&gt;restart&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;always&lt;/span&gt;
   &lt;span class="nt"&gt;hostname&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;gitlab.example.com&amp;#39;&lt;/span&gt;
   &lt;span class="nt"&gt;environment&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
     &lt;span class="nt"&gt;GITLAB_OMNIBUS_CONFIG&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;|&lt;/span&gt;
       &lt;span class="no"&gt;external_url &amp;#39;https://gitlab.example.com&amp;#39;&lt;/span&gt;
       &lt;span class="no"&gt;# Add any other gitlab.rb configuration here, each on its own line&lt;/span&gt;
   &lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
     &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;80:80&amp;#39;&lt;/span&gt;
     &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;443:443&amp;#39;&lt;/span&gt;
     &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;22:22&amp;#39;&lt;/span&gt;
   &lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
     &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;/srv/gitlab/config:/etc/gitlab&amp;#39;&lt;/span&gt;
     &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;/srv/gitlab/logs:/var/log/gitlab&amp;#39;&lt;/span&gt;
     &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;/srv/gitlab/data:/var/opt/gitlab&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ol start="3"&gt;
&lt;li&gt;ç¡®ä¿æ‚¨&lt;code&gt;docker-compose.yml&lt;/code&gt;ä¸è¿è¡Œ&lt;code&gt;docker-compose up -d&lt;/code&gt; åœ¨åŒä¸€ç›®å½•ä¸­ä»¥è¿è¡ŒGitLab&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="openshift"&gt;OpenShift å®‰è£…&lt;a class="headerlink" href="#openshift" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt; æ³¨æ„:&lt;/p&gt;
&lt;p&gt;ç›®å‰Gitlabé€šè¿‡OpenShift å®‰è£…, æœ‰ä¸€äº›å·²çŸ¥çš„é—®é¢˜. å¹¶ä¸”åªåœ¨OpenShift 3.11ç‰ˆæœ¬ä¸Šæµ‹è¯•é€šè¿‡.&lt;/p&gt;
&lt;p&gt;å¦å¤–, å®‰è£…æ˜¯é€šè¿‡ Helm Chartæ–¹å¼è¿›è¡Œå®‰è£…çš„. è¿˜æ˜¯æœ‰ç‚¹å¤æ‚çš„...&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id="_3"&gt;å·²çŸ¥çš„é—®é¢˜&lt;a class="headerlink" href="#_3" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;ä»¥ä¸‹é—®é¢˜æ˜¯å·²çŸ¥çš„ï¼Œå¹¶ä¸”é¢„è®¡é€‚ç”¨äºOpenShiftä¸Šçš„GitLabå®‰è£…ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;anyuid&lt;/code&gt;sccçš„è¦æ±‚ï¼š(OpenShift çš„å®‰å…¨åŠ å›ºå¯¼è‡´çš„)&lt;ul&gt;
&lt;li&gt;GitLabçš„ä¸åŒç»„ä»¶ï¼Œå¦‚Sidekiqï¼Œunicornç­‰ï¼Œä½¿ç”¨UID 1000æ¥è¿è¡ŒæœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;PostgreSQL chartä»¥&lt;code&gt;root&lt;/code&gt;ç”¨æˆ·èº«ä»½è¿è¡ŒæœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;a href="https://gitlab.com/charts/gitlab/issues/752"&gt;é—®é¢˜ï¼ƒ752&lt;/a&gt;æ˜¯opençŠ¶æ€ï¼Œä»¥è°ƒæŸ¥æ›´å¤šæœ‰å…³è§£å†³æ­¤é—®é¢˜çš„ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;å¦‚æœä½¿ç”¨&lt;code&gt;hostpath&lt;/code&gt;å·ï¼Œåˆ™éœ€è¦ä¸ºä¸»æœºä¸­çš„æŒä¹…æ€§å·ç›®å½•æˆäºˆ&lt;code&gt;0777&lt;/code&gt;æƒé™ï¼Œä»¥æˆäºˆæ‰€æœ‰ç”¨æˆ·å¯¹å·çš„è®¿é—®æƒé™ã€‚&lt;/li&gt;
&lt;li&gt;OpenShiftçš„å†…ç½®router ä¸æ”¯æŒé€šè¿‡SSHè¿›è¡ŒGitæ“ä½œã€‚ &lt;a href="https://gitlab.com/charts/gitlab/issues/892"&gt;é—®é¢˜ï¼ƒ892&lt;/a&gt; æ˜¯oepnçŠ¶æ€ï¼Œä»¥è°ƒæŸ¥æ›´å¤šæœ‰å…³è§£å†³æ­¤é—®é¢˜çš„ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;ä¼—æ‰€å‘¨çŸ¥ï¼ŒGitLab Registryä¸èƒ½ä¸OpenShiftçš„å†…ç½®routeré…åˆä½¿ç”¨ã€‚ &lt;a href="https://gitlab.com/charts/gitlab/issues/893"&gt;é—®é¢˜ï¼ƒ893&lt;/a&gt;æ˜¯opençŠ¶æ€ï¼Œä»¥è°ƒæŸ¥æ›´å¤šæœ‰å…³ä¿®å¤æ­¤é—®é¢˜çš„ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;ä»Let's Encryptè‡ªåŠ¨å‘å‡ºSSLè¯ä¹¦ä¸é€‚ç”¨äºOpenShift routerã€‚æˆ‘ä»¬å»ºè®®&lt;a href="https://docs.gitlab.com/charts/installation/tls.html#option-2-use-your-own-wildcard-certificate"&gt;æ‚¨ä½¿ç”¨è‡ªå·±çš„è¯ä¹¦&lt;/a&gt;ã€‚ &lt;a href="https://gitlab.com/charts/gitlab/issues/894"&gt;é—®é¢˜ï¼ƒ894&lt;/a&gt;å¼€æ”¾ï¼Œä»¥è°ƒæŸ¥æ›´å¤šæœ‰å…³è§£å†³æ­¤é—®é¢˜çš„ä¿¡æ¯ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="_4"&gt;å…ˆå†³æ¡ä»¶æ­¥éª¤&lt;a class="headerlink" href="#_4" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;è¯·å‚é˜…&lt;a href="https://www.okd.io/download.html#oc-platforms"&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt; ä»¥å®‰è£…å’Œé…ç½®ç¾¤é›†ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;è¿è¡Œ&lt;code&gt;oc cluster status&lt;/code&gt;å¹¶ç¡®è®¤ç¾¤é›†æ­£åœ¨è¿è¡Œï¼š&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;oc cluster status
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;è¾“å‡ºåº”ç±»ä¼¼äºï¼š
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Web console URL: https://gitlab.example.com:8443/console/

Config is at host directory
Volumes are at host directory
Persistent volumes are at host directory /home/okduser/openshift/openshift.local.clusterup/openshift.local.pv
Data will be discarded when cluster is destroyed
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;è¯·æ³¨æ„ä¸»æœºä¸­Persistent Volumesçš„ä½ç½®ï¼ˆåœ¨ä¸Šä¾‹ä¸­`/home/okduser/openshift/openshift.local.clusterup/openshift.local.pv`ï¼‰ã€‚ä»¥ä¸‹å‘½ä»¤éœ€è¦`PV_HOST_DIRECTORY`ç¯å¢ƒå˜é‡ä¸­çš„è·¯å¾„ã€‚
&lt;/pre&gt;&lt;/div&gt;


&lt;ol start="3"&gt;
&lt;li&gt;ä¿®æ”¹PVç›®å½•çš„æƒé™ï¼ˆç”¨ä»¥ä¸Šå€¼æ›¿æ¢ä»¥ä¸‹å‘½ä»¤ä¸­çš„è·¯å¾„ï¼‰ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo chmod -R a+rwx &lt;span class="si"&gt;${&lt;/span&gt;&lt;span class="nv"&gt;PV_HOST_DIRECTORY&lt;/span&gt;&lt;span class="si"&gt;}&lt;/span&gt;/*
&lt;/pre&gt;&lt;/div&gt;


&lt;ol start="4"&gt;
&lt;li&gt;åˆ‡æ¢åˆ°ç³»ç»Ÿç®¡ç†å‘˜ç”¨æˆ·ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;oc login -u system:admin
&lt;/pre&gt;&lt;/div&gt;


&lt;ol start="5"&gt;
&lt;li&gt;å°†&lt;code&gt;anyuid&lt;/code&gt;scc æ·»åŠ åˆ°ç³»ç»Ÿç”¨æˆ·ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;oc adm policy add-scc-to-group anyuid system:authenticated
&lt;/pre&gt;&lt;/div&gt;


&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;**è­¦å‘Š**ï¼šæ­¤è®¾ç½®å°†åº”ç”¨äºæ‰€æœ‰namespaceï¼Œå¹¶å°†å¯¼è‡´Dockeré•œåƒæœªæ˜ç¡®æŒ‡å®šUSERä½œä¸º`root`ç”¨æˆ·è¿è¡Œã€‚ [é—®é¢˜ï¼ƒ895](https://gitlab.com/charts/gitlab/issues/895)æ˜¯å¼€æ”¾çš„ï¼Œç”¨äºè®°å½•æ‰€éœ€çš„ä¸åŒæœåŠ¡å¸æˆ·ï¼Œå¹¶æè¿°ä»…å°†sccæ·»åŠ åˆ°è¿™äº›æœåŠ¡å¸æˆ·ï¼Œå› æ­¤å½±å“å¯èƒ½æœ‰é™ã€‚
&lt;/pre&gt;&lt;/div&gt;


&lt;ol start="6"&gt;
&lt;li&gt;åˆ›å»ºæœåŠ¡å¸æˆ·å’Œ&lt;code&gt;rolebinding&lt;/code&gt;RBACå¹¶&lt;a href="https://docs.gitlab.com/charts/installation/tools.html#helm"&gt;å®‰è£…Tiller&lt;/a&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;kubectl create -f https://gitlab.com/charts/gitlab/raw/master/doc/installation/examples/rbac-config.yaml
helm init --service-account tiller
&lt;/pre&gt;&lt;/div&gt;


&lt;h3 id="_5"&gt;ä¸‹ä¸€æ­¥&lt;a class="headerlink" href="#_5" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;åœ¨ç¾¤é›†å¯åŠ¨å¹¶è¿è¡Œåï¼Œç»§ç»­&lt;a href="https://docs.gitlab.com/charts/installation/deployment.html"&gt;å®‰è£…chart&lt;/a&gt;ï¼Œå¹¶å‡†å¤‡å¥½é™æ€IPå’ŒDNSæ¡ç›®ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨æ­¤ä¹‹å‰ï¼Œè¯·æ³¨æ„å¸¸è§„ chartå®‰è£…è¿‡ç¨‹ä¸­çš„ä»¥ä¸‹æ›´æ”¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æˆ‘ä»¬å°†ä½¿ç”¨OpenShiftçš„å†…ç½®routerï¼Œå› æ­¤éœ€è¦ç¦ç”¨chartä¸­åŒ…å«çš„nginx-ingressæœåŠ¡ã€‚å°†ä»¥ä¸‹æ ‡å¿—ä¼ é€’ç»™&lt;code&gt;helm install&lt;/code&gt;å‘½ä»¤ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;--set nginx-ingress.enabled&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;false&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ol start="2"&gt;
&lt;li&gt;ç”±äºå·²çŸ¥å†…ç½®æ³¨å†Œè¡¨ä¸èƒ½ä½¿ç”¨Helm Chartä¸OpenShiftä¸€èµ·ä½¿ç”¨ï¼Œå› æ­¤è¯·ç¦ç”¨æ³¨å†Œè¡¨æœåŠ¡ã€‚å°†ä»¥ä¸‹æ ‡å¿—ä¼ é€’ç»™ &lt;code&gt;helm install&lt;/code&gt;å‘½ä»¤ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;--set registry.enabled=false
&lt;/pre&gt;&lt;/div&gt;


&lt;ol start="3"&gt;
&lt;li&gt;&lt;a href="https://docs.gitlab.com/charts/installation/tls.html#option-2-use-your-own-wildcard-certificate"&gt;ä½¿ç”¨æ‚¨è‡ªå·±çš„SSLè¯ä¹¦&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Sun, 26 May 2019 21:24:52 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-05-26:/install-gitlab-with-docker.html</guid><category>docker</category><category>openshift</category><category>k8s</category><category>containers</category><category>git</category></item><item><title>å®¹å™¨è‡ªåŠ¨ä¼¸ç¼©</title><link>https://www.EWhisper.cn/openshift-pod-autoscaling.html</link><description>&lt;div class="toc"&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href="#_1"&gt;æ¦‚è§ˆ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#horizontal-pod-autoscalers"&gt;ä½¿ç”¨Horizontal Pod Autoscalersçš„è¦æ±‚&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_2"&gt;æ”¯æŒçš„æŒ‡æ ‡&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_3"&gt;è‡ªåŠ¨ç¼©æ”¾&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#cpu"&gt;æ ¹æ®CPUåˆ©ç”¨ç‡è‡ªåŠ¨æ‰©å±•&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#_4"&gt;æ ¹æ®å†…å­˜åˆ©ç”¨ç‡è‡ªåŠ¨ç¼©æ”¾&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href="#horizontal-pod-autoscaler"&gt;æŸ¥çœ‹Horizontal Pod Autoscaler&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href="#horizontal-pod-autoscaler-status-conditions"&gt;æŸ¥çœ‹Horizontal Pod Autoscaler Status Conditions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;h2 id="_1"&gt;æ¦‚è§ˆ&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;img alt="" src="./images/Matrix-agent-Smith-clones.jpg"&gt;&lt;/p&gt;
&lt;p&gt;ç”±&lt;code&gt;HorizontalPodAutoscaler&lt;/code&gt;å¯¹è±¡å®šä¹‰çš„æ¨ªå‘podè‡ªåŠ¨ä¼¸ç¼©å™¨(autoscaler)æŒ‡å®šç³»ç»Ÿåº”å¦‚ä½•æ ¹æ®ä»å±äºè¯¥å¤åˆ¶æ§åˆ¶å™¨(replication controller)æˆ–éƒ¨ç½²é…ç½®(deployment configuration)çš„podæ”¶é›†çš„åº¦é‡æ ‡å‡†(metrics)è‡ªåŠ¨å¢åŠ æˆ–å‡å°‘å¤åˆ¶æ§åˆ¶å™¨æˆ–éƒ¨ç½²é…ç½®çš„è§„æ¨¡ã€‚&lt;/p&gt;
&lt;h2 id="horizontal-pod-autoscalers"&gt;ä½¿ç”¨Horizontal Pod Autoscalersçš„è¦æ±‚&lt;a class="headerlink" href="#horizontal-pod-autoscalers" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;è¦ä½¿ç”¨æ¨ªå‘podè‡ªåŠ¨ä¼¸ç¼©å™¨(horizontal pod autoscalers)ï¼Œæ‚¨éœ€è¦å®‰è£…OpenShift Container Platformåº¦é‡æœåŠ¡å™¨ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ ansible-playbook &lt;span class="se"&gt;\&lt;/span&gt;
/usr/share/ansible/openshift-ansible/playbooks/metrics-server/config.yml &lt;span class="se"&gt;\&lt;/span&gt;
-e &lt;span class="nv"&gt;openshift_metrics_server_install&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="nb"&gt;true&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯æœåŠ¡å™¨æ˜¯å¦å·²æ­£ç¡®å®‰è£…ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ oc adm top node
$ oc adm top pod
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;æœ‰å…³è¿™äº›å‘½ä»¤çš„å…¶ä»–ä¿¡æ¯ï¼Œè¯·å‚é˜… &lt;a href="https://docs.openshift.com/container-platform/3.11/admin_guide/manage_nodes.html#viewing-nodes"&gt;æŸ¥çœ‹Nodes&lt;/a&gt;å’Œ &lt;a href="https://docs.openshift.com/container-platform/3.11/admin_guide/managing_pods.html#viewing-pods"&gt;æŸ¥çœ‹Pods&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;h2 id="_2"&gt;æ”¯æŒçš„æŒ‡æ ‡&lt;a class="headerlink" href="#_2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Horizontal pod autoscalersæ”¯æŒä»¥ä¸‹åº¦é‡æ ‡å‡†ï¼š&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align="left"&gt;æŒ‡æ ‡&lt;/th&gt;
&lt;th align="left"&gt;æè¿°&lt;/th&gt;
&lt;th align="left"&gt;APIç‰ˆæœ¬&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align="left"&gt;CPUåˆ©ç”¨ç‡&lt;/td&gt;
&lt;td align="left"&gt;&lt;a href="https://docs.openshift.com/container-platform/3.11/dev_guide/compute_resources.html#dev-cpu-requests"&gt;è¯·æ±‚çš„CPUçš„&lt;/a&gt;ç™¾åˆ†æ¯”&lt;/td&gt;
&lt;td align="left"&gt;&lt;code&gt;autoscaling/v1&lt;/code&gt;ï¼Œ &lt;code&gt;autoscaling/v2beta1&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align="left"&gt;å†…å­˜åˆ©ç”¨ç‡&lt;/td&gt;
&lt;td align="left"&gt;è¯·æ±‚çš„å†…å­˜ç™¾åˆ†æ¯”&lt;/td&gt;
&lt;td align="left"&gt;&lt;code&gt;autoscaling/v2beta1&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id="_3"&gt;è‡ªåŠ¨ç¼©æ”¾&lt;a class="headerlink" href="#_3" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;æ‚¨å¯ä»¥ä½¿ç”¨&lt;code&gt;oc autoscale&lt;/code&gt;å‘½ä»¤åˆ›å»ºhorizontal pod autoscalerï¼Œå¹¶æŒ‡å®šè¦è¿è¡Œçš„pod çš„æœ€å°å’Œæœ€å¤§æ•°é‡ï¼Œä»¥åŠpodåº”æŒ‡å‘çš„ &lt;a href="https://docs.openshift.com/container-platform/3.11/dev_guide/pod_autoscaling.html#creating-a-hpa"&gt;CPUåˆ©ç”¨ç‡&lt;/a&gt;æˆ–&lt;a href="https://docs.openshift.com/container-platform/3.11/dev_guide/pod_autoscaling.html#pod-autoscaling-memory"&gt;å†…å­˜åˆ©ç”¨ç‡&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;åˆ›å»ºhorizontal pod autoscaleråï¼Œå®ƒå¼€å§‹å°è¯•æŸ¥è¯¢Heapsterä»¥è·å–podä¸Šçš„æŒ‡æ ‡ã€‚åœ¨Heapsterè·å¾—åˆå§‹æŒ‡æ ‡ä¹‹å‰å¯èƒ½éœ€è¦ä¸€åˆ°ä¸¤åˆ†é’Ÿã€‚&lt;/p&gt;
&lt;p&gt;åœ¨Heapsterä¸­æä¾›åº¦é‡æ ‡å‡†åï¼Œhorizontal pod autoscalerå°†è®¡ç®—å½“å‰åº¦é‡æ ‡å‡†åˆ©ç”¨ç‡ä¸æ‰€éœ€åº¦é‡æ ‡å‡†åˆ©ç”¨ç‡çš„æ¯”ç‡ï¼Œå¹¶ç›¸åº”åœ°å‘ä¸Šæˆ–å‘ä¸‹æ‰©å±•ã€‚ç¼©æ”¾å°†å®šæœŸå‘ç”Ÿï¼Œä½†åœ¨æŒ‡æ ‡è¿›å…¥Heapsterä¹‹å‰å¯èƒ½éœ€è¦ä¸€åˆ°ä¸¤åˆ†é’Ÿã€‚&lt;/p&gt;
&lt;p&gt;å¯¹äºå¤åˆ¶æ§åˆ¶å™¨(replication controller)ï¼Œæ­¤æ‰©å±•ç›´æ¥å¯¹åº”äºå¤åˆ¶æ§åˆ¶å™¨çš„å‰¯æœ¬ã€‚å¯¹äºéƒ¨ç½²é…ç½®(deployment configuration)ï¼Œæ­¤æ‰©å±•ç›´æ¥å¯¹åº”äºéƒ¨ç½²é…ç½®çš„å‰¯æœ¬è®¡æ•°ã€‚è¯·æ³¨æ„ï¼Œè‡ªåŠ¨ç¼©æ”¾ä»…é€‚ç”¨äº&lt;code&gt;Complete&lt;/code&gt;é˜¶æ®µä¸­çš„æœ€æ–°éƒ¨ç½²ã€‚&lt;/p&gt;
&lt;p&gt;OpenShift Container Platformè‡ªåŠ¨å¯¹èµ„æºè¿›è¡Œæ ¸ç®—ï¼Œå¹¶é˜²æ­¢åœ¨èµ„æºæ¿€å¢æœŸé—´ï¼ˆä¾‹å¦‚å¯åŠ¨æœŸé—´ï¼‰è¿›è¡Œä¸å¿…è¦çš„è‡ªåŠ¨æ‰©å±•ã€‚åœ¨å‘ä¸Šæ‰©å±•æ—¶ï¼Œ&lt;code&gt;unready&lt;/code&gt;çŠ¶æ€ä¸­çš„podçš„CPUä½¿ç”¨ç‡ä¸º&lt;code&gt;0 CPU&lt;/code&gt;ï¼Œå¹¶ä¸”autoscaleråœ¨å‘ä¸‹ä¼¸ç¼©æ—¶ä¼šå¿½ç•¥è¿™äº›podã€‚æ— æ³•è·å–åˆ°æŒ‡æ ‡çš„podåœ¨å‘ä¸Šä¼¸ç¼©æ—¶CPUä½¿ç”¨ç‡ä¸º0%ï¼Œå‘ä¸‹ä¼¸ç¼©æ—¶CPUä½¿ç”¨ç‡ä¸º100%ã€‚è¿™æ ·å¯ä»¥åœ¨HPAå†³ç­–æœŸé—´å®ç°æ›´é«˜çš„ç¨³å®šæ€§ã€‚è¦ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œæ‚¨å¿…é¡»é…ç½® &lt;a href="https://docs.openshift.com/container-platform/3.11/dev_guide/application_health.html#dev-guide-application-health"&gt;readiness checks&lt;/a&gt; ä»¥ç¡®å®šæ˜¯å¦å¯ä»¥ä½¿ç”¨æ–°å®¹å™¨ã€‚&lt;/p&gt;
&lt;h2 id="cpu"&gt;æ ¹æ®CPUåˆ©ç”¨ç‡è‡ªåŠ¨æ‰©å±•&lt;a class="headerlink" href="#cpu" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;oc autoscale&lt;/code&gt;å‘½ä»¤å¹¶æŒ‡å®šåœ¨ä»»ä½•ç»™å®šæ—¶é—´è‡³å°‘è¦è¿è¡Œçš„æœ€å¤§podæ•°ã€‚æ‚¨å¯ä»¥é€‰æ‹©æŒ‡å®špodçš„æœ€å°æ•°é‡ä»¥åŠpodåº”è¯¥å®šä½çš„å¹³å‡CPUåˆ©ç”¨ç‡ï¼Œå¦åˆ™å°†ä»OpenShift Container PlatformæœåŠ¡å™¨è·å¾—è¿™äº›é»˜è®¤å€¼ã€‚&lt;/p&gt;
&lt;p&gt;ä¾‹å¦‚ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ oc autoscale dc/frontend --min &lt;span class="m"&gt;1&lt;/span&gt; --max &lt;span class="m"&gt;10&lt;/span&gt; --cpu-percent&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="m"&gt;80&lt;/span&gt;
deploymentconfig &lt;span class="s2"&gt;&amp;quot;frontend&amp;quot;&lt;/span&gt; autoscaled
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä¸Šé¢çš„ç¤ºä¾‹åœ¨ä½¿ç”¨&lt;code&gt;autoscaling/v1&lt;/code&gt;ç‰ˆæœ¬çš„horizontal pod autoscaleræ—¶ä¼šåˆ›å»ºä¸€ä¸ªå…·æœ‰ä»¥ä¸‹å®šä¹‰çš„horizontal pod autoscalerï¼š&lt;/p&gt;
&lt;p&gt;ä¾‹1. Horizontal Pod Autoscaler å¯¹è±¡å®šä¹‰&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;autoscaling/v1&lt;/span&gt;
&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;HorizontalPodAutoscaler&lt;/span&gt;
&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt; 
&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;scaleTargetRef&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;DeploymentConfig&lt;/span&gt; 
    &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;frontend&lt;/span&gt; 
    &lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;apps/v1&lt;/span&gt; 
    &lt;span class="nt"&gt;subresource&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;scale&lt;/span&gt;
  &lt;span class="nt"&gt;minReplicas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt; 
  &lt;span class="nt"&gt;maxReplicas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;10&lt;/span&gt; 
  &lt;span class="nt"&gt;cpuUtilization&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;targetCPUUtilizationPercentage&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;80&lt;/span&gt; 
&lt;/pre&gt;&lt;/div&gt;


&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‚æ•°&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;metadata.name&lt;/td&gt;
&lt;td&gt;è¿™ä¸ªhorizontal pod autoscaler å¯¹è±¡çš„åå­—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kind&lt;/td&gt;
&lt;td&gt;è¦ä¼¸ç¼©çš„å¯¹è±¡ç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;scaleTargetRef.name&lt;/td&gt;
&lt;td&gt;è¦ä¼¸ç¼©çš„å¯¹è±¡çš„åç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;scaleTargetRef.apiVersion&lt;/td&gt;
&lt;td&gt;è¦æ‰©å±•çš„å¯¹è±¡çš„APIç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;minReplicas&lt;/td&gt;
&lt;td&gt;å‘ä¸‹ä¼¸ç¼©æ—¶çš„æœ€å°å‰¯æœ¬æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;maxReplicas&lt;/td&gt;
&lt;td&gt;å‘ä¸Šæ‰©å±•æ—¶çš„æœ€å¤§å‰¯æœ¬æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;targetCPUUtilizationPercentage&lt;/td&gt;
&lt;td&gt;ç†æƒ³æƒ…å†µä¸‹æ¯ä¸ªpodåº”ä½¿ç”¨çš„è¯·æ±‚CPUçš„ç™¾åˆ†æ¯”&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;æˆ–è€…ï¼Œåœ¨&lt;code&gt;oc autoscale&lt;/code&gt;ä½¿ç”¨horizontal pod autoscalerçš„&lt;code&gt;v2beta1&lt;/code&gt;ç‰ˆæœ¬æ—¶ï¼Œè¯¥å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªå…·æœ‰ä»¥ä¸‹å®šä¹‰çš„horizontal pod autoscaler:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;autoscaling/v2beta1&lt;/span&gt;
&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;HorizontalPodAutoscaler&lt;/span&gt;
&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;hpa-resource-metrics-cpu&lt;/span&gt; 
&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;scaleTargetRef&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;apps/v1&lt;/span&gt; 
    &lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ReplicationController&lt;/span&gt; 
    &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;hello-hpa-cpu&lt;/span&gt; 
  &lt;span class="nt"&gt;minReplicas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt; 
  &lt;span class="nt"&gt;maxReplicas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;10&lt;/span&gt; 
  &lt;span class="nt"&gt;metrics&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Resource&lt;/span&gt;
    &lt;span class="nt"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cpu&lt;/span&gt;
      &lt;span class="nt"&gt;targetAverageUtilization&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;50&lt;/span&gt; 
&lt;/pre&gt;&lt;/div&gt;


&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‚æ•°&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;metadata.name&lt;/td&gt;
&lt;td&gt;è¿™ä¸ªhorizontal pod autoscaler å¯¹è±¡çš„åå­—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;scaleTargetRef.apiVersion&lt;/td&gt;
&lt;td&gt;è¦æ‰©å±•çš„å¯¹è±¡çš„APIç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kind&lt;/td&gt;
&lt;td&gt;è¦æ‰©å±•çš„å¯¹è±¡ç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;scaleTargetRef.name&lt;/td&gt;
&lt;td&gt;è¦ç¼©æ”¾çš„å¯¹è±¡çš„åç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;minReplicas&lt;/td&gt;
&lt;td&gt;å‘ä¸‹ä¼¸ç¼©æ—¶çš„æœ€å°å‰¯æœ¬æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;maxReplicas&lt;/td&gt;
&lt;td&gt;å‘ä¸Šæ‰©å±•æ—¶çš„æœ€å¤§å‰¯æœ¬æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;targetAverageUtilization&lt;/td&gt;
&lt;td&gt;æ¯ä¸ªpodåº”ä½¿ç”¨çš„è¯·æ±‚CPUçš„å¹³å‡ç™¾åˆ†æ¯”&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id="_4"&gt;æ ¹æ®å†…å­˜åˆ©ç”¨ç‡è‡ªåŠ¨ç¼©æ”¾&lt;a class="headerlink" href="#_4" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;ä¸åŸºäºCPUçš„è‡ªåŠ¨ç¼©æ”¾ä¸åŒï¼ŒåŸºäºå†…å­˜çš„è‡ªåŠ¨ç¼©æ”¾éœ€è¦ä½¿ç”¨YAMLè€Œä¸æ˜¯ä½¿ç”¨&lt;code&gt;oc autoscale&lt;/code&gt;å‘½ä»¤æ¥æŒ‡å®šè‡ªåŠ¨ç¼©æ”¾å™¨ã€‚ï¼ˆå¯é€‰ï¼‰æ‚¨å¯ä»¥æŒ‡å®špodçš„æœ€å°æ•°é‡ä»¥åŠpodåº”è¯¥å®šä½çš„å¹³å‡å†…å­˜åˆ©ç”¨ç‡ï¼Œå¦åˆ™å°†ä»OpenShift Container PlatformæœåŠ¡å™¨è·å¾—è¿™äº›é»˜è®¤å€¼ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åŸºäºå†…å­˜çš„è‡ªåŠ¨æ‰©å±•ä»…é€‚ç”¨&lt;code&gt;v2beta1&lt;/code&gt;çš„è‡ªåŠ¨æ‰©å±•API çš„ç‰ˆæœ¬ã€‚é€šè¿‡å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ç¾¤é›†çš„&lt;code&gt;master-config.yaml&lt;/code&gt;æ–‡ä»¶æ¥å¯ç”¨åŸºäºå†…å­˜çš„è‡ªåŠ¨ç¼©æ”¾ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nn"&gt;...&lt;/span&gt;
&lt;span class="nt"&gt;apiServerArguments&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;runtime-config&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;apis/autoscaling/v2beta1=true&lt;/span&gt;
&lt;span class="nn"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;ol start="2"&gt;
&lt;li&gt;å°†ä»¥ä¸‹å†…å®¹æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¾‹å¦‚&lt;code&gt;hpa.yaml&lt;/code&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;autoscaling/v2beta1&lt;/span&gt;
&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;HorizontalPodAutoscaler&lt;/span&gt;
&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;hpa-resource-metrics-memory&lt;/span&gt; 
&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;scaleTargetRef&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;apps/v1&lt;/span&gt; 
    &lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ReplicationController&lt;/span&gt; 
    &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;hello-hpa-memory&lt;/span&gt; 
  &lt;span class="nt"&gt;minReplicas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt; 
  &lt;span class="nt"&gt;maxReplicas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;10&lt;/span&gt; 
  &lt;span class="nt"&gt;metrics&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Resource&lt;/span&gt;
    &lt;span class="nt"&gt;resource&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;memory&lt;/span&gt;
      &lt;span class="nt"&gt;targetAverageUtilization&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;50&lt;/span&gt; 
&lt;/pre&gt;&lt;/div&gt;


&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‚æ•°&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;metadata.name&lt;/td&gt;
&lt;td&gt;è¿™ä¸ªhorizontal pod autoscaler å¯¹è±¡çš„åå­—&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;scaleTargetRef.apiVersion&lt;/td&gt;
&lt;td&gt;è¦æ‰©å±•çš„å¯¹è±¡çš„APIç‰ˆæœ¬&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kind&lt;/td&gt;
&lt;td&gt;è¦æ‰©å±•çš„å¯¹è±¡ç±»å‹&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;scaleTargetRef.name&lt;/td&gt;
&lt;td&gt;è¦ç¼©æ”¾çš„å¯¹è±¡çš„åç§°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;minReplicas&lt;/td&gt;
&lt;td&gt;å‘ä¸‹ç¼©å°æ—¶çš„æœ€å°å‰¯æœ¬æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;maxReplicas&lt;/td&gt;
&lt;td&gt;å‘ä¸Šæ‰©å±•æ—¶çš„æœ€å¤§å‰¯æœ¬æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;targetAverageUtilization&lt;/td&gt;
&lt;td&gt;æ¯ä¸ªpodåº”ä½¿ç”¨çš„è¯·æ±‚å†…å­˜çš„å¹³å‡ç™¾åˆ†æ¯”&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ol start="3"&gt;
&lt;li&gt;ç„¶åï¼Œä»ä¸Šé¢çš„æ–‡ä»¶åˆ›å»ºè‡ªåŠ¨ç¼©æ”¾å™¨ï¼š&lt;code&gt;$ oc create -f hpa.yaml&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;img align="absmiddle" alt="â—" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/2757.png" title=":exclamation:" width="20px"&gt;æ³¨æ„:&lt;/p&gt;
&lt;p&gt;è¦ä½¿åŸºäºå†…å­˜çš„è‡ªåŠ¨ç¼©æ”¾å·¥ä½œï¼Œå†…å­˜ä½¿ç”¨é‡å¿…é¡»ä¸å‰¯æœ¬è®¡æ•°æˆæ¯”ä¾‹åœ°å¢åŠ å’Œå‡å°‘ã€‚ä¸€èˆ¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å‰¯æœ¬è®¡æ•°çš„å¢åŠ å¿…ç„¶å¯¼è‡´æ¯ä¸ªpodçš„å†…å­˜ï¼ˆå·¥ä½œé›† working setï¼‰ä½¿ç”¨ç‡æ•´ä½“ä¸‹é™ã€‚&lt;/li&gt;
&lt;li&gt;å‰¯æœ¬è®¡æ•°çš„å‡å°‘å¿…ç„¶å¯¼è‡´æ¯ä¸ªpodçš„å†…å­˜ä½¿ç”¨é‡æ•´ä½“å¢åŠ ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä½¿ç”¨OpenShift Webæ§åˆ¶å°æ£€æŸ¥åº”ç”¨ç¨‹åºçš„å†…å­˜è¡Œä¸ºï¼Œå¹¶ç¡®ä¿åœ¨ä½¿ç”¨åŸºäºå†…å­˜çš„è‡ªåŠ¨ç¼©æ”¾ä¹‹å‰ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºæ»¡è¶³è¿™äº›è¦æ±‚ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="horizontal-pod-autoscaler"&gt;æŸ¥çœ‹Horizontal Pod Autoscaler&lt;a class="headerlink" href="#horizontal-pod-autoscaler" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;è¦æŸ¥çœ‹Horizontal Pod Autoscalerçš„çŠ¶æ€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;oc get&lt;/code&gt;å‘½ä»¤å¯ä»¥æŸ¥çœ‹æœ‰å…³CPUåˆ©ç”¨ç‡å’Œå®¹å™¨ limits çš„ä¿¡æ¯ï¼š&lt;/p&gt;
&lt;p&gt;&lt;code&gt;bash
$ oc get hpa/hpa-resource-metrics-cpu
NAME                         REFERENCE                                 TARGET    CURRENT  MINPODS        MAXPODS    AGE
hpa-resource-metrics-cpu     DeploymentConfig/default/frontend/scale   80%       79%      1              10         8d&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;è¾“å‡ºåŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›®æ ‡(Target)&lt;/strong&gt;ã€‚ç”±éƒ¨ç½²é…ç½®æ§åˆ¶(deployment configuration)çš„æ‰€æœ‰podçš„ç›®æ ‡å¹³å‡CPUåˆ©ç”¨ç‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Current&lt;/strong&gt;ã€‚ç”±éƒ¨ç½²é…ç½®(deployment configuration)æ§åˆ¶çš„æ‰€æœ‰podçš„å½“å‰CPUåˆ©ç”¨ç‡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Minpods/Maxpods&lt;/strong&gt;ã€‚autoscalerå¯ä»¥è®¾ç½®çš„æœ€å°å’Œæœ€å¤§å‰¯æœ¬æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;ä½¿ç”¨&lt;code&gt;oc describe&lt;/code&gt;å‘½ä»¤è·å–æœ‰å…³Horizontal Pod Autoscalerå¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ oc describe hpa/hpa-resource-metrics-cpu
Name:                           hpa-resource-metrics-cpu
Namespace:                      default
Labels:                         &amp;lt;none&amp;gt;
CreationTimestamp:              Mon, &lt;span class="m"&gt;26&lt;/span&gt; Oct &lt;span class="m"&gt;2015&lt;/span&gt; &lt;span class="m"&gt;21&lt;/span&gt;:13:47 -0400
Reference:                      DeploymentConfig/default/frontend/scale
Target CPU utilization:         &lt;span class="m"&gt;80&lt;/span&gt;% 
Current CPU utilization:        &lt;span class="m"&gt;79&lt;/span&gt;% 
Min replicas:                   &lt;span class="m"&gt;1&lt;/span&gt; 
Max replicas:                   &lt;span class="m"&gt;4&lt;/span&gt; 
ReplicationController pods:     &lt;span class="m"&gt;1&lt;/span&gt; current / &lt;span class="m"&gt;1&lt;/span&gt; desired
Conditions: 
  Type                  Status  Reason                  Message
  ----                  ------  ------                  -------
  AbleToScale           True    ReadyForNewScale        the last scale &lt;span class="nb"&gt;time&lt;/span&gt; was sufficiently old as to warrant a new scale
  ScalingActive         True    ValidMetricFound        the HPA was able to successfully calculate a replica count from pods metric http_requests
  ScalingLimited        False   DesiredWithinRange      the desired replica count is within the acceptable range
Events:
&lt;/pre&gt;&lt;/div&gt;


&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å‚æ•°&lt;/th&gt;
&lt;th&gt;è¯´æ˜&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Target CPU utilization&lt;/td&gt;
&lt;td&gt;æ¯ä¸ªpodåº”ä½¿ç”¨çš„è¯·æ±‚å†…å­˜çš„å¹³å‡ç™¾åˆ†æ¯”ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Current CPU utilization&lt;/td&gt;
&lt;td&gt;ç”±éƒ¨ç½²é…ç½®(deployment configuration)æ§åˆ¶çš„æ‰€æœ‰podçš„å½“å‰CPUåˆ©ç”¨ç‡ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Min replicas&lt;/td&gt;
&lt;td&gt;è¦ç¼©å°åˆ°çš„æœ€å°å‰¯æœ¬æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Max replicas&lt;/td&gt;
&lt;td&gt;è¦æ‰©å±•åˆ°çš„æœ€å¤§å‰¯æœ¬æ•°&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Conditions&lt;/td&gt;
&lt;td&gt;å¦‚æœå¯¹è±¡ä½¿ç”¨&lt;code&gt;v2alpha1&lt;/code&gt;APIï¼Œåˆ™æ˜¾ç¤º&lt;a href="https://docs.openshift.com/container-platform/3.11/dev_guide/pod_autoscaling.html#viewing-a-hpa-status"&gt;status conditions&lt;/a&gt;ã€‚&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="horizontal-pod-autoscaler-status-conditions"&gt;æŸ¥çœ‹Horizontal Pod Autoscaler Status Conditions&lt;a class="headerlink" href="#horizontal-pod-autoscaler-status-conditions" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;æ‚¨å¯ä»¥ä½¿ç”¨è®¾ç½®çš„çŠ¶æ€æ¡ä»¶(status conditions)æ¥ç¡®å®šHorizontal Pod Autoscaler æ˜¯å¦èƒ½å¤Ÿè¿›è¡Œç¼©æ”¾ä»¥åŠå½“å‰æ˜¯å¦ä»¥ä»»ä½•æ–¹å¼é™åˆ¶å®ƒã€‚&lt;/p&gt;
&lt;p&gt;è‡ªåŠ¨æ‰©å±•API &lt;code&gt;v2beta1&lt;/code&gt;çš„ç‰ˆæœ¬æä¾›Horizontal Pod Autoscaler Status Conditionsï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;kubernetesMasterConfig&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;...&lt;/span&gt;
  &lt;span class="l l-Scalar l-Scalar-Plain"&gt;apiServerArguments&lt;/span&gt;&lt;span class="p p-Indicator"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;runtime-config&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;apis/autoscaling/v2beta1=true&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è®¾ç½®ä»¥ä¸‹çŠ¶æ€æ¡ä»¶ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;AbleToScale&lt;/code&gt; æŒ‡ç¤ºHorizontal Pod Autoscaler æ˜¯å¦èƒ½å¤Ÿè·å–å’Œæ›´æ–° scalesï¼Œä»¥åŠæ˜¯å¦æœ‰ä»»ä½•backoff æ¡ä»¶é˜»æ­¢ç¼©æ”¾ã€‚&lt;ul&gt;
&lt;li&gt;&lt;code&gt;True&lt;/code&gt;è¡¨ç¤ºç¼©æ”¾æ˜¯å…è®¸çš„ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;False&lt;/code&gt;è¡¨ç¤ºå¯¹æŒ‡å®šçš„åŸå› ç¼©æ”¾ä¸å…è®¸ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ScalingActive&lt;/code&gt; æŒ‡ç¤ºæ˜¯å¦å¯ç”¨Horizontal Pod Autoscaler ï¼ˆç›®æ ‡çš„å‰¯æœ¬è®¡æ•°ä¸ä¸ºé›¶ï¼‰å¹¶ä¸”èƒ½å¤Ÿè®¡ç®—æ‰€éœ€çš„æ¯”ä¾‹ã€‚&lt;ul&gt;
&lt;li&gt;&lt;code&gt;True&lt;/code&gt;çŠ¶æ€è¡¨ç¤ºåº¦é‡å·¥ä½œæ­£å¸¸ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;False&lt;/code&gt;æ¡ä»¶é€šå¸¸è¡¨æ˜ä¸è·å–æŒ‡æ ‡æ—¶é‡åˆ°é—®é¢˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ScalingLimited&lt;/code&gt; è¡¨ç¤ºä¸å…è®¸è‡ªåŠ¨ç¼©æ”¾ï¼Œå› ä¸ºè¾¾åˆ°äº†æœ€å¤§æˆ–æœ€å°å‰¯æœ¬è®¡æ•°ã€‚&lt;ul&gt;
&lt;li&gt;&lt;code&gt;True&lt;/code&gt;æ¡ä»¶è¡¨æ˜ï¼Œä¸ºäº†è¿›è¡Œç¼©æ”¾ä½ éœ€è¦æé«˜æˆ–é™ä½æœ€å°æˆ–æœ€å¤§å‰¯æœ¬æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;False&lt;/code&gt;çŠ¶æ€è¡¨æ˜è¯·æ±‚çš„æ¯”ä¾‹æ˜¯å…è®¸çš„ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;å¦‚æœæ‚¨éœ€è¦æ·»åŠ æˆ–ç¼–è¾‘æ­¤è¡Œï¼Œè¯·é‡æ–°å¯åŠ¨OpenShift Container PlatformæœåŠ¡ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;#master-restart api&lt;/span&gt;
&lt;span class="c1"&gt;#master-restart controllers&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;è¦æŸ¥çœ‹å½±å“Horizontal Pod Autoscaler çš„æ¡ä»¶ï¼Œè¯·ä½¿ç”¨&lt;code&gt;oc describe hpa&lt;/code&gt;ã€‚æ¡ä»¶å‡ºç°åœ¨&lt;code&gt;status.conditions&lt;/code&gt;å­—æ®µä¸­ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ oc describe hpa cm-test
Name:                           cm-test
Namespace:                      prom
Labels:                         &amp;lt;none&amp;gt;
Annotations:                    &amp;lt;none&amp;gt;
CreationTimestamp:              Fri, &lt;span class="m"&gt;16&lt;/span&gt; Jun &lt;span class="m"&gt;2017&lt;/span&gt; &lt;span class="m"&gt;18&lt;/span&gt;:09:22 +0000
Reference:                      ReplicationController/cm-test
Metrics:                        &lt;span class="o"&gt;(&lt;/span&gt; current / target &lt;span class="o"&gt;)&lt;/span&gt;
  &lt;span class="s2"&gt;&amp;quot;http_requests&amp;quot;&lt;/span&gt; on pods:      66m / 500m
Min replicas:                   &lt;span class="m"&gt;1&lt;/span&gt;
Max replicas:                   &lt;span class="m"&gt;4&lt;/span&gt;
ReplicationController pods:     &lt;span class="m"&gt;1&lt;/span&gt; current / &lt;span class="m"&gt;1&lt;/span&gt; desired
Conditions: 
  Type                  Status  Reason                  Message
  ----                  ------  ------                  -------
  AbleToScale       True      ReadyForNewScale    the last scale &lt;span class="nb"&gt;time&lt;/span&gt; was sufficiently old as to warrant a new scale
  ScalingActive     True      ValidMetricFound    the HPA was able to successfully calculate a replica count from pods metric http_request
  ScalingLimited    False     DesiredWithinRange  the desired replica count is within the acceptable range
Events:
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Horizontal Pod Autoscaler Status Conditions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;AbleToScale&lt;/code&gt;æ¡ä»¶æŒ‡ç¤ºHPAæ˜¯å¦èƒ½å¤Ÿè·å–å’Œæ›´æ–°æ¯”ä¾‹ï¼Œä»¥åŠä»»ä½•ä¸backoffç›¸å…³çš„æ¡ä»¶æ˜¯å¦ä¼šé˜»æ­¢æ‰©å±•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ScalingActive&lt;/code&gt;çŠ¶å†µæŒ‡ç¤ºHPAæ˜¯å¦è¢«å¯ç”¨ï¼ˆä¾‹å¦‚ï¼Œç›®æ ‡çš„å‰¯æœ¬æ•°ä¸ä¸ºé›¶ï¼‰ï¼Œå¹¶èƒ½å¤Ÿè®¡ç®—æ‰€éœ€çš„scalesã€‚&lt;code&gt;False&lt;/code&gt;çŠ¶æ€é€šå¸¸è¡¨ç¤ºè·å–æŒ‡æ ‡çš„é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ScalingLimited&lt;/code&gt;æ¡ä»¶æŒ‡ç¤ºæœŸæœ›scaleç”±Horizontal Pod Autoscalerçš„æœ€å¤§æˆ–æœ€å°ä¸Šé™ã€‚&lt;code&gt;True&lt;/code&gt;çŠ¶æ€ä¸€èˆ¬é¢„ç¤ºç€ä½ å¯èƒ½éœ€è¦åœ¨ä½ çš„æ°´å¹³èšè‡ªåŠ¨é…ç½®å™¨å‡é«˜æˆ–é™ä½çš„æœ€å°æˆ–æœ€å¤§å‰¯æœ¬æ•°é‡çš„é™åˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä»¥ä¸‹æ˜¯æ— æ³•æ‰©å±•çš„podçš„ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Conditions&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
  &lt;span class="n"&gt;Type&lt;/span&gt;           &lt;span class="n"&gt;Status&lt;/span&gt;    &lt;span class="n"&gt;Reason&lt;/span&gt;            &lt;span class="n"&gt;Message&lt;/span&gt;
  &lt;span class="o"&gt;----&lt;/span&gt;           &lt;span class="o"&gt;------&lt;/span&gt;    &lt;span class="o"&gt;------&lt;/span&gt;            &lt;span class="o"&gt;-------&lt;/span&gt;
  &lt;span class="n"&gt;AbleToScale&lt;/span&gt;    &lt;span class="n"&gt;False&lt;/span&gt;     &lt;span class="n"&gt;FailedGetScale&lt;/span&gt;    &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;HPA&lt;/span&gt; &lt;span class="n"&gt;controller&lt;/span&gt; &lt;span class="n"&gt;was&lt;/span&gt; &lt;span class="n"&gt;unable&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="kd"&gt;get&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="n"&gt;current&lt;/span&gt; &lt;span class="n"&gt;scale&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;replicationcontrollers&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="n"&gt;scale&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="na"&gt;extensions&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;hello-hpa-cpu&amp;quot;&lt;/span&gt; &lt;span class="n"&gt;not&lt;/span&gt; &lt;span class="n"&gt;found&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä»¥ä¸‹æ˜¯æ— æ³•è·å–ç¼©æ”¾æ‰€éœ€podçš„æŒ‡æ ‡ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Conditions&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
  &lt;span class="n"&gt;Type&lt;/span&gt;                  &lt;span class="n"&gt;Status&lt;/span&gt;    &lt;span class="n"&gt;Reason&lt;/span&gt;                    &lt;span class="n"&gt;Message&lt;/span&gt;
  &lt;span class="o"&gt;----&lt;/span&gt;                  &lt;span class="o"&gt;------&lt;/span&gt;    &lt;span class="o"&gt;------&lt;/span&gt;                    &lt;span class="o"&gt;-------&lt;/span&gt;
  &lt;span class="n"&gt;AbleToScale&lt;/span&gt;           &lt;span class="n"&gt;True&lt;/span&gt;     &lt;span class="n"&gt;SucceededGetScale&lt;/span&gt;          &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;HPA&lt;/span&gt; &lt;span class="n"&gt;controller&lt;/span&gt; &lt;span class="n"&gt;was&lt;/span&gt; &lt;span class="n"&gt;able&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="kd"&gt;get&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;target&lt;/span&gt;&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="n"&gt;current&lt;/span&gt; &lt;span class="n"&gt;scale&lt;/span&gt;
  &lt;span class="n"&gt;ScalingActive&lt;/span&gt;         &lt;span class="n"&gt;False&lt;/span&gt;    &lt;span class="n"&gt;FailedGetResourceMetric&lt;/span&gt;    &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;HPA&lt;/span&gt; &lt;span class="n"&gt;was&lt;/span&gt; &lt;span class="n"&gt;unable&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;compute&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;replica&lt;/span&gt; &lt;span class="n"&gt;count&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;unable&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="kd"&gt;get&lt;/span&gt; &lt;span class="n"&gt;metrics&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;resource&lt;/span&gt; &lt;span class="n"&gt;cpu&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="n"&gt;no&lt;/span&gt; &lt;span class="n"&gt;metrics&lt;/span&gt; &lt;span class="n"&gt;returned&lt;/span&gt; &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="n"&gt;heapster&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;ä»¥ä¸‹æ˜¯è¯·æ±‚çš„è‡ªåŠ¨ç¼©æ”¾å°äºæ‰€éœ€æœ€å°å€¼çš„podç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;Conditions&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
  &lt;span class="n"&gt;Type&lt;/span&gt;              &lt;span class="n"&gt;Status&lt;/span&gt;    &lt;span class="n"&gt;Reason&lt;/span&gt;              &lt;span class="n"&gt;Message&lt;/span&gt;
  &lt;span class="o"&gt;----&lt;/span&gt;              &lt;span class="o"&gt;------&lt;/span&gt;    &lt;span class="o"&gt;------&lt;/span&gt;              &lt;span class="o"&gt;-------&lt;/span&gt;
  &lt;span class="n"&gt;AbleToScale&lt;/span&gt;       &lt;span class="n"&gt;True&lt;/span&gt;      &lt;span class="n"&gt;ReadyForNewScale&lt;/span&gt;    &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt; &lt;span class="n"&gt;scale&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="n"&gt;was&lt;/span&gt; &lt;span class="n"&gt;sufficiently&lt;/span&gt; &lt;span class="n"&gt;old&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;warrant&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="k"&gt;new&lt;/span&gt; &lt;span class="n"&gt;scale&lt;/span&gt;
  &lt;span class="n"&gt;ScalingActive&lt;/span&gt;     &lt;span class="n"&gt;True&lt;/span&gt;      &lt;span class="n"&gt;ValidMetricFound&lt;/span&gt;    &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;HPA&lt;/span&gt; &lt;span class="n"&gt;was&lt;/span&gt; &lt;span class="n"&gt;able&lt;/span&gt; &lt;span class="n"&gt;to&lt;/span&gt; &lt;span class="n"&gt;successfully&lt;/span&gt; &lt;span class="n"&gt;calculate&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="n"&gt;replica&lt;/span&gt; &lt;span class="n"&gt;count&lt;/span&gt; &lt;span class="n"&gt;from&lt;/span&gt; &lt;span class="n"&gt;pods&lt;/span&gt; &lt;span class="n"&gt;metric&lt;/span&gt; &lt;span class="n"&gt;http_request&lt;/span&gt;
  &lt;span class="n"&gt;ScalingLimited&lt;/span&gt;    &lt;span class="n"&gt;False&lt;/span&gt;     &lt;span class="n"&gt;DesiredWithinRange&lt;/span&gt;  &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;desired&lt;/span&gt; &lt;span class="n"&gt;replica&lt;/span&gt; &lt;span class="n"&gt;count&lt;/span&gt; &lt;span class="k"&gt;is&lt;/span&gt; &lt;span class="n"&gt;within&lt;/span&gt; &lt;span class="n"&gt;the&lt;/span&gt; &lt;span class="n"&gt;acceptable&lt;/span&gt; &lt;span class="n"&gt;range&lt;/span&gt;
&lt;span class="n"&gt;Events&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Tue, 14 May 2019 22:06:59 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-05-14:/openshift-pod-autoscaling.html</guid><category>openshift</category><category>containers</category><category>docker</category><category>k8s</category></item><item><title>OpenShift å’Œ Kubernetes æœ‰ä»€ä¹ˆåŒºåˆ«?</title><link>https://www.EWhisper.cn/openshift-and-kubernetes-whats-difference.html</link><description>&lt;p&gt;OpenShift 3ä»¥å, æ¶æ„å®Œå…¨åŸºäºK8Sè¿›è¡Œäº†é‡æ„, ä½†æ˜¯åˆæœ‰ä¸€äº›å·®å¼‚. ä»Šå¤©, æˆ‘ä»¬å°±æ·±å…¥ç ”ç©¶ä¸€ä¸‹.&lt;/p&gt;
&lt;h2 id="k8s"&gt;K8S æ˜¯"å†…æ ¸"&lt;a class="headerlink" href="#k8s" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;K8Så¯ä»¥è®¤ä¸ºæ˜¯å½“ä»£åˆ†å¸ƒå¼ç³»ç»Ÿçš„"å†…æ ¸". æˆ‘ä»¬æ„è¯†åˆ°, ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„ä½œä¸šè°ƒåº¦ç¨‹åº, è·¨å¤šå°åŠå…¶è¿è¡Œ, èƒ½å¤Ÿåè°ƒæ‰˜ç®¡åœ¨éª‘ä¸Šçš„å·¥ä½œè´Ÿè½½çš„çŠ¶æ€, è‡ªç„¶å°±ä¼šä¿ƒè¿›å†™ä½œ, å°±åƒLinuxå†…æ ¸ä¸ºå•ä¸ªä¸»æœºä¸Šè°ƒåº¦å·¥ä½œè´Ÿè½½æ‰€åšçš„é‚£æ ·. éµå¾ªè¿™ä¸€é€»è¾‘, æˆ‘ä»¬çŸ¥é“ä¸åŒçš„äº§å“ä¼šæ ¹æ®é’ˆå¯¹ç”¨æˆ·çš„ä¸åŒè€Œå·®å¼‚åŒ–åœ°æ‰“é€ .&lt;/p&gt;
&lt;p&gt;åœ¨å¾ˆå¤šæ‰‹æœº, ç”µè„‘, æœåŠ¡å™¨, ç”šè‡³æ˜¯æ ‘è“æ´¾ä¸Š, è¿è¡Œçš„éƒ½æ˜¯ç›¸åŒçš„Linux å†…æ ¸, ä½†æ˜¯é€šè¿‡ä¸åŒçš„ä¸å®šæ¥æ”¯æŒå¤šç§å¤šæ ·çš„ç¡¬ä»¶.&lt;/p&gt;
&lt;p&gt;K8Så’Œå„ç§å„æ ·çš„K8Så‘è¡Œç‰ˆä¹Ÿé€‚ç”¨äºåŒæ ·çš„æ¨¡å‹, é€šè¿‡ä¸åŒç±»å‹çš„è¡¥ä¸, æ¥æ”¯æŒåœ¨K8Sä¸Šé¢çš„ä¸€å±‚. &lt;/p&gt;
&lt;h2 id="openshift"&gt;OpenShift æ˜¯å‘è¡Œç‰ˆ&lt;a class="headerlink" href="#openshift" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;è¿™æ˜¯ä¸€ä¸ªå¼ºæœ‰åŠ›çš„åŒºåˆ«ã€‚OpenShiftå°±æ˜¯Kubernetesçš„å‘è¡Œç‰ˆï¼Œä¸“æ³¨äºå¼€å‘äººå‘˜çš„ä½“éªŒï¼Œè€Œå¼€å‘äººå‘˜éœ€è¦å¼€å‘ä¸‹ä¸€ä»£äº‘åŸç”Ÿåº”ç”¨ç¨‹åºã€‚&lt;/p&gt;
&lt;p&gt;è™½ç„¶ä»»ä½•äººéƒ½å¯ä»¥é€šè¿‡é€‰æ‹©æ¯1ä¸ªéƒ¨åˆ†å¹¶æŒ‰ç…§æ¯ä¸ªç”¨æˆ·é€‰æ‹©çš„å®šåˆ¶æ–¹å¼ç»„è£…å®ƒä»¬æ¥&lt;a href="http://www.linuxfromscratch.org/"&gt;ä»Scratch &lt;/a&gt;æ„å»º&lt;a href="http://www.linuxfromscratch.org/"&gt;Linux&lt;/a&gt;ï¼Œä½†å¤§å¤šæ•°äººéƒ½æ²¡æœ‰ã€‚å¤§å¤šæ•°ç”¨æˆ·é€‰æ‹©çš„æŠ½è±¡çº§åˆ«æ„å‘³ç€ä»–ä»¬ä¸ä¼šä»ç®¡ç†ï¼ˆç”šè‡³äº†è§£ï¼‰Util-Linuxç‰ˆæœ¬2.31å’Œ2.33ä¹‹é—´çš„å·®å¼‚ä¸­è·å¾—å¾ˆå¤šä»·å€¼ã€‚ä¸ºäº†æ›´è¿›ä¸€æ­¥ï¼Œç”¨æˆ·å…³å¿ƒæœ€ä½çº§åˆ«çš„åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œåªè¦è¶…è¿‡æœ€å°ç‰ˆæœ¬å·ï¼Œä»–ä»¬å°±çŸ¥é“å“ªäº›å‘½ä»¤/ APIå¯ç”¨ï¼‰ï¼Œç„¶åæä¾›æ‰€æä¾›åŠŸèƒ½çš„åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸OpenShiftéå¸¸ç›¸ä¼¼ã€‚OpenShiftå°†Kubernetesæ‰“åŒ…å¹¶åŒ…å«å…¶ä»–å·¥å…·ä½œä¸ºOpenShiftè®¤ä¸ºé‡è¦ä¸”OpenShiftçš„ç”¨æˆ·éœ€æ±‚çš„åŠŸèƒ½ã€‚å°±åƒCoreOSå’ŒCentOSåŒ…å«ä¸åŒçš„å·¥å…·é›†ä¸€æ ·ï¼Œè¿åˆä¸åŒçš„ç”¨æˆ·ï¼Œå› æ­¤Kuberneteså‘è¡Œç‰ˆä¹Ÿæ˜¯å¦‚æ­¤ã€‚&lt;/p&gt;
&lt;h2 id="openshiftk8s"&gt;OpenShiftå’ŒK8Sçš„å…·ä½“åŒºåˆ«&lt;a class="headerlink" href="#openshiftk8s" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id="openshift_1"&gt;OpenShift æ¶æ„æ¦‚è¿°&lt;a class="headerlink" href="#openshift_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;OpenShiftå®¹å™¨å¹³å°æ˜¯ä¸€ç³»åˆ—æµè¡Œçš„ç»„ä»¶å’ŒæœåŠ¡çš„é›†åˆä½“, æ„å»ºäºRed Hat Enterprise Linux, Docker, å’ŒK8Sä¹‹ä¸Š. OpenShifté’ˆå¯¹å¼€å‘äººå‘˜, å¢å¼ºäº†ä»¥ä¸‹åŠŸèƒ½: &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è¿œç¨‹ç®¡ç†&lt;/li&gt;
&lt;li&gt;å¤šç§Ÿæˆ·&lt;/li&gt;
&lt;li&gt;å®‰å…¨æ€§å¢å¼º&lt;/li&gt;
&lt;li&gt;åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†&lt;/li&gt;
&lt;li&gt;è‡ªæœåŠ¡æ¥å£&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img alt="OpenShift æ¶æ„" src="./images/openshift-architecture-overview.png"&gt;&lt;/p&gt;
&lt;p&gt;åœ¨ä¸Šå›¾ä¸­, ä»ä¸‹è‡³ä¸Š, ä»å·¦è‡³å³, å±•ç¤ºäº†ç»è¿‡Red Hat åœ¨åŸºæœ¬çš„å®¹å™¨æ¶æ„åŸºç¡€ä¸Šè¿›ä¸€æ­¥é›†æˆã€å¢å¼ºçš„æ¶æ„:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åŸºæœ¬OSæ˜¯Red Hat Enterprise Linux (RHEL)&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Docker&lt;/strong&gt;  æä¾›äº†åŸºæœ¬çš„å®¹å™¨ç®¡ç†APIå’Œå®¹å™¨é•œåƒæ–‡ä»¶æ ¼å¼&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kubernetes&lt;/strong&gt; ç®¡ç†è¿è¡Œå®¹å™¨çš„ä¸»æœºé›†ç¾¤(å®ä½“çš„æˆ–è™šæ‹Ÿçš„). å®ƒé€šè¿‡èµ„æº(resources)æ¥æè¿°å¤šå®¹å™¨åº”ç”¨æ˜¯ç”±å¤šä¸ªèµ„æºç»„æˆçš„, ä»¥åŠä»–ä»¬é—´å¦‚ä½•äº¤äº’&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Etcd&lt;/strong&gt; æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ key-value å­˜å‚¨, Kubernetes é€šè¿‡å®ƒæ¥å­˜å‚¨é›†ç¾¤å†…çš„å…³äºå®¹å™¨å’Œå…¶ä»–èµ„æºçš„é…ç½®å’ŒçŠ¶æ€ä¿¡æ¯.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨Docker + Kubernetes ä¹‹ä¸Š, OpenShiftå¢åŠ äº†å®¹å™¨å¹³å°æ‰€éœ€è¦çš„å…¶ä»–åŠŸèƒ½. å…·ä½“åŒ…æ‹¬:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;OpenShift-Kubernetes æ‰©å±•&lt;/strong&gt; æ˜¯å­˜å‚¨åœ¨Etcdä¸­, ç”±Kubernetesç®¡ç†çš„é¢å¤–çš„èµ„æºç±»å‹(resource types). è¿™äº›é¢å¤–çš„èµ„æºç±»å‹ç»„æˆäº†OpenShift å†…éƒ¨çŠ¶æ€å’Œé…ç½®, è¿˜æœ‰åº”ç”¨çš„èµ„æº.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®¹å™¨åŒ–æœåŠ¡&lt;/strong&gt; å……å®äº†å¾ˆå¤šåŸºç¡€æ¶æ„åŠŸèƒ½, æ¯”å¦‚ç½‘ç»œå’Œè®¤è¯. è¿™äº›åŠŸèƒ½æœ‰äº›æ˜¯ä¸€ç›´è¿è¡Œçš„, æœ‰äº›æ˜¯æŒ‰éœ€å¯åŠ¨çš„. &lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿è¡Œæ—¶å’ŒxPaaS&lt;/strong&gt; æ˜¯ä¸ºå¼€å‘è€…å‡†å¤‡å¥½çš„å®¹å™¨é•œåƒ, æ¯ä¸ªéƒ½é¢„é…ç½®äº†ç‰¹å®šçš„è¯­è¨€è¿è¡Œæ—¶æˆ–æ•°æ®åº“. å¯ä»¥è¢«ç”¨ä½œé•œåƒæµ(Image Stream)æˆ–åœ¨æ­¤åŸºç¡€ä¸Šå¢åŠ ä¸åŒçš„æ¡†æ¶, åº“, ç”šè‡³æ˜¯ä¸­é—´ä»¶æ¥è¿›è¡Œæ‰©å±•. xPaaS æä¾›äº†ä¸€ç³»åˆ—JBossä¸­é—´ä»¶äº§å“çš„åŸºç¡€é•œåƒ, å¦‚: JBoss EAP å’Œ ActiveMQ.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;DevOps å·¥å…·é›†å’Œç”¨æˆ·ä½“éªŒ&lt;/strong&gt;: OpenShift ä¸ºå¼€å‘äººå‘˜å’Œç³»ç»Ÿç®¡ç†å‘˜æä¾›äº†ä¸€ä¸ªWeb UIå’ŒCLI ç®¡ç†å·¥å…·, å…è®¸é…ç½®å’Œç›‘æ§åº”ç”¨å’ŒOpenShiftçš„æœåŠ¡å’Œèµ„æº. Webå’Œ CLI éƒ½æ˜¯åŸºäºç›¸åŒçš„REST API, è¿™ä¸ªAPIä¹Ÿå¯ä»¥è¢«å¤–éƒ¨å·¥å…·(å¦‚: IDEå’ŒCIå¹³å°)æ•´åˆ. OpenShiftä¹Ÿå¯ä»¥è®¿é—®å¤–éƒ¨SCMåº“å’Œå®¹å™¨é•œåƒåº“.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;img align="absmiddle" alt="ğŸ““" class="emojione" height="20px" src="https://cdn.jsdelivr.net/emojione/assets/4.0/png/64/1f4d3.png" title=":notebook:" width="20px"&gt; å¤‡æ³¨:&lt;/p&gt;
&lt;p&gt;OpenShift å›¢é˜Ÿ:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å¸®åŠ©K8S å®Œæˆäº†Namespace å’Œ quotaåŠŸèƒ½çš„å¼€å‘;&lt;/li&gt;
&lt;li&gt;æ¨åŠ¨äº†RBAC æˆæƒè®¤è¯çš„å¼€å‘&lt;/li&gt;
&lt;li&gt;å¸®åŠ©K8Sè¿è¡Œæ›´å¤šç±»å‹çš„åº”ç”¨, å¹¶ä¸ºå…¶å¼€å‘äº†ä¸€äº›å·æ’ä»¶(Volume Plugin)&lt;/li&gt;
&lt;li&gt;ç›¸æ¯”K8S, å¤šäº†Deployment Config(DC) resource. ä½¿ç”¨è¯¥èµ„æºå¯ä»¥è¿›è¡Œå‚æ•°åŒ–éƒ¨ç½², æ‰§è¡Œæ»šåŠ¨éƒ¨ç½²å’Œå›æ»šç­‰.&lt;/li&gt;
&lt;li&gt;ç›¸æ¯”K8S, å¤šäº†Route resource. è€ŒRouterä¹Ÿæ˜¯K8Sçš„IngressåŠŸèƒ½çš„å‰èº«.&lt;/li&gt;
&lt;li&gt;ç›¸æ¯”K8S, é»˜è®¤é›†æˆäº†SDN (Open vSwitch)&lt;/li&gt;
&lt;li&gt;ç›¸æ¯”K8S, å®ç°äº†å¼€å‘è¿ç»´ä¸€ä½“åŒ–.&lt;/li&gt;
&lt;li&gt;çº³å…¥CoreOS&lt;/li&gt;
&lt;li&gt;OpenShift 3.11, é›†æˆäº†Prometheuså’ŒGrafana&lt;/li&gt;
&lt;li&gt;ç›¸æ¯”K8S, å¢å¼ºäº†ç®¡ç†ç‰©ç†èŠ‚ç‚¹çš„èƒ½åŠ›&lt;/li&gt;
&lt;li&gt;ç›®å‰, OpenShiftè¿˜å’ŒNVåˆä½œ, æœªæ¥ä¼šæä¾›åŸºäºGPUè¿ç®—èƒ½åŠ›çš„æ”¯æŒ.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h3 id="_1"&gt;èµ„æºç±»å‹å·®å¼‚&lt;a class="headerlink" href="#_1" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Kubernetes èµ„æºç±»å‹&lt;/strong&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Pods&lt;/li&gt;
&lt;li&gt;Services&lt;/li&gt;
&lt;li&gt;Replication Controllers&lt;/li&gt;
&lt;li&gt;Persistent Volume (PV)&lt;/li&gt;
&lt;li&gt;Persistent Volume Claims (PVC)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;OpenShift èµ„æºç±»å‹&lt;/strong&gt;:&lt;/p&gt;
&lt;p&gt;é™¤äº†ä»¥ä¸Šèµ„æºç±»å‹, OpenShift è¿˜å¢åŠ äº†ä»¥ä¸‹ä¸»è¦çš„èµ„æºç±»å‹:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Deployment Configurations (DC) - ç”¨äº æŒç»­äº¤ä»˜(CD)å·¥ä½œæµ&lt;/li&gt;
&lt;li&gt;Build Configurations (BC) - ç”¨äº æŒç»­é›†æˆ(CI) å·¥ä½œæµ&lt;/li&gt;
&lt;li&gt;Routes - åŸºäºHAProxy, ä½œç”¨ç±»ä¼¼äºK8S Ingress, ä½†æ—©äºIngress.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="openshift-s2i"&gt;OpenShift ç‰¹æœ‰çš„S2I åŠŸèƒ½&lt;a class="headerlink" href="#openshift-s2i" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;OpenShiftä¸­çš„Source-to-Image (S2I) è¿›ç¨‹ä¼šä»SCMä»“åº“ä¸­æ‹‰å–ä»£ç , è‡ªåŠ¨åŒ–ç›‘æµ‹ä»£ç éœ€è¦å“ªç§ç±»å‹çš„è¿è¡Œæ—¶, å¹¶ä»ç‰¹å®šè¿è¡Œæ—¶çš„åŸºç¡€é•œåƒå¯åŠ¨ä¸€ä¸ªpod. åœ¨è¿™ä¸ªpod ä¸­, OpenShift ä»¥å¼€å‘äººå‘˜ç›¸åŒçš„æ–¹å¼æ¥æ„å»ºè¯¥åº”ç”¨(å¦‚, ä½¿ç”¨&lt;strong&gt;maven&lt;/strong&gt;æ¥æ„å»ºjavaç¨‹åº). å¦‚æœæ„å»ºæˆåŠŸ, å¦ä¸€ä¸ªé•œåƒä¼šè¢«åˆ›å»º, æŠŠåº”ç”¨äºŒè¿›åˆ¶é™„åŠ åˆ°è¿è¡Œæ—¶å±‚ä¹‹ä¸Š, å¹¶æŠŠè¿™ä¸ªæ–°é•œåƒæ¨é€åˆ°OpenShiftçš„å†…éƒ¨é•œåƒä»“åº“ä¸­. æ¥ä¸‹æ¥, å¯ä»¥ä»è¿™ä¸ªæ–°é•œåƒåˆ›å»ºä¸€ä¸ªpodæ¥è¿è¡Œè¯¥åº”ç”¨. S2I å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªåµŒå…¥åˆ°OpenShiftå¹³å°ä¸­çš„ CI/CD pipeline.&lt;/p&gt;
&lt;p&gt;CI/CD pipelines ä¼šæœ‰å¾ˆå¤šç§å˜å¼‚, è¿™ä¸ªpipelineä¼šæš´éœ²åœ¨è¿™ä¸ªé¡¹ç›®(project, å°±æ˜¯K8Sçš„namespace)ä¸­, é‚£ä¹ˆå®ƒå°±å¯ä»¥è¢«è°ƒèŠ‚æ¥æ»¡è¶³å¼€å‘äººå‘˜çš„éœ€æ±‚. ä¾‹å¦‚, å¤–éƒ¨CIå·¥å…·(å¦‚Jenkins)å¯ä»¥ç”¨äºæ¥å¯åŠ¨å’Œè¿è¡Œæµ‹è¯•, ç„¶åç»™æ–°é•œåƒæ‰“ä¸Š"æˆåŠŸ"æˆ–"å¤±è´¥"çš„æ ‡ç­¾(label), å¹¶æ¨é€åˆ°QAæˆ–ç”Ÿäº§ç¯å¢ƒ. éšç€æ—¶é—´æ¨ç§», ä¸€ä¸ªç»„ç»‡ä¸€ä¸ªéƒ¨é—¨ä¸€ä¸ªå…¬å¸å¯ä»¥åˆ›å»ºä»–ä»¬è‡ªå·±çš„pipelineæ¨¡æ¿, åŒ…æ‹¬è‡ªå®šä¹‰çš„æ„å»ºå™¨å’Œéƒ¨ç½²å™¨.&lt;/p&gt;
&lt;h2 id="_2"&gt;æ€»ç»“&lt;a class="headerlink" href="#_2" title="Permanent link"&gt;&amp;para;&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;OpenShift å¹³å°ç›¸æ¯”K8S, å…·æœ‰ä»¥ä¸‹ç‰¹æ€§:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;è‡ªæœåŠ¡å¹³å°;&lt;/li&gt;
&lt;li&gt;å¤šè¯­è¨€, å¤šä¸­é—´ä»¶, æ•°æ®åº“æ”¯æŒ&lt;/li&gt;
&lt;li&gt;é«˜å¯ç”¨, å¯ä¼¸ç¼©æ€§&lt;/li&gt;
&lt;li&gt;ä¹Ÿæ˜¯å¼€æºçš„(Red Hatæ”¶å–æœåŠ¡è´¹)&lt;/li&gt;
&lt;li&gt;å®‰å…¨ (åŸºäº: RBAC, LDAP, ä¸»æœº, ç½‘ç»œ, å®¹å™¨å„ä¸ªå±‚é¢çš„åŠ å›º)&lt;/li&gt;
&lt;li&gt;åŠ¨æ€å­˜å‚¨ç®¡ç†&lt;/li&gt;
&lt;li&gt;ä¼ä¸šçº§&lt;/li&gt;
&lt;li&gt;æ—¥å¿—æ•´åˆ/ ç›‘æ§æ•´åˆ&lt;/li&gt;
&lt;/ul&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">ä¸œé£å¾®é¸£</dc:creator><pubDate>Fri, 03 May 2019 16:51:34 +0800</pubDate><guid isPermaLink="false">tag:www.ewhisper.cn,2019-05-03:/openshift-and-kubernetes-whats-difference.html</guid><category>docker</category><category>openshift</category><category>k8s</category><category>containers</category><category>PAAS</category></item></channel></rss>